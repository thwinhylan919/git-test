/*!
 * Copyright (c) 2018 Oracle. All rights reserved.
 *
 * This material is the confidential property of Oracle Corporation or its
 * licensors and may be used, reproduced, stored or transmitted only in
 * accordance with a valid Oracle license or sublicense agreement.
 */

/*! Oracle Live Experience JS API (Built on: 2019-12-10)
 * version: [support/19.11.2 @ 66603d972d1f37e61f88c512e6016248cc7cd18a] */

var liveRequire;!function(){var requirejs,require,define;liveRequire&&liveRequire.requirejs||(liveRequire?require=liveRequire:liveRequire={},function(global,setTimeout){function commentReplace(e,t){return t||""}function isFunction(e){return"[object Function]"===ostring.call(e)}function isArray(e){return"[object Array]"===ostring.call(e)}function each(e,t){var i;if(e)for(i=0;i<e.length&&(!e[i]||!t(e[i],i,e));i+=1);}function eachReverse(e,t){var i;if(e)for(i=e.length-1;i>-1&&(!e[i]||!t(e[i],i,e));i-=1);}function hasProp(e,t){return hasOwn.call(e,t)}function getOwn(e,t){return hasProp(e,t)&&e[t]}function eachProp(e,t){var i;for(i in e)if(hasProp(e,i)&&t(e[i],i))break}function mixin(e,t,i,o){return t&&eachProp(t,function(t,n){!i&&hasProp(e,n)||(!o||"object"!=typeof t||!t||isArray(t)||isFunction(t)||t instanceof RegExp?e[n]=t:(e[n]||(e[n]={}),mixin(e[n],t,i,o)))}),e}function bind(e,t){return function(){return t.apply(e,arguments)}}function scripts(){return document.getElementsByTagName("script")}function defaultOnError(e){throw e}function getGlobal(e){if(!e)return e;var t=global;return each(e.split("."),function(e){t=t[e]}),t}function makeError(e,t,i,o){var n=new Error(t+"\nhttp://requirejs.org/docs/errors.html#"+e);return n.requireType=e,n.requireModules=o,i&&(n.originalError=i),n}function newContext(e){function t(e,t,i){var o,n,a,r,s,l,c,d,u,h,p=t&&t.split("/"),v=b.map,g=v&&v["*"];if(e&&(l=(e=e.split("/")).length-1,b.nodeIdCompat&&jsSuffixRegExp.test(e[l])&&(e[l]=e[l].replace(jsSuffixRegExp,"")),"."===e[0].charAt(0)&&p&&(e=p.slice(0,p.length-1).concat(e)),function(e){var t,i;for(t=0;t<e.length;t++)if("."===(i=e[t]))e.splice(t,1),t-=1;else if(".."===i){if(0===t||1===t&&".."===e[2]||".."===e[t-1])continue;t>0&&(e.splice(t-1,2),t-=2)}}(e),e=e.join("/")),i&&v&&(p||g)){n=e.split("/");e:for(a=n.length;a>0;a-=1){if(s=n.slice(0,a).join("/"),p)for(r=p.length;r>0;r-=1)if((o=getOwn(v,p.slice(0,r).join("/")))&&(o=getOwn(o,s))){c=o,d=a;break e}!u&&g&&getOwn(g,s)&&(u=getOwn(g,s),h=a)}!c&&u&&(c=u,d=h),c&&(n.splice(0,d,c),e=n.join("/"))}return getOwn(b.pkgs,e)||e}function i(e){isBrowser&&each(scripts(),function(t){if(t.getAttribute("data-requiremodule")===e&&t.getAttribute("data-requirecontext")===S.contextName)return t.parentNode.removeChild(t),!0})}function o(e){var t=getOwn(b.paths,e);if(t&&isArray(t)&&t.length>1)return t.shift(),S.require.undef(e),S.makeRequire(null,{skipMap:!0})([e]),!0}function n(e){var t,i=e?e.indexOf("!"):-1;return i>-1&&(t=e.substring(0,i),e=e.substring(i+1,e.length)),[t,e]}function a(e,i,o,a){var r,s,l,c,d=null,u=i?i.name:null,h=e,p=!0,v="";return e||(p=!1,e="_@r"+(k+=1)),d=(c=n(e))[0],e=c[1],d&&(d=t(d,u,a),s=getOwn(A,d)),e&&(d?v=o?e:s&&s.normalize?s.normalize(e,function(e){return t(e,u,a)}):-1===e.indexOf("!")?t(e,u,a):e:(d=(c=n(v=t(e,u,a)))[0],v=c[1],o=!0,r=S.nameToUrl(v))),{prefix:d,name:v,parentMap:i,unnormalized:!!(l=!d||s||o?"":"_unnormalized"+(x+=1)),url:r,originalName:h,isDefine:p,id:(d?d+"!"+v:v)+l}}function r(e){var t=e.id,i=getOwn(E,t);return i||(i=E[t]=new S.Module(e)),i}function s(e,t,i){var o=e.id,n=getOwn(E,o);!hasProp(A,o)||n&&!n.defineEmitComplete?(n=r(e)).error&&"error"===t?i(n.error):n.on(t,i):"defined"===t&&i(A[o])}function l(e,t){var i=e.requireModules,o=!1;t?t(e):(each(i,function(t){var i=getOwn(E,t);i&&(i.error=e,i.events.error&&(o=!0,i.emit("error",e)))}),o||req.onError(e))}function c(){globalDefQueue.length&&(each(globalDefQueue,function(e){var t=e[0];"string"==typeof t&&(S.defQueueMap[t]=!0),T.push(e)}),globalDefQueue=[])}function d(e){delete E[e],delete R[e]}function u(){var e,t,n=1e3*b.waitSeconds,a=n&&S.startTime+n<(new Date).getTime(),r=[],s=[],c=!1,d=!0;if(!m){if(m=!0,eachProp(R,function(e){var n=e.map,l=n.id;if(e.enabled&&(n.isDefine||s.push(e),!e.error))if(!e.inited&&a)o(l)?(t=!0,c=!0):(r.push(l),i(l));else if(!e.inited&&e.fetched&&n.isDefine&&(c=!0,!n.prefix))return d=!1}),a&&r.length)return(e=makeError("timeout","Load timeout for modules: "+r,null,r)).contextName=S.contextName,l(e);d&&each(s,function(e){!function e(t,i,o){var n=t.map.id;t.error?t.emit("error",t.error):(i[n]=!0,each(t.depMaps,function(n,a){var r=n.id,s=getOwn(E,r);!s||t.depMatched[a]||o[r]||(getOwn(i,r)?(t.defineDep(a,A[r]),t.check()):e(s,i,o))}),o[n]=!0)}(e,{},{})}),a&&!t||!c||!isBrowser&&!isWebWorker||C||(C=setTimeout(function(){C=0,u()},50)),m=!1}}function h(e){hasProp(A,e[0])||r(a(e[0],null,!0)).init(e[1],e[2])}function p(e,t,i,o){e.detachEvent&&!isOpera?o&&e.detachEvent(o,t):e.removeEventListener(i,t,!1)}function v(e){var t=e.currentTarget||e.srcElement;return p(t,S.onScriptLoad,"load","onreadystatechange"),p(t,S.onScriptError,"error"),{node:t,id:t&&t.getAttribute("data-requiremodule")}}function g(){var e;for(c();T.length;){if(null===(e=T.shift())[0])return l(makeError("mismatch","Mismatched anonymous define() module: "+e[e.length-1]));h(e)}S.defQueueMap={}}var m,f,S,_,C,b={waitSeconds:7,baseUrl:"./",paths:{},bundles:{},pkgs:{},shim:{},config:{}},E={},R={},y={},T=[],A={},I={},w={},k=1,x=1;return _={require:function(e){return e.require?e.require:e.require=S.makeRequire(e.map)},exports:function(e){if(e.usingExports=!0,e.map.isDefine)return e.exports?A[e.map.id]=e.exports:e.exports=A[e.map.id]={}},module:function(e){return e.module?e.module:e.module={id:e.map.id,uri:e.map.url,config:function(){return getOwn(b.config,e.map.id)||{}},exports:e.exports||(e.exports={})}}},(f=function(e){this.events=getOwn(y,e.id)||{},this.map=e,this.shim=getOwn(b.shim,e.id),this.depExports=[],this.depMaps=[],this.depMatched=[],this.pluginMaps={},this.depCount=0}).prototype={init:function(e,t,i,o){o=o||{},this.inited||(this.factory=t,i?this.on("error",i):this.events.error&&(i=bind(this,function(e){this.emit("error",e)})),this.depMaps=e&&e.slice(0),this.errback=i,this.inited=!0,this.ignore=o.ignore,o.enabled||this.enabled?this.enable():this.check())},defineDep:function(e,t){this.depMatched[e]||(this.depMatched[e]=!0,this.depCount-=1,this.depExports[e]=t)},fetch:function(){if(!this.fetched){this.fetched=!0,S.startTime=(new Date).getTime();var e=this.map;return this.shim?void S.makeRequire(this.map,{enableBuildCallback:!0})(this.shim.deps||[],bind(this,function(){return e.prefix?this.callPlugin():this.load()})):e.prefix?this.callPlugin():this.load()}},load:function(){var e=this.map.url;I[e]||(I[e]=!0,S.load(this.map.id,e))},check:function(){if(this.enabled&&!this.enabling){var e,t,i=this.map.id,o=this.depExports,n=this.exports,a=this.factory;if(this.inited){if(this.error)this.emit("error",this.error);else if(!this.defining){if(this.defining=!0,this.depCount<1&&!this.defined){if(isFunction(a)){if(this.events.error&&this.map.isDefine||req.onError!==defaultOnError)try{n=S.execCb(i,a,o,n)}catch(t){e=t}else n=S.execCb(i,a,o,n);if(this.map.isDefine&&void 0===n&&((t=this.module)?n=t.exports:this.usingExports&&(n=this.exports)),e)return e.requireMap=this.map,e.requireModules=this.map.isDefine?[this.map.id]:null,e.requireType=this.map.isDefine?"define":"require",l(this.error=e)}else n=a;if(this.exports=n,this.map.isDefine&&!this.ignore&&(A[i]=n,req.onResourceLoad)){var r=[];each(this.depMaps,function(e){r.push(e.normalizedMap||e)}),req.onResourceLoad(S,this.map,r)}d(i),this.defined=!0}this.defining=!1,this.defined&&!this.defineEmitted&&(this.defineEmitted=!0,this.emit("defined",this.exports),this.defineEmitComplete=!0)}}else hasProp(S.defQueueMap,i)||this.fetch()}},callPlugin:function(){var e=this.map,i=e.id,o=a(e.prefix);this.depMaps.push(o),s(o,"defined",bind(this,function(o){var n,c,u,h=getOwn(w,this.map.id),p=this.map.name,v=this.map.parentMap?this.map.parentMap.name:null,g=S.makeRequire(e.parentMap,{enableBuildCallback:!0});return this.map.unnormalized?(o.normalize&&(p=o.normalize(p,function(e){return t(e,v,!0)})||""),s(c=a(e.prefix+"!"+p,this.map.parentMap,!0),"defined",bind(this,function(e){this.map.normalizedMap=c,this.init([],function(){return e},null,{enabled:!0,ignore:!0})})),void((u=getOwn(E,c.id))&&(this.depMaps.push(c),this.events.error&&u.on("error",bind(this,function(e){this.emit("error",e)})),u.enable()))):h?(this.map.url=S.nameToUrl(h),void this.load()):((n=bind(this,function(e){this.init([],function(){return e},null,{enabled:!0})})).error=bind(this,function(e){this.inited=!0,this.error=e,e.requireModules=[i],eachProp(E,function(e){0===e.map.id.indexOf(i+"_unnormalized")&&d(e.map.id)}),l(e)}),n.fromText=bind(this,function(t,o){var s=e.name,c=a(s),d=useInteractive;o&&(t=o),d&&(useInteractive=!1),r(c),hasProp(b.config,i)&&(b.config[s]=b.config[i]);try{req.exec(t)}catch(e){return l(makeError("fromtexteval","fromText eval for "+i+" failed: "+e,e,[i]))}d&&(useInteractive=!0),this.depMaps.push(c),S.completeLoad(s),g([s],n)}),void o.load(e.name,g,n,b))})),S.enable(o,this),this.pluginMaps[o.id]=o},enable:function(){R[this.map.id]=this,this.enabled=!0,this.enabling=!0,each(this.depMaps,bind(this,function(e,t){var i,o,n;if("string"==typeof e){if(e=a(e,this.map.isDefine?this.map:this.map.parentMap,!1,!this.skipMap),this.depMaps[t]=e,n=getOwn(_,e.id))return void(this.depExports[t]=n(this));this.depCount+=1,s(e,"defined",bind(this,function(e){this.undefed||(this.defineDep(t,e),this.check())})),this.errback?s(e,"error",bind(this,this.errback)):this.events.error&&s(e,"error",bind(this,function(e){this.emit("error",e)}))}i=e.id,o=E[i],hasProp(_,i)||!o||o.enabled||S.enable(e,this)})),eachProp(this.pluginMaps,bind(this,function(e){var t=getOwn(E,e.id);t&&!t.enabled&&S.enable(e,this)})),this.enabling=!1,this.check()},on:function(e,t){var i=this.events[e];i||(i=this.events[e]=[]),i.push(t)},emit:function(e,t){each(this.events[e],function(e){e(t)}),"error"===e&&delete this.events[e]}},(S={config:b,contextName:e,registry:E,defined:A,urlFetched:I,defQueue:T,defQueueMap:{},Module:f,makeModuleMap:a,nextTick:req.nextTick,onError:l,configure:function(e){if(e.baseUrl&&"/"!==e.baseUrl.charAt(e.baseUrl.length-1)&&(e.baseUrl+="/"),"string"==typeof e.urlArgs){var t=e.urlArgs;e.urlArgs=function(e,i){return(-1===i.indexOf("?")?"?":"&")+t}}var i=b.shim,o={paths:!0,bundles:!0,config:!0,map:!0};eachProp(e,function(e,t){o[t]?(b[t]||(b[t]={}),mixin(b[t],e,!0,!0)):b[t]=e}),e.bundles&&eachProp(e.bundles,function(e,t){each(e,function(e){e!==t&&(w[e]=t)})}),e.shim&&(eachProp(e.shim,function(e,t){isArray(e)&&(e={deps:e}),!e.exports&&!e.init||e.exportsFn||(e.exportsFn=S.makeShimExports(e)),i[t]=e}),b.shim=i),e.packages&&each(e.packages,function(e){var t;t=(e="string"==typeof e?{name:e}:e).name,e.location&&(b.paths[t]=e.location),b.pkgs[t]=e.name+"/"+(e.main||"main").replace(currDirRegExp,"").replace(jsSuffixRegExp,"")}),eachProp(E,function(e,t){e.inited||e.map.unnormalized||(e.map=a(t,null,!0))}),(e.deps||e.callback)&&S.require(e.deps||[],e.callback)},makeShimExports:function(e){return function(){var t;return e.init&&(t=e.init.apply(global,arguments)),t||e.exports&&getGlobal(e.exports)}},makeRequire:function(o,n){function s(t,i,c){var d,h;return n.enableBuildCallback&&i&&isFunction(i)&&(i.__requireJsBuild=!0),"string"==typeof t?isFunction(i)?l(makeError("requireargs","Invalid require call"),c):o&&hasProp(_,t)?_[t](E[o.id]):req.get?req.get(S,t,o,s):(d=a(t,o,!1,!0).id,hasProp(A,d)?A[d]:l(makeError("notloaded",'Module name "'+d+'" has not been loaded yet for context: '+e+(o?"":". Use require([])")))):(g(),S.nextTick(function(){g(),(h=r(a(null,o))).skipMap=n.skipMap,h.init(t,i,c,{enabled:!0}),u()}),s)}return n=n||{},mixin(s,{isBrowser:isBrowser,toUrl:function(e){var i,n=e.lastIndexOf("."),a=e.split("/")[0];return-1!==n&&(!("."===a||".."===a)||n>1)&&(i=e.substring(n,e.length),e=e.substring(0,n)),S.nameToUrl(t(e,o&&o.id,!0),i,!0)},defined:function(e){return hasProp(A,a(e,o,!1,!0).id)},specified:function(e){return e=a(e,o,!1,!0).id,hasProp(A,e)||hasProp(E,e)}}),o||(s.undef=function(e){c();var t=a(e,o,!0),n=getOwn(E,e);n.undefed=!0,i(e),delete A[e],delete I[t.url],delete y[e],eachReverse(T,function(t,i){t[0]===e&&T.splice(i,1)}),delete S.defQueueMap[e],n&&(n.events.defined&&(y[e]=n.events),d(e))}),s},enable:function(e){getOwn(E,e.id)&&r(e).enable()},completeLoad:function(e){var t,i,n,a=getOwn(b.shim,e)||{},r=a.exports;for(c();T.length;){if(null===(i=T.shift())[0]){if(i[0]=e,t)break;t=!0}else i[0]===e&&(t=!0);h(i)}if(S.defQueueMap={},n=getOwn(E,e),!t&&!hasProp(A,e)&&n&&!n.inited){if(!(!b.enforceDefine||r&&getGlobal(r)))return o(e)?void 0:l(makeError("nodefine","No define call for "+e,null,[e]));h([e,a.deps||[],a.exportsFn])}u()},nameToUrl:function(e,t,i){var o,n,a,r,s,l,c=getOwn(b.pkgs,e);if(c&&(e=c),l=getOwn(w,e))return S.nameToUrl(l,t,i);if(req.jsExtRegExp.test(e))r=e+(t||"");else{for(o=b.paths,a=(n=e.split("/")).length;a>0;a-=1)if(s=getOwn(o,n.slice(0,a).join("/"))){isArray(s)&&(s=s[0]),n.splice(0,a,s);break}r=n.join("/"),r=("/"===(r+=t||(/^data\:|^blob\:|\?/.test(r)||i?"":".js")).charAt(0)||r.match(/^[\w\+\.\-]+:/)?"":b.baseUrl)+r}return b.urlArgs&&!/^blob\:/.test(r)?r+b.urlArgs(e,r):r},load:function(e,t){req.load(S,e,t)},execCb:function(e,t,i,o){return t.apply(o,i)},onScriptLoad:function(e){if("load"===e.type||readyRegExp.test((e.currentTarget||e.srcElement).readyState)){interactiveScript=null;var t=v(e);S.completeLoad(t.id)}},onScriptError:function(e){var t=v(e);if(!o(t.id)){var i=[];return eachProp(E,function(e,o){0!==o.indexOf("_@r")&&each(e.depMaps,function(e){if(e.id===t.id)return i.push(o),!0})}),l(makeError("scripterror",'Script error for "'+t.id+(i.length?'", needed by: '+i.join(", "):'"'),e,[t.id]))}}}).require=S.makeRequire(),S}function getInteractiveScript(){return interactiveScript&&"interactive"===interactiveScript.readyState?interactiveScript:(eachReverse(scripts(),function(e){if("interactive"===e.readyState)return interactiveScript=e}),interactiveScript)}var req,s,head,baseElement,dataMain,src,interactiveScript,currentlyAddingScript,mainScript,subPath,version="2.3.3",commentRegExp=/\/\*[\s\S]*?\*\/|([^:"'=]|^)\/\/.*$/gm,cjsRequireRegExp=/[^.]\s*require\s*\(\s*["']([^'"\s]+)["']\s*\)/g,jsSuffixRegExp=/\.js$/,currDirRegExp=/^\.\//,op=Object.prototype,ostring=op.toString,hasOwn=op.hasOwnProperty,isBrowser=!("undefined"==typeof window||"undefined"==typeof navigator||!window.document),isWebWorker=!isBrowser&&"undefined"!=typeof importScripts,readyRegExp=isBrowser&&"PLAYSTATION 3"===navigator.platform?/^complete$/:/^(complete|loaded)$/,defContextName="_",isOpera="undefined"!=typeof opera&&"[object Opera]"===opera.toString(),contexts={},cfg={},globalDefQueue=[],useInteractive=!1;if(void 0===define){if(void 0!==requirejs){if(isFunction(requirejs))return;cfg=requirejs,requirejs=void 0}void 0===require||isFunction(require)||(cfg=require,require=void 0),req=requirejs=function(e,t,i,o){var n,a,r=defContextName;return isArray(e)||"string"==typeof e||(a=e,isArray(t)?(e=t,t=i,i=o):e=[]),a&&a.context&&(r=a.context),(n=getOwn(contexts,r))||(n=contexts[r]=req.s.newContext(r)),a&&n.configure(a),n.require(e,t,i)},req.config=function(e){return req(e)},req.nextTick=void 0!==setTimeout?function(e){setTimeout(e,4)}:function(e){e()},require||(require=req),req.version=version,req.jsExtRegExp=/^\/|:|\?|\.js$/,req.isBrowser=isBrowser,s=req.s={contexts:contexts,newContext:newContext},req({}),each(["toUrl","undef","defined","specified"],function(e){req[e]=function(){var t=contexts[defContextName];return t.require[e].apply(t,arguments)}}),isBrowser&&(head=s.head=document.getElementsByTagName("head")[0],baseElement=document.getElementsByTagName("base")[0],baseElement&&(head=s.head=baseElement.parentNode)),req.onError=defaultOnError,req.createNode=function(e,t,i){var o=e.xhtml?document.createElementNS("http://www.w3.org/1999/xhtml","html:script"):document.createElement("script");return o.type=e.scriptType||"text/javascript",o.charset="utf-8",o.async=!0,o},req.load=function(e,t,i){var o,n=e&&e.config||{};if(isBrowser)return(o=req.createNode(n,t,i)).setAttribute("data-requirecontext",e.contextName),o.setAttribute("data-requiremodule",t),!o.attachEvent||o.attachEvent.toString&&o.attachEvent.toString().indexOf("[native code")<0||isOpera?(o.addEventListener("load",e.onScriptLoad,!1),o.addEventListener("error",e.onScriptError,!1)):(useInteractive=!0,o.attachEvent("onreadystatechange",e.onScriptLoad)),o.src=i,n.onNodeCreated&&n.onNodeCreated(o,n,t,i),currentlyAddingScript=o,baseElement?head.insertBefore(o,baseElement):head.appendChild(o),currentlyAddingScript=null,o;if(isWebWorker)try{setTimeout(function(){},0),importScripts(i),e.completeLoad(t)}catch(o){e.onError(makeError("importscripts","importScripts failed for "+t+" at "+i,o,[t]))}},isBrowser&&!cfg.skipDataMain&&eachReverse(scripts(),function(e){if(head||(head=e.parentNode),dataMain=e.getAttribute("data-main"))return mainScript=dataMain,cfg.baseUrl||-1!==mainScript.indexOf("!")||(src=mainScript.split("/"),mainScript=src.pop(),subPath=src.length?src.join("/")+"/":"./",cfg.baseUrl=subPath),mainScript=mainScript.replace(jsSuffixRegExp,""),req.jsExtRegExp.test(mainScript)&&(mainScript=dataMain),cfg.deps=cfg.deps?cfg.deps.concat(mainScript):[mainScript],!0}),define=function(e,t,i){var o,n;"string"!=typeof e&&(i=t,t=e,e=null),isArray(t)||(i=t,t=null),!t&&isFunction(i)&&(t=[],i.length&&(i.toString().replace(commentRegExp,commentReplace).replace(cjsRequireRegExp,function(e,i){t.push(i)}),t=(1===i.length?["require"]:["require","exports","module"]).concat(t))),useInteractive&&((o=currentlyAddingScript||getInteractiveScript())&&(e||(e=o.getAttribute("data-requiremodule")),n=contexts[o.getAttribute("data-requirecontext")])),n?(n.defQueue.push([e,t,i]),n.defQueueMap[e]=!0):globalDefQueue.push([e,t,i])},define.amd={jQuery:!0},req.exec=function(text){return eval(text)},req(cfg)}}(this,"undefined"==typeof setTimeout?void 0:setTimeout),liveRequire.requirejs=requirejs,liveRequire.require=require,liveRequire.define=define)}(),liveRequire.define("requireLib",function(){}),function(){return function e(t,i,o){function n(r,s){if(!i[r]){if(!t[r]){var l="function"==typeof require&&require;if(!s&&l)return l(r,!0);if(a)return a(r,!0);var c=new Error("Cannot find module '"+r+"'");throw c.code="MODULE_NOT_FOUND",c}var d=i[r]={exports:{}};t[r][0].call(d.exports,function(e){return n(t[r][1][e]||e)},d,d.exports,e,t,i,o)}return i[r].exports}for(var a="function"==typeof require&&require,r=0;r<o.length;r++)n(o[r]);return n}}()({1:[function(e,t,i){"use strict";function o(e,t,i,o,n){var a=l.writeRtpDescription(e.kind,t);if(a+=l.writeIceParameters(e.iceGatherer.getLocalParameters()),a+=l.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===i?"actpass":n||"active"),a+="a=mid:"+e.mid+"\r\n",a+=e.rtpSender&&e.rtpReceiver?"a=sendrecv\r\n":e.rtpSender?"a=sendonly\r\n":e.rtpReceiver?"a=recvonly\r\n":"a=inactive\r\n",e.rtpSender){var r=e.rtpSender._initialTrackId||e.rtpSender.track.id;e.rtpSender._initialTrackId=r;var s="msid:"+(o?o.id:"-")+" "+r+"\r\n";a+="a="+s,a+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+s,e.sendEncodingParameters[0].rtx&&(a+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+s,a+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return a+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+l.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(a+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+l.localCName+"\r\n"),a}function n(e,t){var i={codecs:[],headerExtensions:[],fecMechanisms:[]},o=function(e,t){e=parseInt(e,10);for(var i=0;i<t.length;i++)if(t[i].payloadType===e||t[i].preferredPayloadType===e)return t[i]},n=function(e,t,i,n){var a=o(e.parameters.apt,i),r=o(t.parameters.apt,n);return a&&r&&a.name.toLowerCase()===r.name.toLowerCase()};return e.codecs.forEach(function(o){for(var a=0;a<t.codecs.length;a++){var r=t.codecs[a];if(o.name.toLowerCase()===r.name.toLowerCase()&&o.clockRate===r.clockRate){if("rtx"===o.name.toLowerCase()&&o.parameters&&r.parameters.apt&&!n(o,r,e.codecs,t.codecs))continue;(r=JSON.parse(JSON.stringify(r))).numChannels=Math.min(o.numChannels,r.numChannels),i.codecs.push(r),r.rtcpFeedback=r.rtcpFeedback.filter(function(e){for(var t=0;t<o.rtcpFeedback.length;t++)if(o.rtcpFeedback[t].type===e.type&&o.rtcpFeedback[t].parameter===e.parameter)return!0;return!1});break}}}),e.headerExtensions.forEach(function(e){for(var o=0;o<t.headerExtensions.length;o++){var n=t.headerExtensions[o];if(e.uri===n.uri){i.headerExtensions.push(n);break}}}),i}function a(e,t,i){return-1!=={offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[t][e].indexOf(i)}function r(e,t){var i=e.getRemoteCandidates().find(function(e){return t.foundation===e.foundation&&t.ip===e.ip&&t.port===e.port&&t.priority===e.priority&&t.protocol===e.protocol&&t.type===e.type});return i||e.addRemoteCandidate(t),!i}function s(e,t){var i=new Error(t);return i.name=e,i.code={NotSupportedError:9,InvalidStateError:11,InvalidAccessError:15,TypeError:void 0,OperationError:void 0}[e],i}var l=e("sdp");t.exports=function(e,t){function i(t,i){i.addTrack(t),i.dispatchEvent(new e.MediaStreamTrackEvent("addtrack",{track:t}))}function c(t,i){i.removeTrack(t),i.dispatchEvent(new e.MediaStreamTrackEvent("removetrack",{track:t}))}function d(t,i,o,n){var a=new Event("track");a.track=i,a.receiver=o,a.transceiver={receiver:o},a.streams=n,e.setTimeout(function(){t._dispatchEvent("track",a)})}var u=function(i){var o=this,n=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach(function(e){o[e]=n[e].bind(n)}),this.canTrickleIceCandidates=null,this.needNegotiation=!1,this.localStreams=[],this.remoteStreams=[],this._localDescription=null,this._remoteDescription=null,this.signalingState="stable",this.iceConnectionState="new",this.connectionState="new",this.iceGatheringState="new",i=JSON.parse(JSON.stringify(i||{})),this.usingBundle="max-bundle"===i.bundlePolicy,"negotiate"===i.rtcpMuxPolicy)throw s("NotSupportedError","rtcpMuxPolicy 'negotiate' is not supported");switch(i.rtcpMuxPolicy||(i.rtcpMuxPolicy="require"),i.iceTransportPolicy){case"all":case"relay":break;default:i.iceTransportPolicy="all"}switch(i.bundlePolicy){case"balanced":case"max-compat":case"max-bundle":break;default:i.bundlePolicy="balanced"}if(i.iceServers=function(e,t){var i=!1;return(e=JSON.parse(JSON.stringify(e))).filter(function(e){if(e&&(e.urls||e.url)){var o=e.urls||e.url;e.url&&!e.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead.");var n="string"==typeof o;return n&&(o=[o]),o=o.filter(function(e){return 0!==e.indexOf("turn:")||-1===e.indexOf("transport=udp")||-1!==e.indexOf("turn:[")||i?0===e.indexOf("stun:")&&t>=14393&&-1===e.indexOf("?transport=udp"):(i=!0,!0)}),delete e.url,e.urls=n?o[0]:o,!!o.length}})}(i.iceServers||[],t),this._iceGatherers=[],i.iceCandidatePoolSize)for(var a=i.iceCandidatePoolSize;a>0;a--)this._iceGatherers.push(new e.RTCIceGatherer({iceServers:i.iceServers,gatherPolicy:i.iceTransportPolicy}));else i.iceCandidatePoolSize=0;this._config=i,this.transceivers=[],this._sdpSessionId=l.generateSessionId(),this._sdpSessionVersion=0,this._dtlsRole=void 0,this._isClosed=!1};Object.defineProperty(u.prototype,"localDescription",{configurable:!0,get:function(){return this._localDescription}}),Object.defineProperty(u.prototype,"remoteDescription",{configurable:!0,get:function(){return this._remoteDescription}}),u.prototype.onicecandidate=null,u.prototype.onaddstream=null,u.prototype.ontrack=null,u.prototype.onremovestream=null,u.prototype.onsignalingstatechange=null,u.prototype.oniceconnectionstatechange=null,u.prototype.onconnectionstatechange=null,u.prototype.onicegatheringstatechange=null,u.prototype.onnegotiationneeded=null,u.prototype.ondatachannel=null,u.prototype._dispatchEvent=function(e,t){this._isClosed||(this.dispatchEvent(t),"function"==typeof this["on"+e]&&this["on"+e](t))},u.prototype._emitGatheringStateChange=function(){var e=new Event("icegatheringstatechange");this._dispatchEvent("icegatheringstatechange",e)},u.prototype.getConfiguration=function(){return this._config},u.prototype.getLocalStreams=function(){return this.localStreams},u.prototype.getRemoteStreams=function(){return this.remoteStreams},u.prototype._createTransceiver=function(e,t){var i=this.transceivers.length>0,o={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:e,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,associatedRemoteMediaStreams:[],wantReceive:!0};if(this.usingBundle&&i)o.iceTransport=this.transceivers[0].iceTransport,o.dtlsTransport=this.transceivers[0].dtlsTransport;else{var n=this._createIceAndDtlsTransports();o.iceTransport=n.iceTransport,o.dtlsTransport=n.dtlsTransport}return t||this.transceivers.push(o),o},u.prototype.addTrack=function(t,i){if(this._isClosed)throw s("InvalidStateError","Attempted to call addTrack on a closed peerconnection.");if(this.transceivers.find(function(e){return e.track===t}))throw s("InvalidAccessError","Track already exists.");for(var o,n=0;n<this.transceivers.length;n++)this.transceivers[n].track||this.transceivers[n].kind!==t.kind||(o=this.transceivers[n]);return o||(o=this._createTransceiver(t.kind)),this._maybeFireNegotiationNeeded(),-1===this.localStreams.indexOf(i)&&this.localStreams.push(i),o.track=t,o.stream=i,o.rtpSender=new e.RTCRtpSender(t,o.dtlsTransport),o.rtpSender},u.prototype.addStream=function(e){var i=this;if(t>=15025)e.getTracks().forEach(function(t){i.addTrack(t,e)});else{var o=e.clone();e.getTracks().forEach(function(e,t){var i=o.getTracks()[t];e.addEventListener("enabled",function(e){i.enabled=e.enabled})}),o.getTracks().forEach(function(e){i.addTrack(e,o)})}},u.prototype.removeTrack=function(t){if(this._isClosed)throw s("InvalidStateError","Attempted to call removeTrack on a closed peerconnection.");if(!(t instanceof e.RTCRtpSender))throw new TypeError("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.");var i=this.transceivers.find(function(e){return e.rtpSender===t});if(!i)throw s("InvalidAccessError","Sender was not created by this connection.");var o=i.stream;i.rtpSender.stop(),i.rtpSender=null,i.track=null,i.stream=null,-1===this.transceivers.map(function(e){return e.stream}).indexOf(o)&&this.localStreams.indexOf(o)>-1&&this.localStreams.splice(this.localStreams.indexOf(o),1),this._maybeFireNegotiationNeeded()},u.prototype.removeStream=function(e){var t=this;e.getTracks().forEach(function(e){var i=t.getSenders().find(function(t){return t.track===e});i&&t.removeTrack(i)})},u.prototype.getSenders=function(){return this.transceivers.filter(function(e){return!!e.rtpSender}).map(function(e){return e.rtpSender})},u.prototype.getReceivers=function(){return this.transceivers.filter(function(e){return!!e.rtpReceiver}).map(function(e){return e.rtpReceiver})},u.prototype._createIceGatherer=function(t,i){var o=this;if(i&&t>0)return this.transceivers[0].iceGatherer;if(this._iceGatherers.length)return this._iceGatherers.shift();var n=new e.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy});return Object.defineProperty(n,"state",{value:"new",writable:!0}),this.transceivers[t].bufferedCandidateEvents=[],this.transceivers[t].bufferCandidates=function(e){var i=!e.candidate||0===Object.keys(e.candidate).length;n.state=i?"completed":"gathering",null!==o.transceivers[t].bufferedCandidateEvents&&o.transceivers[t].bufferedCandidateEvents.push(e)},n.addEventListener("localcandidate",this.transceivers[t].bufferCandidates),n},u.prototype._gather=function(t,i){var o=this,n=this.transceivers[i].iceGatherer;if(!n.onlocalcandidate){var a=this.transceivers[i].bufferedCandidateEvents;this.transceivers[i].bufferedCandidateEvents=null,n.removeEventListener("localcandidate",this.transceivers[i].bufferCandidates),n.onlocalcandidate=function(e){if(!(o.usingBundle&&i>0)){var a=new Event("icecandidate");a.candidate={sdpMid:t,sdpMLineIndex:i};var r=e.candidate,s=!r||0===Object.keys(r).length;if(s)"new"!==n.state&&"gathering"!==n.state||(n.state="completed");else{"new"===n.state&&(n.state="gathering"),r.component=1,r.ufrag=n.getLocalParameters().usernameFragment;var c=l.writeCandidate(r);a.candidate=Object.assign(a.candidate,l.parseCandidate(c)),a.candidate.candidate=c,a.candidate.toJSON=function(){return{candidate:a.candidate.candidate,sdpMid:a.candidate.sdpMid,sdpMLineIndex:a.candidate.sdpMLineIndex,usernameFragment:a.candidate.usernameFragment}}}var d=l.getMediaSections(o._localDescription.sdp);d[a.candidate.sdpMLineIndex]+=s?"a=end-of-candidates\r\n":"a="+a.candidate.candidate+"\r\n",o._localDescription.sdp=l.getDescription(o._localDescription.sdp)+d.join("");var u=o.transceivers.every(function(e){return e.iceGatherer&&"completed"===e.iceGatherer.state});"gathering"!==o.iceGatheringState&&(o.iceGatheringState="gathering",o._emitGatheringStateChange()),s||o._dispatchEvent("icecandidate",a),u&&(o._dispatchEvent("icecandidate",new Event("icecandidate")),o.iceGatheringState="complete",o._emitGatheringStateChange())}},e.setTimeout(function(){a.forEach(function(e){n.onlocalcandidate(e)})},0)}},u.prototype._createIceAndDtlsTransports=function(){var t=this,i=new e.RTCIceTransport(null);i.onicestatechange=function(){t._updateIceConnectionState(),t._updateConnectionState()};var o=new e.RTCDtlsTransport(i);return o.ondtlsstatechange=function(){t._updateConnectionState()},o.onerror=function(){Object.defineProperty(o,"state",{value:"failed",writable:!0}),t._updateConnectionState()},{iceTransport:i,dtlsTransport:o}},u.prototype._disposeIceAndDtlsTransports=function(e){var t=this.transceivers[e].iceGatherer;t&&(delete t.onlocalcandidate,delete this.transceivers[e].iceGatherer);var i=this.transceivers[e].iceTransport;i&&(delete i.onicestatechange,delete this.transceivers[e].iceTransport);var o=this.transceivers[e].dtlsTransport;o&&(delete o.ondtlsstatechange,delete o.onerror,delete this.transceivers[e].dtlsTransport)},u.prototype._transceive=function(e,i,o){var a=n(e.localCapabilities,e.remoteCapabilities);i&&e.rtpSender&&(a.encodings=e.sendEncodingParameters,a.rtcp={cname:l.localCName,compound:e.rtcpParameters.compound},e.recvEncodingParameters.length&&(a.rtcp.ssrc=e.recvEncodingParameters[0].ssrc),e.rtpSender.send(a)),o&&e.rtpReceiver&&a.codecs.length>0&&("video"===e.kind&&e.recvEncodingParameters&&t<15019&&e.recvEncodingParameters.forEach(function(e){delete e.rtx}),e.recvEncodingParameters.length?a.encodings=e.recvEncodingParameters:a.encodings=[{}],a.rtcp={compound:e.rtcpParameters.compound},e.rtcpParameters.cname&&(a.rtcp.cname=e.rtcpParameters.cname),e.sendEncodingParameters.length&&(a.rtcp.ssrc=e.sendEncodingParameters[0].ssrc),e.rtpReceiver.receive(a))},u.prototype.setLocalDescription=function(e){var t,i,o=this;if(-1===["offer","answer"].indexOf(e.type))return Promise.reject(s("TypeError",'Unsupported type "'+e.type+'"'));if(!a("setLocalDescription",e.type,o.signalingState)||o._isClosed)return Promise.reject(s("InvalidStateError","Can not set local "+e.type+" in state "+o.signalingState));if("offer"===e.type)t=l.splitSections(e.sdp),i=t.shift(),t.forEach(function(e,t){var i=l.parseRtpParameters(e);o.transceivers[t].localCapabilities=i}),o.transceivers.forEach(function(e,t){o._gather(e.mid,t)});else if("answer"===e.type){t=l.splitSections(o._remoteDescription.sdp),i=t.shift();var r=l.matchPrefix(i,"a=ice-lite").length>0;t.forEach(function(e,t){var a=o.transceivers[t],s=a.iceGatherer,c=a.iceTransport,d=a.dtlsTransport,u=a.localCapabilities,h=a.remoteCapabilities;if(!(l.isRejected(e)&&0===l.matchPrefix(e,"a=bundle-only").length)&&!a.rejected){var p=l.getIceParameters(e,i),v=l.getDtlsParameters(e,i);r&&(v.role="server"),o.usingBundle&&0!==t||(o._gather(a.mid,t),"new"===c.state&&c.start(s,p,r?"controlling":"controlled"),"new"===d.state&&d.start(v));var g=n(u,h);o._transceive(a,g.codecs.length>0,!1)}})}return o._localDescription={type:e.type,sdp:e.sdp},"offer"===e.type?o._updateSignalingState("have-local-offer"):o._updateSignalingState("stable"),Promise.resolve()};try{u.prototype.setRemoteDescription=function(o){var u=this;if(-1===["offer","answer"].indexOf(o.type))return Promise.reject(s("TypeError",'Unsupported type "'+o.type+'"'));if(!a("setRemoteDescription",o.type,u.signalingState)||u._isClosed)return Promise.reject(s("InvalidStateError","Can not set remote "+o.type+" in state "+u.signalingState));var h={};u.remoteStreams.forEach(function(e){h[e.id]=e});var p=[],v=l.splitSections(o.sdp),g=v.shift(),m=l.matchPrefix(g,"a=ice-lite").length>0,f=l.matchPrefix(g,"a=group:BUNDLE ").length>0;u.usingBundle=f;var S=l.matchPrefix(g,"a=ice-options:")[0];return u.canTrickleIceCandidates=!!S&&S.substr(14).split(" ").indexOf("trickle")>=0,v.forEach(function(a,s){var d=l.splitLines(a),v=l.getKind(a),S=l.isRejected(a)&&0===l.matchPrefix(a,"a=bundle-only").length,_=d[0].substr(2).split(" ")[2],C=l.getDirection(a,g),b=l.parseMsid(a),E=l.getMid(a)||l.generateIdentifier();if(S||"application"===v&&("DTLS/SCTP"===_||"UDP/DTLS/SCTP"===_))u.transceivers[s]={mid:E,kind:v,protocol:_,rejected:!0};else{!S&&u.transceivers[s]&&u.transceivers[s].rejected&&(u.transceivers[s]=u._createTransceiver(v,!0));var R,y,T,A,I,w,k,x,O,L,N,D=l.parseRtpParameters(a);S||(L=l.getIceParameters(a,g),(N=l.getDtlsParameters(a,g)).role="client"),k=l.parseRtpEncodingParameters(a);var P=l.parseRtcpParameters(a),M=l.matchPrefix(a,"a=end-of-candidates",g).length>0,V=l.matchPrefix(a,"a=candidate:").map(function(e){return l.parseCandidate(e)}).filter(function(e){return 1===e.component});if(("offer"===o.type||"answer"===o.type)&&!S&&f&&s>0&&u.transceivers[s]&&(u._disposeIceAndDtlsTransports(s),u.transceivers[s].iceGatherer=u.transceivers[0].iceGatherer,u.transceivers[s].iceTransport=u.transceivers[0].iceTransport,u.transceivers[s].dtlsTransport=u.transceivers[0].dtlsTransport,u.transceivers[s].rtpSender&&u.transceivers[s].rtpSender.setTransport(u.transceivers[0].dtlsTransport),u.transceivers[s].rtpReceiver&&u.transceivers[s].rtpReceiver.setTransport(u.transceivers[0].dtlsTransport)),"offer"!==o.type||S){if("answer"===o.type&&!S)y=(R=u.transceivers[s]).iceGatherer,T=R.iceTransport,A=R.dtlsTransport,I=R.rtpReceiver,w=R.sendEncodingParameters,x=R.localCapabilities,u.transceivers[s].recvEncodingParameters=k,u.transceivers[s].remoteCapabilities=D,u.transceivers[s].rtcpParameters=P,V.length&&"new"===T.state&&(!m&&!M||f&&0!==s?V.forEach(function(e){r(R.iceTransport,e)}):T.setRemoteCandidates(V)),f&&0!==s||("new"===T.state&&T.start(y,L,"controlling"),"new"===A.state&&A.start(N)),!n(R.localCapabilities,R.remoteCapabilities).codecs.filter(function(e){return"rtx"===e.name.toLowerCase()}).length&&R.sendEncodingParameters[0].rtx&&delete R.sendEncodingParameters[0].rtx,u._transceive(R,"sendrecv"===C||"recvonly"===C,"sendrecv"===C||"sendonly"===C),!I||"sendrecv"!==C&&"sendonly"!==C?delete R.rtpReceiver:(O=I.track,b?(h[b.stream]||(h[b.stream]=new e.MediaStream),i(O,h[b.stream]),p.push([O,I,h[b.stream]])):(h.default||(h.default=new e.MediaStream),i(O,h.default),p.push([O,I,h.default])))}else{(R=u.transceivers[s]||u._createTransceiver(v)).mid=E,R.iceGatherer||(R.iceGatherer=u._createIceGatherer(s,f)),V.length&&"new"===R.iceTransport.state&&(!M||f&&0!==s?V.forEach(function(e){r(R.iceTransport,e)}):R.iceTransport.setRemoteCandidates(V)),x=e.RTCRtpReceiver.getCapabilities(v),t<15019&&(x.codecs=x.codecs.filter(function(e){return"rtx"!==e.name})),w=R.sendEncodingParameters||[{ssrc:1001*(2*s+2)}];var U,B=!1;if("sendrecv"===C||"sendonly"===C){if(B=!R.rtpReceiver,I=R.rtpReceiver||new e.RTCRtpReceiver(R.dtlsTransport,v),B)O=I.track,b&&"-"===b.stream||(b?(h[b.stream]||(h[b.stream]=new e.MediaStream,Object.defineProperty(h[b.stream],"id",{get:function(){return b.stream}})),Object.defineProperty(O,"id",{get:function(){return b.track}}),U=h[b.stream]):(h.default||(h.default=new e.MediaStream),U=h.default)),U&&(i(O,U),R.associatedRemoteMediaStreams.push(U)),p.push([O,I,U])}else R.rtpReceiver&&R.rtpReceiver.track&&(R.associatedRemoteMediaStreams.forEach(function(e){var t=e.getTracks().find(function(e){return e.id===R.rtpReceiver.track.id});t&&c(t,e)}),R.associatedRemoteMediaStreams=[]);R.localCapabilities=x,R.remoteCapabilities=D,R.rtpReceiver=I,R.rtcpParameters=P,R.sendEncodingParameters=w,R.recvEncodingParameters=k,u._transceive(u.transceivers[s],!1,B)}}}),void 0===u._dtlsRole&&(u._dtlsRole="offer"===o.type?"active":"passive"),u._remoteDescription={type:o.type,sdp:o.sdp},"offer"===o.type?u._updateSignalingState("have-remote-offer"):u._updateSignalingState("stable"),Object.keys(h).forEach(function(t){var i=h[t];if(i.getTracks().length){if(-1===u.remoteStreams.indexOf(i)){u.remoteStreams.push(i);var o=new Event("addstream");o.stream=i,e.setTimeout(function(){u._dispatchEvent("addstream",o)})}p.forEach(function(e){var t=e[0],o=e[1];i.id===e[2].id&&d(u,t,o,[i])})}}),p.forEach(function(e){e[2]||d(u,e[0],e[1],[])}),e.setTimeout(function(){u&&u.transceivers&&u.transceivers.forEach(function(e){e.iceTransport&&"new"===e.iceTransport.state&&e.iceTransport.getRemoteCandidates().length>0&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),e.iceTransport.addRemoteCandidate({}))})},4e3),Promise.resolve()}}catch(e){}u.prototype.close=function(){this.transceivers.forEach(function(e){e.iceTransport&&e.iceTransport.stop(),e.dtlsTransport&&e.dtlsTransport.stop(),e.rtpSender&&e.rtpSender.stop(),e.rtpReceiver&&e.rtpReceiver.stop()}),this._isClosed=!0,this._updateSignalingState("closed")},u.prototype._updateSignalingState=function(e){this.signalingState=e;var t=new Event("signalingstatechange");this._dispatchEvent("signalingstatechange",t)},u.prototype._maybeFireNegotiationNeeded=function(){var t=this;"stable"===this.signalingState&&!0!==this.needNegotiation&&(this.needNegotiation=!0,e.setTimeout(function(){if(t.needNegotiation){t.needNegotiation=!1;var e=new Event("negotiationneeded");t._dispatchEvent("negotiationneeded",e)}},0))},u.prototype._updateIceConnectionState=function(){var e,t={new:0,closed:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(e){t[e.iceTransport.state]++}),e="new",t.failed>0?e="failed":t.checking>0?e="checking":t.disconnected>0?e="disconnected":t.new>0?e="new":t.connected>0?e="connected":t.completed>0&&(e="completed"),e!==this.iceConnectionState){this.iceConnectionState=e;var i=new Event("iceconnectionstatechange");this._dispatchEvent("iceconnectionstatechange",i)}},u.prototype._updateConnectionState=function(){var e,t={new:0,closed:0,connecting:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(e){t[e.iceTransport.state]++,t[e.dtlsTransport.state]++}),t.connected+=t.completed,e="new",t.failed>0?e="failed":t.connecting>0?e="connecting":t.disconnected>0?e="disconnected":t.new>0?e="new":t.connected>0&&(e="connected"),e!==this.connectionState){this.connectionState=e;var i=new Event("connectionstatechange");this._dispatchEvent("connectionstatechange",i)}},u.prototype.createOffer=function(){var i=this;if(i._isClosed)return Promise.reject(s("InvalidStateError","Can not call createOffer after close"));var n=i.transceivers.filter(function(e){return"audio"===e.kind}).length,a=i.transceivers.filter(function(e){return"video"===e.kind}).length,r=arguments[0];if(r){if(r.mandatory||r.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");void 0!==r.offerToReceiveAudio&&(n=!0===r.offerToReceiveAudio?1:!1===r.offerToReceiveAudio?0:r.offerToReceiveAudio),void 0!==r.offerToReceiveVideo&&(a=!0===r.offerToReceiveVideo?1:!1===r.offerToReceiveVideo?0:r.offerToReceiveVideo)}for(i.transceivers.forEach(function(e){"audio"===e.kind?--n<0&&(e.wantReceive=!1):"video"===e.kind&&(--a<0&&(e.wantReceive=!1))});n>0||a>0;)n>0&&(i._createTransceiver("audio"),n--),a>0&&(i._createTransceiver("video"),a--);var c=l.writeSessionBoilerplate(i._sdpSessionId,i._sdpSessionVersion++);i.transceivers.forEach(function(o,n){var a=o.track,r=o.kind,s=o.mid||l.generateIdentifier();o.mid=s,o.iceGatherer||(o.iceGatherer=i._createIceGatherer(n,i.usingBundle));var c=e.RTCRtpSender.getCapabilities(r);t<15019&&(c.codecs=c.codecs.filter(function(e){return"rtx"!==e.name})),c.codecs.forEach(function(e){"H264"===e.name&&void 0===e.parameters["level-asymmetry-allowed"]&&(e.parameters["level-asymmetry-allowed"]="1"),o.remoteCapabilities&&o.remoteCapabilities.codecs&&o.remoteCapabilities.codecs.forEach(function(t){e.name.toLowerCase()===t.name.toLowerCase()&&e.clockRate===t.clockRate&&(e.preferredPayloadType=t.payloadType)})}),c.headerExtensions.forEach(function(e){(o.remoteCapabilities&&o.remoteCapabilities.headerExtensions||[]).forEach(function(t){e.uri===t.uri&&(e.id=t.id)})});var d=o.sendEncodingParameters||[{ssrc:1001*(2*n+1)}];a&&t>=15019&&"video"===r&&!d[0].rtx&&(d[0].rtx={ssrc:d[0].ssrc+1}),o.wantReceive&&(o.rtpReceiver=new e.RTCRtpReceiver(o.dtlsTransport,r)),o.localCapabilities=c,o.sendEncodingParameters=d}),"max-compat"!==i._config.bundlePolicy&&(c+="a=group:BUNDLE "+i.transceivers.map(function(e){return e.mid}).join(" ")+"\r\n"),c+="a=ice-options:trickle\r\n",i.transceivers.forEach(function(e,t){c+=o(e,e.localCapabilities,"offer",e.stream,i._dtlsRole),c+="a=rtcp-rsize\r\n",!e.iceGatherer||"new"===i.iceGatheringState||0!==t&&i.usingBundle||(e.iceGatherer.getLocalCandidates().forEach(function(e){e.component=1,c+="a="+l.writeCandidate(e)+"\r\n"}),"completed"===e.iceGatherer.state&&(c+="a=end-of-candidates\r\n"))});var d=new e.RTCSessionDescription({type:"offer",sdp:c});return Promise.resolve(d)},u.prototype.createAnswer=function(){var i=this;if(i._isClosed)return Promise.reject(s("InvalidStateError","Can not call createAnswer after close"));if("have-remote-offer"!==i.signalingState&&"have-local-pranswer"!==i.signalingState)return Promise.reject(s("InvalidStateError","Can not call createAnswer in signalingState "+i.signalingState));var a=l.writeSessionBoilerplate(i._sdpSessionId,i._sdpSessionVersion++);i.usingBundle&&(a+="a=group:BUNDLE "+i.transceivers.map(function(e){return e.mid}).join(" ")+"\r\n"),a+="a=ice-options:trickle\r\n";var r=l.getMediaSections(i._remoteDescription.sdp).length;i.transceivers.forEach(function(e,s){if(!(s+1>r)){if(e.rejected)return"application"===e.kind?a+="DTLS/SCTP"===e.protocol?"m=application 0 DTLS/SCTP 5000\r\n":"m=application 0 "+e.protocol+" webrtc-datachannel\r\n":"audio"===e.kind?a+="m=audio 0 UDP/TLS/RTP/SAVPF 0\r\na=rtpmap:0 PCMU/8000\r\n":"video"===e.kind&&(a+="m=video 0 UDP/TLS/RTP/SAVPF 120\r\na=rtpmap:120 VP8/90000\r\n"),void(a+="c=IN IP4 0.0.0.0\r\na=inactive\r\na=mid:"+e.mid+"\r\n");var l;if(e.stream)"audio"===e.kind?l=e.stream.getAudioTracks()[0]:"video"===e.kind&&(l=e.stream.getVideoTracks()[0]),l&&t>=15019&&"video"===e.kind&&!e.sendEncodingParameters[0].rtx&&(e.sendEncodingParameters[0].rtx={ssrc:e.sendEncodingParameters[0].ssrc+1});var c=n(e.localCapabilities,e.remoteCapabilities);!c.codecs.filter(function(e){return"rtx"===e.name.toLowerCase()}).length&&e.sendEncodingParameters[0].rtx&&delete e.sendEncodingParameters[0].rtx,a+=o(e,c,"answer",e.stream,i._dtlsRole),e.rtcpParameters&&e.rtcpParameters.reducedSize&&(a+="a=rtcp-rsize\r\n")}});var c=new e.RTCSessionDescription({type:"answer",sdp:a});return Promise.resolve(c)},u.prototype.addIceCandidate=function(e){var t,i=this;return e&&void 0===e.sdpMLineIndex&&!e.sdpMid?Promise.reject(new TypeError("sdpMLineIndex or sdpMid required")):new Promise(function(o,n){if(!i._remoteDescription)return n(s("InvalidStateError","Can not add ICE candidate without a remote description"));if(e&&""!==e.candidate){var a=e.sdpMLineIndex;if(e.sdpMid)for(var c=0;c<i.transceivers.length;c++)if(i.transceivers[c].mid===e.sdpMid){a=c;break}var d=i.transceivers[a];if(!d)return n(s("OperationError","Can not add ICE candidate"));if(d.rejected)return o();var u=Object.keys(e.candidate).length>0?l.parseCandidate(e.candidate):{};if("tcp"===u.protocol&&(0===u.port||9===u.port))return o();if(u.component&&1!==u.component)return o();if((0===a||a>0&&d.iceTransport!==i.transceivers[0].iceTransport)&&!r(d.iceTransport,u))return n(s("OperationError","Can not add ICE candidate"));var h=e.candidate.trim();0===h.indexOf("a=")&&(h=h.substr(2)),(t=l.getMediaSections(i._remoteDescription.sdp))[a]+="a="+(u.type?h:"end-of-candidates")+"\r\n",i._remoteDescription.sdp=l.getDescription(i._remoteDescription.sdp)+t.join("")}else for(var p=0;p<i.transceivers.length&&(i.transceivers[p].rejected||(i.transceivers[p].iceTransport.addRemoteCandidate({}),(t=l.getMediaSections(i._remoteDescription.sdp))[p]+="a=end-of-candidates\r\n",i._remoteDescription.sdp=l.getDescription(i._remoteDescription.sdp)+t.join(""),!i.usingBundle));p++);o()})},u.prototype.getStats=function(t){if(t&&t instanceof e.MediaStreamTrack){var i=null;if(this.transceivers.forEach(function(e){e.rtpSender&&e.rtpSender.track===t?i=e.rtpSender:e.rtpReceiver&&e.rtpReceiver.track===t&&(i=e.rtpReceiver)}),!i)throw s("InvalidAccessError","Invalid selector.");return i.getStats()}var o=[];return this.transceivers.forEach(function(e){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(t){e[t]&&o.push(e[t].getStats())})}),Promise.all(o).then(function(e){var t=new Map;return e.forEach(function(e){e.forEach(function(e){t.set(e.id,e)})}),t})};["RTCRtpSender","RTCRtpReceiver","RTCIceGatherer","RTCIceTransport","RTCDtlsTransport"].forEach(function(t){var i=e[t];if(i&&i.prototype&&i.prototype.getStats){var o=i.prototype.getStats;i.prototype.getStats=function(){return o.apply(this).then(function(e){var t=new Map;return Object.keys(e).forEach(function(i){e[i].type=function(e){return{inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type}(e[i]),t.set(i,e[i])}),t})}}});var h=["createOffer","createAnswer"];h.forEach(function(e){var t=u.prototype[e];u.prototype[e]=function(){var e=arguments;return"function"==typeof e[0]||"function"==typeof e[1]?t.apply(this,[arguments[2]]).then(function(t){"function"==typeof e[0]&&e[0].apply(null,[t])},function(t){"function"==typeof e[1]&&e[1].apply(null,[t])}):t.apply(this,arguments)}}),h=["setLocalDescription","setRemoteDescription","addIceCandidate"];try{h.forEach(function(e){var t=u.prototype[e];u.prototype[e]=function(){var e=arguments;return"function"==typeof e[1]||"function"==typeof e[2]?t.apply(this,arguments).then(function(){"function"==typeof e[1]&&e[1].apply(null)},function(t){"function"==typeof e[2]&&e[2].apply(null,[t])}):t.apply(this,arguments)}})}catch(e){}return["getStats"].forEach(function(e){var t=u.prototype[e];u.prototype[e]=function(){var e=arguments;return"function"==typeof e[1]?t.apply(this,arguments).then(function(){"function"==typeof e[1]&&e[1].apply(null)}):t.apply(this,arguments)}}),u}},{sdp:2}],2:[function(e,t,i){"use strict";var o={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};o.localCName=o.generateIdentifier(),o.splitLines=function(e){return e.trim().split("\n").map(function(e){return e.trim()})},o.splitSections=function(e){return e.split("\nm=").map(function(e,t){return(t>0?"m="+e:e).trim()+"\r\n"})},o.getDescription=function(e){var t=o.splitSections(e);return t&&t[0]},o.getMediaSections=function(e){var t=o.splitSections(e);return t.shift(),t},o.matchPrefix=function(e,t){return o.splitLines(e).filter(function(e){return 0===e.indexOf(t)})},o.parseCandidate=function(e){for(var t,i={foundation:(t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" "))[0],component:parseInt(t[1],10),protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],address:t[4],port:parseInt(t[5],10),type:t[7]},o=8;o<t.length;o+=2)switch(t[o]){case"raddr":i.relatedAddress=t[o+1];break;case"rport":i.relatedPort=parseInt(t[o+1],10);break;case"tcptype":i.tcpType=t[o+1];break;case"ufrag":i.ufrag=t[o+1],i.usernameFragment=t[o+1];break;default:i[t[o]]=t[o+1]}return i},o.writeCandidate=function(e){var t=[];t.push(e.foundation),t.push(e.component),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.address||e.ip),t.push(e.port);var i=e.type;return t.push("typ"),t.push(i),"host"!==i&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push("ufrag"),t.push(e.usernameFragment||e.ufrag)),"candidate:"+t.join(" ")},o.parseIceOptions=function(e){return e.substr(14).split(" ")},o.parseRtpMap=function(e){var t=e.substr(9).split(" "),i={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),i.name=t[0],i.clockRate=parseInt(t[1],10),i.channels=3===t.length?parseInt(t[2],10):1,i.numChannels=i.channels,i},o.writeRtpMap=function(e){var t=e.payloadType;void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType);var i=e.channels||e.numChannels||1;return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==i?"/"+i:"")+"\r\n"},o.parseExtmap=function(e){var t=e.substr(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1]}},o.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+"\r\n"},o.parseFmtp=function(e){for(var t,i={},o=e.substr(e.indexOf(" ")+1).split(";"),n=0;n<o.length;n++)i[(t=o[n].trim().split("="))[0].trim()]=t[1];return i},o.writeFmtp=function(e){var t="",i=e.payloadType;if(void 0!==e.preferredPayloadType&&(i=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){var o=[];Object.keys(e.parameters).forEach(function(t){e.parameters[t]?o.push(t+"="+e.parameters[t]):o.push(t)}),t+="a=fmtp:"+i+" "+o.join(";")+"\r\n"}return t},o.parseRtcpFb=function(e){var t=e.substr(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},o.writeRtcpFb=function(e){var t="",i=e.payloadType;return void 0!==e.preferredPayloadType&&(i=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach(function(e){t+="a=rtcp-fb:"+i+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"}),t},o.parseSsrcMedia=function(e){var t=e.indexOf(" "),i={ssrc:parseInt(e.substr(7,t-7),10)},o=e.indexOf(":",t);return o>-1?(i.attribute=e.substr(t+1,o-t-1),i.value=e.substr(o+1)):i.attribute=e.substr(t+1),i},o.parseSsrcGroup=function(e){var t=e.substr(13).split(" ");return{semantics:t.shift(),ssrcs:t.map(function(e){return parseInt(e,10)})}},o.getMid=function(e){var t=o.matchPrefix(e,"a=mid:")[0];if(t)return t.substr(6)},o.parseFingerprint=function(e){var t=e.substr(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1]}},o.getDtlsParameters=function(e,t){return{role:"auto",fingerprints:o.matchPrefix(e+t,"a=fingerprint:").map(o.parseFingerprint)}},o.writeDtlsParameters=function(e,t){var i="a=setup:"+t+"\r\n";return e.fingerprints.forEach(function(e){i+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"}),i},o.getIceParameters=function(e,t){var i=o.splitLines(e);return{usernameFragment:(i=i.concat(o.splitLines(t))).filter(function(e){return 0===e.indexOf("a=ice-ufrag:")})[0].substr(12),password:i.filter(function(e){return 0===e.indexOf("a=ice-pwd:")})[0].substr(10)}},o.writeIceParameters=function(e){return"a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n"},o.parseRtpParameters=function(e){for(var t={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},i=o.splitLines(e)[0].split(" "),n=3;n<i.length;n++){var a=i[n],r=o.matchPrefix(e,"a=rtpmap:"+a+" ")[0];if(r){var s=o.parseRtpMap(r),l=o.matchPrefix(e,"a=fmtp:"+a+" ");switch(s.parameters=l.length?o.parseFmtp(l[0]):{},s.rtcpFeedback=o.matchPrefix(e,"a=rtcp-fb:"+a+" ").map(o.parseRtcpFb),t.codecs.push(s),s.name.toUpperCase()){case"RED":case"ULPFEC":t.fecMechanisms.push(s.name.toUpperCase())}}}return o.matchPrefix(e,"a=extmap:").forEach(function(e){t.headerExtensions.push(o.parseExtmap(e))}),t},o.writeRtpDescription=function(e,t){var i="";i+="m="+e+" ",i+=t.codecs.length>0?"9":"0",i+=" UDP/TLS/RTP/SAVPF ",i+=t.codecs.map(function(e){return void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType}).join(" ")+"\r\n",i+="c=IN IP4 0.0.0.0\r\n",i+="a=rtcp:9 IN IP4 0.0.0.0\r\n",t.codecs.forEach(function(e){i+=o.writeRtpMap(e),i+=o.writeFmtp(e),i+=o.writeRtcpFb(e)});var n=0;return t.codecs.forEach(function(e){e.maxptime>n&&(n=e.maxptime)}),n>0&&(i+="a=maxptime:"+n+"\r\n"),i+="a=rtcp-mux\r\n",t.headerExtensions&&t.headerExtensions.forEach(function(e){i+=o.writeExtmap(e)}),i},o.parseRtpEncodingParameters=function(e){var t,i=[],n=o.parseRtpParameters(e),a=-1!==n.fecMechanisms.indexOf("RED"),r=-1!==n.fecMechanisms.indexOf("ULPFEC"),s=o.matchPrefix(e,"a=ssrc:").map(function(e){return o.parseSsrcMedia(e)}).filter(function(e){return"cname"===e.attribute}),l=s.length>0&&s[0].ssrc,c=o.matchPrefix(e,"a=ssrc-group:FID").map(function(e){return e.substr(17).split(" ").map(function(e){return parseInt(e,10)})});c.length>0&&c[0].length>1&&c[0][0]===l&&(t=c[0][1]),n.codecs.forEach(function(e){if("RTX"===e.name.toUpperCase()&&e.parameters.apt){var o={ssrc:l,codecPayloadType:parseInt(e.parameters.apt,10)};l&&t&&(o.rtx={ssrc:t}),i.push(o),a&&((o=JSON.parse(JSON.stringify(o))).fec={ssrc:l,mechanism:r?"red+ulpfec":"red"},i.push(o))}}),0===i.length&&l&&i.push({ssrc:l});var d=o.matchPrefix(e,"b=");return d.length&&(d=0===d[0].indexOf("b=TIAS:")?parseInt(d[0].substr(7),10):0===d[0].indexOf("b=AS:")?1e3*parseInt(d[0].substr(5),10)*.95-16e3:void 0,i.forEach(function(e){e.maxBitrate=d})),i},o.parseRtcpParameters=function(e){var t={},i=o.matchPrefix(e,"a=ssrc:").map(function(e){return o.parseSsrcMedia(e)}).filter(function(e){return"cname"===e.attribute})[0];i&&(t.cname=i.value,t.ssrc=i.ssrc);var n=o.matchPrefix(e,"a=rtcp-rsize");t.reducedSize=n.length>0,t.compound=0===n.length;var a=o.matchPrefix(e,"a=rtcp-mux");return t.mux=a.length>0,t},o.parseMsid=function(e){var t,i=o.matchPrefix(e,"a=msid:");if(1===i.length)return{stream:(t=i[0].substr(7).split(" "))[0],track:t[1]};var n=o.matchPrefix(e,"a=ssrc:").map(function(e){return o.parseSsrcMedia(e)}).filter(function(e){return"msid"===e.attribute});return n.length>0?{stream:(t=n[0].value.split(" "))[0],track:t[1]}:void 0},o.generateSessionId=function(){return Math.random().toString().substr(2,21)},o.writeSessionBoilerplate=function(e,t,i){var n,a=void 0!==t?t:2;return n=e||o.generateSessionId(),"v=0\r\no="+(i||"thisisadapterortc")+" "+n+" "+a+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},o.writeMediaSection=function(e,t,i,n){var a=o.writeRtpDescription(e.kind,t);if(a+=o.writeIceParameters(e.iceGatherer.getLocalParameters()),a+=o.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===i?"actpass":"active"),a+="a=mid:"+e.mid+"\r\n",a+=e.direction?"a="+e.direction+"\r\n":e.rtpSender&&e.rtpReceiver?"a=sendrecv\r\n":e.rtpSender?"a=sendonly\r\n":e.rtpReceiver?"a=recvonly\r\n":"a=inactive\r\n",e.rtpSender){var r="msid:"+n.id+" "+e.rtpSender.track.id+"\r\n";a+="a="+r,a+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+r,e.sendEncodingParameters[0].rtx&&(a+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+r,a+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return a+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+o.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(a+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+o.localCName+"\r\n"),a},o.getDirection=function(e,t){for(var i=o.splitLines(e),n=0;n<i.length;n++)switch(i[n]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return i[n].substr(2)}return t?o.getDirection(t):"sendrecv"},o.getKind=function(e){return o.splitLines(e)[0].split(" ")[0].substr(2)},o.isRejected=function(e){return"0"===e.split(" ",2)[1]},o.parseMLine=function(e){var t=o.splitLines(e)[0].substr(2).split(" ");return{kind:t[0],port:parseInt(t[1],10),protocol:t[2],fmt:t.slice(3).join(" ")}},o.parseOLine=function(e){var t=o.matchPrefix(e,"o=")[0].substr(2).split(" ");return{username:t[0],sessionId:t[1],sessionVersion:parseInt(t[2],10),netType:t[3],addressType:t[4],address:t[5]}},o.isValidSDP=function(e){if("string"!=typeof e||0===e.length)return!1;for(var t=o.splitLines(e),i=0;i<t.length;i++)if(t[i].length<2||"="!==t[i].charAt(1))return!1;return!0},"object"==typeof t&&(t.exports=o)},{}],3:[function(e,t,i){(function(i){"use strict";var o=e("./adapter_factory.js");t.exports=o({window:i.window})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./adapter_factory.js":4}],4:[function(e,t,i){"use strict";var o=e("./utils");t.exports=function(t,i){var n=t&&t.window,a={shimChrome:!0,shimFirefox:!0,shimEdge:!0,shimSafari:!0};for(var r in i)hasOwnProperty.call(i,r)&&(a[r]=i[r]);var s=o.log,l=o.detectBrowser(n),c=e("./chrome/chrome_shim")||null,d=e("./edge/edge_shim")||null,u=e("./firefox/firefox_shim")||null,h=e("./safari/safari_shim")||null,p=e("./common_shim")||null,v={browserDetails:l,commonShim:p,extractVersion:o.extractVersion,disableLog:o.disableLog,disableWarnings:o.disableWarnings};switch(l.browser){case"chrome":if(!c||!c.shimPeerConnection||!a.shimChrome)return s("Chrome shim is not included in this adapter release."),v;s("adapter.js shimming chrome."),v.browserShim=c,p.shimCreateObjectURL(n),c.shimGetUserMedia(n),c.shimMediaStream(n),c.shimSourceObject(n),c.shimPeerConnection(n),c.shimOnTrack(n),c.shimAddTrackRemoveTrack(n),c.shimGetSendersWithDtmf(n),c.shimSenderReceiverGetStats(n),c.fixNegotiationNeeded(n),p.shimRTCIceCandidate(n),p.shimMaxMessageSize(n),p.shimSendThrowTypeError(n);break;case"firefox":if(!u||!u.shimPeerConnection||!a.shimFirefox)return s("Firefox shim is not included in this adapter release."),v;s("adapter.js shimming firefox."),v.browserShim=u,p.shimCreateObjectURL(n),u.shimGetUserMedia(n),u.shimSourceObject(n),u.shimPeerConnection(n),u.shimOnTrack(n),u.shimRemoveStream(n),u.shimSenderGetStats(n),u.shimReceiverGetStats(n),u.shimRTCDataChannel(n),p.shimRTCIceCandidate(n),p.shimMaxMessageSize(n),p.shimSendThrowTypeError(n);break;case"edge":if(!d||!d.shimPeerConnection||!a.shimEdge)return s("MS edge shim is not included in this adapter release."),v;s("adapter.js shimming edge."),v.browserShim=d,p.shimCreateObjectURL(n),d.shimGetUserMedia(n),d.shimPeerConnection(n),d.shimReplaceTrack(n),p.shimMaxMessageSize(n),p.shimSendThrowTypeError(n);break;case"safari":if(!h||!a.shimSafari)return s("Safari shim is not included in this adapter release."),v;s("adapter.js shimming safari."),v.browserShim=h,p.shimCreateObjectURL(n),h.shimRTCIceServerUrls(n),h.shimCreateOfferLegacy(n),h.shimCallbacksAPI(n),h.shimLocalStreamsAPI(n),h.shimRemoteStreamsAPI(n),h.shimTrackEventTransceiver(n),h.shimGetUserMedia(n),p.shimRTCIceCandidate(n),p.shimMaxMessageSize(n),p.shimSendThrowTypeError(n);break;default:s("Unsupported browser!")}return v}},{"./chrome/chrome_shim":5,"./common_shim":7,"./edge/edge_shim":8,"./firefox/firefox_shim":11,"./safari/safari_shim":13,"./utils":14}],5:[function(e,t,i){"use strict";function o(e,t,i){var o=i?"outbound-rtp":"inbound-rtp",n=new Map;if(null===t)return n;var a=[];return e.forEach(function(e){"track"===e.type&&e.trackIdentifier===t.id&&a.push(e)}),a.forEach(function(t){e.forEach(function(i){i.type===o&&i.trackId===t.id&&function e(t,i,o){i&&!o.has(i.id)&&(o.set(i.id,i),Object.keys(i).forEach(function(n){n.endsWith("Id")?e(t,t.get(i[n]),o):n.endsWith("Ids")&&i[n].forEach(function(i){e(t,t.get(i),o)})}))}(e,i,n)})}),n}var n=e("../utils.js"),a=n.log;t.exports={shimGetUserMedia:e("./getusermedia"),shimMediaStream:function(e){e.MediaStream=e.MediaStream||e.webkitMediaStream},shimOnTrack:function(e){if("object"!=typeof e||!e.RTCPeerConnection||"ontrack"in e.RTCPeerConnection.prototype)n.wrapPeerConnectionEvent(e,"track",function(e){return e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e});else{Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)},enumerable:!0,configurable:!0});var t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){var i=this;return i._ontrackpoly||(i._ontrackpoly=function(t){t.stream.addEventListener("addtrack",function(o){var n;n=e.RTCPeerConnection.prototype.getReceivers?i.getReceivers().find(function(e){return e.track&&e.track.id===o.track.id}):{track:o.track};var a=new Event("track");a.track=o.track,a.receiver=n,a.transceiver={receiver:n},a.streams=[t.stream],i.dispatchEvent(a)}),t.stream.getTracks().forEach(function(o){var n;n=e.RTCPeerConnection.prototype.getReceivers?i.getReceivers().find(function(e){return e.track&&e.track.id===o.id}):{track:o};var a=new Event("track");a.track=o,a.receiver=n,a.transceiver={receiver:n},a.streams=[t.stream],i.dispatchEvent(a)})},i.addEventListener("addstream",i._ontrackpoly)),t.apply(i,arguments)}}},shimGetSendersWithDtmf:function(e){if("object"==typeof e&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){var t=function(e,t){return{track:t,get dtmf(){return void 0===this._dtmf&&("audio"===t.kind?this._dtmf=e.createDTMFSender(t):this._dtmf=null),this._dtmf},_pc:e}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};var i=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,o){var n=this,a=i.apply(n,arguments);return a||(a=t(n,e),n._senders.push(a)),a};var o=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){var t=this;o.apply(t,arguments);var i=t._senders.indexOf(e);-1!==i&&t._senders.splice(i,1)}}var n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){var i=this;i._senders=i._senders||[],n.apply(i,[e]),e.getTracks().forEach(function(e){i._senders.push(t(i,e))})};var a=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;t._senders=t._senders||[],a.apply(t,[e]),e.getTracks().forEach(function(e){var i=t._senders.find(function(t){return t.track===e});i&&t._senders.splice(t._senders.indexOf(i),1)})}}else if("object"==typeof e&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){var r=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){var e=this,t=r.apply(e,[]);return t.forEach(function(t){t._pc=e}),t},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}},shimSenderReceiverGetStats:function(e){if("object"==typeof e&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver){if(!("getStats"in e.RTCRtpSender.prototype)){var t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){var e=this,i=t.apply(e,[]);return i.forEach(function(t){t._pc=e}),i});var i=e.RTCPeerConnection.prototype.addTrack;i&&(e.RTCPeerConnection.prototype.addTrack=function(){var e=i.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){var e=this;return this._pc.getStats().then(function(t){return o(t,e.track,!0)})}}if(!("getStats"in e.RTCRtpReceiver.prototype)){var a=e.RTCPeerConnection.prototype.getReceivers;a&&(e.RTCPeerConnection.prototype.getReceivers=function(){var e=this,t=a.apply(e,[]);return t.forEach(function(t){t._pc=e}),t}),n.wrapPeerConnectionEvent(e,"track",function(e){return e.receiver._pc=e.srcElement,e}),e.RTCRtpReceiver.prototype.getStats=function(){var e=this;return this._pc.getStats().then(function(t){return o(t,e.track,!1)})}}if("getStats"in e.RTCRtpSender.prototype&&"getStats"in e.RTCRtpReceiver.prototype){var r=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){var t=this;if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){var i,o,n,a=arguments[0];return t.getSenders().forEach(function(e){e.track===a&&(i?n=!0:i=e)}),t.getReceivers().forEach(function(e){return e.track===a&&(o?n=!0:o=e),e.track===a}),n||i&&o?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):i?i.getStats():o?o.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return r.apply(t,arguments)}}}},shimSourceObject:function(e){var t=e&&e.URL;"object"==typeof e&&(!e.HTMLMediaElement||"srcObject"in e.HTMLMediaElement.prototype||Object.defineProperty(e.HTMLMediaElement.prototype,"srcObject",{get:function(){return this._srcObject},set:function(e){var i=this;return this._srcObject=e,this.src&&t.revokeObjectURL(this.src),e?(this.src=t.createObjectURL(e),e.addEventListener("addtrack",function(){i.src&&t.revokeObjectURL(i.src),i.src=t.createObjectURL(e)}),void e.addEventListener("removetrack",function(){i.src&&t.revokeObjectURL(i.src),i.src=t.createObjectURL(e)})):void(this.src="")}}))},shimAddTrackRemoveTrackWithNative:function(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){var e=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(function(t){return e._shimmedLocalStreams[t][0]})};var t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,i){if(!i)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};var o=t.apply(this,arguments);return this._shimmedLocalStreams[i.id]?-1===this._shimmedLocalStreams[i.id].indexOf(o)&&this._shimmedLocalStreams[i.id].push(o):this._shimmedLocalStreams[i.id]=[i,o],o};var i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){var t=this;this._shimmedLocalStreams=this._shimmedLocalStreams||{},e.getTracks().forEach(function(e){if(t.getSenders().find(function(t){return t.track===e}))throw new DOMException("Track already exists.","InvalidAccessError")});var o=t.getSenders();i.apply(this,arguments);var n=t.getSenders().filter(function(e){return-1===o.indexOf(e)});this._shimmedLocalStreams[e.id]=[e].concat(n)};var o=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[e.id],o.apply(this,arguments)};var n=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){var t=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},e&&Object.keys(this._shimmedLocalStreams).forEach(function(i){var o=t._shimmedLocalStreams[i].indexOf(e);-1!==o&&t._shimmedLocalStreams[i].splice(o,1),1===t._shimmedLocalStreams[i].length&&delete t._shimmedLocalStreams[i]}),n.apply(this,arguments)}},shimAddTrackRemoveTrack:function(e){function t(e,t){var i=t.sdp;return Object.keys(e._reverseStreams||[]).forEach(function(t){var o=e._reverseStreams[t],n=e._streams[o.id];i=i.replace(new RegExp(n.id,"g"),o.id)}),new RTCSessionDescription({type:t.type,sdp:i})}var i=n.detectBrowser(e);if(e.RTCPeerConnection.prototype.addTrack&&i.version>=65)return this.shimAddTrackRemoveTrackWithNative(e);var o=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){var e=this,t=o.apply(this);return e._reverseStreams=e._reverseStreams||{},t.map(function(t){return e._reverseStreams[t.id]})};var a=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(t){var i=this;if(i._streams=i._streams||{},i._reverseStreams=i._reverseStreams||{},t.getTracks().forEach(function(e){if(i.getSenders().find(function(t){return t.track===e}))throw new DOMException("Track already exists.","InvalidAccessError")}),!i._reverseStreams[t.id]){var o=new e.MediaStream(t.getTracks());i._streams[t.id]=o,i._reverseStreams[o.id]=t,t=o}a.apply(i,[t])};var r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;t._streams=t._streams||{},t._reverseStreams=t._reverseStreams||{},r.apply(t,[t._streams[e.id]||e]),delete t._reverseStreams[t._streams[e.id]?t._streams[e.id].id:e.id],delete t._streams[e.id]},e.RTCPeerConnection.prototype.addTrack=function(t,i){var o=this;if("closed"===o.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");var n=[].slice.call(arguments,1);if(1!==n.length||!n[0].getTracks().find(function(e){return e===t}))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(o.getSenders().find(function(e){return e.track===t}))throw new DOMException("Track already exists.","InvalidAccessError");o._streams=o._streams||{},o._reverseStreams=o._reverseStreams||{};var a=o._streams[i.id];if(a)a.addTrack(t),Promise.resolve().then(function(){o.dispatchEvent(new Event("negotiationneeded"))});else{var r=new e.MediaStream([t]);o._streams[i.id]=r,o._reverseStreams[r.id]=i,o.addStream(r)}return o.getSenders().find(function(e){return e.track===t})},["createOffer","createAnswer"].forEach(function(i){var o=e.RTCPeerConnection.prototype[i];e.RTCPeerConnection.prototype[i]=function(){var e=this,i=arguments;return arguments.length&&"function"==typeof arguments[0]?o.apply(e,[function(o){var n=t(e,o);i[0].apply(null,[n])},function(e){i[1]&&i[1].apply(null,e)},arguments[2]]):o.apply(e,arguments).then(function(i){return t(e,i)})}});var s=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){var e=this;return arguments.length&&arguments[0].type?(arguments[0]=function(e,t){var i=t.sdp;return Object.keys(e._reverseStreams||[]).forEach(function(t){var o=e._reverseStreams[t],n=e._streams[o.id];i=i.replace(new RegExp(o.id,"g"),n.id)}),new RTCSessionDescription({type:t.type,sdp:i})}(e,arguments[0]),s.apply(e,arguments)):s.apply(e,arguments)};var l=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get:function(){var e=l.get.apply(this);return""===e.type?e:t(this,e)}}),e.RTCPeerConnection.prototype.removeTrack=function(e){var t,i=this;if("closed"===i.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!e._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(e._pc===i))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");i._streams=i._streams||{},Object.keys(i._streams).forEach(function(o){i._streams[o].getTracks().find(function(t){return e.track===t})&&(t=i._streams[o])}),t&&(1===t.getTracks().length?i.removeStream(i._reverseStreams[t.id]):t.removeTrack(e.track),i.dispatchEvent(new Event("negotiationneeded")))}},shimPeerConnection:function(e){var t=n.detectBrowser(e);!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=function(t,i){return a("PeerConnection"),t&&t.iceTransportPolicy&&(t.iceTransports=t.iceTransportPolicy),new e.webkitRTCPeerConnection(t,i)},e.RTCPeerConnection.prototype=e.webkitRTCPeerConnection.prototype,e.webkitRTCPeerConnection.generateCertificate&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return e.webkitRTCPeerConnection.generateCertificate}}));var i=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(e,t,o){var n=this,a=arguments;if(arguments.length>0&&"function"==typeof e)return i.apply(this,arguments);var r=function(e){var t={};return e.result().forEach(function(e){var i={id:e.id,timestamp:e.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};e.names().forEach(function(t){i[t]=e.stat(t)}),t[i.id]=i}),t},s=function(e){var t=new Map(Object.keys(e).map(function(t){return[t,e[t]]}));return Object.keys(e).forEach(function(i){t[i]=e[i]}),t};if(arguments.length>=2){return i.apply(this,[function(e){a[1](s(r(e)))},arguments[0]])}return new Promise(function(e,t){i.apply(n,[function(t){e(s(r(t)))},t])}).then(t,o)},t.version<51&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){try{var i=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){var e=arguments,t=this,o=new Promise(function(o,n){i.apply(t,[e[0],o,n])});return e.length<2?o:o.then(function(){e[1].apply(null,[])},function(t){e.length>=3&&e[2].apply(null,[t])})}}catch(e){}}),t.version<52&&["createOffer","createAnswer"].forEach(function(t){var i=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){var e=this;if(arguments.length<1||1===arguments.length&&"object"==typeof arguments[0]){var t=1===arguments.length?arguments[0]:void 0;return new Promise(function(o,n){i.apply(e,[o,n,t])})}return i.apply(this,arguments)}}),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){try{var i=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),i.apply(this,arguments)}}catch(e){}});try{var o=e.RTCPeerConnection.prototype.addIceCandidate;e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?o.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())}}catch(e){}},fixNegotiationNeeded:function(e){n.wrapPeerConnectionEvent(e,"negotiationneeded",function(e){if("stable"===e.target.signalingState)return e})},shimGetDisplayMedia:function(e,t){if(!("getDisplayMedia"in e.navigator))return"function"!=typeof t?void console.error("shimGetDisplayMedia: getSourceId argument is not a function"):void(navigator.getDisplayMedia=function(e){return t(e).then(function(t){return e.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t,maxFrameRate:e.video.frameRate||3}},navigator.mediaDevices.getUserMedia(e)})})}}},{"../utils.js":14,"./getusermedia":6}],6:[function(e,t,i){"use strict";var o=e("../utils.js"),n=o.log;t.exports=function(e){var t=o.detectBrowser(e),i=e&&e.navigator,a=function(e){if("object"!=typeof e||e.mandatory||e.optional)return e;var t={};return Object.keys(e).forEach(function(i){if("require"!==i&&"advanced"!==i&&"mediaSource"!==i){var o="object"==typeof e[i]?e[i]:{ideal:e[i]};void 0!==o.exact&&"number"==typeof o.exact&&(o.min=o.max=o.exact);var n=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==o.ideal){t.optional=t.optional||[];var a={};"number"==typeof o.ideal?(a[n("min",i)]=o.ideal,t.optional.push(a),(a={})[n("max",i)]=o.ideal,t.optional.push(a)):(a[n("",i)]=o.ideal,t.optional.push(a))}void 0!==o.exact&&"number"!=typeof o.exact?(t.mandatory=t.mandatory||{},t.mandatory[n("",i)]=o.exact):["min","max"].forEach(function(e){void 0!==o[e]&&(t.mandatory=t.mandatory||{},t.mandatory[n(e,i)]=o[e])})}}),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t},r=function(e,o){if(t.version>=61)return o(e);if((e=JSON.parse(JSON.stringify(e)))&&"object"==typeof e.audio){var r=function(e,t,i){t in e&&!(i in e)&&(e[i]=e[t],delete e[t])};r((e=JSON.parse(JSON.stringify(e))).audio,"autoGainControl","googAutoGainControl"),r(e.audio,"noiseSuppression","googNoiseSuppression"),e.audio=a(e.audio)}if(e&&"object"==typeof e.video){var s=e.video.facingMode;s=s&&("object"==typeof s?s:{ideal:s});var l,c=t.version<66;if(s&&("user"===s.exact||"environment"===s.exact||"user"===s.ideal||"environment"===s.ideal)&&(!i.mediaDevices.getSupportedConstraints||!i.mediaDevices.getSupportedConstraints().facingMode||c))if(delete e.video.facingMode,"environment"===s.exact||"environment"===s.ideal?l=["back","rear"]:"user"!==s.exact&&"user"!==s.ideal||(l=["front"]),l)return i.mediaDevices.enumerateDevices().then(function(t){var i=(t=t.filter(function(e){return"videoinput"===e.kind})).find(function(e){return l.some(function(t){return-1!==e.label.toLowerCase().indexOf(t)})});return!i&&t.length&&-1!==l.indexOf("back")&&(i=t[t.length-1]),i&&(e.video.deviceId=s.exact?{exact:i.deviceId}:{ideal:i.deviceId}),e.video=a(e.video),n("chrome: "+JSON.stringify(e)),o(e)});e.video=a(e.video)}return n("chrome: "+JSON.stringify(e)),o(e)},s=function(e){return t.version>=64?e:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[e.name]||e.name,message:e.message,constraint:e.constraint||e.constraintName,toString:function(){return this.name+(this.message&&": ")+this.message}}};i.getUserMedia=function(e,t,o){r(e,function(e){i.webkitGetUserMedia(e,t,function(e){o&&o(s(e))})})};var l=function(e){return new Promise(function(t,o){i.getUserMedia(e,t,o)})};if(i.mediaDevices||(i.mediaDevices={getUserMedia:l,enumerateDevices:function(){return new Promise(function(t){var i={audio:"audioinput",video:"videoinput"};return e.MediaStreamTrack.getSources(function(e){t(e.map(function(e){return{label:e.label,kind:i[e.kind],deviceId:e.id,groupId:""}}))})})},getSupportedConstraints:function(){return{deviceId:!0,echoCancellation:!0,facingMode:!0,frameRate:!0,height:!0,width:!0}}}),i.mediaDevices.getUserMedia){var c=i.mediaDevices.getUserMedia.bind(i.mediaDevices);i.mediaDevices.getUserMedia=function(e){return r(e,function(e){return c(e).then(function(t){if(e.audio&&!t.getAudioTracks().length||e.video&&!t.getVideoTracks().length)throw t.getTracks().forEach(function(e){e.stop()}),new DOMException("","NotFoundError");return t},function(e){return Promise.reject(s(e))})})}}else i.mediaDevices.getUserMedia=function(e){return l(e)};void 0===i.mediaDevices.addEventListener&&(i.mediaDevices.addEventListener=function(){n("Dummy mediaDevices.addEventListener called.")}),void 0===i.mediaDevices.removeEventListener&&(i.mediaDevices.removeEventListener=function(){n("Dummy mediaDevices.removeEventListener called.")})}},{"../utils.js":14}],7:[function(e,t,i){"use strict";var o=e("sdp"),n=e("./utils");t.exports={shimRTCIceCandidate:function(e){if(e.RTCIceCandidate&&!(e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)){var t=e.RTCIceCandidate;e.RTCIceCandidate=function(e){if("object"==typeof e&&e.candidate&&0===e.candidate.indexOf("a=")&&((e=JSON.parse(JSON.stringify(e))).candidate=e.candidate.substr(2)),e.candidate&&e.candidate.length){var i=new t(e),n=o.parseCandidate(e.candidate),a=Object.assign(i,n);return a.toJSON=function(){return{candidate:a.candidate,sdpMid:a.sdpMid,sdpMLineIndex:a.sdpMLineIndex,usernameFragment:a.usernameFragment}},a}return new t(e)},e.RTCIceCandidate.prototype=t.prototype,n.wrapPeerConnectionEvent(e,"icecandidate",function(t){return t.candidate&&Object.defineProperty(t,"candidate",{value:new e.RTCIceCandidate(t.candidate),writable:"false"}),t})}},shimCreateObjectURL:function(e){var t=e&&e.URL;if("object"==typeof e&&e.HTMLMediaElement&&"srcObject"in e.HTMLMediaElement.prototype&&t.createObjectURL&&t.revokeObjectURL){var i=t.createObjectURL.bind(t),o=t.revokeObjectURL.bind(t),a=new Map,r=0;t.createObjectURL=function(e){if("getTracks"in e){var t="polyblob:"+ ++r;return a.set(t,e),n.deprecated("URL.createObjectURL(stream)","elem.srcObject = stream"),t}return i(e)},t.revokeObjectURL=function(e){o(e),a.delete(e)};var s=Object.getOwnPropertyDescriptor(e.HTMLMediaElement.prototype,"src");Object.defineProperty(e.HTMLMediaElement.prototype,"src",{get:function(){return s.get.apply(this)},set:function(e){return this.srcObject=a.get(e)||null,s.set.apply(this,[e])}});var l=e.HTMLMediaElement.prototype.setAttribute;e.HTMLMediaElement.prototype.setAttribute=function(){return 2===arguments.length&&"src"===(""+arguments[0]).toLowerCase()&&(this.srcObject=a.get(arguments[1])||null),l.apply(this,arguments)}}},shimMaxMessageSize:function(e){if(!e.RTCSctpTransport&&e.RTCPeerConnection){var t=n.detectBrowser(e);"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get:function(){return void 0===this._sctp?null:this._sctp}});var i=function(e){var t=o.splitSections(e.sdp);return t.shift(),t.some(function(e){var t=o.parseMLine(e);return t&&"application"===t.kind&&-1!==t.protocol.indexOf("SCTP")})},a=function(e){var i=65536;return"firefox"===t.browser&&(i=t.version<57?-1===e?16384:2147483637:t.version<60?57===t.version?65535:65536:2147483637),i},r=function(e,i){var n=65536;"firefox"===t.browser&&57===t.version&&(n=65535);var a=o.matchPrefix(e.sdp,"a=max-message-size:");return a.length>0?n=parseInt(a[0].substr(19),10):"firefox"===t.browser&&-1!==i&&(n=2147483637),n};try{var s=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){var e=this;if(e._sctp=null,i(arguments[0])){var t,o=function(e){var t=e.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===t||t.length<2)return-1;var i=parseInt(t[1],10);return i!=i?-1:i}(arguments[0]),n=a(o),l=r(arguments[0],o);t=0===n&&0===l?Number.POSITIVE_INFINITY:0===n||0===l?Math.max(n,l):Math.min(n,l);var c={};Object.defineProperty(c,"maxMessageSize",{get:function(){return t}}),e._sctp=c}return s.apply(e,arguments)}}catch(e){}}},shimSendThrowTypeError:function(e){function t(e,t){var i=e.send;e.send=function(){var o=arguments[0],n=o.length||o.size||o.byteLength;if("open"===e.readyState&&t.sctp&&n>t.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+t.sctp.maxMessageSize+" bytes)");return i.apply(e,arguments)}}if(e.RTCPeerConnection&&"createDataChannel"in e.RTCPeerConnection.prototype){var i=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){var e=i.apply(this,arguments);return t(e,this),e},n.wrapPeerConnectionEvent(e,"datachannel",function(e){return t(e.channel,e.target),e})}}}},{"./utils":14,sdp:2}],8:[function(e,t,i){"use strict";var o=e("../utils"),n=e("./filtericeservers"),a=e("rtcpeerconnection-shim");t.exports={shimGetUserMedia:e("./getusermedia"),shimPeerConnection:function(e){var t=o.detectBrowser(e);if(e.RTCIceGatherer&&(e.RTCIceCandidate||(e.RTCIceCandidate=function(e){return e}),e.RTCSessionDescription||(e.RTCSessionDescription=function(e){return e}),t.version<15025)){var i=Object.getOwnPropertyDescriptor(e.MediaStreamTrack.prototype,"enabled");Object.defineProperty(e.MediaStreamTrack.prototype,"enabled",{set:function(e){i.set.call(this,e);var t=new Event("enabled");t.enabled=e,this.dispatchEvent(t)}})}!e.RTCRtpSender||"dtmf"in e.RTCRtpSender.prototype||Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=new e.RTCDtmfSender(this):"video"===this.track.kind&&(this._dtmf=null)),this._dtmf}}),e.RTCDtmfSender&&!e.RTCDTMFSender&&(e.RTCDTMFSender=e.RTCDtmfSender);var r=a(e,t.version);e.RTCPeerConnection=function(e){return e&&e.iceServers&&(e.iceServers=n(e.iceServers)),new r(e)},e.RTCPeerConnection.prototype=r.prototype},shimReplaceTrack:function(e){!e.RTCRtpSender||"replaceTrack"in e.RTCRtpSender.prototype||(e.RTCRtpSender.prototype.replaceTrack=e.RTCRtpSender.prototype.setTrack)}}},{"../utils":14,"./filtericeservers":9,"./getusermedia":10,"rtcpeerconnection-shim":1}],9:[function(e,t,i){"use strict";var o=e("../utils");t.exports=function(e,t){var i=!1;return(e=JSON.parse(JSON.stringify(e))).filter(function(e){if(e&&(e.urls||e.url)){var n=e.urls||e.url;e.url&&!e.urls&&o.deprecated("RTCIceServer.url","RTCIceServer.urls");var a="string"==typeof n;return a&&(n=[n]),n=n.filter(function(e){return 0===e.indexOf("turn:")&&-1!==e.indexOf("transport=udp")&&-1===e.indexOf("turn:[")&&!i?(i=!0,!0):0===e.indexOf("stun:")&&t>=14393&&-1===e.indexOf("?transport=udp")}),delete e.url,e.urls=a?n[0]:n,!!n.length}})}},{"../utils":14}],10:[function(e,t,i){"use strict";t.exports=function(e){var t=e&&e.navigator,i=t.mediaDevices.getUserMedia.bind(t.mediaDevices);t.mediaDevices.getUserMedia=function(e){return i(e).catch(function(e){return Promise.reject(function(e){return{name:{PermissionDeniedError:"NotAllowedError"}[e.name]||e.name,message:e.message,constraint:e.constraint,toString:function(){return this.name}}}(e))})}}},{}],11:[function(e,t,i){"use strict";var o=e("../utils");t.exports={shimGetUserMedia:e("./getusermedia"),shimOnTrack:function(e){"object"!=typeof e||!e.RTCPeerConnection||"ontrack"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){this._ontrack&&(this.removeEventListener("track",this._ontrack),this.removeEventListener("addstream",this._ontrackpoly)),this.addEventListener("track",this._ontrack=e),this.addEventListener("addstream",this._ontrackpoly=function(e){e.stream.getTracks().forEach(function(t){var i=new Event("track");i.track=t,i.receiver={track:t},i.transceiver={receiver:i.receiver},i.streams=[e.stream],this.dispatchEvent(i)}.bind(this))}.bind(this))},enumerable:!0,configurable:!0}),"object"==typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},shimSourceObject:function(e){"object"==typeof e&&(!e.HTMLMediaElement||"srcObject"in e.HTMLMediaElement.prototype||Object.defineProperty(e.HTMLMediaElement.prototype,"srcObject",{get:function(){return this.mozSrcObject},set:function(e){this.mozSrcObject=e}}))},shimPeerConnection:function(e){var t=o.detectBrowser(e);if("object"==typeof e&&(e.RTCPeerConnection||e.mozRTCPeerConnection)){e.RTCPeerConnection||(e.RTCPeerConnection=function(i,o){if(t.version<38&&i&&i.iceServers){for(var n=[],a=0;a<i.iceServers.length;a++){var r=i.iceServers[a];if(r.hasOwnProperty("urls"))for(var s=0;s<r.urls.length;s++){var l={url:r.urls[s]};0===r.urls[s].indexOf("turn")&&(l.username=r.username,l.credential=r.credential),n.push(l)}else n.push(i.iceServers[a])}i.iceServers=n}return new e.mozRTCPeerConnection(i,o)},e.RTCPeerConnection.prototype=e.mozRTCPeerConnection.prototype,e.mozRTCPeerConnection.generateCertificate&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return e.mozRTCPeerConnection.generateCertificate}}),e.RTCSessionDescription=e.mozRTCSessionDescription,e.RTCIceCandidate=e.mozRTCIceCandidate),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){try{var i=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),i.apply(this,arguments)}}catch(e){}});try{var i=e.RTCPeerConnection.prototype.addIceCandidate;e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?i.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())}}catch(e){}var n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},a=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(e,i,o){return a.apply(this,[e||null]).then(function(e){if(t.version<48&&(e=function(e){var t=new Map;return Object.keys(e).forEach(function(i){t.set(i,e[i]),t[i]=e[i]}),t}(e)),t.version<53&&!i)try{e.forEach(function(e){e.type=n[e.type]||e.type})}catch(t){if("TypeError"!==t.name)throw t;e.forEach(function(t,i){e.set(i,Object.assign({},t,{type:n[t.type]||t.type}))})}return e}).then(i,o)}}},shimSenderGetStats:function(e){if("object"==typeof e&&e.RTCPeerConnection&&e.RTCRtpSender&&!(e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)){var t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){var e=this,i=t.apply(e,[]);return i.forEach(function(t){t._pc=e}),i});var i=e.RTCPeerConnection.prototype.addTrack;i&&(e.RTCPeerConnection.prototype.addTrack=function(){var e=i.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}},shimReceiverGetStats:function(e){if("object"==typeof e&&e.RTCPeerConnection&&e.RTCRtpSender&&!(e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)){var t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){var e=this,i=t.apply(e,[]);return i.forEach(function(t){t._pc=e}),i}),o.wrapPeerConnectionEvent(e,"track",function(e){return e.receiver._pc=e.srcElement,e}),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}},shimRemoveStream:function(e){!e.RTCPeerConnection||"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;o.deprecated("removeStream","removeTrack"),this.getSenders().forEach(function(i){i.track&&-1!==e.getTracks().indexOf(i.track)&&t.removeTrack(i)})})},shimRTCDataChannel:function(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)},shimGetDisplayMedia:function(e,t){"getDisplayMedia"in e.navigator||(navigator.getDisplayMedia=function(e){if(!e||!e.video){var i=new DOMException("getDisplayMedia without video constraints is undefined");return i.name="NotFoundError",i.code=8,Promise.reject(i)}return!0===e.video?e.video={mediaSource:t}:e.video.mediaSource=t,navigator.mediaDevices.getUserMedia(e)})}}},{"../utils":14,"./getusermedia":12}],12:[function(e,t,i){"use strict";var o=e("../utils"),n=o.log;t.exports=function(e){var t=o.detectBrowser(e),i=e&&e.navigator,a=e&&e.MediaStreamTrack,r=function(e){return{name:{InternalError:"NotReadableError",NotSupportedError:"TypeError",PermissionDeniedError:"NotAllowedError",SecurityError:"NotAllowedError"}[e.name]||e.name,message:{"The operation is insecure.":"The request is not allowed by the user agent or the platform in the current context."}[e.message]||e.message,constraint:e.constraint,toString:function(){return this.name+(this.message&&": ")+this.message}}},s=function(e,o,a){var s=function(e){if("object"!=typeof e||e.require)return e;var t=[];return Object.keys(e).forEach(function(i){if("require"!==i&&"advanced"!==i&&"mediaSource"!==i){var o=e[i]="object"==typeof e[i]?e[i]:{ideal:e[i]};if(void 0===o.min&&void 0===o.max&&void 0===o.exact||t.push(i),void 0!==o.exact&&("number"==typeof o.exact?o.min=o.max=o.exact:e[i]=o.exact,delete o.exact),void 0!==o.ideal){e.advanced=e.advanced||[];var n={};"number"==typeof o.ideal?n[i]={min:o.ideal,max:o.ideal}:n[i]=o.ideal,e.advanced.push(n),delete o.ideal,Object.keys(o).length||delete e[i]}}}),t.length&&(e.require=t),e};return e=JSON.parse(JSON.stringify(e)),t.version<38&&(n("spec: "+JSON.stringify(e)),e.audio&&(e.audio=s(e.audio)),e.video&&(e.video=s(e.video)),n("ff37: "+JSON.stringify(e))),i.mozGetUserMedia(e,o,function(e){a(r(e))})};if(i.mediaDevices||(i.mediaDevices={getUserMedia:function(e){return new Promise(function(t,i){s(e,t,i)})},addEventListener:function(){},removeEventListener:function(){}}),i.mediaDevices.enumerateDevices=i.mediaDevices.enumerateDevices||function(){return new Promise(function(e){e([{kind:"audioinput",deviceId:"default",label:"",groupId:""},{kind:"videoinput",deviceId:"default",label:"",groupId:""}])})},t.version<41){var l=i.mediaDevices.enumerateDevices.bind(i.mediaDevices);i.mediaDevices.enumerateDevices=function(){return l().then(void 0,function(e){if("NotFoundError"===e.name)return[];throw e})}}if(t.version<49){var c=i.mediaDevices.getUserMedia.bind(i.mediaDevices);i.mediaDevices.getUserMedia=function(e){return c(e).then(function(t){if(e.audio&&!t.getAudioTracks().length||e.video&&!t.getVideoTracks().length)throw t.getTracks().forEach(function(e){e.stop()}),new DOMException("The object can not be found here.","NotFoundError");return t},function(e){return Promise.reject(r(e))})}}if(!(t.version>55&&"autoGainControl"in i.mediaDevices.getSupportedConstraints())){var d=function(e,t,i){t in e&&!(i in e)&&(e[i]=e[t],delete e[t])},u=i.mediaDevices.getUserMedia.bind(i.mediaDevices);if(i.mediaDevices.getUserMedia=function(e){return"object"==typeof e&&"object"==typeof e.audio&&(e=JSON.parse(JSON.stringify(e)),d(e.audio,"autoGainControl","mozAutoGainControl"),d(e.audio,"noiseSuppression","mozNoiseSuppression")),u(e)},a&&a.prototype.getSettings){var h=a.prototype.getSettings;a.prototype.getSettings=function(){var e=h.apply(this,arguments);return d(e,"mozAutoGainControl","autoGainControl"),d(e,"mozNoiseSuppression","noiseSuppression"),e}}if(a&&a.prototype.applyConstraints){var p=a.prototype.applyConstraints;a.prototype.applyConstraints=function(e){return"audio"===this.kind&&"object"==typeof e&&(e=JSON.parse(JSON.stringify(e)),d(e,"autoGainControl","mozAutoGainControl"),d(e,"noiseSuppression","mozNoiseSuppression")),p.apply(this,[e])}}}i.getUserMedia=function(e,n,a){return t.version<44?s(e,n,a):(o.deprecated("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),void i.mediaDevices.getUserMedia(e).then(n,a))}}},{"../utils":14}],13:[function(e,t,i){"use strict";var o=e("../utils");t.exports={shimLocalStreamsAPI:function(e){if("object"==typeof e&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),"getStreamById"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getStreamById=function(e){var t=null;return this._localStreams&&this._localStreams.forEach(function(i){i.id===e&&(t=i)}),this._remoteStreams&&this._remoteStreams.forEach(function(i){i.id===e&&(t=i)}),t}),!("addStream"in e.RTCPeerConnection.prototype)){var t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(e){this._localStreams||(this._localStreams=[]),-1===this._localStreams.indexOf(e)&&this._localStreams.push(e);var i=this;e.getTracks().forEach(function(o){t.call(i,o,e)})},e.RTCPeerConnection.prototype.addTrack=function(e,i){return i&&(this._localStreams?-1===this._localStreams.indexOf(i)&&this._localStreams.push(i):this._localStreams=[i]),t.call(this,e,i)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){this._localStreams||(this._localStreams=[]);var t=this._localStreams.indexOf(e);if(-1!==t){this._localStreams.splice(t,1);var i=this,o=e.getTracks();this.getSenders().forEach(function(e){-1!==o.indexOf(e.track)&&i.removeTrack(e)})}})}},shimRemoteStreamsAPI:function(e){if("object"==typeof e&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get:function(){return this._onaddstream},set:function(e){this._onaddstream&&this.removeEventListener("addstream",this._onaddstream),this.addEventListener("addstream",this._onaddstream=e)}});var t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){var e=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(t){t.streams.forEach(function(t){if(e._remoteStreams||(e._remoteStreams=[]),!(e._remoteStreams.indexOf(t)>=0)){e._remoteStreams.push(t);var i=new Event("addstream");i.stream=t,e.dispatchEvent(i)}})}),t.apply(e,arguments)}}},shimCallbacksAPI:function(e){if("object"==typeof e&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype,i=t.createOffer,o=t.createAnswer,n=t.setLocalDescription,a=t.setRemoteDescription,r=t.addIceCandidate;t.createOffer=function(e,t){var o=arguments.length>=2?arguments[2]:arguments[0],n=i.apply(this,[o]);return t?(n.then(e,t),Promise.resolve()):n},t.createAnswer=function(e,t){var i=arguments.length>=2?arguments[2]:arguments[0],n=o.apply(this,[i]);return t?(n.then(e,t),Promise.resolve()):n};var s=function(e,t,i){var o=n.apply(this,[e]);return i?(o.then(t,i),Promise.resolve()):o};t.setLocalDescription=s,s=function(e,t,i){var o=a.apply(this,[e]);return i?(o.then(t,i),Promise.resolve()):o},t.setRemoteDescription=s,s=function(e,t,i){var o=r.apply(this,[e]);return i?(o.then(t,i),Promise.resolve()):o},t.addIceCandidate=s}},shimGetUserMedia:function(e){var t=e&&e.navigator;t.getUserMedia||(t.webkitGetUserMedia?t.getUserMedia=t.webkitGetUserMedia.bind(t):t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=function(e,i,o){t.mediaDevices.getUserMedia(e).then(i,o)}.bind(t)))},shimRTCIceServerUrls:function(e){var t=e.RTCPeerConnection;e.RTCPeerConnection=function(e,i){if(e&&e.iceServers){for(var n=[],a=0;a<e.iceServers.length;a++){var r=e.iceServers[a];!r.hasOwnProperty("urls")&&r.hasOwnProperty("url")?(o.deprecated("RTCIceServer.url","RTCIceServer.urls"),(r=JSON.parse(JSON.stringify(r))).urls=r.url,delete r.url,n.push(r)):n.push(e.iceServers[a])}e.iceServers=n}return new t(e,i)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in e.RTCPeerConnection&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return t.generateCertificate}})},shimTrackEventTransceiver:function(e){"object"==typeof e&&e.RTCPeerConnection&&"receiver"in e.RTCTrackEvent.prototype&&!e.RTCTransceiver&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},shimCreateOfferLegacy:function(e){var t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(e){var i=this;if(e){void 0!==e.offerToReceiveAudio&&(e.offerToReceiveAudio=!!e.offerToReceiveAudio);var o=i.getTransceivers().find(function(e){return e.sender.track&&"audio"===e.sender.track.kind});!1===e.offerToReceiveAudio&&o?"sendrecv"===o.direction?o.setDirection?o.setDirection("sendonly"):o.direction="sendonly":"recvonly"===o.direction&&(o.setDirection?o.setDirection("inactive"):o.direction="inactive"):!0!==e.offerToReceiveAudio||o||i.addTransceiver("audio"),void 0!==e.offerToReceiveVideo&&(e.offerToReceiveVideo=!!e.offerToReceiveVideo);var n=i.getTransceivers().find(function(e){return e.sender.track&&"video"===e.sender.track.kind});!1===e.offerToReceiveVideo&&n?"sendrecv"===n.direction?n.setDirection?n.setDirection("sendonly"):n.direction="sendonly":"recvonly"===n.direction&&(n.setDirection?n.setDirection("inactive"):n.direction="inactive"):!0!==e.offerToReceiveVideo||n||i.addTransceiver("video")}return t.apply(i,arguments)}}}},{"../utils":14}],14:[function(e,t,i){"use strict";function o(e,t,i){var o=e.match(t);return o&&o.length>=i&&parseInt(o[i],10)}var n=!0,a=!0;t.exports={extractVersion:o,wrapPeerConnectionEvent:function(e,t,i){if(e.RTCPeerConnection){var o=e.RTCPeerConnection.prototype,n=o.addEventListener;o.addEventListener=function(e,o){if(e!==t)return n.apply(this,arguments);var a=function(e){var t=i(e);t&&o(t)};return this._eventMap=this._eventMap||{},this._eventMap[o]=a,n.apply(this,[e,a])};var a=o.removeEventListener;o.removeEventListener=function(e,i){if(e!==t||!this._eventMap||!this._eventMap[i])return a.apply(this,arguments);var o=this._eventMap[i];return delete this._eventMap[i],a.apply(this,[e,o])},Object.defineProperty(o,"on"+t,{get:function(){return this["_on"+t]},set:function(e){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),e&&this.addEventListener(t,this["_on"+t]=e)},enumerable:!0,configurable:!0})}},disableLog:function(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(n=e,e?"adapter.js logging disabled":"adapter.js logging enabled")},disableWarnings:function(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(a=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))},log:function(){if("object"==typeof window){if(n)return;"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}},deprecated:function(e,t){a&&console.warn(e+" is deprecated, please use "+t+" instead.")},detectBrowser:function(e){var t=e&&e.navigator,i={browser:null,version:null};if(void 0===e||!e.navigator)return i.browser="Not a browser.",i;if(t.mozGetUserMedia)i.browser="firefox",i.version=o(t.userAgent,/Firefox\/(\d+)\./,1);else if(t.webkitGetUserMedia)i.browser="chrome",i.version=o(t.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(t.mediaDevices&&t.userAgent.match(/Edge\/(\d+).(\d+)$/))i.browser="edge",i.version=o(t.userAgent,/Edge\/(\d+).(\d+)$/,2);else{if(!e.RTCPeerConnection||!t.userAgent.match(/AppleWebKit\/(\d+)\./))return i.browser="Not a supported browser.",i;i.browser="safari",i.version=o(t.userAgent,/AppleWebKit\/(\d+)\./,1)}return i}}},{}]},{},[3]);var live=function(e){function t(e,t,i){var o=e.match(t);return o&&o.length>=i&&parseInt(o[i],10)}var i=e._private=e._private||{},o=function(){var e={browser:null,version:null};if("undefined"==typeof window||!window.navigator)return e.browser="Not a browser.",e;if(navigator.mozGetUserMedia)e.browser="firefox",e.version=t(navigator.userAgent,/Firefox\/([0-9]+)\./,1);else if(navigator.webkitGetUserMedia)if(window.webkitRTCPeerConnection)e.browser="chrome",e.version=t(navigator.userAgent,/Chrom(e|ium)\/([0-9]+)\./,2);else{if(!navigator.userAgent.match(/Version\/(\d+).(\d+)/))return e.browser="Unsupported webkit-based browser with GUM support but no WebRTC support.",e;e.browser="safari",e.version=t(navigator.userAgent,/AppleWebKit\/([0-9]+)\./,1)}else{if(!navigator.mediaDevices||!navigator.userAgent.match(/Edge\/(\d+).(\d+)$/))return e.browser="Not a supported browser.",e;e.browser="edge",e.version=t(navigator.userAgent,/Edge\/(\d+).(\d+)$/,2)}return e}(),n={};n.isFirefox="firefox"===o.browser,n.isChrome="chrome"===o.browser,n.isEdge="edge"===o.browser,n.isIE=!1,n.isSafari=!1,n.version=o.version,n.supportSessionStorage=!1;try{n.supportSessionStorage="sessionStorage"in window&&null!=window.sessionStorage}catch(e){}return(-1!==navigator.userAgent.indexOf("MSIE")?/MSIE (\d+\.\d+);/:/Trident.*rv[ :]*(\d+\.\d+)/).test(navigator.userAgent)&&(n.isIE=!0,n.version=Number(RegExp.$1)),"undefined"==typeof Android&&navigator.userAgent.match(/Version\/[\d\.]+.*Safari/)&&(n.isSafari=!0),-1===navigator.userAgent.indexOf("OPR")||n.isChrome||n.isFirefox||n.isEdge||n.isSafari||(n.isOpera=!0),i.browser=n,e}(live||{}),live=function(e){"use strict";var t={LOGLEVEL:{DEBUG:2,INFO:4,WARN:6,ERROR:8,OFF:10},SESSIONSTATE:{NONE:"NONE",CONNECTED:"CONNECTED",RECONNECTING:"RECONNECTING",RELOADING:"RELOADING",HIBERNATED:"HIBERNATED",SUSPENDED:"SUSPENDED",FAILED:"FAILED",CLOSED:"CLOSED"},CALLSTATE:{NONE:"NONE",STARTED:"STARTED",RESPONDED:"RESPONDED",ESTABLISHED:"ESTABLISHED",UPDATING:"UPDATING",UPDATE_FAILED:"UPDATE_FAILED",UPDATED:"UPDATED",FAILED:"FAILED",ERROR:"ERROR",ENDED:"ENDED"},MEDIASTREAMEVENT:{LOCAL_STREAM_ADDED:"LOCAL_STREAM_ADDED",LOCAL_STREAM_REMOVED:"LOCAL_STREAM_REMOVED",LOCAL_STREAM_ERROR:"LOCAL_STREAM_ERROR",REMOTE_STREAM_ADDED:"REMOTE_STREAM_ADDED",REMOTE_STREAM_REMOVED:"REMOTE_STREAM_REMOVED",REMOTE_STREAM_ERROR:"REMOTE_STREAM_ERROR"},MEDIADIRECTION:{SENDONLY:"sendonly",RECVONLY:"recvonly",SENDRECV:"sendrecv",NONE:"inactive",INACTIVE:"inactive"},ERRORCODE:{UNAUTHORIZED:401,FORBIDDEN:403,RESOURCE_UNAVAILABLE:404,PROXYAUTH_REQUIRED:407,TEMPORARILY_UNAVAILABLE:480,BUSY_HERE:486,REQUEST_TERMINATED:487,SYSTEM_ERROR:500,BUSY_EVERYWHERE:600,DECLINED:603,WEBSOCKET_ERROR:1001,PEERCONNECTION_ERROR:1101,SET_LOCAL_SDP_ERROR:1102,SET_REMOTE_SDP_ERROR:1103,GENERATE_SDP_ERROR:1104,MEDIA_ERROR:1201,GET_USER_MEDIA_ERROR:1202,RESTORE_FAILED:1301,SAVE_FAILED:1302,SIGNALING_ERROR:1401,ICE_CONNECTION_ERROR:1501},PROTOCOL:{HOST:"HOST",STUN:"STUN",TURN:"TURN"},LOGTYPE:{EVENT_LOG:"event",ERROR_LOG:"error"},EVENTLOG:{CALL_START:"call starts",CALL_END:"call ends",CALL_UPDATE:"call updates",ESTABLISH_PEER_CONNECTION_START:"establishing peer connection starts",ESTABLISH_PEER_CONNECTION_END:"establishing peer connection ends",PEER_CONNECTION_CREATE_OFFER:"peer connection creates offer",PEER_CONNECTION_CREATE_ANSWER:"peer connection creates answer",NETWORK_SWITCHED:"network switched",GET_USER_MEDIA:"succeed to get user media",ON_ICE_CANDIDATE:"onicecandidate",ON_ADD_STREAM:"onaddstream",ON_REMOVE_STREAM:"onremovestream",ON_SIGNALING_STATE_CHANGE:"onsignalingstatechange",ON_ICE_CONNECTION_STATE_CHANGE:"oniceconnectionstatechange",ON_NEGOTIATION_NEEDED:"onnegotiationneeded",ON_DATA_CHANNEL:"ondatachannel",ON_ICE_GATHERING_STATE_CHANGE:"onicegatheringstatechange"},ERRORLOG:{ERROR_FROM_SERVER:"receive error responded from server",GET_USER_MEDIA_ERROR:"failed to get access to local media",GENERATE_SDP_ERROR:"failed to generate SDP",ICE_CONNECTION_ERROR:"ice connection failed",SET_REMOTE_SDP_ERROR:"failed to set remote SDP"},AUTHTYPE:{SERVICE:"SERVICE",TURN:"TURN"},ConnectionStateEnum:{INIT:"init",ESTABLISHED:"established",ERROR:"error",CLOSED:"closed"},PACKAGE:{ALL:"all",REGISTER:"register",CALL:"call",CONVERSATION:"conversation",MESSAGE_NOTIFICATION:"message_notification",MESSAGING:"messaging",CAPABILITY:"capability",CHAT:"chat",FILE_TRANSFER:"file_transfer"},CONSTCS:{SERVER:"s",CLIENT:"c"},RESUME_STATE:{waittingFinalResp:"waittingFinalResp",reStartingCall:"reStartingCall",updateCallByIceFailure:"updateCallByIceFailure"},OFFER_ANSWER_STATE:{INITIAL:"Initial state",OFFER_SENT:"Offer sent",OFFER_GOT:"Offer received",OFFER_REJECTED:"My offer was rejected by the other peer",OFFER_REJECT:"I Rejected the other peer's offer",ANSWER_SENT:"Answer sent",ANSWER_GOT:"Answer received",ACK_SENT:"Ack sent",ACK_GOT:"Ack received",GLARE:"Glare state"},TYPE:{REQUEST:"request",ACK:"acknowledgement",RESPONSE:"response",MESSAGE:"message",ERROR:"error"},ACTION:{CONNECT:"connect",START:"start",SHUTDOWN:"shutdown",COMPLETE:"complete",NOTIFY:"notify",RELAY:"relay",RELIABLE_RELAY:"reliableRelay",TRICKLE:"trickle",PRACK:"prack",ENQUIRY:"enquiry",MODIFY:"modify",HIBERNATE:"hibernate",ICE_ENQUIRY:"iceEnquiry",RELAY_FAILED:"relayFailed",AUDIT:"audit",SUBSCRIBE:"subscribe"},MESSAGESTATE:{INITIAL:"initial",SUBSEQUENT:"subsequent",FINAL:"final"},CONVERSATION:{ADD_STREAM:"add_stream",REMOVE_STREAM:"remove_stream",BEGIN_RECORD:"begin_record",END_RECORD:"end_record",LIST_PARTICIPANTS:"list_participants",STREAM_OPTIONS:"media_direction",STREAM_LAYOUT:"video_layout",RECORDING_RULES:"recording_rules",PAUSE_RESUME_STREAM:"pause_resume_stream",UPDATE_PROFILE:"update_profile",CANCEL:"cancel",CREATE_SIDEBAR:"create_sidebar",REMOTE_ADD_STREAM:"remote_add_stream",ANNOTATE_CUSTOMER_STREAM:"annotate_customer_stream"},CONVERSATIONSTATE:{STREAM_ADDED:"stream_added",STREAM_REMOVED:"stream_removed",STREAM_REJECTED:"stream_rejected",STREAM_JOINED:"stream_joined",STREAM_STARTED:"stream_started",STREAM_LEFT:"stream_left",STREAM_CHANGED:"stream_changed",STREAM_ACTIVE:"stream_active",RECORDING_STARTED:"recording_started",RECORDING_ENDED:"recording_ended",PROFILE_UPDATED:"profile_updated",SIDEBAR_CREATED:"sidebar_created"},STREAMTYPE:{AUDIOVIDEO:"audiovideo",SCREENSHARE:"screenshare"},STREAMSIZE:{MAX:"maximize",MIN:"minimize",PRIMARY:"primary",NORMAL:"normal"},RELAYTYPE:{COMMAND:"command",TEXT:"text",DATA:"data"},RELAYSTATUS:{ACCEPTED:"accepted",DECLINED:"declined"},PAUSERESUME:{PAUSE:"pause",RESUME:"resume"},PAUSERESUMEREASON:{PAUSE_RESUME:"pause_resume",UPGRADE_DOWNGRADE:"upgrade_downgrade"},ICE_CHECK_PERIOD:2e3,PROTOCOL_VERSION:"4.0",ExperienceFactor:{VIDEO_INBOUND:"video_inbound",VIDEO_OUTBOUND:"video_outbound",AUDIO_INBOUND:"audio_inbound",AUDIO_OUTBOUND:"audio_outbound"},ExperienceStatus:{GOOD:2,BAD:1,NOT_AVAILABLE:0}};return(e._private=e._private||{}).wscConst=t,e.MEDIADIRECTION=t.MEDIADIRECTION,e.SESSIONSTATE=t.SESSIONSTATE,e.CONNECTIONSTATE=t.SESSIONSTATE,e.CALLSTATE=t.CALLSTATE,e.STREAMSTATE=t.CALLSTATE,e.MEDIASTREAMEVENT=t.MEDIASTREAMEVENT,e.ERRORCODE=t.ERRORCODE,e.AUTHTYPE=t.AUTHTYPE,e.ConnectionStateEnum=t.ConnectionStateEnum,e.LOGLEVEL=t.LOGLEVEL,e.MSSAGETYPE=t.TYPE,e.ACTION=t.ACTION,e.CONVERSATION=t.CONVERSATION,e.CONVERSATIONSTATE=t.CONVERSATIONSTATE,e.STREAMTYPE=t.STREAMTYPE,e.STREAMSIZE=t.STREAMSIZE,e.RELAYTYPE=t.RELAYTYPE,e.RELAYSTATUS=t.RELAYSTATUS,e.PAUSERESUME=t.PAUSERESUME,e.PAUSERESUMEREASON=t.PAUSERESUMEREASON,e.ExperienceFactor=t.ExperienceFactor,e.ExperienceStatus=t.ExperienceStatus,e}(live||{}),live=function(e){var t=e._private=e._private||{},i=t.wscUtils=t.wscUtils||{};return i.Map=function(){"use strict";this.mapSize=0,this.entry={}},i.Map.prototype={put:function(e,t){this.containsKey(e)||(this.mapSize=this.mapSize+1),this.entry[e]=t},get:function(e){var t=null;return this.containsKey(e)&&(t=this.entry[e]),t},remove:function(e){var t=!1;return this.containsKey(e)&&delete this.entry[e]&&(t=!0,this.mapSize=this.mapSize-1),t},clear:function(){for(var e in this.entry)delete this.entry[e];this.mapSize=0},containsKey:function(e){var t=!1;return e in this.entry&&(t=!0),t},containsValue:function(e){for(var t in this.entry)if(this.entry[t]===e)return!0;return!1},values:function(){var e=[];for(var t in this.entry)this.entry.hasOwnProperty(t)&&e.push(this.entry[t]);return e},keys:function(){var e=[];for(var t in this.entry)e.push(t);return e},size:function(){return this.mapSize}},i.Queue=function(){var e=[],t=0;this.toJSON=function(){return{array:e,offset:t}},this.length=function(){return e.length-t},this.enqueue=function(t){e.push(t)},this.dequeue=function(){if(0===e.length)return null;var i=e[t];return 2*++t>=e.length&&(e=e.slice(t),t=0),i},this.peek=function(){return e.length>0?e[t]:null}},e.Map=i.Map,e}(live||{}),live=function(e){var t=e._private=e._private||{},i=t.wscUtils=t.wscUtils||{},o=t.wscConst,n=console,a=null,r=o.LOGLEVEL.WARN;return i.setLogger=function(e){n=e,i.AspectConfig.aspectClassMap.clear(),i.initAspectConfig()},i.getLogger=function(){return a},i.setLogLevel=function(e){r=e},i.getLogLevel=function(){return r},i.setsessionid=function(e){e},i.printTimeStr=function(e){var t=new Date;return(e?t.getDateStr(e):t.getDateStr())+" "},Date.prototype.getDateStr=function(e){var t={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};for(var i in e||(e="yyyy-MM-dd hh:mm:ss"),/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length))),t)new RegExp("("+i+")").test(e)&&(e=e.replace(RegExp.$1,1==RegExp.$1.length?t[i]:("00"+t[i]).substr((""+t[i]).length)));return e},i.waveFunc=function(e,t){if(t){if(t.prototype){var o=function(){};o.prototype=t.prototype;var n=e.prototype;e.prototype=new o,n&&i.deepCopy(n,e.prototype),e.prototype.constructor=e}if(t.prototype)e.superclass=t.prototype,e.superclass.constructor=t;else{for(var a in t)e[a]="object"==typeof t&&"error"!=a&&"warn"!=a&&"log"!=a&&"info"!=a&&"debug"!=a?function(e){return function(){t[e](arguments[0])}}(a):t[a];e.superclass=t,e.prototype=void 0}}},i.AspectConfig={},i.getCaller_line=function(){var e=null;try{(e=(new Error).stack.split("\n")[4]).indexOf("Error")>=0&&(e=null)}catch(e){}return e},i.isDebugEnabled=function(){var e=!1;if(r===o.LOGLEVEL.DEBUG&&(e=!0),e&&n){var t=i.getCaller_line();if((t=t?"Debug line:"+t:"Debug:").indexOf("tmpProxyClass")>0)return!0;n.debug(i.printTimeStr()+"[wsc "+t+"]")}return e},i.isInfoEnabled=function(){var e=!1;return r<=o.LOGLEVEL.INFO&&(e=!0),e&&n&&n.info(i.printTimeStr()+"[wsc Info]:"),e},i.isWarnEnabled=function(){var e=!1;if(r<=o.LOGLEVEL.WARN&&(e=!0),e&&n){var t=i.getCaller_line();if((t=t?"Warn line:"+t:"Warn:").indexOf("tmpProxyClass")>0)return!0;n.warn(i.printTimeStr()+"[wsc "+t+"]")}return e},i.isErrorEnabled=function(){var e=!1;if(r<=o.LOGLEVEL.ERROR&&(e=!0),e&&n){var t=null;if((t=(t=i.getCaller_line())?"Error line:"+t:"Error:").indexOf("tmpProxyClass")>0)return!0}return e},i.AspectConfig.aspectClassMap=new i.Map,o.WAVETYPE={BEFORE:"before",AFTER:"after",AFTERRETURN:"afterReturn",AFTERTHROW:"afterThrow"},i.AspectConfig.wavePointcut=function(e,t,r,s){var l,c,d=i.AspectConfig.aspectClassMap.get(e);null==d?(d=function(){d.superclass&&d.superclass.prototype&&d.superclass.constructor.apply(this,arguments)},i.waveFunc(d,e),c=d):(l=function(){l.superclass&&l.superclass.prototype&&l.superclass.constructor.apply(this,arguments)},i.waveFunc(l,d),c=l);var u,h=t.indexOf("*"),p=!1;h>=0&&(u=h>0?new RegExp("^"+t.substr(0,h)):new RegExp(t.substr(1)+"$"));var v=function(i){var o=null,n=c;a.superclass&&(n=a.superclass);try{for(;n.superclass;)n=n.superclass;o=n[t]?n[t].apply(n,i):e[t].apply(e,i)}catch(e){a.warn(e)}return o};if(e.prototype){if(e.prototype[t]){switch(s){case o.WAVETYPE.BEFORE:c.prototype[t]=function(){var e=!1,i=null;try{e=r(arguments)}catch(e){throw e}if(e&&(null!==(i=c.superclass[t].apply(this,arguments))&&void 0!==i))return i};break;case o.WAVETYPE.AFTER:c.prototype[t]=function(){var e=null;try{e=c.superclass[t].apply(this,arguments)}catch(e){throw n.error(t+" exception:"+e),e}if(r(arguments),null!==e&&void 0!==e)return e};break;case o.WAVETYPE.AFTERRETURN:c.prototype[t]=function(){var e;if(e=c.superclass[t].apply(this,arguments),r(arguments),null!==e&&void 0!==e)return e};break;case o.WAVETYPE.AFTERTHROW:c.prototype[t]=function(){var e=null;try{if(null!==(e=c.superclass[t].apply(this,arguments))&&void 0!==e)return e}catch(e){r(t,e)}}}p=!0}else if(h>=0)for(var g in e.prototype)if(u.test(g)){switch(s){case o.WAVETYPE.BEFORE:c.prototype[g]=function(){var e=!1,t=null;try{e=r(arguments)}catch(e){throw e}if(e&&(null!==(t=c.superclass[g].apply(this,arguments))&&void 0!==t))return t};break;case o.WAVETYPE.AFTER:c.prototype[g]=function(){var e=null;try{e=c.superclass[g].apply(this,arguments)}catch(e){throw n.error(g+" exception:"+e),e}if(r(arguments),null!==e&&void 0!==e)return e};break;case o.WAVETYPE.AFTERRETURN:c.prototype[g]=function(){var e;if(e=c.superclass[g].apply(this,arguments),r(arguments),null!==e&&void 0!==e)return e};break;case o.WAVETYPE.AFTERTHROW:c.prototype[g]=function(){var e=null;try{if(null!==(e=c.superclass[g].apply(this,arguments))&&void 0!==e)return e}catch(e){r(g,e)}}}p=!0}}else if(e[t]){switch(s){case o.WAVETYPE.BEFORE:c[t]=function(){if(r(arguments)){var e=v(arguments);if(null!==e&&void 0!==e)return e}};break;case o.WAVETYPE.AFTER:c[t]=function(){try{var e=v(arguments)}catch(e){n.error(t+" exception:"+e)}if(r(arguments),null!==e&&void 0!==e)return e};break;case o.WAVETYPE.AFTERRETURN:c[t]=function(){var e=v(arguments);if(r(arguments),null!==e&&void 0!==e)return e};break;case o.WAVETYPE.AFTERTHROW:c[t]=function(){try{var e=v(arguments);if(null!==e&&void 0!==e)return e}catch(e){r(t,e)}}}p=!0}else if(h>=0)for(var g in e)if(u.test(g)){switch(s){case o.WAVETYPE.BEFORE:c[g]=function(){if(r(arguments)){var e=v(arguments);if(null!==e&&void 0!==e)return e}};break;case o.WAVETYPE.AFTER:c[g]=function(){try{var e=v(arguments);if(null!==e&&void 0!==e)return e}catch(e){n.error(g+" exception:"+e)}return r(arguments),e};break;case o.WAVETYPE.AFTERRETURN:c[g]=function(){var e=v(arguments);if(r(arguments),null!==e&&void 0!==e)return e};break;case o.WAVETYPE.AFTERTHROW:c[g]=function(){try{var e=v(arguments);if(null!==e&&void 0!==e)return e}catch(e){r(g,e)}}}p=!0}p&&i.AspectConfig.aspectClassMap.put(e,c)},i.AspectConfig.before=function(e,t,n){i.AspectConfig.wavePointcut(e,t,n,o.WAVETYPE.BEFORE)},i.AspectConfig.after=function(e,t,n){i.AspectConfig.wavePointcut(e,t,n,o.WAVETYPE.AFTER)},i.AspectConfig.afterReturn=function(e,t,n){i.AspectConfig.wavePointcut(e,t,n,o.WAVETYPE.AFTERRETURN)},i.AspectConfig.afterThrow=function(e,t,n){i.AspectConfig.wavePointcut(e,t,n,o.WAVETYPE.AFTERTHROW)},i.AspectConfig.getWavedObject=function(e){var t=i.AspectConfig.aspectClassMap.get(e);return t||(t=e),new t},i.AspectConfig.getWavedClass=function(e){var t=i.AspectConfig.aspectClassMap.get(e);return t||(t=e),t},i.initAspectConfig=function(){n?(i.AspectConfig.before(n,"info",i.isInfoEnabled),i.AspectConfig.before(n,"debug",i.isDebugEnabled),i.AspectConfig.before(n,"warn",i.isWarnEnabled),i.AspectConfig.before(n,"error",i.isErrorEnabled),i.AspectConfig.before(n,"log",i.isInfoEnabled),a=i.AspectConfig.getWavedClass(n)):a=n={},a.info||(a.info=function(){},n.info=function(){}),a.debug||(a.debug=function(){},n.debug=function(){}),a.warn||(a.warn=function(){},n.warn=function(){}),a.error||(a.error=function(){},n.error=function(){}),a.log||(a.log=function(){},n.log=function(){})},i.initAspectConfig(),e.setLogLevel=i.setLogLevel,e.getLogLevel=i.getLogLevel,e.setLogger=i.setLogger,e.getLogger=i.getLogger,e}(live||{}),live=function(e){function t(e){var t=!1;if(void 0===p)return Promise.reject("Audio context is not supported.");return navigator.mediaDevices.enumerateDevices().then(function(i){var o=[],n=[];return i.forEach(function(t){t.kind===e&&o.push(t)}),u.debug("We have audio sources (for "+e+") as follows:",o),0===o.length?Promise.resolve({available:!1,details:n}):v(o,function(e){return new function(e){this.sourceInfo=e;var t,i,o={},n=null,a=null,r=[],s=0,l=this;for(i=6;i--;)r[i]=[];this.test=function(){return o.sourceId=this.sourceInfo.deviceId,o.label=this.sourceInfo.label,new Promise(function(e,i){l.resolve=e,l.reject=i;var r={audio:{optional:[{echoCancellation:!1},{sourceId:l.sourceInfo.deviceId}]}};u.debug("Calling getUserMedia with constraints",r),navigator.mediaDevices.getUserMedia(r).then(function(i){if(t=i,"undefined"!=typeof RTCRtpReceiver&&i instanceof RTCRtpReceiver||"undefined"!=typeof RTCRtpSender&&i instanceof RTCRtpSender){if(!i.track||i.track&&"video"===i.track.kind)return u.warn("There is not audio track in the stream."),o.available=!1,void e(o);i.track&&"audio"===i.track.kind&&(o.label=i.track.label)}else{if(i.getAudioTracks().length<1)return u.warn("There is not audio track in the stream."),o.available=!1,void e(o);var r=i.getAudioTracks();r.length>0&&(o.label=r[0].label)}n=p.createMediaStreamSource(i),a=p.createScriptProcessor(0,6,2),n&&a?(n.connect(a),a.connect(p.destination),a.onaudioprocess=c):(u.warn("AudioStreamSource or ScriptProcessor is invalid."),o.available=!1,e(o))}).catch(i)})};var c=function(e){var c,h,v,g=e.inputBuffer.length,m=e.inputBuffer.numberOfChannels,f=e.inputBuffer.sampleRate;for(c=0;c<m;c++)h=e.inputBuffer.getChannelData(c),(v=new Float32Array(g)).set(h),r[c].push(v);if((s+=g)/f>=2){if("undefined"!=typeof RTCRtpReceiver&&t instanceof RTCRtpReceiver||"undefined"!=typeof RTCRtpSender&&t instanceof RTCRtpSender)t.track&&"audio"===t.track.kind&&t.track.stop();else{var S=t.getAudioTracks();for(i=S.length;i--;)S[i].stop()}if(n&&a){u.debug("Try to disconnect the audio node");try{n.disconnect(a)}catch(e){u.debug("Failed to disconnect audio node",e)}try{a.disconnect(p.destination)}catch(e){u.debug("Failed to disconnect audio node",e)}}d(r),l.resolve(o)}},d=function(e){var t=[];if(e.forEach(function(e,i){h(e)&&t.push(i)}),t.length>0?(o.available=!0,u.debug(t.length+" active audio channels are found")):(o.available=!1,u.warn("Can not detect any active channels. Please check if audio device is valid.")),o.channelNumber=t.length,2===t.length){for(var i=e[t[0]],n=e[t[1]],a=0,r=i.length;a<r;a++){var s=i[a],l=n[a];if(s.length!==l.length)return o.isStereo=!0,void u.info("Audio device might be stereo.");for(var c=0;c<s.length;c++)if(Math.abs(s[c]-l[c])>1/65536)return o.isStereo=!0,void u.info("Audio device might be stereo.")}o.isStereo=!1,u.info("Audio device might be mono.")}},h=function(e){for(var t=0,i=e.length;t<i;t++){var o=e[t];if(o.length>0)for(var n=0,a=0;a<o.length;a++)if(Math.abs(o[a])>1/32767){if((n+=1)>10)return!0}else n=0}return!1}}(e).test().then(function(e){return n.push(e),{available:t=t||e.available,details:n}})}).catch(function(e){return u.debug(e),Promise.resolve({available:!1,details:[]})})}).catch(function(e){return u.debug("Device selection is not supported",e),Promise.resolve({available:!1,details:[]})})}function i(e,t,i,o){this.turnURI=e,this.username=t,this.password=i,this.protocol=o,this.test=function(){if(!this.turnURI||!this.username||!this.password)return Promise.reject("TURN URI, username and password are required");if("string"!=typeof this.turnURI||"string"!=typeof this.username||"string"!=typeof this.password)return Promise.reject("TURN URI, username and password must be string type");var e={username:this.username||"",credential:this.password||"",urls:this.turnURI.split(",")};n(e,o);var t={iceServers:[e]};return new Promise(function(e,i){var o;try{var n={};u.debug("Constraints used for peerConnection: "+JSON.stringify(n)),o=new RTCPeerConnection(t,n)}catch(t){return u.error("Fail to create peer connection: "+t),void e(!1)}o.onicecandidate=function(t){{if("closed"!==o.signalingState)return t.candidate?"relay"===g(t.candidate.candidate).type?(u.info("Got a relay candidate",t.candidate),o.close(),void e(!0)):void u.debug("Got a non-relay candidate",t.candidate):(o.close(),u.warn("No relay candidate is got before end of candidates"),void e(!1));e(!1)}},o.addTransceiver("audio"),o.createOffer().then(function(e){u.debug("got offer: ",e),o.setLocalDescription(e).then(function(){console.log("Local description set successfully")}).catch(function(e){console.log("Setting local description failed",e)})}).catch(function(e){console.log("Create offer failed with reason ",e)})})};var n=function(e,t){for(var i="transport="+t,o=[],n=0;n<e.urls.length;n++){var a=e.urls[n];-1!==a.indexOf(i)?o.push(a):-1===a.indexOf("?transport=")&&"turn"===a.slice(0,4)&&o.push(a+"?"+i)}e.urls=o}}function o(e,t,i){this.turnURI=e,this.username=t,this.password=i,this.testResult={}}function n(e,t,i){void 0!==p&&void 0!==p.createScriptProcessor||i&&i("Audio context is not supported.");var o=function(e){var i,o={available:!1,details:[]};0==(i=e.filter(function(e){return"audioinput"===e.kind})).length&&t(o);var n=function(e,i,o){this.available=this.available||o.available,this.details.push(o),e&&i?e.test(i):t(this)},a=i.map(function(e){return new function(e){this.sourceInfo=e;var t,i,o,n,a={},r=[],s=0;for(i=6;i--;)r[i]=[];this.test=function(e){a.sourceId=this.sourceInfo.deviceId,a.label=this.sourceInfo.label;var i={audio:{optional:[{echoCancellation:!1},{sourceId:this.sourceInfo.deviceId}]}};u.debug("Calling getUserMedia with constraints",i),h(i).then(function(i){if(t=i,"undefined"!=typeof RTCRtpReceiver&&i instanceof RTCRtpReceiver||"undefined"!=typeof RTCRtpSender&&i instanceof RTCRtpSender){if(!i.track||i.track&&"video"===i.track.kind)return u.warn("There is not audio track in the stream."),a.available=!1,void e(a)}else if(i.getAudioTracks().length<1)return u.warn("There is not audio track in the stream."),a.available=!1,void e(a);return o=p.createMediaStreamSource(i),n=p.createScriptProcessor(0,6,2),o&&n?(o.connect(n),n.connect(p.destination),void(n.onaudioprocess=l.bind(null,e))):(u.warn("AudioStreamSource or ScriptProcessor is invalid."),a.available=!1,void e(a))}).catch(function(){a.available=!1,e(a)})};var l=function(e,l){var d,u,h,v=l.inputBuffer.length,g=l.inputBuffer.numberOfChannels,m=l.inputBuffer.sampleRate;for(d=0;d<g;d++)u=l.inputBuffer.getChannelData(d),(h=new Float32Array(v)).set(u),r[d].push(h);if((s+=v)/m>=2){if("undefined"!=typeof RTCRtpReceiver&&t instanceof RTCRtpReceiver||"undefined"!=typeof RTCRtpSender&&t instanceof RTCRtpSender)t.track&&"audio"===t.track.kind&&t.track.stop();else{var f=t.getAudioTracks();for(i=f.length;i--;)f[i].stop()}o.disconnect(n),n.disconnect(p.destination),c(r),e(a)}},c=function(e){var t=[];if(e.forEach(function(e,i){d(e)&&t.push(i)}),t.length>0?(a.available=!0,u.debug(t.length+" active audio input channels are found")):(a.available=!1,u.warn("Can not detect any active input channels. Please check if microphone is valid.")),a.channelNumber=t.length,2===t.length){for(var i=e[t[0]],o=e[t[1]],n=0,r=i.length;n<r;n++){var s=i[n],l=o[n];if(s.length!==l.length)return a.isStereo=!0,void u.info("Audio device might be stereo.");for(var c=0;c<s.length;c++)if(Math.abs(s[c]-l[c])>1/65536)return a.isStereo=!0,void u.info("Audio device might be stereo.")}a.isStereo=!1,u.info("Audio device might be mono.")}},d=function(e){for(var t=0,i=e.length;t<i;t++){var o=e[t];if(o.length>0)for(var n=0,a=0;a<o.length;a++)if(Math.abs(o[a])>1/32767){if((n+=1)>10)return!0}else n=0}return!1}}(e)}),r=a.shift(),s=a.reverse().reduce(function(e,t){return n.bind(o,t,e)},n.bind(o,null,null));r.test(s)};void 0!==navigator.mediaDevices&&void 0!==navigator.mediaDevices.enumerateDevices?navigator.mediaDevices.enumerateDevices().then(o).catch(function(e){u.debug("Device selection is not supported",e),t&&t({available:!1,details:[]})}):"undefined"!=typeof MediaStreamTrack&&void 0!==MediaStreamTrack.getSources?MediaStreamTrack.getSources(function(e){o(e.map(function(e){return{label:e.label,kind:kinds[e.kind],deviceId:e.id,groupId:""}}))}):i("Devices cannot be enumerated.")}function a(e,t,i,o){this.turnURI=e,this.username=t,this.password=i,this.protocol=o;var n=function(e){u.debug("dumbFunc: ",e)};this.test=function(e){var t={username:this.username||"",credential:this.password||"",urls:this.turnURI.split(",")};a(t,o);var i,r={iceServers:[t]};try{var s={};u.debug("Constraints used for peerConnection: "+JSON.stringify(s)),i=new RTCPeerConnection(r,s)}catch(t){return u.error("Fail to create peer connection: "+t),void e(!1)}i.onicecandidate=function(t){{if("closed"!==i.signalingState)return t.candidate?"relay"===g(t.candidate.candidate).type?(u.info("Got a relay candidate",t.candidate),i.close(),void e(!0)):void u.debug("Got a non-relay candidate",t.candidate):(i.close(),u.warn("No relay candidate is got before end of candidates"),void e(!1));e(!1)}};i.createOffer(function(e){u.debug("got offer: ",e),i.setLocalDescription(e,n,n)},n,{offerToReceiveAudio:1})};var a=function(e,t){for(var i="transport="+t,o=[],n=0;n<e.urls.length;n++){var a=e.urls[n];-1!==a.indexOf(i)?o.push(a):-1===a.indexOf("?transport=")&&"turn"===a.slice(0,4)&&o.push(a+"?"+i)}e.urls=o}}function r(e,t,i){this.turnURI=e,this.username=t,this.password=i,this.testResult={}}function s(e,t,i){var o={};u.debug("Constraints used for peerConnection: "+JSON.stringify(o)),u.debug("Config used for peerConnection: "+JSON.stringify(e,null,2)),this.pc1=new RTCPeerConnection(e,o),this.pc2=new RTCPeerConnection(e,o);var n,a=this.pc1,r=this.pc2,s=!1,l=!1,c=this,d=function(e,i){e.candidate?"relay"===g(e.candidate.candidate).type&&(i.addIceCandidate(e.candidate),l=!0):l||t(c,"No relay candidate is got before end of candidates")};a.onicecandidate=function(e){d(e,r)},r.onicecandidate=function(e){d(e,a)};var h=function(e){u.debug("offer answer",e),t(c,e)},p=function(e){return e.replace(/a=candidate:[^\r]*\r\n/g,"").replace(/a=end-of-candidates\r\n/g,"")};const v=function(e){if(s&&(e.sdp=e.sdp.replace(/a=mid:video\r\n/g,"a=mid:video\r\nb=AS:"+n+"\r\n")),i){var t=e.sdp;e.sdp=p(t)}r.setLocalDescription(e).then(function(){a.setRemoteDescription(e).then(function(){}).catch(h)}).catch(h)},m=function(e){s&&(t=(t=(t=(t=(t=(t=e.sdp).replace(/(m=video 1 [^\r]+) 116 117\r\n/g,function(e,t){return t.trim()+"\r\n"})).split(/a=rtpmap:116 red\/90000\r\n/g).join("")).split(/a=rtpmap:117 ulpfec\/90000\r\n/g).join("")).split(/a=rtpmap:98 rtx\/90000\r\n/g).join("")).split(/a=fmtp:98 apt=116\r\n/g).join(""),e.sdp=t);if(i){var t=e.sdp;e.sdp=p(t)}a.setLocalDescription(e).then(function(){r.setRemoteDescription(e).then(function(){r.createAnswer().then(v).catch(h)}).catch(h)}).catch(h)};this.start=function(){a.createOffer().then(m).catch(h)},this.end=function(){"closed"!=this.pc1.signalingState&&this.pc1.close(),"closed"!=this.pc2.signalingState&&this.pc2.close()},this.setMaxVideoBitRate=function(e){n=e},this.disableVideoFec=function(){s=!0}}var l=e._private=e._private||{},c=l.wscUtils=l.wscUtils||{},d=l.wscConst,u=e.getLogger(),h=navigator.getUserMedia;navigator.mediaDevices&&"function"==typeof navigator.mediaDevices.getUserMedia&&(h=navigator.mediaDevices.getUserMedia);try{var p=new(window.AudioContext||window.webkitAudioContext)}catch(e){u.debug("Failed to instantiate an audio context, error: "+e)}window.msCrypto&&(window.crypto=window.msCrypto),"function"!=typeof Array.prototype.find&&(Array.prototype.find=function(e){"use strict";if(null==this)throw new TypeError("Array.prototype.find called on null or undefined");if("function"!=typeof e)throw new TypeError("predicate must be a function");for(var t,i=Object(this),o=i.length>>>0,n=arguments[1],a=0;a<o;a++)if(t=i[a],e.call(n,t,a,i))return t});var v=function(e,t){return e.reduce(function(e,i){return e.then(function(){return t(i)})},Promise.resolve())},g=function(e){var t=e.split(/\s+/);return t.length>7?{type:t[7],protocol:t[2],address:t[4]}:{}},m=[{label:"720p",width:1280,height:720,ratio:"16:9"},{label:"SVGA",width:800,height:600,ratio:"4:3"},{label:"VGA",width:640,height:480,ratio:"4:3"},{label:"360p",width:640,height:360,ratio:"16:9"}];if(c.Message=function(e){"use strict";if(this.control={type:void 0,package_type:void 0,session_id:void 0,subsession_id:void 0,sequence:void 0,message_state:void 0,correlation_id:void 0,ack_sequence:void 0,version:void 0},this.header={action:void 0,initiator:void 0,target:void 0,error_code:void 0,reason:void 0,participant:void 0,conversation_key:void 0,instruction:void 0,conversation_topic:void 0,recording_channel:void 0,web_context:void 0,conversation_info:void 0,stream_id:void 0,stream_type:void 0},this.payload={},e)for(var t in"string"==typeof e&&(e=JSON.parse(e)),e)e.hasOwnProperty(t)&&(this[t]=e[t])},c.Message.systemHeaders={action:"action",initiator:"initiator",target:"target",cslr:"cslr",cslw:"cslw",csuw:"csuw",sslr:"sslr",error_code:"error_code",response_code:"response_code",reason:"reason",participant:"participant",enquiry_data:"enquiry_data",authorization:"authorization",authenticate:"authenticate",expiry:"expiry",participants:"participants",conversation_key:"conversation_key",instruction:"instruction",conversation_topic:"conversation_topic",recording_channel:"recording_channel",web_context:"web_context",conversation_info:"conversation_info",stream_id:"stream_id",stream_type:"stream_type"},c.Message.prototype={isRequest:function(){return this.control.type===d.TYPE.REQUEST},isResponse:function(){return this.control.type===d.TYPE.RESPONSE},isEnquiry:function(){return this.header.action===d.ACTION.ENQUIRY},isModify:function(){return this.header.action===d.ACTION.MODIFY},isFinalResponse:function(){var e=this.control.type,t=this.control.message_state;return e===d.TYPE.RESPONSE&&t===d.MESSAGESTATE.FINAL},isError:function(){return this.control.type===d.TYPE.ERROR},isMessage:function(){return this.control.type===d.TYPE.MESSAGE},isReliableRelay:function(){return this.header.action===d.ACTION.RELIABLE_RELAY},isACK:function(){return this.control.type===d.TYPE.ACK},isReconnect:function(){var e=this.control.package_type,t=this.control.session_id,i=this.header.action;return!(e!==d.PACKAGE.REGISTER||!t||i!==d.ACTION.CONNECT)},ack:function(e){var t=new c.Message;t.control.session_id=this.control.session_id,t.control.subsession_id=this.control.subsession_id,t.control.type=d.TYPE.ACK,t.control.package_type=this.control.package_type,t.control.sequence=this.control.sequence,e.sendMessage(t)},complete:function(e){var t=new c.Message;t.control.session_id=this.control.session_id,t.control.subsession_id=this.control.subsession_id,t.control.correlation_id=this.control.correlation_id,t.control.type=d.TYPE.MESSAGE,t.control.package_type=this.control.package_type,t.header.action=d.ACTION.COMPLETE,t.header.stream_id=this.header.stream_id,t.header.stream_type=this.header.stream_type,e.sendMessage(t)},addExtHeaders:function(e){for(var t in e)if(e.hasOwnProperty(t)){var i=e[t];this.header[t]||(this.header[t]=i)}},getExtHeaders:function(){var e;if(this.header)for(var t in this.header)if(this.header.hasOwnProperty(t)){if(c.Message.systemHeaders[t])continue;e||(e={}),e[t]=this.header[t]}return e},addExtPayloads:function(e){for(var t in e)if(e.hasOwnProperty(t)){var i=e[t];this.payload[t]||(this.payload[t]=i)}}},c.ErrorInfo=function(e,t){this.code=e,this.reason=t},c.wscLoginWithOAuthToken=function(e,t,i,o,n){var a=o+"?oauth_token="+e+"&final_redirect_uri="+t+"&wsc_app_uri="+n;if(u.debug("Login WebRTC Session Controller by OAuth token to destination -> "+a),!i){var r="The parameter loginWindowType is required.";throw u.error(r),r}"current_window"===i?window.location.href=a:"new_window"===i&&window.open(a,"Wsc Login","width=500,height=500,left=200,top=100")},c.AuthHandler=function(e){"use strict";this.session=e,e.authHandler=this,this.refresh=null,this.toJSON=function(){return c.toJSON({session:""},this)}},c.checkAuthInfo=function(e,t){var i=!1;if(e===d.AUTHTYPE.SERVICE){if(!t)return!1;i=!0}else if(e===d.AUTHTYPE.TURN){if(!t)return!0;null!=t.iceServers&&(i=!0)}return i},c.getRTCConfiguration=function(e){var t,i=e.authHandler,o=0,n=null,a=!0;if(i&&i.refresh)for(;a&&o<3;){o++;try{if(n=i.refresh(d.AUTHTYPE.TURN),c.checkAuthInfo(d.AUTHTYPE.TURN,n))break;if(!1===n){t="No correct information was returned from the callback function 'AuthHandler.refresh()', or the user canceled the operation.",u.warn(t),a=!1;break}t="No correct information was return from the callback function 'AuthHandler.refresh()'. Please try again.",u.warn(t)}catch(e){u.error("Handle unauthenticated message error: "+e),a=!1}}else u.warn("No AuthHandler object created for this Session, or this AuthHandler does not have the callback function 'AuthHandler.refresh()'."),a=!1;if(!1===a&&(n=null),n||(n={iceServers:[],iceTransportPolicy:"all"}),e.iceServerListFromServer.length>0){var r=e.iceServerListFromServer.concat(n.iceServers);n.iceServers=r}return n},c.calcHa1=function(e,t){return""},c.extend=function(e,t){var i=function(){};i.prototype=t.prototype;var o=e.prototype;e.prototype=new i,o&&c.deepCopy(o,e.prototype),e.prototype.constructor=e,e.superclass=t.prototype,e.superclass&&(e.superclass.constructor=t)},c.deepCopy=function(e,t){for(var i in t=t||{},e)"object"==typeof e[i]?(t[i]=e[i].constructor===Array?[]:{},c.deepCopy(e[i],t[i])):t[i]=e[i];return t},c.toJSON=function(e,t){var i={};for(var o in t)o in e||(i[o]=t[o]);return i},c.testBrowser=function(){var e,t,i,o,n,a,r=!1;if(l.browser.isChrome&&(e="Chrome",r=!0,t=parseInt(navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./)[2],10),i=void 0,o=void 0),l.browser.isFirefox&&(e="Firefox",r=!0,t=parseInt(navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1],10),i=void 0,o=void 0),navigator.mediaDevices&&navigator.userAgent.match(/Edge\/(\d+).(\d+)$/)&&(e="Edge",r=!0,t=parseInt(navigator.userAgent.match(/Edge\/(\d+).(\d+)$/)[1],10),i=void 0,o=void 0),l.browser.isIE&&(e="IE",r=!1,t=parseInt(navigator.userAgent.match(/rv\:([0-9]+)\./)[1],10),i=void 0,o=void 0),l.browser.isSafari&&(e="Safari",r=!0,t=parseInt(navigator.userAgent.match(/Version\/([0-9]+)\./)[1],10),i=void 0,o=void 0),l.browser.isOpera&&(e="Opera",r=!0,t=parseInt(navigator.userAgent.match(/OPR\/([0-9]+)\./)[1],10),i=void 0,o=void 0),a=l.browser.supportSessionStorage,n="WebSocket"in window,void 0===e){var s=navigator.userAgent;s.startsWith("Mozilla")&&(u.debug("Mozilla user agent: "+s),s.includes("CriOS/")&&(e="Chrome",t=parseInt(navigator.userAgent.match(/CriOS\/([0-9]+)\./)[1],10),r=!0,i=void 0,o=void 0,a=!0,n=!0),s.includes("FxiOS/")&&(e="Firefox",t="60",r=!0,i=void 0,o=void 0,a=!0,n=!0),u.debug("iOS browser app:"+e+" v"+t))}return{compatible:r&&n&&a,details:{browserName:e,browserVersion:t,supportedMinimumVersion:i,supportedMaximumVersion:o,supportWebRTC:r,supportWebSocket:n,supportSessionStorage:a}}},c.resumeAudioContext=function(e,t){return void 0===p?t("Audio context is not supported."):void p.resume().then(e).catch(t)},c.testMicrophone=function(){return t("audioinput")},c.testAudio=function(){return t("audiooutput")},c.testCamera=function(){var e=!1;return navigator.mediaDevices.enumerateDevices().then(function(t){var i=[],o=[];return t.forEach(function(e){"videoinput"===e.kind&&i.push(e)}),0==i.length?Promise.resolve({available:!1,details:o}):v(i,function(t){return new function(e){this.sourceInfo=e;var t={};this.test=function(){var e=[];return t.sourceId=this.sourceInfo.deviceId,t.label=this.sourceInfo.label,v(m,function(o){var n={audio:!1,video:{width:{ideal:o.width},height:{ideal:o.height}}};return i(n).then(function(i){if(i){if("undefined"!=typeof RTCRtpReceiver&&i instanceof RTCRtpReceiver||"undefined"!=typeof RTCRtpSender&&i instanceof RTCRtpSender)i.track&&"video"===i.track.kind&&(i.track.stop(),t.label=i.track.label);else{var n=i.getVideoTracks();n.length>0&&(n[0].stop(),t.label=n[0].label)}e.push(o.width+"x"+o.height)}return t.availableResolutions=e,e.length>0&&(t.available=!0),t})}).catch(function(e){u.debug(e)})};var i=function(e){return new Promise(function(t,i){u.debug("Calling getUserMedia with constraints",e),navigator.mediaDevices.getUserMedia(e).then(t).catch(function(e){u.warn("getUserMedia error when check resolution of camera",e),t()})})}}(t).test().then(function(t){return o.push(t),{available:e=e||t.available,details:o}})}).catch(function(e){return u.debug(e),Promise.resolve({available:!1,details:[]})})}).catch(function(e){return u.debug("Device selection is not supported",e),Promise.resolve({available:!1,details:[]})})},c.testNetwork=function(e,t,n){var a={details:{}};return new i(e,t,n,"udp").test().then(function(o){return u.debug("udp connectivity test..."),a.details.udpConnectivity=o,new i(e,t,n,"tcp").test()}).then(function(i){return u.debug("tcp connectivity test..."),a.details.tcpConnectivity=i,new function(e,t,i){this.turnURI=e,this.username=t,this.password=i,this.test=function(){var e={iceServers:[{username:this.username||"",credential:this.password||"",urls:this.turnURI.split(",")}]};return new Promise(function(t,i){var o,n=new s(e,function(e,i){u.warn(i),e.end(),t(0)}),a=null,r=0,l=0,c=!1,d="",h=null;d="12345";for(var p=0;p<5;p++)d+=d+d;o=100*d.length,(h=n.pc1.createDataChannel(null)).onopen=function(){a||(a=new Date);var e=function(){for(var t=0;100!==t&&!(h.bufferedAmount>=o);++t)r+=d.length,h.send(d);new Date-a>=3e3?c=!0:setTimeout(e,1)};e()},n.pc2.ondatachannel=function(e){e.channel.onmessage=function(e){if(l+=e.data.length,c&&r===l){n.end();var i=l/(new Date-a);i=Math.round(1e3*i*8)/1e3,n.end(),t(i)}}},n.start()})}}(e,t,n).test()}).then(function(i){return u.debug("data channel connectivity test..."),a.details.dataThroughput=i,new o(e,t,n).test()}).then(function(e){return u.debug("video bandwidth connectivity test..."),a.details.videoBandwidth=e,a.connectivity=(a.details.udpConnectivity||a.details.tcpConnectivity)&&a.details.dataThroughput>0&&a.details.videoBandwidth>0,a}).catch(function(e){return u.error("Error happens when test network. ",e),Promise.reject(e)})},o.prototype={test:function(){var e={iceServers:[{username:this.username||"",credential:this.password||"",urls:this.turnURI.split(",")}]};return new Promise(function(t,i){var o=4e4,n=0,a=0,r=null,l=null,c=new s(e,function(e,i){u.warn(i),p(),t(-1)});c.setMaxVideoBitRate(2e3),c.disableVideoFec();var d={audio:!1,video:{optional:[{minWidth:1280},{minHeight:720}]}};u.debug("Calling getUserMedia with constraints",d),h(d).then(function(e){e.getTracks().forEach(function(t){c.pc1.addTrack(t,e)}),c.start(),r=setTimeout(function(){v(),null==l&&(l=setTimeout(function(){p();var e=-1;a>0&&(e=Math.round(n/a)),t(e)},o))},2e3)}).catch(function(e){u.warn("getUserMedia error when testing video bandwidth",e),t(-1)});var p=function(){if(r&&clearTimeout(r),l&&clearTimeout(l),c&&c.pc1){var e=c.pc1.getLocalStreams();e.length>0&&e[0].getTracks().forEach(function(e){e.stop()}),c.end()}},v=function(){c.pc1.getStats(null,function(e){var i;for(var o in e){var r=e[o];if("bweforvideo"===r.id){i=r.googAvailableSendBandwidth/1e3;break}}void 0==i?(u.warn("Cannot get bandwidth from getStats()."),p(),t(-1)):(n+=i,a+=1)},function(e){u.warn("Error when get statistics.",e),p(),t(-1)}),r=setTimeout(v,1e3)}})}},c.testMicrophoneCallback=function(e,t){return n(0,e,t)},c.testAudioCallback=function(e,t){return n(0,e,t)},c.testCameraCallback=function(e,t){var i=function(t){var i,o={available:!1,details:[]};0==(i=t.filter(function(e){return"videoinput"===e.kind})).length&&e(o);var n=function(t,i,o){this.available=this.available||o.available,this.details.push(o),t&&i?t.test(i):e(this)},a=i.map(function(e){return new function(e){this.sourceInfo=e;var t={};this.test=function(e){t.sourceId=this.sourceInfo.deviceId,t.label=this.sourceInfo.label,t.availableResolutions=[];var i=function(i,o,n){n&&("undefined"!=typeof RTCRtpReceiver&&n instanceof RTCRtpReceiver||"undefined"!=typeof RTCRtpSender&&n instanceof RTCRtpSender?n.track&&"video"===n.track.kind&&n.track.stop():n.getVideoTracks()[0].stop(),t.availableResolutions.push(i.video.mandatory.minWidth+"x"+i.video.mandatory.minHeight)),o?o():(t.available=t.availableResolutions.length>0,e(t))},o=function(i,o){u.warn("getUserMedia error when check resolution of camera",o),i?i():(t.available=t.availableResolutions.length>0,e(t))},n=m.map(function(e){return{audio:!1,video:{mandatory:{minWidth:e.width,minHeight:e.height,maxWidth:e.width,maxHeight:e.height},optional:[{sourceId:t.sourceId}]}}}),a=n.reverse().shift();n.reduce(function(e,t){return u.debug("Calling getUserMedia with constraints",a),h.bind(null,t,i.bind(null,t,e),o.bind(null,e))},h.bind(null,a,i.bind(null,a,null),o.bind(null,null)))()}}(e)}),r=a.shift(),s=a.reverse().reduce(function(e,t){return n.bind(o,t,e)},n.bind(o,null,null));r.test(s)};void 0!==navigator.mediaDevices&&void 0!==navigator.mediaDevices.enumerateDevices?navigator.mediaDevices.enumerateDevices().then(i).catch(function(t){u.debug("Device selection is not supported",t),e&&e({available:!1,details:[]})}):"undefined"!=typeof MediaStreamTrack&&void 0!==MediaStreamTrack.getSources?MediaStreamTrack.getSources(function(e){i(e.map(function(e){return{label:e.label,kind:kinds[e.kind],deviceId:e.id,groupId:""}}))}):t("Devices cannot be enumerated.")},c.testNetworkCallback=function(e,t,i,o,n){e&&t&&i||n("TURN URI, username and password are required"),"string"==typeof e&&"string"==typeof t&&"string"==typeof i||n("TURN URI, username and password must be string type");var s={},l={iceServers:[{username:this.username||"",credential:this.password||"",urls:this.turnURI.split(",")}]};s.connectivity=!1,s.details={},new a(e,t,i,"udp").test(function(n){u.debug("udp connectivity test...Done"),s.details.udpConnectivity=n,new a(e,t,i,"tcp").test(function(n){u.debug("tcp connectivity test...Done"),s.details.tcpConnectivity=n,new c.DataChannelThroughput_CallbackBased(l,3).test(function(n){u.debug("data channel connectivity test...Done"),s.details.dataThroughput=n,new r(e,t,i).test(function(e){u.debug("video bandwidth connectivity test...Done"),s.details.videoBandwidth=e,s.connectivity=(s.details.udpConnectivity||s.details.tcpConnectivity)&&s.details.dataThroughput>0&&s.details.videoBandwidth>0,o(s)})})})})},c.DataChannelThroughput_CallbackBased=function(e,t,i,o){var n=c.DataChannelThroughput_CallbackBased;this.test=function(a,r){var l=new s(e,function(e,t){h&&clearTimeout(h),e.end(),b=!0,"function"==typeof r&&r(t)},!0);n.lastConfig=e;var d,h,p,v,g,m=null,f=0,S=0,_=!1,C=null,b=!1,E=0,R=0,y=[],T=function(e){e&&e.end(),d&&clearTimeout(d)};if(!c.__throughputPayloadData__){c.__throughputPayloadData__="";for(var A=0;A<128;A++)c.__throughputPayloadData__+="12345678"}var I=function(e){v&&clearTimeout(v),g&&clearTimeout(g),"function"==typeof r&&r(e),T(l),b=!0};if("closed"===l.pc1.connectionState||"closed"===l.pc1.signalingState||"closed"===l.pc2.connectionState||"closed"===l.pc2.signalingState)return u.info("Failed to open data channel, connectionState="+l.pc1.connectionState+", signalingState="+l.pc1.signalingState),"function"==typeof r&&r("Cannot get network status.Illegal state for peer connection."),T(l),void(b=!0);(C=l.pc1.createDataChannel(null)).onopen=function(){h&&clearTimeout(h);var e,n=function(){if(Date.now()-e>1100)return u.warn("The timer is executed after additional 1000ms, the page tab may be inactive so that browser tunes the timer interval"),"function"==typeof r&&r("Network diagnostics : Throughput determination failed. The page tab may be inactive so that browser tunes the timer interval."),T(l),void(b=!0);if(C.bufferedAmount<c.__throughputPayloadData__.length){f+=c.__throughputPayloadData__.length;try{C.send(c.__throughputPayloadData__)}catch(e){return void I(e)}}new Date-m>=1e3*t||f-R>307200?_=!0:(e=Date.now(),v=setTimeout(n,1))},a=function(){void 0!==i&&null!==i&&(p=setTimeout(function(){u.debug("Timeout for network status detection, interrupt it and get throughput"),w()},1e3*i)),m||(m=new Date),n()};if(!0===o){var s=function(){if(Date.now()-e>1100)return u.warn("The timer is executed after additional 1000ms, the page tab may be inactive so that browser tunes the timer interval"),"function"==typeof r&&r("Network diagnostics : Latency determination failed. The page tab may be inactive so that browser tunes the timer interval."),T(l),void(b=!0);var t=""+Date.now();try{C.send(t)}catch(e){return void I(e)}R+=t.length,f+=t.length,(E+=1)>=40?a():(e=Date.now(),g=setTimeout(s,100))};s()}else a()};var w=function(){if(!b){b=!0,clearTimeout(v),T(l);var e,t,i,n=new Date-m;if(o){if(y.length>10){var r=y.slice(10),s=0;e=r[0],t=e,r.forEach(function(i){s+=i,i>e&&(e=i),i<t&&(t=i)}),i=Math.round(s/r.length),u.debug("Latency(ms): average: "+i+", min: "+t+", max: "+e+", count: "+r.length+", details: "+r.toString())}u.debug("Warmup details(ms):"+y.slice(0,10))}var c=S-R,d=Math.round(8*c/n);u.debug("Network status detection succeeds. The throughput is: "+d+" kbps, use time (ms): "+n+", received bytes: "+c),"function"==typeof a&&(o?a(d,i,e,t):a(d))}};l.pc2.ondatachannel=function(e){e.channel.onmessage=function(e){if(e.data.length<20){var t=parseInt(e.data),i=Date.now()-t;y.push(i)}S+=e.data.length,_&&f===S&&(p&&clearTimeout(p),w())}};h=setTimeout(function(){u.debug("Takes more than 10000ms to open the data channel. End the call and invoke error callback"),T(l),b=!0,"function"==typeof r&&r("Network diagnostics : ICE failed. Takes more than 10000ms to open the data channel.")},1e4),l.start(),d=setTimeout(function(){T(l)},6e4)}},r.prototype={test:function(e){var t=4e4,i=0,o=0,n=null,a=null,r=new s({iceServers:[{username:this.username||"",credential:this.password||"",urls:this.turnURI.split(",")}]},function(t,i){u.warn(i),c(),e(-1)});r.setMaxVideoBitRate(2e3),r.disableVideoFec();var l={audio:!1,video:{optional:[{minWidth:1280},{minHeight:720}]}};console.log("Calling getUserMedia with constraints",l),h(l).then(function(s){s.getTracks().forEach(function(e){r.pc1.addTrack(e,s)}),r.start(),n=setTimeout(function(){d(),null==a&&(a=setTimeout(function(){c();var t=-1;o>0&&(t=Math.round(i/o)),e(t)},t))},2e3)}).catch(function(t){u.warn("getUserMedia error when testing video bandwidth",t),e(-1)});var c=function(){if(n&&clearTimeout(n),a&&clearTimeout(a),r&&r.pc1){var e=r.pc1.getLocalStreams();e.length>0&&e[0].getTracks().forEach(function(e){e.stop()}),r.end()}},d=function(){r.pc1.getStats(null,function(t){var n;for(var a in t){var r=t[a];if("bweforvideo"===r.id){n=r.googAvailableSendBandwidth/1e3;break}}void 0==n?(u.warn("Cannot get bandwidth from getStats()."),c(),e(-1)):(i+=n,o+=1)},function(t){u.warn("Error when get statistics.",t),c(),e(-1)}),n=setTimeout(d,1e3)}}},l.browser.isIE){var f=JSON.stringify;JSON.stringify=function(){var e=Array.prototype.slice.call(arguments);return(1===e.length||e.length>1&&(null===e[1]||void 0===e[1]))&&(e[1]=function(e,t){return t&&t.call&&t.apply?void 0:t}),f.apply(this,e)}}return e.extend=c.extend,e.wscLoginWithOAuthToken=c.wscLoginWithOAuthToken,e.Message=c.Message,e.ErrorInfo=c.ErrorInfo,e.AuthHandler=c.AuthHandler,e.testBrowser=c.testBrowser,e.testMicrophone=c.testMicrophone,e.testAudio=c.testAudio,e.testCamera=c.testCamera,e.testNetwork=c.testNetwork,e.testMicrophoneCallback=c.testMicrophoneCallback,e.testAudioCallback=c.testAudioCallback,e.testCameraCallback=c.testCameraCallback,e.testNetworkCallback=c.testNetworkCallback,e.resumeAudioContext=c.resumeAudioContext,e}(live||{}),live=function(e){"use strict";function t(e,t){var i=t.pkgInstance.videoSendBitrate;return i?(g.debug("Prefer video send bitrate: "+i),o(e,i,"video")):e}function i(e,t){var i=t.pkgInstance.videoRecvBitrate;return i?(g.debug("Prefer video receive bitrate: "+i),o(e,i,"video")):e}function o(e,t,i){var o=e.split("\r\n"),n=c(o,"m=",i);if(null===n)return g.debug("Failed to add bandwidth line to sdp, as no m-line found"),e;var a=d(o,n+1,-1,"m=");null===a&&(a=o.length);var r=d(o,n+1,a,"c=");if(null===r)return g.debug("Failed to add bandwidth line to sdp, as no c-line found"),e;var s=d(o,r+1,a,"b=AS");s&&o.splice(s,1);var l="b=AS:"+t;return o.splice(r+1,0,l),o.join("\r\n")}function n(e,t){if(!t.pkgInstance.removeVideoFec)return e;g.debug("Removing FEC-related SDP lines (red / ulpfec / rtx)");var i=e.split("\r\n"),o=c(i,"a=rtpmap","red");if(null===o)return e;var n=l(i[o]);if(null===(o=c(i=a(i=r(i,n),"ulpfec"),"a=fmtp",n.toString())))return e;var s=function(e){var t={},i=e.indexOf(" "),o=e.substring(i+1).split("; "),n=new RegExp("a=fmtp:(\\d+)"),a=e.match(n);if(!a||2!==a.length)return null;t.pt=a[1];for(var r={},s=0;s<o.length;++s){var l=o[s].split("=");2===l.length&&(r[l[0]]=l[1])}return t.params=r,t}(i[o]).pt;return null===s?e:(i.splice(o,1),(i=r(i,s)).join("\r\n"))}function a(e,t){var i=c(e,"a=rtpmap",t);if(null===i)return e;var o=l(e[i]);e.splice(i,1);var n=c(e,"m=","video");return null===n?e:(e[n]=s(e[n],o),e)}function r(e,t){var i=c(e,"a=rtpmap",t.toString());if(null===i)return e;e.splice(i,1);var o=c(e,"m=","video");return null===o?e:(e[o]=s(e[o],t),e)}function s(e,t){e=e.split(" ");for(var i=0;i<e.length;++i)e[i]===t.toString()&&e.splice(i,1);return e.join(" ")}function l(e){var t=new RegExp("a=rtpmap:(\\d+) [a-zA-Z0-9-]+\\/\\d+"),i=e.match(t);return i&&2===i.length?i[1]:null}function c(e,t,i){return d(e,0,-1,t,i)}function d(e,t,i,o,n){for(var a=-1!==i?i:e.length,r=t;r<a;++r)if(0===e[r].indexOf(o)&&(!n||-1!==e[r].toLowerCase().indexOf(n.toLowerCase())))return r;return null}var u=e._private=e._private||{},h={},p=u.wscConst,v=u.browser,g=e.getLogger();return h.collectHostIPsByPc=function(e,t){function i(e){g.error("Create offer error while collect Host IP, "+e);o([])}function o(i){try{a&&(a.close(),a=null),r&&(r.close(),r=null),i.length>0?(g.debug("Collected hostIPs: "+JSON.stringify(i,null,2)),e&&e(i)):t()}catch(e){g.error(e)}}var n={};g.debug("Constraints used for peerConnection: "+JSON.stringify(n));var a=new window.RTCPeerConnection(null,n),r=new window.RTCPeerConnection(null,n);try{a.onicecandidate=function(e){if(e.candidate)g.debug("Collected candidate: candidate- "+JSON.stringify(e.candidate));else if(a&&a.localDescription){var i=a.localDescription.sdp;g.debug("Collecting host ips from sdp -"+i),o(function(e){for(var t=[],i=e.split("\r\n"),o=0;o<i.length;o++){var n=i[o],a=null;if(n.match(/^c=/i)){var r=n.split(/\s+/);a=r[2]}else if(n.match(/^a=candidate:.*typ host/i)){var s=n.split(/\s+/);a=s[4]}a&&-1===t.indexOf(a)&&t.push(a)}return t}(i))}else t()},a.createDataChannel("");a.createOffer().then(function(e){a&&r&&(a.setLocalDescription(e),r.setRemoteDescription(e),r.createAnswer().then(function(e){r.setLocalDescription(e),a.setRemoteDescription(e)}).catch(function(e){i(e)}))}).catch(function(e){i(e)})}catch(e){g.error("Got exception when trying to get host IPs: "+e);o([])}},h.addCandidatesFromSdp=function(e,t){var i,o=h.getMediaFromSDP(t),n=[],a={},r=o.length,s=0,l=0;for(s=0;s<r;s++)for(i=(n=o[s].candidates).length,l=0;l<i;l++)a=new RTCIceCandidate({sdpMLineIndex:s,candidate:n[l]}),e.addIceCandidate(a)},h.createPeerConnection=function(t,i){var o,n=null,a=u.wscUtils;try{n=a.getRTCConfiguration(t.session);var r={};r.optional=[{googIPv6:t.pkgInstance.ipv6},{googDscp:t.pkgInstance.dscp}],g.debug("Constraints used for peerConnection: "+JSON.stringify(r)),g.debug("authInfo: "+JSON.stringify(n));var s={};s.start=(new Date).getTime(),t.timeRecording.timeToNewPeerConnection=s,t.collectClientLog(p.LOGTYPE.EVENT_LOG,p.EVENTLOG.ESTABLISH_PEER_CONNECTION_START),o=new window.RTCPeerConnection(n,r),t.collectClientLog(p.LOGTYPE.EVENT_LOG,p.EVENTLOG.ESTABLISH_PEER_CONNECTION_END),t.timeRecording.timeToNewPeerConnection.end=(new Date).getTime();o.onremovestream=function(e){g.info("Remote stream removed."),t.collectClientLog(p.LOGTYPE.EVENT_LOG,p.EVENTLOG.ON_REMOVE_STREAM+":"+e.stream),t.fireMediaStreamEvent(p.MEDIASTREAMEVENT.REMOTE_STREAM_REMOVED,e.stream)},o.ontrack=function(e){g.info("Remote stream added via onAddStream.",e),e.streams.length>0&&(t.collectClientLog(p.LOGTYPE.EVENT_LOG,p.EVENTLOG.ON_ADD_STREAM+":"+e.streams[0]),t.timeRecording.timeToGetRemoteMedia.end=(new Date).getTime(),t.fireMediaStreamEvent(p.MEDIASTREAMEVENT.REMOTE_STREAM_ADDED,e.streams[0]),o.___wsc_onaddstream_called=!0)},o.onconnecting=function(e){g.info("Session connecting.")},o.onopen=function(e){g.info("Session opened.")},t.peerConnection=o,i?(g.debug("Adding local to streams to ",i),h.addLocalStreams(t,i)):h.addLocalStream(t),o.onstatechange=function(e){g.debug("iceConnectionState : "+e.currentTarget.iceConnectionState+"\niceGatheringState : "+e.currentTarget.iceGatheringState+"\n")}}catch(i){g.error("Create peer connection: "+i),h.invokeCallError(t,e.ERRORCODE.PEERCONNECTION_ERROR,i)}},h.createNewPeerConnection=function(e){if(e.peerConnection){var t=h.getLocalStreams(e.peerConnection);if(e.temporarySavedStreams=t,t)for(var i=0;i<t.length;i++){var o=t[i];h.removeLocalStream(e,o)}e.peerConnection.close(),e.peerConnection=null}h.createPeerConnection(e)},h.clearPeerConnection=function(e){var t=e.peerConnection,i=0;if(t){var o=h.getLocalStreams(t),n=h.getRemoteStreams(t);if(o)for(i=0;i<o.length;i++){var a=o[i];h.removeLocalStream(e,a)}if(n)for(i=0;i<n.length;i++)v.isFirefox;t.close(),e.peerConnection=null}},h.setLocalDescription=function(i,o,a,r){g.debug("rtcHelper.setLocalDescription, newSdp:",o);var s=null,l=null;if(i&&i.peerConnection&&o){a||(a=function(){g.debug("Set localDescription succeed!")}),l=function(){i.timeRecording.timeToGetIceCandidates.start=(new Date).getTime(),a.apply(this,arguments)},s=r?function(t){r(t),h.invokeCallError(i,e.ERRORCODE.SET_LOCAL_SDP_ERROR,t)}:function(t){g.warn("Set local description failed: ",t),h.invokeCallError(i,e.ERRORCODE.SET_LOCAL_SDP_ERROR,t)};var c=i.peerConnection.localDescription;g.debug("iceConnectionState/iceGatheringState is: "+i.getIceConnectionState()+"/"+i.peerConnection.iceGatheringState),g.debug("Updating SDP parameters by reconstruction (in case sdp is read only)..",o);var d=o.sdp;if(d=n(d=t(d,i),i),!v.isFirefox&&"offer"===o.type&&d.includes("m=video")){var u=d.indexOf("m=video");d.includes("a=ssrc",u)||(d+="a=ssrc:1 cname:AAAa0AaA0AaAaaaO\r\n")}var p=new RTCSessionDescription({type:o.type,sdp:d});g.debug("setLocalDescription: type: "+p.type+", sdp: \n"+JSON.stringify(p,null,2)),i.peerConnection.setLocalDescription(p).then(l).catch(s),i.peerConnection.__wscLastLocalSdp=c}},h.setRemoteDescription=function(t,o,a,r){var s=null;if(t&&t.peerConnection&&o){a||(a=function(){g.debug("Set remote description succeed!")}),s=r?function(i){r(i),h.invokeCallError(t,e.ERRORCODE.SET_REMOTE_SDP_ERROR,i)}:function(i){g.warn("Set remote description failed!",i),t.collectClientLog(p.LOGTYPE.ERROR_LOG,p.ERRORLOG.SET_REMOTE_SDP_ERROR+":"+o),h.invokeCallError(t,e.ERRORCODE.SET_REMOTE_SDP_ERROR,i)},g.debug("Updating (remote) SDP parameters by reconstruction (in case sdp is read only)..",o);var l=o.sdp;if(l=function(e){return g.debug("Pre H264 fixes sdp: "+e),e=(e=(e=e.replace("profile-level-id=42001f","profile-level-id=42e01f")).replace("profile-level-id=420c1f","profile-level-id=42e01f")).replace("packetization-mode=0","packetization-mode=1"),v.isSafari&&(e=e.replace("h264","H264")),g.debug("Post H264 fixes sdp: "+e),e}(l=n(l=i(l=function(e,t){return g.debug("Browser is: "+JSON.stringify(v,null,2)),v.isIE&&(g.debug("Filtering SDP to remove 'rtcp-fb:* nack' support"),t=t.split("\r\n").filter(function(e){return!e.match(/rtcp-fb:\* nack.*/)}).join("\r\n"),g.debug("Filtering SDP to remove b=AS:0"),t=t.split("\r\n").filter(function(e){return"b=AS:0"!==e}).join("\r\n")),t.split("\r\n").map(function(t){var i=t.match(/a=setup:.*/g);return"offer"===e&&i?(g.debug("SDP offer contains: "+i),"a=setup:actpass"!==i[0]?(g.debug("SDP offer should not contain "+i),"a=setup:actpass"):t):t}).join("\r\n")}(o.type,l),t),t)),v.isFirefox&&"offer"===o.type&&l.includes("m=audio")&&!l.includes("m=video")&&!l.includes("m=application")){var c=l.indexOf("m=audio");l.includes("a=mid",c)||(l+="a=mid:audio\r\n")}g.debug("setRemoteDescription: type: "+o.type+", sdp: \n"+JSON.stringify(l,null,2));var d=new RTCSessionDescription({type:o.type,sdp:l});t.peerConnection.setRemoteDescription(d).then(a).catch(s)}},h.removeLocalStream=function(e,t){t&&(t.peerConnectionNum&&(t.peerConnectionNum--,g.debug("removeLocalStream, peerConnectionNum: "+t.peerConnectionNum)),v.isFirefox||("undefined"!=typeof RTCRtpSender&&t instanceof RTCRtpSender?e.peerConnection.removeTrack(t):e.peerConnection.removeStream(t)),e.fireMediaStreamEvent(p.MEDIASTREAMEVENT.LOCAL_STREAM_REMOVED,t))},h.addLocalStream=function(e,t){var i=e.peerConnection,o=0;if(t){t.peerConnectionNum?t.peerConnectionNum++:t.peerConnectionNum=1,"undefined"!=typeof RTCRtpReceiver&&t instanceof RTCRtpReceiver||"undefined"!=typeof RTCRtpSender&&t instanceof RTCRtpSender?(t.track&&"video"===t.track.kind&&!e.callConfig.shouldSendVideo()&&(t.track.enabled=!1),t.track&&"audio"===t.track.kind&&(g.debug("Adding audio track to new stream",t.track),i.addTrack(t.track,t),g.debug("addLocalStream (video: 0, audio: 1), peerConnectionNum: "+t.peerConnectionNum,t)),t.track&&"video"===t.track.kind&&(g.debug("Adding video track to new stream",t.track),i.addTrack(t.track,t),g.debug("addLocalStream (video: 1, audio: 0), peerConnectionNum: "+t.peerConnectionNum,t))):(t.getVideoTracks().length>0&&!e.callConfig.shouldSendVideo()&&t.getVideoTracks().map(function(e){e.enabled=!1}),t.getAudioTracks().forEach(function(e){g.debug("Adding audio track to new stream",e),i.addTrack(e,t)}),t.getVideoTracks().forEach(function(e){g.debug("Adding video track to new stream",e),i.addTrack(e,t)}),g.debug("addLocalStream (video: "+t.getVideoTracks().length+", audio: "+t.getAudioTracks().length+"), peerConnectionNum: "+t.peerConnectionNum,t));var n=!0,a=e.localMediaStreams;for(o=0;o<a.length;o++){if(a[o]===t){n=!1;break}}n&&(e.localMediaStreams||(e.localMediaStreams=[]),e.localMediaStreams.push(t)),i.__wscIsAudioStreamAdded||(i.__wscIsAudioStreamAdded=h.streamHasMediaTracks([t],"audio")),i.__wscIsVideoStreamAdded||(i.__wscIsVideoStreamAdded=h.streamHasMediaTracks([t],"video")),e.fireMediaStreamEvent(p.MEDIASTREAMEVENT.LOCAL_STREAM_ADDED,t)}else{for(o=0;o<e.temporarySavedStreams.length;o++){var r=e.temporarySavedStreams[o];r.peerConnectionNum?r.peerConnectionNum++:r.peerConnectionNum=1,"undefined"!=typeof RTCRtpReceiver&&r instanceof RTCRtpReceiver||"undefined"!=typeof RTCRtpSender&&r instanceof RTCRtpSender?(r.track&&"audio"===r.track.kind&&(g.debug("Adding audio track to existing stream",r.track),i.addTrack(r.track,r)),r.track&&"video"===r.track.kind&&(g.debug("Adding video track to existing stream",r.track),i.addTrack(r.track,r))):(r.getAudioTracks().forEach(function(e){g.debug("Adding audio track to existing stream",e),i.addTrack(e,r)}),r.getVideoTracks().forEach(function(e){g.debug("Adding video track to existing stream",e),i.addTrack(e,r)})),e.fireMediaStreamEvent(p.MEDIASTREAMEVENT.LOCAL_STREAM_ADDED,r),g.debug("addLocalStream, peerConnectionNum: "+r.peerConnectionNum)}i.__wscIsAudioStreamAdded||(i.__wscIsAudioStreamAdded=h.streamHasMediaTracks(e.localMediaStreams,"audio")),i.__wscIsVideoStreamAdded||(i.__wscIsVideoStreamAdded=h.streamHasMediaTracks(e.localMediaStreams,"video"))}g.debug("call local media streams length : "+e.localMediaStreams.length)},h.addLocalStreams=function(e,t){if(t)for(var i=0;i<t.length;i++){var o=t[i];h.addLocalStream(e,o)}},h.calculateMediaChange=function(e,t){var i=!1,o=[],n=[];if(e.forEach(function(e){"inactive"!==e.mode&&0!==e.port&&o.push(e)}),t.forEach(function(e){"inactive"!==e.mode&&0!==e.port&&n.push(e)}),o.length<n.length)i=!0;else if(o.length>n.length)i=!0;else for(var a=0;a<n.length;a++){for(var r=n[a],s=!1,l=0;l<o.length;l++)if(r.equals(o[l])){s=!0;break}if(!s){i=!0;break}}return i},h.isMediaChanged=function(e,t){return h.calculateMediaChange(e,t)},h.getMediaFromSDP=function(e){var t,i,o,n,a,r,s,l,c=e.split("\r\n"),d=0,u="sendrecv",p=[],v=c.length;for(t=0;t<v;t++)switch(i=c[t].split("="),i[0]){case"a":"sendonly"===(o=i[1])||"sendrecv"===o||"recvonly"===o||"inactive"===o?0===d?u=i[1]:p[d-1].mode=i[1]:0===o.indexOf("candidate:")?p[d-1].candidates.push(c[t]):0===o.indexOf("mid:")&&(p[d-1].mid=c[t]);break;case"m":a=(n=i[1].split(" "))[0],r=n[1],s=new h.Media(a,u,r),p[d++]=s;break;case"o":l=(o=i[1]).split(" ")[1],p.sessionId=l}return p},h.Media=function(e,t,i){this.type=e,this.mode=t,this.port=i,this.candidates=[],this.mid="",this.toJSON=function(){return{type:this.type,mode:this.mode,port:this.port}},this.equals=function(e){return 0===this.port&&(this.mode="inactive"),0===e.port&&(e.mode="inactive"),this.type===e.type&&this.mode===e.mode}},h.getCallConfigFromRemoteSDP=function(t,i){var o=p.MEDIADIRECTION.NONE,n=p.MEDIADIRECTION.NONE,a=null,r=function(e,t){switch(e.toLowerCase()){case"sendonly":return t?p.MEDIADIRECTION.SENDONLY:p.MEDIADIRECTION.RECVONLY;case"recvonly":return t?p.MEDIADIRECTION.RECVONLY:p.MEDIADIRECTION.SENDONLY;case"sendrecv":return p.MEDIADIRECTION.SENDRECV;case"inactive":return p.MEDIADIRECTION.NONE}};if(t){for(var s=h.getMediaFromSDP(t),l=null,c=0;c<s.length;c++)"audio"===s[c].type.toLowerCase()?n=r(s[c].mode,i):"video"===s[c].type.toLowerCase()?o=r(s[c].mode,i):"application"===s[c].type.toLowerCase()&&(l=[]);a=new e.CallConfig(n,o,l)}return a},h.streamHasMediaTracks=function(e,t){var i=!1;if(null===e||"audio"!==t&&"video"!==t)return i;for(var o=0;o<e.length;o++)if("audio"===t)if("undefined"!=typeof RTCRtpReceiver&&e[o]instanceof RTCRtpReceiver||"undefined"!=typeof RTCRtpSender&&e[o]instanceof RTCRtpSender)e[o].track&&"audio"===e[o].track.kind&&(i=!0);else{var n=e[o].getAudioTracks();if(null!==n&&n.length>0){i=!0;break}}else if("undefined"!=typeof RTCRtpReceiver&&e[o]instanceof RTCRtpReceiver||"undefined"!=typeof RTCRtpSender&&e[o]instanceof RTCRtpSender)e[o].track&&"video"===e[o].track.kind&&(i=!0);else{var a=e[o].getVideoTracks();if(null!==a&&a.length>0){i=!0;break}}return i},h.changeSdpByCallConfig=function(e,t){function i(e){var t=r;switch(e){case p.MEDIADIRECTION.RECVONLY:t=v[1];break;case p.MEDIADIRECTION.SENDONLY:t=v[2];break;case p.MEDIADIRECTION.SENDRECV:t=v[0];break;case p.MEDIADIRECTION.NONE:t=v[3]}return t}function o(i,o,n){if(!(i<=-1)){var a="",r="";(d=e.indexOf(c,i+o.length))>-1?(r=e.substring(i,d),a=e.substring(d)):r=e.substring(i);for(var s=0;s<v.length;s++){r.indexOf(v[s])>=0&&(r=r.replace(v[s],n))}var l=t.pkgInstance.trickleIceMode;"full"!==l&&"half"!==l||(r.indexOf("ice-options:google-ice")>0?r=r.replace(/ice-options:google-ice/g,"ice-options:trickle"):r.indexOf("ice-options:trickle")<0&&(r+="a=ice-options:trickle\r\n")),e=e.substring(0,i)+r+a}}var n,a,r="a=inactive",s="m=video",l="m=audio",c="m=",d=-1,u=t.callConfig.audioConfig,h=t.callConfig.videoConfig,v=[];return v[0]="a=sendrecv",v[1]="a=recvonly",v[2]="a=sendonly",v[3]=r,(a=e.indexOf(l))>-1&&o(a,l,i(u)),(n=e.indexOf(s))>-1&&o(n,s,i(h)),e},h.getLocalStreams=function(e){return e?"function"==typeof e.getLocalStreams?e.getLocalStreams():u.browser.isFirefox?e.localStreams:void 0:[]},h.getRemoteStreams=function(e){return e?"function"==typeof e.getRemoteStreams?e.getRemoteStreams():u.browser.isFirefox?e.remoteStreams:void 0:[]},h.invokeCallError=function(t,i,o){if(t.onCallError){var n=new e.ErrorInfo(i,o);try{t.onCallError(n)}catch(e){g.error("The callback function 'Call.onCallError()' exception:"+e)}}},u.rtcHelper=h,e}(live||{}),live=function(e){function t(){this.value,this.statistics={peak:0,bottom:0,count:0,sdv:0,mean:0,oldMean:0,S:0,oldS:0}}var i=e._private=e._private||{},o={},n=i.wscConst,a=i.wscUtils,r=e.getLogger(),s=function(i,s,u,h,p,v,g,m){"use strict";if(v&&(this.extHeaders=v),p){var f=o.rehydrateSession(i,s,u,h,p,v,g,m);if(null==f){var S="Failed to reload session data.",_=new a.ErrorInfo(n.ERRORCODE.RESTORE_FAILED,S);r.warn(S);try{h&&h(_)}catch(e){r.error("onError callback exception: "+e)}}return r.debug("Completed session rehydration: "+p),f}this.webSocketUri=s,this.wscWebsocket=null,this.sessionId=null,this.userName=i,this.sessionState=n.SESSIONSTATE.NONE,this.timeToInitWebSocket=0;try{o.initWebSocket(this)}catch(e){if(r.error("Websocket initialization exception: "+e),h){_=new a.ErrorInfo(n.ERRORCODE.WEBSOCKET_ERROR,e);try{h(_)}catch(e){r.error("The callback function 'Session.failureCallback()' returned the exception: "+e)}}}this.subSessionsMap=new e.Map,this.unACKedMsgQueue=new l,this.successCallback=u,this.failureCallback=h,this.lastOutboundSeq=0,this.lastInboundSeq=0,this.lastUnHandledInboundReq=null,this.lastUnACKedInboundMsg=null,this.hostIPs=[],this.onSessionStateChange=null,this.packagesMap=new e.Map,this.busyPingInterval=3e3,this.idlePingInterval=1e4,this.pingMessage="ping",this.pongMessage="pong",this.pingInterval=this.idlePingInterval,this.reConnectInterval=2e3,this.ackInterval=6e4,this.reConnectTime=6e4,this.retryCount=2,this.retryTimes=0,this.timeToLive=0,this.hibernateSuccessCallback=null,this.hibernateFailureCallback=null,this.onHibernationRequest=null,this.iceServerListFromServer=[],this.iceServerAccessToken=null,g&&(this.extPayloads=g,this.timeToLive=3600,this.clientCapability=new c),this.sessionTimeOut=null,this.reConnectTimeOut=null,this.pingTimeOut=null,this.periodlyACKChecker=new function(e){var t,i,o=e,s=this;this.start=function(){if(o.sessionState===n.SESSIONSTATE.CONNECTED){t&&window.clearTimeout(t);var e=o.lastUnACKedInboundMsg;if(e){var l=e.control.sequence;l&&l!==i&&(typeof e!==a.Message&&(e=new a.Message(e)),e.ack(o),r.debug("PeriodlyACKChecker ack the message in sequence "+l),i=l)}t=window.setTimeout(function(){s.start()},o.ackInterval)}else s.stop()},this.stop=function(){t&&(r.debug("Stop PeriodlyACKChecker"),window.clearTimeout(t))}}(this),this.iceServerEnquirer=new function(e){var t,i,a=e,s=[],l=!1,c=function(){s.forEach(function(e){e()}),s=[],l=!1};this.stop=function(){t&&(r.debug("Stop IceServerEnquiry Timer"),window.clearTimeout(t),t=void 0)},this.scheduleIceEnquiry=function(e){t&&window.clearTimeout(t),t=window.setTimeout(function(){r.debug("Enquiring...."),o.sendIceEnquiry(a)},Math.max(e,0))},this.doIceEnquiry=function(e){if(s.push(e),!l){l=!0;var t=this,n=t.handleIceEnquiry;t.handleIceEnquiry=function(e,o){t.handleIceEnquiry=n,n(e,o),clearTimeout(i),c()},r.debug("Enquiring...."),o.sendIceEnquiry(a),i=setTimeout(function(){r.warn("Timeout of IceServerEnquirer is triggered..."),t.handleIceEnquiry=n,c()},3e3)}},this.handleIceEnquiry=function(e,t){var i=t.control.type;if(i===n.TYPE.RESPONSE){r.debug("Receive Response for ICE-Enquiry "),e.iceServerListFromServer=[];var o=t.payload.iceServers,a=-1;if(o)for(var s=0;s<o.length;s++){var l="",c="",d=-1;if(o[s].username&&(l=o[s].username,e.iceServerAccessToken=l),o[s].credential&&(c=o[s].credential),o[s].lifetime&&(d=1e3*o[s].lifetime),o[s].urls)for(var u=0;u<o[s].urls.length;u++){var h={urls:o[s].urls[u],username:l,credential:c};r.debug("Retrieve an ICE Server from response: "+JSON.stringify(h)),e.iceServerListFromServer.push(h),d>0&&(d<a||a<=0)&&(a=d)}}a<=0?r.warn("The minimum lifetime retrieved from response is "+a+" ms, so stop ICE Enquiry"):(a=2*a/3,r.debug("Schedule an ICE Enquiry in "+a+" ms"),e.iceServerEnquirer.scheduleIceEnquiry(a),e.iceServerEnquiryLifetime=a,e.iceServerEnquiryNextTime=Date.now()+a),e.saveToStorage()}else i===n.TYPE.ERROR&&r.error("Receive an error for ICE-Enquiry Request");if(r.debug("session.callUpdateOnIceResponse="+e.callUpdateOnIceResponse),e.callUpdateOnIceResponse){var p=e.getAllSubSessions();if(p&&p.length>0)for(s=0;s<p.length;s++){var v=p[s],g=v.peerConnection,m=v.getStreams();if(!g||"relay"!==g.sessionType&&"relayed"!==g.sessionType){if(m)for(r.debug("Updating conversation due to Relay Failure"),s=0;s<m.length;s++){var f=m[s];"relayed"!==f.call.sessionType&&"relay"!==f.call.sessionType||f.update(f.getStreamOptions())}}else r.debug("Updating the call due to Relay Failure"),e.allowRetry=!0,v.update(v.callConfig)}e.callUpdateOnIceResponse=!1}}}(this),this.iceServerEnquiryLifetime=0,this.iceServerEnquiryNextTime=0,this.connectSubSessionId=null,this.lastActiveTime=null,this.pingSentTime=null,this.expectedTimeLimitToReceivePong=3e3,this.callUpdateOnIceResponse=!1,this.allowRetry=!1,this.enableVerbose=!1,this.isGetNetworkStatusInProgress=!1,this.getNetworkStatusListeners={successCBs:[],errorCBs:[]},this.networkStatusFactor=new t,this.throughputFactor=new t,this.avgLatencyFactor=new t,this.subscribeErrorCallback=null,this.subscribeNotifyCallback=null,this.__externalAuditData__=[],new d(this),this.toJSON=function(){return{sessionId:this.sessionId,userName:this.userName,unACKedMsgQueue:this.unACKedMsgQueue,lastOutboundSeq:this.lastOutboundSeq,lastInboundSeq:this.lastInboundSeq,lastUnHandledInboundReq:this.lastUnHandledInboundReq,subSessionsMap:this.subSessionsMap,packagesMap:this.packagesMap,iceServerListFromServer:this.iceServerListFromServer,iceServerEnquiryNextTime:this.iceServerEnquiryNextTime}}};s.prototype={getAllSubSessions:function(){for(var e=[],t=this.subSessionsMap.values(),i=0,o=0;o<t.length;o++)for(var n=t[o].values(),a=0;a<n.length;a++)e[i]=n[a],i++;return e},getSubSessionsByPackageType:function(e){return this.subSessionsMap.get(e)},putSubSession:function(t,i,n){var a=this.subSessionsMap.get(t);a||(a=new e.Map,this.subSessionsMap.put(t,a)),a.put(i,n),o.updateActivityMarker(this),o.schedulePing(this,!1)},getSubSession:function(e){"use strict";for(var t=null,i=this.subSessionsMap.values(),o=0;o<i.length&&null==(t=i[o].get(e));o++);return t},removeSubSession:function(e){"use strict";r.debug("Removing sub-session: "+e);for(var t=this.subSessionsMap.values(),i=0;i<t.length;i++)t[i].remove(e);var n=this.getAllSubSessions();n&&0===n.length&&o.updateActivityMarker(this),this.saveToStorage()},saveToStorage:function(){if(this.sessionState!==n.SESSIONSTATE.CLOSED&&this.sessionState!==n.SESSIONSTATE.FAILED&&this.sessionState!==n.SESSIONSTATE.RELOADING)if(i.browser.supportSessionStorage)if(this.sessionId)try{sessionStorage.setItem(this.sessionId,JSON.stringify(this));var t=JSON.parse(sessionStorage.getItem(this.sessionId));r.debug("saved ..."),r.debug(t)}catch(t){r.error("Failed to save. Error = "+t),o.invokeSessionError(this,e.ERRORCODE.SAVE_FAILED,t)}else r.debug("Not saving. No sessionId");else r.warn("Sorry, web storage is not supported...");else r.debug("Do not save session data with session state: "+this.sessionState)},setSessionState:function(e){"use strict";this.sessionState=e,null!=this.sessionId&&this.saveToStorage(),this.onSessionStateChange&&this.onSessionStateChange(e)},close:function(){o.clearSession(this),this.wscWebsocket&&(this.wscWebsocket.close(1e3,"Normal close"),this.wscWebsocket=null,r.info("Websocket normally closed")),this.setSessionState(n.SESSIONSTATE.CLOSED)},getPackage:function(e){return this.packagesMap.get(e)},registerPackage:function(t){var i=t.packageType;if(!i)throw"There is no packageType defined in the package.";try{if(this.packagesMap.get(i))throw"Duplicated package type in Session.";this.packagesMap.put(i,t);var o=new e.Map;this.subSessionsMap.put(i,o)}catch(e){r.error("Package registration failed:"+e)}},getUserName:function(){return this.userName},getSessionId:function(){return this.sessionId},getLastOutboundSeq:function(){return this.lastOutboundSeq},setIdlePingInterval:function(e){this.idlePingInterval=e<1e3?1e3:e},setBusyPingInterval:function(e){this.busyPingInterval=e<1e3?1e3:e},setPingPongMessages:function(e,t){this.pingMessage=e,this.pongMessage=t},setReconnectInterval:function(e){this.reConnectInterval=e},setReconnectTime:function(e){this.reConnectTime=e},sendMessage:function(e){"use strict";var t,i=e.control.package_type,o=this.sessionId,a=e.control.type;if(o&&(e.control.session_id=o),e.control.version=n.PROTOCOL_VERSION,e.isReconnect()||a!==n.TYPE.ACK&&(e.control.sequence=this.lastOutboundSeq+1),t=JSON.stringify(e),this.sessionState===n.SESSIONSTATE.CLOSED||this.sessionState===n.SESSIONSTATE.FAILED)throw r.debug("Cannot send message; session state: "+this.sessionState),"Cannot send message; session state: "+this.sessionState;if(this.sessionState===n.SESSIONSTATE.CONNECTED||i===n.PACKAGE.REGISTER)try{this.wscWebsocket.send(t),r.debug("Session: "+o+", Sending message: "+JSON.stringify(e,null,2))}catch(e){r.error("Received an exception when sending message: "+e)}e.isACK()||e.isReconnect()||this.lastOutboundSeq++,r.debug("Send message - lastInboundSeq = "+this.lastInboundSeq+", lastOutboundSeq = "+this.lastOutboundSeq),this.unACKedMsgQueue.addMessage(e),(e.isFinalResponse()||e.isError()||"complete"===e.header.action)&&(this.lastUnHandledInboundReq&&this.lastUnHandledInboundReq.control.sequence<=e.control.ack_sequence&&(this.lastUnHandledInboundReq=null),this.lastUnACKedInboundMsg&&this.lastUnACKedInboundMsg.control.sequence===e.control.ack_sequence&&(this.lastUnACKedInboundMsg=null)),this.saveToStorage()},reSendMessage:function(e){var t=JSON.stringify(e);try{this.wscWebsocket.send(t),r.debug("Re-send message: "+JSON.stringify(e,null,4))}catch(e){r.error("Received an exception when re-sending message: "+e)}this.unACKedMsgQueue.addMessage(e),r.debug("Re-send message - lastInboundSeq = "+this.lastInboundSeq+", lastOutboundSeq = "+this.lastOutboundSeq),this.saveToStorage()},genNewCorrelationId:function(){return n.CONSTCS.CLIENT+(this.getLastOutboundSeq()+1)},generateSubSessionId:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=window.crypto.getRandomValues(new Uint8Array(1))[0]%16|0;return("x"===e?t:3&t|8).toString(16)})},hibernate:function(t,i,n){var a=this.getAllSubSessions();t&&t>0&&(this.timeToLive=t),this.hibernateSuccessCallback=i,this.hibernateFailureCallback=n,o.updateActivityMarker(this),a&&a.length>0?o.invokeHibernateError(this,e.ERRORCODE.BUSY_EVERYWHERE,"session on busy"):o.sendHibernate(this,t)},getNetworkStatus:function(e,t){var i=this;if(i.getNetworkStatusListeners.successCBs.push(e),i.getNetworkStatusListeners.errorCBs.push(t),!0!==i.isGetNetworkStatusInProgress)if(0!==this.iceServerListFromServer.length){i.isGetNetworkStatusInProgress=!0;var o={iceServers:[].concat(this.iceServerListFromServer)},s=function(e){r.warn("Error happens when get network status: "+e);try{i.getNetworkStatusListeners.errorCBs.forEach(function(e){"function"==typeof e&&e("Cannot get network status.")})}finally{i.getNetworkStatusListeners.successCBs=[],i.getNetworkStatusListeners.errorCBs=[],i.isGetNetworkStatusInProgress=!1}},l=o.iceServers;Array.isArray(l)&&(o.iceServers=[].concat(l.filter(function(e){return e.urls&&(0===e.urls.toLowerCase().indexOf("turn:")||0===e.urls.toLowerCase().indexOf("turns:"))})));try{new a.DataChannelThroughput_CallbackBased(o,4,8,!0).test(function(e,t,o,s){var l=1,c={};try{if(e>=0){if(c.throughput=e,l=e<=25?1:e>25&&e<=150?2:e>150&&e<=300?3:e>300&&e<=1e3?4:5,void 0!==t&&void 0!==o&&void 0!==s&&(t>1e3&&(l=1),c.avgLatency=t,c.maxLatency=o,c.minLatency=s),i.getNetworkStatusListeners.successCBs.forEach(function(e){"function"==typeof e&&e(l,c)}),i.networkStatusFactor.put(l),i.throughputFactor.put(e),i.avgLatencyFactor.put(t),i.enableVerbose&&i.sessionState===n.SESSIONSTATE.CONNECTED){var d=new a.Message;d.control.type=n.TYPE.MESSAGE,d.control.package_type=n.PACKAGE.REGISTER,d.control.subsession_id=i.connectSubSessionId,d.control.session_id=i.sessionId,d.control.ack_sequence=i.lastInboundSeq,d.header.initiator=i.userName,d.header.action=n.ACTION.AUDIT,d.header.module="WEB";var u=null,h=i.getSubSessionsByPackageType(n.PACKAGE.CONVERSATION);h&&h.size()>0&&(u=h.values()[0].conversationKey),u&&(d.header.conversation_key=u),d.header.access_token=i.iceServerAccessToken;var p={network_test:{mos:l,bandwidth:e,rtt:t}};d.payload={audit_data:p},i.sendMessage(d)}}else i.getNetworkStatusListeners.errorCBs.forEach(function(e){"function"==typeof e&&e("Throughput is less than zero.")})}catch(e){r.error("Error happens when getNetworkStatus..."+e),i.getNetworkStatusListeners.errorCBs.forEach(function(e){"function"==typeof e&&e("Throughput is less than zero.")})}finally{i.getNetworkStatusListeners.successCBs=[],i.getNetworkStatusListeners.errorCBs=[],i.isGetNetworkStatusInProgress=!1}},s)}catch(e){r.info("Network test failed..",e),s(e)}}else r.warn("ICE servers is not ready. The callbacks will be invoked by next effective invocation");else r.warn("getNetworkStatus is already in progress.")},getNetworkTestStatisticsData:function(){return{mos:this.networkStatusFactor.toJSON(),bandwidth:this.throughputFactor.toJSON(),rtt:this.avgLatencyFactor.toJSON()}},setTimeToLive:function(e){e&&e>0&&(this.timeToLive=e)},suspend:function(){return this.wscWebsocket&&(this.wscWebsocket.close(3001,"Abnormal close"),this.wscWebsocket=null,r.info("Websocket abnormal closed")),this.setSessionState(n.SESSIONSTATE.SUSPENDED),i.browser.supportSessionStorage?sessionStorage.getItem(this.sessionId):(r.warn("The browser does not support SessionStorage, there is no stateInfo stored."),null)},subscribeToEntity:function(e,t,i,n){return this.subscribeErrorCallback=i,this.subscribeNotifyCallback=n,o.sendSubscribe(this,null,e,t)},unsubscribeFromEntity:function(e){o.sendSubscribe(this,e.subsession_id,e.entity,0)},logEventTimestamp:function(e,t){var i={};i[e]=t||Date.now(),this.__externalAuditData__.push(i)}},t.prototype={put:function(e){return void 0===e||isNaN(e)?void(this.value=void 0):e<0?void(this.value=e):(e*=1,this.value=e,this.statistics.count++,1===this.statistics.count?(this.statistics.peak=e,this.statistics.bottom=e):(this.statistics.peak<e&&(this.statistics.peak=e),this.statistics.bottom>e&&(this.statistics.bottom=e)),void(1==this.statistics.count?this.statistics.oldMean=this.statistics.mean=e:(this.statistics.mean=this.statistics.oldMean+(e-this.statistics.oldMean)/this.statistics.count,this.statistics.S=this.statistics.oldS+(e-this.statistics.oldMean)*(e-this.statistics.mean),this.statistics.oldMean=this.statistics.mean,this.statistics.oldS=this.statistics.S,this.statistics.sdv=this.statistics.count>1?Math.sqrt(this.statistics.S/(this.statistics.count-1)):0)))},toJSON:function(){return{peak:void 0===this.statistics.peak?void 0:this.statistics.peak%1==0?this.statistics.peak:1*this.statistics.peak.toFixed(2),bottom:void 0===this.statistics.bottom?void 0:this.statistics.bottom%1==0?this.statistics.bottom:1*this.statistics.bottom.toFixed(2),count:this.statistics.count,sdv:void 0===this.statistics.sdv?void 0:this.statistics.sdv%1==0?this.statistics.sdv:1*this.statistics.sdv.toFixed(2),mean:void 0===this.statistics.mean?void 0:this.statistics.sdv%1==0?this.statistics.sdv:1*this.statistics.mean.toFixed(2)}}},o.handleWsOpen=function(e){function t(){var t=e.getAllSubSessions();if(t&&t.length>0)for(var a=0;a<t.length;a++){var s=t[a],l=s.peerConnection;if(l){r.debug("Cleanup call between caller ["+s.getCaller()+"] and callee ["+s.getCallee()+"]");var c=n.getLocalStreams(l),d=n.getRemoteStreams(l);if(s.temporarySavedStreams=c,c)for(a=0;a<c.length;a++)n.removeLocalStream(s,c[a]);if(d)for(a=0;a<d.length;a++)i.browser.isFirefox||l.removeStream(d[a]);"closed"!==l.iceConnectionState&&(l.close(),s.peerConnection=null)}}o.sendRegister(e,null)}r.debug("Session opened with id: "+e.sessionId+", Old IPs: "+JSON.stringify(e.hostIPs,null,2));var n=i.rtcHelper;n.collectHostIPsByPc(function(i){r.debug("New IPs: "+JSON.stringify(i,null,2)+"\nOld IPs: "+JSON.stringify(e.hostIPs,null,2)),0!==e.hostIPs.length?function(e,t){for(var i=!0,o=0;o<t.length;o++){var n=t[o];if(e.indexOf(n)>-1){i=!1;break}}return i}(e.hostIPs,i)?(r.debug("Host IPs have changed"),e.clientIpNotChangedAfterReconnect=!1,t()):(r.debug("Host IPs have NOT changed"),e.clientIpNotChangedAfterReconnect=!0,o.sendRegister(e,null)):o.sendRegister(e,null),e.hostIPs=i,r.debug("New IPs: "+JSON.stringify(e.hostIPs,null,2))},function(){r.error("Failed to get host IPs."),t()})},o.handleWsClose=function(t,i){r.debug("Session closed with id: "+t.sessionId),o.clearWebSocket(t.wscWebsocket,i),t.wscWebsocket=null,t.sessionState===n.SESSIONSTATE.CONNECTED?(t.periodlyACKChecker.stop(),t.iceServerEnquirer.stop(),t.setSessionState(n.SESSIONSTATE.RECONNECTING),window.clearTimeout(t.pingTimeOut),t.sessionTimeOut=window.setTimeout(function(){r.warn("reconnect timeout."),o.clearSession(t),t.setSessionState(n.SESSIONSTATE.FAILED),window.clearTimeout(t.reConnectTimeOut)},t.reConnectTime),o.reInitWebSocket(t)):t.sessionState===n.SESSIONSTATE.RELOADING?o.invokeSessionError(t,e.ERRORCODE.WEBSOCKET_ERROR,"websocket onerror"):t.sessionState===n.SESSIONSTATE.NONE&&(o.clearSession(t),o.invokeSessionError(t,e.ERRORCODE.WEBSOCKET_ERROR,"websocket onerror"))},o.reInitWebSocket=function(e){r.debug("Session reinitialised with id: "+e.sessionId);var t=e.sessionState;r.debug("reInitWebSocket with state: "+t),t!==n.SESSIONSTATE.CONNECTED&&t!==n.SESSIONSTATE.CLOSED&&(e.reConnectTimeOut&&window.clearTimeout(e.reConnectTimeOut),e.sessionTimeOut&&window.clearTimeout(e.sessionTimeOut),o.initWebSocket(e),e.reConnectTimeOut=window.setTimeout(function(){o.reInitWebSocket(e)},e.reConnectInterval))},o.schedulePing=function(e,t){if(e.sessionState===n.SESSIONSTATE.CONNECTED){e.pingTimeOut&&window.clearTimeout(e.pingTimeOut),t&&o.sendPing(e);var i=e.getAllSubSessions();i&&i.length>0?e.pingInterval=e.busyPingInterval:e.pingInterval=e.idlePingInterval,e.pingInterval>0&&(e.pingTimeOut=window.setTimeout(function(){o.schedulePing(e,!0)},e.pingInterval))}},o.sendPing=function(e){try{null!=e.wscWebsocket&&(e.wscWebsocket.send(e.pingMessage),e.pingSentTime=Date.now(),o.isAlive(e))}catch(e){r.debug("can not send ping now: "+e)}},o.isAlive=function(e){setTimeout(function(){var t=e.lastActiveTime-e.pingSentTime;t<0||t>e.expectedTimeToGetResponseFromServer?(e.retryTimes++,r.debug("The ping-pong retryTimes/retryCount: "+e.retryTimes+"/"+e.retryCount),e.retryTimes===e.retryCount&&(e.retryTimes=0,r.warn("Client reconnecting..."),o.handleWsClose(e,!0))):e.retryTimes=0},e.expectedTimeLimitToReceivePong)},o.updateActivityMarker=function(e){e.lastActiveTime=Date.now()},o.clearSession=function(e,t){var o=1e3,n=[];e.packagesMap&&(n=e.packagesMap.values());for(var r=0;r<n.length;r++)n[r].clear&&n[r].clear();t&&(o=t),1e3==o&&i.browser.supportSessionStorage&&sessionStorage&&sessionStorage.removeItem(e.sessionId),e.periodlyACKChecker&&e.periodlyACKChecker.stop(),e.iceServerEnquirer&&e.iceServerEnquirer.stop(),a.setsessionid("")};var l=function(){var e=null,t=null,i=new a.Queue;this.toJSON=function(){return{lowerSeq:e,upperSeq:t,msgQueue:i}},this.getLowerSeq=function(){return e},this.setLowerSeq=function(t){e=t},this.getUpperSeq=function(){return t},this.setUpperSeq=function(e){t=e},this.getMsgQueue=function(){return i},this.addMessage=function(o){if(!o.isACK()&&!o.isReconnect()){var n=o.control.sequence;null==e&&(e=n),t=n,i.enqueue(o),r.debug("addMessage - queue size = "+i.length()+", cslw: "+e+", csuw: "+t)}},this.ackMessages=function(o){if(r.debug("ackMessages - (before) ackSeq = "+o+", queue size = "+i.length()+", cslw = "+e+", csuw = "+t),0!==i.length()&&o>=e&&o<=t){for(var n=i.dequeue(),a=n.control.sequence;n&&a<o;)a=(n=i.dequeue()).control.sequence;return r.debug("ackMessages - queued message sequence = "+a),null==i.peek()?(e=t+1,r.debug("ackMessages - Reset cslw to csuw+1 = "+e)):(n=i.peek(),e=n.control.sequence,r.debug("ackMessages - Reset cslw to incoming seq = "+e)),r.debug("ackMessages - (after) queue size = "+i.length()+", cslw = "+e+", csuw = "+t),!0}return!1},this.reSendMessage=function(o,n){for(var a=i.length(),s=0;s++<a;){(l=i.dequeue()).control.sequence>=n+1?(l.control.sequence=o.lastOutboundSeq+1,o.reSendMessage(l),o.lastOutboundSeq=l.control.sequence):r.debug("skip message: "+JSON.stringify(l))}if(null==i.peek())e=t+1,r.debug("reSendMessage - Reset cslw to csuw+1 = "+e);else{var l=i.peek();e=l.control.sequence,r.debug("reSendMessage - Reset cslw to incoming seq = "+e)}r.debug("reSendMessage - cslw: "+this.getLowerSeq()+", csuw: "+this.getUpperSeq()+", queue size = "+i.length())}};o.handleWsData=function(e,t){"use strict";if(o.updateActivityMarker(t),e===t.pongMessage);else{o.schedulePing(t,!1);var i;i="string"==typeof e?JSON.parse(e):e,r.debug("Session: "+t.sessionId+", Received data from server: "+JSON.stringify(i,null,2));var s=new a.Message(i),l=null,c=null,d=null,u=null,h=null;if(s&&(l=s.control.sequence,c=s.control.ack_sequence,d=s.control.type,u=s.header.action,h=s.control.package_type),l&&(t.lastInboundSeq=l),c?(t.unACKedMsgQueue.ackMessages(c),r.debug("handleWsData: lastInboundSeq = "+t.lastInboundSeq+", lastOutboundSeq = "+t.lastOutboundSeq)):d===n.TYPE.RESPONSE&&null!=l&&(t.unACKedMsgQueue.ackMessages(l),r.debug("handleWsData: lastInboundSeq = "+t.lastInboundSeq+", lastOutboundSeq = "+t.lastOutboundSeq)),h||(h=n.PACKAGE.REGISTER),d===n.TYPE.REQUEST&&(t.lastUnHandledInboundReq=s),t.lastUnACKedInboundMsg=s,u===n.ACTION.SHUTDOWN&&null!=t.lastUnHandledInboundReq)t.lastUnHandledInboundReq.control.subsession_id===s.control.subsession_id&&(t.lastUnHandledInboundReq=null);var p=t.getPackage(h);p?p.onMessage(s):r.warn("package_type '"+h+"' is not defined!"),t.saveToStorage()}},o.invokeSessionError=function(t,i,o){if(t.failureCallback){var n=new e.ErrorInfo(i,o);try{t.failureCallback(n)}catch(e){r.error("The callback function 'Session.failureCallback()' returned an exception: "+e)}}},o.invokeHibernateError=function(t,i,o){if(t.hibernateFailureCallback){var n=new e.ErrorInfo(i,o);try{t.hibernateFailureCallback(n)}catch(e){r.error("The callback function 'Session.hibernateFailureCallback()' returned an exception: "+e)}}},o.initWebSocket=function(e){"use strict";if(null==e.wscWebsocket){r.debug("creating the websocket..."),e.timeToInitWebSocket=(new Date).getTime();try{e.wscWebsocket=new WebSocket(e.webSocketUri,"webrtc.oracle.com")}catch(e){throw r.debug("sessionHelper.initWebSocket(): new WebSocket() returns error: ",e),new Error("sessionHelper.initWebSocket(): new WebSocket() returns error: "+JSON.stringify(e))}if(null==e.wscWebsocket)throw new Error("sessionHelper.initWebSocket(): new WebSocket() returns null.");e.wscWebsocket.onopen=function(t){e.timeToInitWebSocket=(new Date).getTime()-e.timeToInitWebSocket,r.debug("websocket event handler onopen is invoked."),o.handleWsOpen(e)},e.wscWebsocket.onclose=function(t){r.debug("websocket event handler onclose is invoked.",t),o.handleWsClose(e)},e.wscWebsocket.onmessage=function(t){t.data&&o.handleWsData(t.data,e)},e.wscWebsocket.onerror=function(e){r.info("websocket onerror",e)}}},o.clearWebSocket=function(e,t){if(null!=e){r.debug("Closing web socket",e),e.onopen=null,e.onclose=null,e.onmessage=null,e.onerror=null;var i=1e3,o="Normal close";t&&(i=3001,o="Abnormal close"),r.debug("Closing web socket with code: "+i,e),e.close(i,o)}},o.sendRegister=function(e,t){"use strict";var i=new a.Message;if(i.control.type=n.TYPE.REQUEST,i.control.package_type=n.PACKAGE.REGISTER,e.userName&&(i.header.initiator=e.userName,i.header.target=e.userName),i.header.action=n.ACTION.CONNECT,t&&(i.header.authorization=t),e.extHeaders&&i.addExtHeaders(e.extHeaders),e.extPayloads&&i.addExtPayloads(e.extPayloads),e.clientCapability){var o={family:e.clientCapability.family,version:e.clientCapability.version};if(i.payload.capability)for(var r in o){var s=o[r];i.payload.capability[r]||(i.payload.capability[r]=s)}else i.payload.capability=o}e.sessionId?t?e.sendMessage(i):(i.header.cslr=e.lastInboundSeq,i.header.cslw=e.unACKedMsgQueue.getLowerSeq(),i.header.csuw=e.unACKedMsgQueue.getUpperSeq(),e.sendMessage(i)):e.sendMessage(i)},o.sendHibernate=function(e,t){"use strict";var i,o=new a.Message;o.control.type=n.TYPE.REQUEST,o.control.package_type=n.PACKAGE.REGISTER,o.control.subsession_id=e.generateSubSessionId(),o.control.correlation_id=e.genNewCorrelationId(),o.header.action=n.ACTION.HIBERNATE,i=t&&t>0?{ttl:t}:{ttl:3600},o.addExtHeaders(i),e.sendMessage(o)},o.respondHibernate=function(e,t){"use strict";var i=new a.Message;if(e.timeToLive&&e.timeToLive>0){i.control.type=n.TYPE.RESPONSE,i.header.response_code=200,i.control.message_state=n.MESSAGESTATE.FINAL;var o={ttl:e.timeToLive};i.addExtHeaders(o),i.header.response_code}else i.control.type=n.TYPE.ERROR,i.header.error_code=n.ERRORCODE.FORBIDDEN,i.header.reason="Not supported",i.header.error_code;i.control.package_type=n.PACKAGE.REGISTER,i.control.subsession_id=t.control.subsession_id,i.control.correlation_id=t.control.correlationId,i.control.ack_sequence=e.lastInboundSeq,i.header.action=n.ACTION.HIBERNATE,e.sendMessage(i)},o.sendIceEnquiry=function(e){"use strict";var t=new a.Message;t.control.type=n.TYPE.REQUEST,t.control.package_type=n.PACKAGE.REGISTER,t.control.subsession_id=e.connectSubSessionId,t.control.correlation_id=e.genNewCorrelationId(),t.header.action=n.ACTION.ICE_ENQUIRY,e.sendMessage(t)},o.rehydrateSession=function(e,t,a,l,d,u,h,p){if(p){if(d&&d!==p.sessionId)return r.error("SessionId is inconsistent, sessionId in stateInfo is: "+p.sessionId+", but the given sessionId is: "+d),null;i.browser.supportSessionStorage?sessionStorage.setItem(p.sessionId,JSON.stringify(p)):r.warn("Sorry, web storage is not supported...")}var v=o.getStoredSession(d);if(r.debug("Get stored session: "+JSON.stringify(v)),v){var g=new s(e,t,a,l);g.userName=v.userName,g.sessionId=v.sessionId,g.lastOutboundSeq=v.lastOutboundSeq,g.lastInboundSeq=v.lastInboundSeq,g.lastUnHandledInboundReq=v.lastUnHandledInboundReq,g.iceServerListFromServer=v.iceServerListFromServer,g.iceServerEnquiryNextTime=v.iceServerEnquiryNextTime,g.extHeaders=u,h&&(g.extPayloads=h,g.timeToLive=3600,g.clientCapability=new c),g.unACKedMsgQueue.setUpperSeq(v.unACKedMsgQueue.upperSeq),g.unACKedMsgQueue.setLowerSeq(v.unACKedMsgQueue.lowerSeq);for(var m=v.unACKedMsgQueue.msgQueue.array,f=0;f<m.length;f++)g.unACKedMsgQueue.getMsgQueue().enqueue(m[f]);return g.rehydrationData={subSessionsMap:v.subSessionsMap,packagesMap:v.packagesMap},g.setSessionState(n.SESSIONSTATE.RELOADING),g}return null},o.getStoredSession=function(e){if(i.browser.supportSessionStorage){var t=sessionStorage.getItem(e);if(t)return JSON.parse(t)}return null},o.removeStoredSession=function(e){i.browser.supportSessionStorage&&sessionStorage.removeItem(e)},o.handleAuthenticateChallenge=function(e,t,i,o){var s=e.authHandler,l=null,c=!0,d=0;if(s&&s.refresh)for(;c&&d<3;)try{d++;var u=t.header.authenticate,h=s.refresh(n.AUTHTYPE.SERVICE,null);if(a.checkAuthInfo(n.AUTHTYPE.SERVICE,h)){u.ha1=a.calcHa1(h,u),u.username=h.username,i(u),c=!1;break}if(null==h||""===h){l="No correct information was returned from the callback function 'AuthHandler.refresh()', or the user canceled the operation.",r.warn(l);break}l="No correct information was returned from the callback function 'AuthHandler.refresh()'. Please try again.",r.warn(l)}catch(e){l="Handle unauthenticated message error:"+e,r.error(l),c=!0}else l="No AuthHandler object was created for this Session or this AuthHandler did not implement the callback function 'AuthHandler.refresh()'!",r.warn(l);c&&o(l)},o.handleConnection=function(e,t){var i=t.control.type,s=t.getExtHeaders();if(i===n.TYPE.RESPONSE){e.sessionId&&e.sessionId!==t.control.session_id&&(r.warn("Local session id does not match remote session id - local: "+e.sessionId+", remote: "+t.control.session_id),o.clearSession(e),e.lastOutboundSeq=1,e.lastUnHandledInboundReq=null,e.lastUnACKedInboundMsg=null,e.sessionState=n.SESSIONSTATE.NONE),e.sessionId=t.control.session_id,r.debug("Retrieve verbose log flag from connect/response message : "+t.header.enable_verbose),t.header.enable_verbose&&(e.enableVerbose=t.header.enable_verbose),e.connectSubSessionId=t.control.subsession_id;var l=function(){var i=e.sessionState;switch(r.debug("doAfterIceEnquiry: session state = "+i),e.setSessionState(n.SESSIONSTATE.CONNECTED),i){case n.SESSIONSTATE.NONE:if(e.userName=t.header.initiator,a.setsessionid(e.sessionId),e.successCallback)try{e.successCallback(s)}catch(e){r.warn("The callback function 'session.successCallback()' exception:"+e)}break;case n.SESSIONSTATE.RECONNECTING:r.info("Session re-connected."),e.sessionTimeOut&&window.clearTimeout(e.sessionTimeOut),e.reConnectTimeOut&&window.clearTimeout(e.reConnectTimeOut),(v=t.header.sslr)&&v>e.unACKedMsgQueue.getUpperSeq&&e.unACKedMsgQueue.setUpperSeq(v),e.unACKedMsgQueue.reSendMessage(e,v);var l=e.packagesMap.entry,c=e.subSessionsMap.entry;for(var d in l){var u=e.getPackage(d),h=c[d];if(u&&u.onResurrect)for(var p in h.entry)u.onResurrect(h.get(p))}break;case n.SESSIONSTATE.RELOADING:r.info("Session re-loaded.");var v=t.header.sslr;if(e.successCallback)try{e.successCallback(s)}catch(e){r.warn("The callback function 'session.successCallback()' exception:"+e)}var g=e.rehydrationData;if(g){l=g.packagesMap.entry,c=g.subSessionsMap.entry;for(var d in l){u=e.getPackage(d),h=c[d];u&&u.onRehydration&&u.onRehydration(h)}}var m=e.lastUnHandledInboundReq;m&&o.handleWsData(m,e)}o.updateActivityMarker(e),o.schedulePing(e,!1),e.periodlyACKChecker.start()},c=t.header.sslr;if(void 0===c)r.debug("sslr is undefined and this is the first time register, do ice enquiry..."),e.iceServerEnquirer.doIceEnquiry(l);else{if(r.debug("sslr is NOT undefined and this is the reconnecting register, skip ice enquiry."),e.lastOutboundSeq=c,e.iceServerEnquiryNextTime>0){var d=e.iceServerEnquiryNextTime-Date.now();r.debug("Schedule ice enquiry after: "+d+"ms."),e.iceServerEnquirer.scheduleIceEnquiry(d)}l()}}else if(i===n.TYPE.ERROR){var u=t.header.error_code,h=t.header.reason,p=new a.ErrorInfo(u,h),v=function(t){t&&(h=h+"("+t+")"),r.warn("Session connect failed:"+h),o.invokeSessionError(e,u,h),e.close()};if(u===n.ERRORCODE.UNAUTHORIZED||u===n.ERRORCODE.PROXYAUTH_REQUIRED){r.debug("Authentication failed: "+p.code);o.handleAuthenticateChallenge(e,t,function(t){o.sendRegister(e,t)},v)}else v()}},o.handleHibernation=function(e){o.clearSession(e,3001),e.wscWebsocket&&(e.wscWebsocket.close(3001,"Session hibernated"),e.wscWebsocket=null,r.info("Websocket closed for hibernation")),e.lastUnHandledInboundReq=null,e.lastUnACKedInboundMsg=null,e.pingTimeOut&&window.clearTimeout(e.pingTimeOut),e.reConnectTimeOut&&window.clearTimeout(e.reConnectTimeOut),e.sessionTimeOut&&window.clearTimeout(e.sessionTimeOut),e.setSessionState(n.SESSIONSTATE.HIBERNATED)},o.sendSubscribe=function(e,t,i,o){"use strict";var r=new a.Message,s=null===t?e.generateSubSessionId():t;r.control.type=n.TYPE.REQUEST,r.control.package_type=n.PACKAGE.REGISTER,r.control.subsession_id=s,r.control.correlation_id=e.genNewCorrelationId(),r.header.action=n.ACTION.SUBSCRIBE,r.header.initiator=e.userName;var l=i.split("@"),c={tenant:l.length>1?l[1]:"unknown",entity:i,expires:o};return r.header.presence_data=c,e.sendMessage(r),{entity:i,subsession_id:s}},o.handleSubscribeResponse=function(e,t){"use strict";var i=t.control.type;if(i===n.TYPE.RESPONSE)r.debug("Subscription success");else if(i===n.TYPE.ERROR&&e.subscribeErrorCallback){var o=t.header.error_code,s=t.header.reason,l=new a.ErrorInfo(o,s);r.warn("Subscription failed: "+JSON.stringify(l));try{e.subscribeErrorCallback(l)}catch(e){r.warn("The callback function 'session.subscribeErrorCallback()' exception: "+e)}}},o.handleSubscribeNotify=function(e,t){"use strict";var i=t.header.presence_data;if(r.debug("Subscription notify: "+JSON.stringify(i)),void 0!==i&&e.subscribeNotifyCallback)try{e.subscribeNotifyCallback(i)}catch(e){r.warn("The callback function 'session.subscribeNotifyCallback()' exception: "+e)}};var c=function(){"use strict";var e,t,i,o=navigator.userAgent,n=navigator.appName,a=""+parseFloat(navigator.appVersion);o&&(-1!=(t=o.indexOf("Opera"))?(n="Opera",a=o.substring(t+6),-1!=(t=o.indexOf("Version"))&&(a=o.substring(t+8))):-1!=(t=o.indexOf("MSIE"))?(n="Microsoft Internet Explorer",a=o.substring(t+5)):-1!=(t=o.indexOf("Chrome"))?(n="Chrome",a=o.substring(t+7)):-1!=(t=o.indexOf("Safari"))?(n="Safari",a=o.substring(t+7),-1!=(t=o.indexOf("Version"))&&(a=o.substring(t+8))):-1!=(t=o.indexOf("Firefox"))?(n="Firefox",a=o.substring(t+8)):(e=o.lastIndexOf(" ")+1)<(t=o.lastIndexOf("/"))&&(n=o.substring(e,t),a=o.substring(t+1),n.toLowerCase()==n.toUpperCase()&&(n=navigator.appName)),-1!=(i=a.indexOf(";"))&&(a=a.substring(0,i)),-1!=(i=a.indexOf(" "))&&(a=a.substring(0,i))),this.family=n,this.version=a},d=function(e){"use strict";this.session=e,this.packageType=n.PACKAGE.REGISTER,e.packagesMap.put(this.packageType,this)};return d.prototype={toJSON:function(){"use strict";return a.toJSON({session:""},this)},onMessage:function(t){"use strict";var i=t.control.type,a=t.header.action;if(t.getExtHeaders(),delete e._private,a===n.ACTION.HIBERNATE)if(i===n.TYPE.REQUEST)this.session.onHibernationRequest&&this.session.onHibernationRequest(t),o.respondHibernate(this.session,t),this.session.timeToLive&&this.session.timeToLive>0&&o.handleHibernation(this.session);else{var s,l;if(o.handleHibernation(this.session),i===n.TYPE.RESPONSE?s=t.header.response_code:i===n.TYPE.ERROR&&(s=t.header.error_code),l=t.header.reason,null==s||s>=200&&s<300){if(this.session.hibernateSuccessCallback)try{this.session.hibernateSuccessCallback(s)}catch(e){r.warn("The callback function 'session.successCallback()' exception: "+e)}}else o.invokeHibernateError(this.session,s,l)}else a===n.ACTION.CONNECT?o.handleConnection(this.session,t):a===n.ACTION.ICE_ENQUIRY?this.session.iceServerEnquirer.handleIceEnquiry(this.session,t):a===n.ACTION.RELAY_FAILED?(r.warn("Received relayFailed message: "+t),this.session.callUpdateOnIceResponse=!0,o.sendIceEnquiry(this.session)):a===n.ACTION.SUBSCRIBE?o.handleSubscribeResponse(this.session,t):a===n.ACTION.NOTIFY?o.handleSubscribeNotify(this.session,t):r.warn("Receive an unexpected message: "+t)}},i.sessionHelper=o,e.Session=s,e.ExtensibleSession=s,e}(live||{}),live=function(e){"use strict";var t,i=e._private=e._private||{},o={},n={},a=i.wscConst,r=i.wscUtils,s=i.rtcHelper,l=e.getLogger();return e.CallConfig=function(e,t,i){this.audioConfig=e,this.videoConfig=t,this.dataChannelConfig=i},e.CallConfig.prototype={hasAudio:function(){return this.shouldSendAudio()||this.shouldReceiveAudio()},hasVideo:function(){return this.shouldSendVideo()||this.shouldReceiveVideo()},shouldSendAudio:function(){return null!==this.audioConfig&&(this.audioConfig===a.MEDIADIRECTION.SENDRECV||this.audioConfig===a.MEDIADIRECTION.SENDONLY)},shouldSendVideo:function(){return null!==this.videoConfig&&(this.videoConfig===a.MEDIADIRECTION.SENDRECV||this.videoConfig===a.MEDIADIRECTION.SENDONLY)},shouldReceiveAudio:function(){return null!==this.audioConfig&&(this.audioConfig===a.MEDIADIRECTION.SENDRECV||this.audioConfig===a.MEDIADIRECTION.RECVONLY)},shouldReceiveVideo:function(){return null!==this.videoConfig&&(this.videoConfig===a.MEDIADIRECTION.SENDRECV||this.videoConfig===a.MEDIADIRECTION.RECVONLY)},isPaused:function(){return this.audioConfig===a.MEDIADIRECTION.NONE&&this.videoConfig===a.MEDIADIRECTION.NONE},getChannelType:function(){return this.shouldSendVideo()?"video":this.shouldSendAudio()?"audio":this.shouldReceiveVideo()?"video":"audio"},toJSON:function(){return{audioConfig:this.audioConfig,videoConfig:this.videoConfig,dataChannelConfig:this.dataChannelConfig}},asJSON:function(){return{audio:this.audioConfig,video:this.videoConfig}}},e.CallConfig.fromJSON=function(t){return new e.CallConfig(t.audio,t.video)},e.StreamOptions=function(t,i){e.StreamOptions.superclass.constructor.apply(this,[t,i])},r.extend(e.StreamOptions,e.CallConfig),e.CallState=function(e,t,i,o){this.state=e,this.status={code:t,reason:i},this.streamId=o},e.CallState.prototype={isFinalState:function(){var e=!1;return this.state!==a.CALLSTATE.ENDED&&this.state!==a.CALLSTATE.FAILED||(e=!0),e},is180Ringing:function(){return!(!this.status||this.state!==a.CALLSTATE.RESPONDED||180!==this.status.code)},hasEstablished:function(){return this.state===a.CALLSTATE.ESTABLISHED||this.state===a.CALLSTATE.UPDATE_FAILED||this.state===a.CALLSTATE.UPDATED||this.state===a.CALLSTATE.UPDATING}},e.StreamState=function(t,i,o,n){e.StreamState.superclass.constructor.apply(this,[t,i,o,n])},r.extend(e.StreamState,e.CallState),o.doRequest=function(e,t){function i(){l.debug("=== doStartCallRequest ==="),n.isValidSdp(e,g)?(e.caller=h,e.callee=p,e.setCallState(a.CALLSTATE.STARTED,null,"receive call"),e.subSessionId=v,e.startReqCorrId=u,e.offerAnswerManager.updateState(a.OFFER_ANSWER_STATE.OFFER_GOT,g),e._template.doStartCallRequest&&e._template.doStartCallRequest(t)):n.sendReject(e,603,"Invalid Sdp")}function o(){l.debug("=== doUpdateCallRequest ==="),e.callState.state===a.CALLSTATE.UPDATING&&(l.debug("Got update message when call state is UPDATING, that is, my offer lost the glare then."),e.offerAnswerManager.updateState(a.OFFER_ANSWER_STATE.OFFER_REJECTED),e._template.rollbackUpdate&&(l.debug("Roll back the update initiated by me and accept the update from the other peer."),e._template.rollbackUpdate())),n.isValidSdp(e,g)?(e.offerAnswerManager.updateState(a.OFFER_ANSWER_STATE.OFFER_GOT,g),e._template.doUpdateCallRequest&&e._template.doUpdateCallRequest(t)):n.sendReject(e,603,"Invalid Sdp")}var r=e.callState,s=r.state,c=r.status.code,d=t.header.action,u=t.control.correlation_id,h=t.header.initiator,p=t.header.target,v=t.control.subsession_id,g=t.payload.sdp;switch(u&&(e.lastServerCorrelationId=u),t.payload&&t.payload.sdp&&l.debug("The SDP in the request is :\r\n"+t.payload.sdp),s){case a.CALLSTATE.NONE:case a.CALLSTATE.STARTED:switch(d){case a.ACTION.START:i();break;default:n.doUnexpectedMsg(e,t)}break;case a.CALLSTATE.RESPONDED:switch(d){case a.ACTION.START:switch(c){case 180:i();break;case 183:l.debug("=== doUpdateCallReqInEarlyPhase ==="),o(),e.offerAnswerManager.updateState(a.OFFER_ANSWER_STATE.ACK_GOT)}break;default:n.doUnexpectedMsg(e,t)}break;case a.CALLSTATE.ESTABLISHED:case a.CALLSTATE.UPDATED:case a.CALLSTATE.UPDATE_FAILED:case a.CALLSTATE.ERROR:case a.CALLSTATE.UPDATING:switch(d){case a.ACTION.START:o();break;default:n.doUnexpectedMsg(e,t)}break;default:n.doUnexpectedMsg(e,t)}},o.doResponse=function(e,t){function i(){t.complete(d),e.callState.state===a.CALLSTATE.UPDATING?e.setCallState(a.CALLSTATE.UPDATED,null,"sent complete"):e.setCallState(a.CALLSTATE.ESTABLISHED,null,"sent complete"),e.offerAnswerManager.updateState(a.OFFER_ANSWER_STATE.ACK_SENT),n.checkResumeState(e)}function o(e){var t="";return 180===e&&(t="Ringing"),181===e&&(t="Call Is Being Forwarded"),182===e&&(t="Queued"),183===e&&(t="Session Progress"),t}var r=e.callState.state,s=t.header.action,c=t.header.response_code,d=e.session;switch(t.payload&&t.payload.sdp&&l.debug("The SDP in the response is :\r\n"+t.payload.sdp),r){case a.CALLSTATE.NONE:n.doUnexpectedMsg(e,t);break;case a.CALLSTATE.STARTED:case a.CALLSTATE.RESPONDED:switch(s){case a.ACTION.START:c>100&&c<200?t.payload&&t.payload.sdp?t.header.reliable?(l.debug("=== doStartReliableProvRespWithSDP ==="),e.earlyMediaState=a.OFFER_ANSWER_STATE.INITIAL,e.setCallState(a.CALLSTATE.RESPONDED,c,o(c)),e._template.doStartReliableProvRespWithSDP&&e._template.doStartReliableProvRespWithSDP(t)):(l.debug("=== doStartUnReliableProvRespWithSDP ==="),e.setCallState(a.CALLSTATE.RESPONDED,c,o(c)),e.gotAnsweredInProvResp=!0,e.offerAnswerManager.updateState(a.OFFER_ANSWER_STATE.ANSWER_GOT,t.payload.sdp),e._template.doStartUnReliableProvRespWithSDP&&e._template.doStartUnReliableProvRespWithSDP(t)):t.header.reliable?(l.debug("=== doStartReliableProvRespWithoutSDP ==="),e._template.doStartReliableProvRespWithoutSDP&&e._template.doStartReliableProvRespWithoutSDP(t)):(l.debug("=== doStartUnReliableProvRespWithoutSDP ==="),e.setCallState(a.CALLSTATE.RESPONDED,c,o(c))):c>=200&&c<300&&function(){if(e.earlyMediaState)switch(e.earlyMediaState){case a.OFFER_ANSWER_STATE.ACK_SENT:case a.OFFER_ANSWER_STATE.ACK_GOT:l.debug("=== doStart200RespInEarlyPahse ==="),e._template.doStart200RespInEarlyPhase&&e._template.doStart200RespInEarlyPhase(t);break;case a.OFFER_ANSWER_STATE.OFFER_SENT:l.debug("=== doUpdate200RespInEarlyPhase ==="),e._template.doUpdate200RespInEarlyPhase&&e._template.doUpdate200RespInEarlyPhase(t)}else l.debug("=== doStart2XXResponse ==="),e.extHeaders&&delete e.extHeaders,e.gotAnsweredInProvResp?e.gotAnsweredInProvResp=null:e._template.doStart2XXResponse&&(e._template.doStart2XXResponse(t),e.offerAnswerManager.updateState(a.OFFER_ANSWER_STATE.ANSWER_GOT,t.payload.sdp)),e.setCallState(a.CALLSTATE.RESPONDED,c,"got success response"),i()}();break;case a.ACTION.PRACK:l.debug("=== doPrack200Response ==="),e.offerAnswerManager.updateState(a.OFFER_ANSWER_STATE.ACK_SENT);break;default:n.doUnexpectedMsg(e,t)}break;case a.CALLSTATE.ESTABLISHED:case a.CALLSTATE.UPDATING:case a.CALLSTATE.UPDATED:case a.CALLSTATE.UPDATE_FAILED:case a.CALLSTATE.ERROR:switch(s){case a.ACTION.START:200===c&&(l.debug("=== doUpdate200Response ==="),e.extHeaders&&delete e.extHeaders,t.payload.sdp?(e._template.doUpdate200Response&&e._template.doUpdate200Response(t),e.offerAnswerManager.updateState(a.OFFER_ANSWER_STATE.ANSWER_GOT,t.payload.sdp),i()):l.error("Failed to handle update response with no SDP"));break;default:n.doUnexpectedMsg(e,t)}break;default:n.doUnexpectedMsg(e,t)}},o.doMessage=function(e,t){function o(){l.debug("=== doCancelCallMessage ==="),e.setCallState(a.CALLSTATE.ENDED,"","cancelled"),e.end()}function r(){l.debug("=== doShutdownMessage ==="),e.setCallState(a.CALLSTATE.ENDED,"","shutdown"),e._template.doShutdownMessage&&e._template.doShutdownMessage()}function s(){l.debug("=== doCompleteMessage ==="),e.setCallState(a.CALLSTATE.ESTABLISHED,null,"got complete"),e.offerAnswerManager.updateState(a.OFFER_ANSWER_STATE.ACK_GOT)}function c(){if(l.debug("=== doTrickleIce ==="),t.payload.candidates&&e.peerConnection){var i,o=t.payload.candidates.split("\r\n");if(o.length>0){var n=(i=o.shift()).split(":");0===i.indexOf("a=mid")&&2===n.length?d(n[1],o):l.warn("invalid trickle ice candidate")}}}function d(t,o){var n={};null!==e.peerConnection.remoteSDP&&void 0!==e.peerConnection.remoteSDP||e.peerConnection.remoteDescription&&(e.peerConnection.remoteSDP=e.peerConnection.remoteDescription.sdp);for(var a=e.peerConnection.remoteSDP;o.length>0;){var r=o.shift();if(r&&0===r.indexOf("a=mid:")){var s=r.split(":");2===s.length&&(t=s[1])}else if(r&&0===r.indexOf("a=candidate:")){var c={};if(c.candidate=r,c.sdpMid=t,i.browser.isFirefox||i.browser.isEdge||i.browser.isSafari){if(void 0===n[t]){var d=a.split("a=mid:"),u=-1;d.length>1&&(d.shift(),d.every(function(e,i){return 0!==e.indexOf(t+"\r\n")||(u=i,!1)})),n[t]=u}n[t]>-1&&(c.sdpMLineIndex=n[t])}var h=new RTCIceCandidate(c);e.peerConnection.addIceCandidate(h).then(function(){l.debug("addIceCandidate succeed, "+JSON.stringify(h))}).catch(function(e){l.warn("For candidate: "+JSON.stringify(h)+", addIceCandidate gets error: "+e.name)})}else r&&0===r.indexOf("a=end-of-candidates")?l.debug("Get end-of-candidates when handling trickle ice candidate"):""!==r.trim()&&l.debug("Get unknown line of trickle ice candidate: "+r)}}var u=e.callState.state,h=t.header.action;switch(u){case a.CALLSTATE.NONE:n.doUnexpectedMsg(e,t);break;case a.CALLSTATE.STARTED:switch(h){case a.ACTION.SHUTDOWN:o();break;default:n.doUnexpectedMsg(e,t)}break;case a.CALLSTATE.RESPONDED:switch(h){case a.ACTION.SHUTDOWN:o();break;case a.ACTION.COMPLETE:s();break;case a.ACTION.TRICKLE:c();break;default:n.doUnexpectedMsg(e,t)}break;case a.CALLSTATE.ESTABLISHED:case a.CALLSTATE.UPDATED:case a.CALLSTATE.UPDATE_FAILED:case a.CALLSTATE.ERROR:switch(h){case a.ACTION.SHUTDOWN:r();break;case a.ACTION.COMPLETE:s();break;case a.ACTION.TRICKLE:c();break;default:n.doUnexpectedMsg(e,t)}break;case a.CALLSTATE.UPDATING:switch(h){case a.ACTION.SHUTDOWN:l.debug("=== doUpdateShutdownMessage ==="),"##re-invite_cancel@server##"===t.header.initiator?(e.setCallState(a.CALLSTATE.UPDATE_FAILED,null,"canceled by server"),e.offerAnswerManager.updateState(a.OFFER_ANSWER_STATE.OFFER_REJECT)):r();break;case a.ACTION.COMPLETE:l.debug("=== doUpdateComplete ==="),e.setCallState(a.CALLSTATE.UPDATED,null,"got complete"),e.offerAnswerManager.updateState(a.OFFER_ANSWER_STATE.ACK_GOT);break;case a.ACTION.TRICKLE:c();break;default:n.doUnexpectedMsg(e,t)}break;default:h===a.ACTION.TRICKLE?c():n.doUnexpectedMsg(e,t)}},o.doError=function(e,t){var i=e.callState,o=t.header.action,s=t.header.error_code,c=t.header.reason,d=e.session;switch(o){case a.ACTION.START:switch(s){case 401:case 407:!function(){l.debug("=== doAuthentication ===");var i,o=!0,n=0,d=e.session.authHandler,u=t.header.authenticate;if(d&&d.refresh)for(;o&&n<3;){n++;try{if(i=d.refresh(a.AUTHTYPE.SERVICE,null),r.checkAuthInfo(a.AUTHTYPE.SERVICE,i))u.ha1=r.calcHa1(i,u),u.username=i.username,e.authInfo=u,e._template.sendOffer(),o=!1;else{if(null===i||""===i){l.warn("No valid authentication information");break}l.warn("No valid authentication information")}}catch(e){l.error("Got exception: "+e),o=!0}}else l.warn("No AuthHandler for this Session");!0===o&&(e.setCallState(a.CALLSTATE.FAILED,s,c),e._template.clearCall())}();break;case 491:l.debug("Got 491, ACK and do nothing."),t.ack(d);break;default:!function(){l.debug("=== doErrorMessage ==="),t.ack(d);var o=new r.ErrorInfo(s,c);if(d.sessionState===a.SESSIONSTATE.CONNECTED)e.callState.state!==a.CALLSTATE.NONE&&(i.hasEstablished()?function(){if(l.debug("=== doUpdateCallError ==="),e.offerAnswerManager.updateState(a.OFFER_ANSWER_STATE.OFFER_REJECTED),e.callState.state===a.CALLSTATE.UPDATING&&e.setCallState(a.CALLSTATE.UPDATE_FAILED,s,c),e._template.rollbackUpdate&&e._template.rollbackUpdate(),e.session.allowRetry){l.debug("Retry update due to Relay failure");var t=Math.floor(500*Math.random());window.setTimeout(e.update(e.callConfig),t)}e.session.allowRetry=!1,n.checkResumeState(e)}():(l.debug("=== doStartCallError ==="),e.setCallState(a.CALLSTATE.FAILED,s,c),e.offerAnswerManager.updateState(a.OFFER_ANSWER_STATE.OFFER_REJECTED),e._template.doStartCallError&&e._template.doStartCallError()));else try{d.failureCallback(o)}catch(e){l.error("Exception in Session failureCallback: "+e)}}()}break;default:n.doUnexpectedMsg(e,t)}},o.doACK=function(e,t){l.debug("ACK")},t=function(t){var i=a.OFFER_ANSWER_STATE.INITIAL,o=a.OFFER_ANSWER_STATE.INITIAL,r=t,c="",d="",u="";this.trickledCandidatesMap=new e.Map,this.getMasterState=function(){return i},this.getSlaveState=function(){return o},this.updateCallRemoteMedias=function(e){r.remoteMedias=s.getMediaFromSDP(e)},this.updateState=function(e,t){switch(l.debug("Trying to update offer-answer state to : "+e),e){case a.OFFER_ANSWER_STATE.OFFER_SENT:d=t,i=e;break;case a.OFFER_ANSWER_STATE.OFFER_GOT:c=t,o=e;break;case a.OFFER_ANSWER_STATE.ANSWER_SENT:o=e,d=t,u=c,this.updateCallRemoteMedias(u);break;case a.OFFER_ANSWER_STATE.ANSWER_GOT:i=e,u=t,this.updateCallRemoteMedias(u);break;case a.OFFER_ANSWER_STATE.ACK_SENT:i=e,t&&(d=t),n.sendTrickledCandidates(r);break;case a.OFFER_ANSWER_STATE.ACK_GOT:o=e,n.sendTrickledCandidates(r);break;case a.OFFER_ANSWER_STATE.OFFER_REJECTED:i=e;break;case a.OFFER_ANSWER_STATE.OFFER_REJECT:o=e}r.offerAnswerManager.masterState=i,r.offerAnswerManager.slaveState=o,r.earlyMediaState&&(r.earlyMediaState=e)},this.canSendOffer=function(){var e=!1;if(r.callState){var t=r.callState.state;t!==a.CALLSTATE.END&&t!==a.CALLSTATE.FAILED||(e=!0)}var n=!(i!==a.OFFER_ANSWER_STATE.ACK_SENT&&i!==a.OFFER_ANSWER_STATE.INITIAL&&i!==a.OFFER_ANSWER_STATE.OFFER_REJECTED||o!==a.OFFER_ANSWER_STATE.ACK_GOT&&o!==a.OFFER_ANSWER_STATE.OFFER_REJECT&&o!==a.OFFER_ANSWER_STATE.INITIAL&&o!==a.OFFER_ANSWER_STATE.ANSWER_SENT||e);return l.debug((n?"Can":"Cannot")+" send offer now. The offer-answer master/slave state is: "+r.offerAnswerManager.getMasterState()+" / "+r.offerAnswerManager.getSlaveState()+", call State: "+r.callState.state+", session State: "+r.session.sessionState+", ICE connection state: "+(r.peerConnection?r.getIceConnectionState():"peerConnection is null")),n},this.reset=function(){i=a.OFFER_ANSWER_STATE.INITIAL,o=a.OFFER_ANSWER_STATE.INITIAL,c=""},this.getLatestActiveRemoteSdp=function(){return u},this.getLatestActiveLocalSdp=function(){return d}},n.isValidSdp=function(e,t){return!(void 0===t||null===t||t.indexOf("a=")<0&&t.indexOf("m=")<0)},n.getInitiator=function(e){return e.session.userName},n.getTarget=function(e){return e.session.userName===e.caller?e.callee:e.caller},n.send180Ringing=function(e){var t=n.createResponse(e);t.control.message_state=a.MESSAGESTATE.SUBSEQUENT,t.header.action=a.ACTION.START,e.session.sendMessage(t),e.setCallState(a.CALLSTATE.RESPONDED,180,"Ringing")},n.sendReject=function(e,t,i,o){var r=n.createError(e),s=a.ERRORCODE.DECLINED;r.header.error_code=t||s,i&&(r.header.reason=i),r.header.action=a.ACTION.START,o&&r.addExtHeaders(o),e.session.sendMessage(r),e.offerAnswerManager.updateState(a.OFFER_ANSWER_STATE.OFFER_REJECT)},n.sendPrack=function(e){var t=n.createRequest(e);t.control.correlation_id=e.lastServerCorrelationId,t.header.action=a.ACTION.PRACK,e.session.sendMessage(t)},n.createRequest=function(e){var t=new r.Message,i=e.session.lastInboundSeq,o=n.getInitiator(e),s=n.getTarget(e);return t.control.type=a.TYPE.REQUEST,t.control.subsession_id=e.subSessionId,t.control.package_type=e.pkgInstance.packageType,t.control.ack_sequence=i,t.header.initiator=o,s&&(t.header.target=s),e.streamId&&e.streamType&&(t.header.stream_id=e.streamId,t.header.stream_type=e.streamType),t},n.createResponse=function(e){var t=new r.Message,i=e.lastServerCorrelationId,o=e.session.lastInboundSeq,n=e.caller,s=e.callee,l=e.subSessionId;return t.control.type=a.TYPE.RESPONSE,t.control.subsession_id=l,t.control.package_type=e.pkgInstance.packageType,t.control.correlation_id=i,t.control.ack_sequence=o,t.header.initiator=n,s&&(t.header.target=s),e.streamId&&e.streamType&&(t.header.stream_id=e.streamId,t.header.stream_type=e.streamType),t},n.createError=function(e){var t=n.createResponse(e);return t.control.type=a.TYPE.ERROR,t},n.createMessage=function(e){var t=new r.Message,i=e.session.lastInboundSeq,o=n.getInitiator(e),s=n.getTarget(e),l=e.subSessionId;return t.control.type=a.TYPE.MESSAGE,t.control.subsession_id=l,t.control.package_type=e.pkgInstance.packageType,t.control.ack_sequence=i,t.header.initiator=o,s&&(t.header.target=s),e.streamId&&e.streamType&&(t.header.stream_id=e.streamId,t.header.stream_type=e.streamType),t},n.sendTrickledCandidates=function(e){var t=e.offerAnswerManager.trickledCandidatesMap,i="";if(t.size()>0){for(var o=t.keys();o.length>0;){var a=o.shift();i+=a;for(var r=t.get(a);r.length>0;){var s=r.shift();if(s){i+=s.match(/^a=.*\r\n$/i)?s:"a="+s+"\r\n"}else l.warn("sendTrickledCandidates found invalid candidate in candidatesArray; skipping")}}n.sendTrickleMessage(e,i)}},n.sendTrickleMessage=function(e,t){var i=n.createMessage(e);i.header.action=a.ACTION.TRICKLE,i.payload={candidates:t},e.session.sendMessage(i),t.indexOf("end-of-candidates")>-1&&e.offerAnswerManager.trickledCandidatesMap.clear()},n.checkResumeState=function(e){if(e.resumeState)switch(e.resumeState){case a.RESUME_STATE.waittingFinalResp:e.resumeState=null,e.resume();break;case a.RESUME_STATE.reStartingCall:e.resumeSuccessCallback&&(e.resumeSuccessCallback(),e.resumeState=null);break;case a.RESUME_STATE.updateCallByIceFailure:e.resumeState=null}},n.setCallState=function(e,t,i,o){var n=e.callState,r=n.state;if(!n.isFinalState()&&(!n.hasEstablished()||t!==a.CALLSTATE.NONE&&t!==a.CALLSTATE.STARTED&&t!==a.CALLSTATE.RESPONDED)){var s=n.status.code;if(r!==t||r===t&&s!==i){e.callState.state=t,e.callState.status.code=i,e.callState.status.reason=o;try{if(e.onCallStateChange)if(e.lastServerExtHeader){var c=e.lastServerExtHeader;e.onCallStateChange(e.callState,c),delete e.lastServerExtHeader}else e.onCallStateChange(e.callState);else if(e.onStateChange)if(e.lastServerExtHeader){var d=e.lastServerExtHeader;e.onStateChange(e.callState,d),delete e.lastServerExtHeader}else e.onStateChange(e.callState)}catch(e){l.warn("The callback function 'Call.onCallStateChange()' exception: "+e)}e.session.saveToStorage()}}},n.onMessage=function(e,t){if(e.isEnquiry()){if(!t.capabilityExchange){var i="No CapabilityExchange registered with Chat";throw l.error(i),i}t.capabilityExchange.onMessage(e)}else e.isRequest()?o.doRequest(t,e):e.isResponse()?o.doResponse(t,e):e.isMessage()?o.doMessage(t,e):e.isACK()?o.doACK(t,e):e.isError()&&o.doError(t,e)},n.clearMsrpSubSession=function(e){e.session.removeSubSession(e.subSessionId),e.msrpSession&&e.msrpSession.close()},n.msrpSubSessionDecline=function(e,t,i,o){var r,s;r=t||a.ERRORCODE.DECLINED,s=i||"Decline",e.callState.state===a.CALLSTATE.UPDATING?e.setCallState(a.CALLSTATE.UPDATE_FAILED,r,s):(n.clearMsrpSubSession(e),e.setCallState(a.CALLSTATE.FAILED,r,s)),n.sendReject(e,r,s,o)},n.sendAcceptResponse=function(e,t,i,o){var r=n.createResponse(e);r.control.message_state=a.MESSAGESTATE.FINAL,r.header.action=a.ACTION.START,r.control.correlation_id=t,o&&r.addExtHeaders(o),r.payload={sdp:i},e.session.sendMessage(r)},n.addParticipants2MsrpSubSession=function(e,t){if(t.callState.state!==a.CALLSTATE.NONE)throw{name:"IllegalStateException",message:"Cannot add participants at subSession state: "+t.callState.state};if(!(e instanceof Array))throw{name:"IllegalArgumentException",message:"parameter participants is not array type"};t.participants=e},n.doUnexpectedMsg=function(e,t){l.warn("Unexpected message is received: "+JSON.stringify(t,null,4))},e._private.CallStateMachine=o,e._private.offerAnswerManager=t,e._private.CallCommonUtils=n,e}(live||{}),live=function(e){var t=e._private=e._private||{},i=t.browser,o=e.getLogger(),n=function(){this.dataChannel=null,this.origDataChannel=null,this.state="none",this.label=null,this.onOpen=null,this.onClose=null,this.onError=null,this.dataSender=null,this.dataReceiver=null;var e=this,t=function(){e.dataSender=new a(e.dataChannel),o.info("Sender of DataTransfer created.")},n=function(t){o.debug("DataTransfer: Received data:"+t.data),e.dataReceiver?e.dataReceiver.onMessage(t):o.warn("The default data receiver is still initialized to receive data.")},s=function(i){e.origDataChannel&&(e.origDataChannel=null),e.state="open",t(),e.dataReceiver=new r,o.info("Receiver of DataTransfer created.");var a=e.dataChannel.readyState;null==e.label&&(e.label=e.dataChannel.label),o.debug('Data Channel "'+e.dataChannel.label+'" is open; current readyState: '+a),e.dataChannel.disabled=!1,e.dataChannel.onmessage=n,e.onOpen&&e.onOpen(i)},l=function(t){if(e.origDataChannel&&t.target&&e.origDataChannel.id!=t.target.id)return e.dataChannel=e.origDataChannel,void(e.origDataChannel=null);e.state="closed";var i=e.dataChannel.readyState;null==e.label&&(e.label=e.dataChannel.label),o.debug('Data Channel "'+e.dataChannel.label+'" is closing; current readyState is: '+i),e.dataChannel.disabled=!0,e.onClose&&e.onClose(t)},c=function(t){o.debug("Received dataChannel error event for DataTransfer: "+e.dataChannel.label),e.onError&&e.onError(t)};this.initDataChannel=function(t,n){if(o.debug("DataTransfer object initialized by the dataChannel."),n&&(e.origDataChannel=e.dataChannel),e.dataChannel=t,e.state="starting",e.label=t.label,e.dataChannel)try{e.dataChannel.onopen=s,i.isIE&&"open"==e.dataChannel.readyState&&setTimeout(function(){var t=null;try{t=new Event("open")}catch(e){(t=document.createEvent("Event")).initEvent("open",!1,!1)}s.call(e.dataChannel,t)},0),e.dataChannel.onerror=c,e.dataChannel.onclose=l}catch(e){o.error("Exception occured when initializing the callback functions of the data channel: "+e)}else o.error("Could not initialize the data channel with null.")},this.clear=function(){try{null!=e.dataChannel&&(e.dataChannel.close(),e.dataChannel.disabled=!0,o.info("DataTransfer closed its data channel; current readyState is: "+e.dataChannel.readyState)),o.info("DataTransfer object cleared")}catch(e){o.error("Recieved an exception when cleaning the DataTransfer object: "+e)}},this.toJSON=function(){var e={},t={session:"",pkgInstance:""};for(var i in this)i in t||(e[i]=this[i]);return e}};n.prototype={getState:function(){return this.state},getSender:function(){return this.dataSender},getReceiver:function(){return this.dataReceiver}};var a=function(e){this.dataChannel=e};a.prototype={send:function(e){if(null!=this.dataChannel&&"open"===this.dataChannel.readyState)try{this.dataChannel.send(e)}catch(e){throw o.debug("Exception when sending data by dataChannel: "+e),e}else o.error("Error when sending data. The dataChannel is not in a valid state.")}};var r=function(){this.onMessage=function(e){o.info("onMessage function is not overridden by the application. New received data is handle by the default DataReceiver object."+e.data)}};return r.prototype={},t.DataTransfer=n,t.DataSender=a,t.DataReceiver=r,e}(live||{});window.console||(console={log:function(){},info:function(){},debug:function(){},warn:function(){},error:function(){}}),"function"!=typeof Date.prototype.now&&(Date.now=function(){return+new Date}),"function"!=typeof String.prototype.trim&&(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),void 0===Error.prototype.stack&&(Error.prototype.stack="Error:\n\n\n\n\n"),Array.prototype.some||(Array.prototype.some=function(e){"use strict";if(null==this)throw new TypeError("Array.prototype.some called on null or undefined");if("function"!=typeof e)throw new TypeError;for(var t=Object(this),i=t.length>>>0,o=arguments.length>=2?arguments[1]:void 0,n=0;n<i;n++)if(n in t&&e.call(o,t[n],n,t))return!0;return!1});var browserIsIE=!1,IEversion=null;if(-1!=navigator.userAgent.indexOf("MSIE"))var ie_regexp=/MSIE (\d+\.\d+);/;else var ie_regexp=/Trident.*rv[ :]*(\d+\.\d+)/;ie_regexp.test(navigator.userAgent)&&(browserIsIE=!0,IEversion=new Number(RegExp.$1),console.log("Browser is IE, version "+IEversion)),browserIsIE&&IEversion<=9&&(baseconsole=console,9==IEversion&&(console={log:function(e){baseconsole.log(e)},info:function(e){baseconsole.info(e)},debug:function(e){baseconsole.log(e)},warn:function(e){baseconsole.warn(e)},error:function(e){baseconsole.error(e)},clear:function(e){baseconsole.clear(e)},assert:function(e){baseconsole.assert(e)},dir:function(e){baseconsole.dir(e)},profile:function(e){baseconsole.profile(e)},profileEnd:function(e){baseconsole.profileEnd(e)}}),IEversion<=8&&(console={log:function(e){baseconsole.log(e)},info:function(e){baseconsole.info(e)},debug:function(e){baseconsole.log(e)},warn:function(e){baseconsole.warn(e)},error:function(e){baseconsole.error(e)},clear:function(e){baseconsole.clear(e)},assert:function(e){baseconsole.assert(e)}}));var live=function(e){function t(e,t){if(e.session.sessionState===c.SESSIONSTATE.CONNECTED){var i=new d.Message;i.control.type=c.TYPE.MESSAGE,i.control.package_type=c.PACKAGE.REGISTER,i.control.subsession_id=e.session.connectSubSessionId,i.control.session_id=e.session.sessionId,i.control.ack_sequence=e.session.lastInboundSeq,i.header.initiator=e.session.userName,i.header.action=c.ACTION.AUDIT,i.header.module="WEB",i.header.conversation_key=e.conversation.conversationKey,i.header.access_token=e.session.iceServerAccessToken,i.payload={audit_data:t},e.session.sendMessage(i)}}function i(e){function i(){function t(e){return e.getType()===c.STREAMTYPE.AUDIOVIDEO}this.audio={inbound:{bitRate:new I(N,D),rtt:new I(N,D),jitter:new I(N,D),packetLossRate:new I(N,D)},outbound:{bitRate:new I(N,P),rtt:new I(N,P),jitter:new I(N,P),packetLossRate:new I(N,P)}},this.video={inbound:{bitRate:new I(L,D),rtt:new I(L,D),jitter:new I(L,D),packetLossRate:new I(L,D),frameRate:new I(L,D),resolutionWidth:new I(L,D),resolutionHeight:new I(L,D),firsSent:new w(L,D),nacksSent:new w(L,D),plisSent:new w(L,D)},outbound:{bitRate:new I(L,P),rtt:new I(L,P),jitter:new I(L,P),packetLossRate:new I(L,P),frameRate:new I(L,P),resolutionWidth:new I(L,P),resolutionHeight:new I(L,P),firsReceived:new w(L,P),nacksReceived:new w(L,P),plisReceived:new w(L,P)}},this.mos={inbound:{transmission:new I,video:new I(L,D),audio:new I(N,D)},outbound:{transmission:new I,video:new I(L,P),audio:new I(N,P)}},this.calculateInboundVideoMOS=function(){var e,i=this.video.inbound.packetLossRate.value,o=this.video.inbound.frameRate.value;e=void 0!==i&&void 0!==o?t(S.streamInfo)&&o<=S.__frameRateThreshold?c.ExperienceStatus.BAD:c.ExperienceStatus.GOOD:c.ExperienceStatus.NOT_AVAILABLE,this.mos.inbound.video.alarmPut(e,c.ExperienceFactor.VIDEO_INBOUND,{packetLossRate:this.video.inbound.packetLossRate.value,frameRate:this.video.inbound.frameRate.value})},this.calculateOutboundVideoMOS=function(){var e,i=this.video.outbound.packetLossRate.value,o=this.video.outbound.frameRate.value,n=this.video.outbound.rtt.value;e=void 0!==i&&void 0!==o&&void 0!==n?t(S.streamInfo)&&o<=S.__frameRateThreshold?c.ExperienceStatus.BAD:n>=S.__videoOutboundRttThreshold?c.ExperienceStatus.BAD:c.ExperienceStatus.GOOD:c.ExperienceStatus.NOT_AVAILABLE,this.mos.outbound.video.alarmPut(e,c.ExperienceFactor.VIDEO_OUTBOUND,{packetLossRate:i,frameRate:o,rtt:n})},this.calculateInboundAudioMOS=function(){if(!n.browser.isFirefox){var e,t=this.audio.inbound.jitter.value,i=this.audio.inbound.packetLossRate.value;e=void 0!==t&&void 0!==i?t>=S.__jitterThreshold?c.ExperienceStatus.BAD:c.ExperienceStatus.GOOD:c.ExperienceStatus.NOT_AVAILABLE,this.mos.inbound.audio.alarmPut(e,c.ExperienceFactor.AUDIO_INBOUND,{packetLossRate:i,jitter:t})}},this.calculateOutboundAudioMOS=function(){if(!n.browser.isFirefox){var e,t=this.audio.outbound.jitter.value,i=this.audio.outbound.packetLossRate.value,o=this.audio.outbound.rtt.value;e=void 0!==t&&void 0!==i&&void 0!==o?t>=S.__jitterThreshold?c.ExperienceStatus.BAD:o>=S.__audioOutboundRttThreshold?c.ExperienceStatus.BAD:c.ExperienceStatus.GOOD:c.ExperienceStatus.NOT_AVAILABLE,this.mos.outbound.audio.alarmPut(e,c.ExperienceFactor.AUDIO_OUTBOUND,{packetLossRate:i,jitter:t,rtt:o})}},this.calculateMOS=function(){if(this.calculateInboundVideoMOS(),this.calculateOutboundVideoMOS(),this.calculateInboundAudioMOS(),this.calculateOutboundAudioMOS(),Object.keys(m).length>0);else{var t=[];e.conversation.getParticipants().forEach(function(e){-1===g.indexOf(e)&&t.push.apply(t,e.getStreamInfos())}),t.length>0&&(m={},void 0!==this.mos.inbound.audio.publishedValue&&(m[c.ExperienceFactor.AUDIO_INBOUND]={value:this.mos.inbound.audio.publishedValue,hints:{packetLossRate:this.audio.inbound.packetLossRate.value,jitter:this.audio.inbound.jitter.value}}),void 0!==this.mos.inbound.video.publishedValue&&(m[c.ExperienceFactor.VIDEO_INBOUND]={value:this.mos.inbound.video.publishedValue,hints:{packetLossRate:this.video.inbound.packetLossRate.value,frameRate:this.video.inbound.frameRate.value}}),void 0!==this.mos.outbound.audio.publishedValue&&(m[c.ExperienceFactor.AUDIO_OUTBOUND]={value:this.mos.outbound.audio.publishedValue,hints:{packetLossRate:this.audio.outbound.packetLossRate.value,jitter:this.audio.outbound.jitter.value,rtt:this.audio.outbound.rtt.value}}),void 0!==this.mos.outbound.video.publishedValue&&(m[c.ExperienceFactor.VIDEO_OUTBOUND]={value:this.mos.outbound.video.publishedValue,hints:{packetLossRate:this.video.outbound.packetLossRate.value,frameRate:this.video.outbound.frameRate.value,rtt:this.video.outbound.rtt.value}}))}g=e.conversation.getParticipants(),m={}},this.cleanProperties=function(){delete this.audio.inbound.packetsReceived,delete this.audio.inbound.packetsLost,delete this.audio.outbound.packetsSent,delete this.audio.outbound.packetsLost,delete this.video.inbound.packetsReceived,delete this.video.inbound.packetsLost,delete this.video.outbound.packetsSent,delete this.video.outbound.packetsLost}}function o(e,t,i){if(void 0!==e&&void 0!==t){var n,a,r=o[i]=o[i]||{lastPacketsLost:void 0,lastPacketsTransmitted:void 0,lastEffectivePacketsTransmitted:void 0,keepCount:999};return n=i.indexOf("audio.")>-1?S.__audioPacketsLostKeepLimit:S.__videoPacketsLostKeepLimit,void 0!==r.lastPacketsLost?e<=r.lastPacketsLost?(r.keepCount=r.keepCount+1,a=r.keepCount<=n?-1:0):(a=r.keepCount<=n?(e-r.lastPacketsLost)/(e-r.lastPacketsLost+(t-r.lastEffectivePacketsTransmitted)):-1,r.lastEffectivePacketsTransmitted=t,r.keepCount=0):a=-1,r.lastPacketsLost=e,r.lastPacketsTransmitted=t,a}}function a(t,i,n){var a=x;if(n&&(a=n),"audio"==t.mediaType){if(t.id.indexOf("_recv")>-1){var r=void 0;v&&v[t.id]&&(r=8*(t.bytesReceived-v[t.id].bytesReceived)),a.audio.inbound.bitRate.put(r),a.audio.inbound.jitter.put(t.googJitterReceived);var s=void 0;if(v&&v[t.id]){var l=t.packetsLost-v[t.id].packetsLost,c=t.packetsReceived-v[t.id].packetsReceived;s=o(t.packetsLost,t.packetsReceived,"audio.inbound")}if(a.audio.inbound.packetsLost=l,a.audio.inbound.packetsReceived=c,a.audio.inbound.packetLossRate.put(s),t.transportId&&t.transportId.indexOf("Channel-")>-1){var d=i[p=i[t.transportId].selectedCandidatePairId].googLocalAddress.split(":");e.userIp=d[0],e.url=i[p].googRemoteAddress;var u=i[p].googLocalCandidateType;e.sessionType=u,e.protocol=M(u)}}else if(t.id.indexOf("_send")>-1){r=void 0;v&&v[t.id]&&(r=8*(t.bytesSent-v[t.id].bytesSent)),a.audio.outbound.bitRate.put(r),a.audio.outbound.rtt.put(t.googRtt);s=void 0;if(v&&v[t.id]){l=t.packetsLost-v[t.id].packetsLost;var h=t.packetsSent-v[t.id].packetsSent;s=o(t.packetsLost,t.packetsSent,"audio.outbound")}if(a.audio.outbound.packetsLost=l,a.audio.outbound.packetsSent=h,a.audio.outbound.packetLossRate.put(s),t.transportId&&t.transportId.indexOf("Channel-")>-1){d=i[p=i[t.transportId].selectedCandidatePairId].googLocalAddress.split(":");e.userIp=d[0],e.url=i[p].googRemoteAddress;u=i[p].googLocalCandidateType;e.sessionType=u,e.protocol=M(u)}}}else if("video"==t.mediaType)if(t.id.indexOf("_recv")>-1){r=void 0;v&&v[t.id]&&(r=8*(t.bytesReceived-v[t.id].bytesReceived)),a.video.inbound.bitRate.put(r),a.video.inbound.jitter.put(t.googJitterReceived);s=void 0;if(v&&v[t.id]){l=t.packetsLost-v[t.id].packetsLost,c=t.packetsReceived-v[t.id].packetsReceived;s=o(t.packetsLost,t.packetsReceived,"video.inbound")}if(a.video.inbound.packetsLost=l,a.video.inbound.packetsReceived=c,a.video.inbound.packetLossRate.put(s),a.video.inbound.frameRate.triggerPut(t.googFrameRateReceived,"onNewInboundFrameRate"),a.video.inbound.resolutionWidth.triggerPut(t.googFrameWidthReceived,"onNewInboundResolution",[t.googFrameWidthReceived,t.googFrameHeightReceived]),a.video.inbound.resolutionHeight.put(t.googFrameHeightReceived),a.video.inbound.firsSent.put(1*t.googFirsSent),a.video.inbound.nacksSent.put(1*t.googNacksSent),a.video.inbound.plisSent.put(1*t.googPlisSent),t.transportId&&t.transportId.indexOf("Channel-")>-1){d=i[p=i[t.transportId].selectedCandidatePairId].googLocalAddress.split(":");e.userIp=d[0],e.url=i[p].googRemoteAddress;u=i[p].googLocalCandidateType;e.sessionType=u,e.protocol=M(u)}}else if(t.id.indexOf("_send")>-1){r=void 0;v&&v[t.id]&&(r=8*(t.bytesSent-v[t.id].bytesSent)),a.video.outbound.bitRate.put(r),a.video.outbound.rtt.put(t.googRtt);s=void 0;if(v&&v[t.id]){l=t.packetsLost-v[t.id].packetsLost,h=t.packetsSent-v[t.id].packetsSent;s=o(t.packetsLost,t.packetsSent,"video.outbound")}if(a.video.outbound.packetsLost=l,a.video.outbound.packetsSent=h,a.video.outbound.packetLossRate.put(s),a.video.outbound.frameRate.triggerPut(t.googFrameRateSent,"onNewOutboundFrameRate"),a.video.outbound.resolutionWidth.triggerPut(t.googFrameWidthSent,"onNewOutboundResolution",[t.googFrameWidthSent,t.googFrameHeightSent]),a.video.outbound.resolutionHeight.put(t.googFrameHeightSent),a.video.outbound.firsReceived.put(1*t.googFirsReceived),a.video.outbound.nacksReceived.put(1*t.googNacksReceived),a.video.outbound.plisReceived.put(1*t.googPlisReceived),t.transportId&&t.transportId.indexOf("Channel-")>-1){var p;d=i[p=i[t.transportId].selectedCandidatePairId].googLocalAddress.split(":");e.userIp=d[0],e.url=i[p].googRemoteAddress;u=i[p].googLocalCandidateType;e.sessionType=u,e.protocol=M(u)}}}function r(t,i,n){var a=x;if(n&&(a=n),t.id.indexOf("inbound_rtp_audio")>-1){var r=void 0;v&&v[t.id]&&(r=8*(t.bytesReceived-v[t.id].bytesReceived)),a.audio.inbound.bitRate.put(r),a.audio.inbound.jitter.put(1e3*t.jitter);var s=void 0;if(v&&v[t.id]){var l=t.packetsLost-v[t.id].packetsLost,c=t.packetsReceived-v[t.id].packetsReceived;s=o(t.packetsLost,t.packetsReceived,"audio.inbound")}if(a.audio.inbound.packetsLost=l,a.audio.inbound.packetsReceived=c,a.audio.inbound.packetLossRate.put(s),t.transportId&&t.transportId.indexOf("Channel-")>-1){var d=i[m=i[t.transportId].selectedCandidatePairId].googLocalAddress.split(":");e.userIp=d[0],e.url=i[m].googRemoteAddress;var u=i[m].googLocalCandidateType;e.sessionType=u,e.protocol=M(u)}}else if(t.id.indexOf("outbound_rtp_audio")>-1){r=void 0;v&&v[t.id]&&(r=8*(t.bytesSent-v[t.id].bytesSent)),a.audio.outbound.bitRate.put(r),jitter=void 0,i[t.remoteId]&&(jitter=1e3*i[t.remoteId].jitter);s=void 0;if(v&&v[t.id]&&i[t.remoteId]&&v[t.remoteId]){l=i[t.remoteId].packetsLost-v[t.remoteId].packetsLost;var h=i[t.remoteId].packetsReceived-v[t.remoteId].packetsReceived;s=o(i[t.remoteId].packetsLost,i[t.remoteId].packetsReceived,"audio.outbound")}if(a.audio.outbound.packetsLost=l,a.audio.outbound.packetsSent=h,a.audio.outbound.packetLossRate.put(s),t.transportId&&t.transportId.indexOf("Channel-")>-1){d=i[m=i[t.transportId].selectedCandidatePairId].googLocalAddress.split(":");e.userIp=d[0],e.url=i[m].googRemoteAddress;u=i[m].googLocalCandidateType;e.sessionType=u,e.protocol=M(u)}}else if(t.id.indexOf("inbound_rtp_video")>-1){r=void 0;v&&v[t.id]&&(r=8*(t.bytesReceived-v[t.id].bytesReceived)),a.video.inbound.bitRate.put(r),a.video.inbound.jitter.put(1e3*t.jitter);s=void 0;if(v&&v[t.id]){l=t.packetsLost-v[t.id].packetsLost,c=t.packetsReceived-v[t.id].packetsReceived;s=o(t.packetsLost,t.packetsReceived,"video.inbound")}a.video.inbound.packetsLost=l,a.video.inbound.packetsReceived=c,a.video.inbound.packetLossRate.put(s);var g=void 0;if(v&&v[t.id]&&(g=(t.framesDecoded-v[t.id].framesDecoded)/(p/1e3)),a.video.inbound.frameRate.triggerPut(g,"onNewInboundFrameRate"),a.video.inbound.firsSent.put(1*t.firCount),a.video.inbound.nacksSent.put(1*t.nackCount),a.video.inbound.plisSent.put(1*t.pliCount),t.transportId&&t.transportId.indexOf("Channel-")>-1){d=i[m=i[t.transportId].selectedCandidatePairId].googLocalAddress.split(":");e.userIp=d[0],e.url=i[m].googRemoteAddress;u=i[m].googLocalCandidateType;e.sessionType=u,e.protocol=M(u)}}else if(t.id.indexOf("outbound_rtp_video")>-1){r=void 0;v&&v[t.id]&&(r=8*(t.bytesSent-v[t.id].bytesSent)),a.video.outbound.bitRate.put(r);s=void 0;if(v&&v[t.id]&&i[t.remoteId]&&v[t.remoteId]){l=i[t.remoteId].packetsLost-v[t.remoteId].packetsLost,h=i[t.remoteId].packetsReceived-v[t.remoteId].packetsReceived;s=o(i[t.remoteId].packetsLost,i[t.remoteId].packetsReceived,"video.outbound")}a.video.outbound.packetsLost=l,a.video.outbound.packetsSent=h,a.video.outbound.packetLossRate.put(s);g=void 0;if(v&&v[t.id]&&(g=(t.framesEncoded-v[t.id].framesEncoded)/(p/1e3)),a.video.outbound.frameRate.triggerPut(g,"onNewOutboundFrameRate"),a.video.outbound.firsReceived.put(1*t.firCount),a.video.outbound.nacksReceived.put(1*t.nackCount),a.video.outbound.plisReceived.put(1*t.pliCount),t.transportId&&t.transportId.indexOf("Channel-")>-1){var m;d=i[m=i[t.transportId].selectedCandidatePairId].googLocalAddress.split(":");e.userIp=d[0],e.url=i[m].googRemoteAddress;u=i[m].googLocalCandidateType;e.sessionType=u,e.protocol=M(u)}}else if("candidatepair"===t.type&&"succeeded"===t.state&&t.selected){var f=t.localCandidateId;u=i[f].candidateType;e.userIp=i[f].ipAddress,e.url=i[f].ipAddress+":"+i[f].portNumber,e.sessionType=u,e.protocol=M(u)}}function s(t,i,n){var a=x;if(n&&(a=n),t.id.indexOf("RTCInboundRTPAudioStream")>-1){var r=void 0;v&&v[t.id]&&(r=8*(t.bytesReceived-v[t.id].bytesReceived)),a.audio.inbound.bitRate.put(r),a.audio.inbound.jitter.put(1e3*t.jitter);var s=void 0;if(v&&v[t.id]){var l=t.packetsLost-v[t.id].packetsLost,c=t.packetsReceived-v[t.id].packetsReceived;s=o(t.packetsLost,t.packetsReceived,"audio.inbound")}a.audio.inbound.packetsLost=l,a.audio.inbound.packetsReceived=c,a.audio.inbound.packetLossRate.put(s)}else if(t.id.indexOf("RTCOutboundRTPAudioStream")>-1){r=void 0;v&&v[t.id]&&(r=8*(t.bytesSent-v[t.id].bytesSent)),a.audio.outbound.bitRate.put(r),a.audio.outbound.rtt.put(t.googRtt);s=void 0;if(v&&v[t.id]){l=t.packetsLost-v[t.id].packetsLost;var d=t.packetsSent-v[t.id].packetsSent;s=o(t.packetsLost,t.packetsSent,"audio.outbound")}a.audio.outbound.packetsLost=l,a.audio.outbound.packetsSent=d,a.audio.outbound.packetLossRate.put(s)}else if(t.id.indexOf("RTCInboundRTPVideoStream")>-1){r=void 0;v&&v[t.id]&&(r=8*(t.bytesReceived-v[t.id].bytesReceived)),a.video.inbound.bitRate.put(r),a.video.inbound.jitter.put(1e3*t.jitter);s=void 0;if(v&&v[t.id]){l=1*t.packetsLost-1*v[t.id].packetsLost,c=1*t.packetsReceived-1*v[t.id].packetsReceived;s=o(1*t.packetsLost,1*t.packetsReceived,"video.inbound")}a.video.inbound.packetsLost=l,a.video.inbound.packetsReceived=c,a.video.inbound.packetLossRate.put(s),t.googFrameRateInput?a.video.inbound.frameRate.triggerPut(t.googFrameRateInput,"onNewInboundFrameRate"):t.googFrameRateReceived&&a.video.inbound.frameRate.triggerPut(t.googFrameRateReceived,"onNewInboundFrameRate"),i[u=t.trackId].frameHeight&&i[u].frameWidth&&(a.video.inbound.resolutionWidth.triggerPut(i[u].frameWidth,"onNewInboundResolution",[i[u].frameWidth,i[u].frameHeight]),a.video.inbound.resolutionHeight.put(i[u].frameHeight)),a.video.inbound.firsReceived.put(1*t.firCount),a.video.inbound.nacksReceived.put(1*t.nackCount),a.video.inbound.plisReceived.put(1*t.pliCount)}else if(t.id.indexOf("RTCOutboundRTPVideoStream")>-1){r=void 0;v&&v[t.id]&&(r=8*(t.bytesSent-v[t.id].bytesSent)),a.video.outbound.bitRate.put(r);var u;s=void 0;if(v&&v[t.id]){l=t.packetsLost-v[t.id].packetsLost,d=t.packetsSent-v[t.id].packetsSent;s=o(t.packetsLost,t.packetsSent,"video.outbound")}a.video.outbound.packetsLost=l,a.video.outbound.packetsSent=d,a.video.outbound.packetLossRate.put(s),a.video.outbound.frameRate.triggerPut(t.googFrameRateSent,"onNewOutboundFrameRate"),i[u=t.trackId].frameHeight&&i[u].frameWidth&&(a.video.outbound.resolutionWidth.triggerPut(i[u].frameWidth,"onNewInboundResolution",[i[u].frameWidth,i[u].frameHeight]),a.video.outbound.resolutionHeight.put(i[u].frameHeight)),a.video.outbound.firsSent.put(1*t.firCount),a.video.outbound.nacksSent.put(1*t.nackCount),a.video.outbound.plisSent.put(1*t.pliCount)}if(t.id.indexOf("RTCIceCandidatePair_")>-1&&(t.transportId.indexOf("audio")>-1?a.audio.outbound.rtt.put(1e3*t.totalRoundTripTime):t.transportId.indexOf("video")>-1&&a.video.outbound.rtt.put(1e3*t.totalRoundTripTime)),t.id.indexOf("RTCIceCandidate_")>-1&&t.type.indexOf("local-candidate")>-1){var h=t.candidateType;e.sessionType=h,e.protocol=M(h)}}function l(t,i){if(t.googFrameRateReceived||t.googFrameRateSent){if(t.googFrameRateReceived||t.googFrameRateSent)if(t.id.indexOf("_recv")>-1){var n=void 0;v&&v[t.id]&&(n=8*(t.bytesReceived-v[t.id].bytesReceived)),factorReports.video.inbound.bitRate.put(n),factorReports.video.inbound.jitter.put(t.googJitterReceived);var a=void 0;if(v&&v[t.id]){var r=1*t.packetsLost-1*v[t.id].packetsLost,s=1*t.packetsReceived-1*v[t.id].packetsReceived;a=o(1*t.packetsLost,1*t.packetsReceived,"video.inbound")}if(factorReports.video.inbound.packetsLost=r,factorReports.video.inbound.packetsReceived=s,factorReports.video.inbound.packetLossRate.put(a),t.googFrameRateInput?factorReports.video.inbound.frameRate.triggerPut(t.googFrameRateInput,"onNewInboundFrameRate"):t.googFrameRateReceived&&factorReports.video.inbound.frameRate.triggerPut(t.googFrameRateReceived,"onNewInboundFrameRate"),t.googFrameWidthInput&&t.googFrameHeightInput?(factorReports.video.inbound.resolutionWidth.triggerPut(t.googFrameWidthInput,"onNewInboundResolution",[t.googFrameWidthInput,t.googFrameHeightInput]),factorReports.video.inbound.resolutionHeight.put(t.googFrameHeightInput)):t.googFrameWidthReceived&&t.googFrameHeightReceived&&(factorReports.video.inbound.resolutionWidth.triggerPut(t.googFrameWidthReceived,"onNewInboundResolution",[t.googFrameWidthReceived,t.googFrameHeightReceived]),factorReports.video.inbound.resolutionHeight.put(t.googFrameHeightReceived)),t.transportId&&t.transportId.indexOf("Channel-")>-1)if(void 0!==(u=i[t.transportId].selectedCandidatePairId)){var l=i[u].googLocalAddress.split(":");e.userIp=l[0],e.url=i[u].googRemoteAddress;var c=i[u].googLocalCandidateType;e.sessionType=c,e.protocol=M(c)}}else if(t.id.indexOf("_send")>-1){n=void 0;v&&v[t.id]&&(n=8*(t.bytesSent-v[t.id].bytesSent)),factorReports.video.outbound.bitRate.put(n),factorReports.video.outbound.rtt.put(t.googRtt);a=void 0;if(v&&v[t.id]){r=t.packetsLost-v[t.id].packetsLost;var d=t.packetsSent-v[t.id].packetsSent;a=o(t.packetsLost,t.packetsSent,"video.outbound")}if(factorReports.video.outbound.packetsLost=r,factorReports.video.outbound.packetsSent=d,factorReports.video.outbound.packetLossRate.put(a),factorReports.video.outbound.frameRate.triggerPut(t.googFrameRateSent,"onNewOutboundFrameRate"),factorReports.video.outbound.resolutionWidth.triggerPut(t.googFrameWidthSent,"onNewOutboundResolution",[t.googFrameWidthSent,t.googFrameHeightSent]),factorReports.video.outbound.resolutionHeight.put(t.googFrameHeightSent),t.transportId&&t.transportId.indexOf("Channel-")>-1)if(void 0!==(u=i[t.transportId].selectedCandidatePairId)){l=i[u].googLocalAddress.split(":");e.userIp=l[0],e.url=i[u].googRemoteAddress;c=i[u].googLocalCandidateType;e.sessionType=c,e.protocol=M(c)}}}else if(t.id.indexOf("_recv")>-1){n=void 0;v&&v[t.id]&&(n=8*(t.bytesReceived-v[t.id].bytesReceived)),factorReports.audio.inbound.bitRate.put(n),factorReports.audio.inbound.jitter.put(t.googJitterReceived);a=void 0;if(v&&v[t.id]){r=t.packetsLost-v[t.id].packetsLost,s=t.packetsReceived-v[t.id].packetsReceived;a=o(t.packetsLost,t.packetsReceived,"audio.inbound")}if(factorReports.audio.inbound.packetsLost=r,factorReports.audio.inbound.packetsReceived=s,factorReports.audio.inbound.packetLossRate.put(a),t.transportId&&t.transportId.indexOf("Channel-")>-1)if(void 0!==(u=i[t.transportId].selectedCandidatePairId)){l=i[u].googLocalAddress.split(":");e.userIp=l[0],e.url=i[u].googRemoteAddress;c=i[u].googLocalCandidateType;e.sessionType=c,e.protocol=M(c)}}else if(t.id.indexOf("_send")>-1){n=void 0;v&&v[t.id]&&(n=8*(t.bytesSent-v[t.id].bytesSent)),factorReports.audio.outbound.bitRate.put(n),factorReports.audio.outbound.rtt.put(t.googRtt);var u;a=void 0;if(v&&v[t.id]){r=t.packetsLost-v[t.id].packetsLost,d=t.packetsSent-v[t.id].packetsSent;a=o(t.packetsLost,t.packetsSent,"audio.outbound")}if(factorReports.audio.outbound.packetsLost=r,factorReports.audio.outbound.packetsSent=d,factorReports.audio.outbound.packetLossRate.put(a),t.transportId&&t.transportId.indexOf("Channel-")>-1)if(void 0!==(u=i[t.transportId].selectedCandidatePairId)){l=i[u].googLocalAddress.split(":");e.userIp=l[0],e.url=i[u].googRemoteAddress;c=i[u].googLocalCandidateType;e.sessionType=c,e.protocol=M(c)}}}var d="initial",u=null,p=1e3,v=null,g=e.conversation.getParticipants(),m={},f={},S=e.conversation.getLocalParticipant().getStreamInfo(e.avStream.getId()).getQualityMonitor(),_=S.factorMonitors,C=e.callConfig,b=null,E=null,R=null;var y=!1,T=!1,A=!1,I=function(e,t){this.value,this.isVideo=e,this.isInbound=t,this.statistics={peak:0,bottom:0,count:0,sdv:0,mean:0,oldMean:0,S:0,oldS:0}};I.prototype={put:function(e){return void 0===e||isNaN(e)?void(this.value=void 0):e<0?void(this.value=e):(e*=1,this.value=e,this.statistics.count++,1===this.statistics.count?(this.statistics.peak=e,this.statistics.bottom=e):(this.statistics.peak<e&&(this.statistics.peak=e),this.statistics.bottom>e&&(this.statistics.bottom=e)),void(1===this.statistics.count?(this.statistics.oldMean=e,this.statistics.mean=e):(this.statistics.mean=this.statistics.oldMean+(e-this.statistics.oldMean)/this.statistics.count,this.statistics.S=this.statistics.oldS+(e-this.statistics.oldMean)*(e-this.statistics.mean),this.statistics.oldMean=this.statistics.mean,this.statistics.oldS=this.statistics.S,this.statistics.sdv=this.statistics.count>1?Math.sqrt(this.statistics.S/(this.statistics.count-1)):0)))},alarmPut:function(t,i,o,n){void 0===this.publishedValue&&(this.publishedValue=c.ExperienceStatus.NOT_AVAILABLE,this.lastValue=c.ExperienceStatus.NOT_AVAILABLE,this.keepCount=0);var a=this.publishedValue;if(k(this))t!==this.publishedValue&&(t===this.lastValue?(this.keepCount=this.keepCount+1,this.keepCount===S.__keepCount&&(this.publishedValue=t)):this.keepCount=1,!0===n&&(this.publishedValue=t));else{var r=e.callState.state===c.CALLSTATE.UPDATING?e.lastCallConfig:e.callConfig;if(r.audioConfig===C.audioConfig&&r.videoConfig===C.videoConfig)return;this.publishedValue=c.ExperienceStatus.NOT_AVAILABLE,o={},t=c.ExperienceStatus.NOT_AVAILABLE}var s=_[i];a!==this.publishedValue?("function"==typeof s&&s.call(S,this.publishedValue,o),m[i]={value:this.publishedValue,hints:o}):"function"==typeof s&&"function"!=typeof f[i]&&s.call(S,this.publishedValue,o),f[i]=s,this.lastValue=t,this.put(t)},triggerPut:function(e,t,i){var o=e&&Math.floor(e),n=this.value&&Math.floor(this.value),a=S[t];i||(i=[o]),n!==o?"function"==typeof a&&(a.apply(S,i),f[t]=a):"function"==typeof a&&"function"!=typeof f[t]&&(a.call(S,i),f[t]=a),this.put(e)},toJSON:function(){return 0==this.statistics.count?{peak:"N/A",bottom:"N/A",count:"N/A",sdv:"N/A",mean:"N/A"}:{peak:void 0===this.statistics.peak?void 0:this.statistics.peak%1==0?this.statistics.peak:1*this.statistics.peak.toFixed(2),bottom:void 0===this.statistics.bottom?void 0:this.statistics.bottom%1==0?this.statistics.bottom:1*this.statistics.bottom.toFixed(2),count:this.statistics.count,sdv:void 0===this.statistics.sdv?void 0:this.statistics.sdv%1==0?this.statistics.sdv:1*this.statistics.sdv.toFixed(2),mean:void 0===this.statistics.mean?void 0:this.statistics.mean%1==0?this.statistics.mean:1*this.statistics.mean.toFixed(2)}}};var w=function(e,t){this.value,this.isVideo=e,this.isInbound=t};w.prototype={put:function(e){this.value=e},toJSON:function(){return this.value}};var k=function(t){var i=e.callConfig;return e.callState.state===c.CALLSTATE.UPDATING&&(i=e.lastCallConfig),t.isInbound&&t.isVideo&&i.shouldReceiveVideo()||t.isInbound&&!t.isVideo&&i.shouldReceiveAudio()||!t.isInbound&&t.isVideo&&i.shouldSendVideo()||!t.isInbound&&!t.isVideo&&i.shouldSendAudio()},x=new i,O=new i,L=!0,N=!1,D=!0,P=!1,M=function(e){var t=void 0;return"local"===e||"host"===e?t=c.PROTOCOL.HOST:"srflx"===e?t=c.PROTOCOL.STUN:"relay"!==e&&"relayed"!==e||(t=c.PROTOCOL.TURN),t},V=0,U=function(o){if(0!==Object.keys(o).length){if(null!=v)try{if(V>=20){var d=e.generateIntermidateAuditData();if(t(e,d),e.avStream&&e.avStream.onQualityMetrics){var u=d.streams[0];e.avStream.onQualityMetrics(u.stream_id,u.data)}O=new i,V=0}else V++;for(var p in o){var g=o[p];n.browser.isChrome?(a(g,o,O),a(g,o)):n.browser.isFirefox?(r(g,o,O),r(g,o)):n.browser.isSafari?(s(g,o,O),s(g,o)):n.browser.isIE&&l(g,o)}x.calculateMOS(),O.calculateMOS(),void 0!==window.__debug_monitor_data_detail__&&!0===window.__debug_monitor_data_detail__&&function e(t,i){e.__headerPrinted||(e.__headerPrinted=!0,h.debug("==audio==inbound.bitRate,inbound.rtt,inbound.packetsReceived,inbound.packetsLost,inbound.jitter,inbound.packetLossRate,outbound.bitRate,outbound.rtt,outbound.packetsSent,outbound.packetsLost,outbound.jitter,outbound.packetLossRate,inbound.mos,outbound.mos,inbound.publishedMos,outbound.publishedMos"),h.debug("==video==inbound.bitRate,inbound.rtt,inbound.packetsReceived,inbound.packetsLost,inbound.jitter,inbound.packetLossRate,inbound.frameRate,inbound.resolutionWidth*inbound.resolutionHeight,outbound.bitRate,outbound.rtt,outbound.packetsSent,outbound.packetsLost,outbound.jitter,outbound.packetLossRate,outbound.frameRate,outbound.resolutionWidth*outbound.resolutionHeight,inbound.mos,outbound.mos,inbound.publishedMos,outbound.publishedMos")),h.debug("==audio=="+i.audio.inbound.bitRate.value+","+i.audio.inbound.rtt.value+","+i.audio.inbound.packetsReceived+","+i.audio.inbound.packetsLost+","+i.audio.inbound.jitter.value+","+i.audio.inbound.packetLossRate.value+","+i.audio.outbound.bitRate.value+","+i.audio.outbound.rtt.value+","+i.audio.outbound.packetsSent+","+i.audio.outbound.packetsLost+","+i.audio.outbound.jitter.value+","+i.audio.outbound.packetLossRate.value+","+i.mos.inbound.audio.lastValue+","+i.mos.outbound.audio.lastValue+","+i.mos.inbound.audio.publishedValue+","+i.mos.outbound.audio.publishedValue),h.debug("==video=="+i.video.inbound.bitRate.value+","+i.video.inbound.rtt.value+","+i.video.inbound.packetsReceived+","+i.video.inbound.packetsLost+","+i.video.inbound.jitter.value+","+i.video.inbound.packetLossRate.value+","+i.video.inbound.frameRate.value+","+i.video.inbound.resolutionWidth.value+"*"+i.video.inbound.resolutionHeight.value+","+i.video.outbound.bitRate.value+","+i.video.outbound.rtt.value+","+i.video.outbound.packetsSent+","+i.video.outbound.packetsLost+","+i.video.outbound.jitter.value+","+i.video.outbound.packetLossRate.value+","+i.video.outbound.frameRate.value+","+i.video.outbound.resolutionWidth.value+"*"+i.video.outbound.resolutionHeight.value+","+i.mos.inbound.video.lastValue+","+i.mos.outbound.video.lastValue+","+i.mos.inbound.video.publishedValue+","+i.mos.outbound.video.publishedValue),h.debug("==stats==",t)}(o,x)}catch(e){h.debug("Error happens when extractDataFromStats: ",e)}C=e.callState.state===c.CALLSTATE.UPDATING?e.lastCallConfig:e.callConfig,v=o}},B=function(){var t=e.getPeerConnection();null==t||"connected"!==t.iceConnectionState&&"completed"!==t.iceConnectionState||(b=t.iceConnectionState,t.getStats(null).then(function(e){var t={};n.browser.isFirefox||n.browser.isSafari?e.forEach(function(e){t[e.id]=e}):t=e,U(t)}).catch(function(e){h.warn("Error when get statistics.",e)})),null!=t&&"disconnected"===t.iceConnectionState&&"disconnected"!==b&&(b="disconnected",function(){var e=c.ExperienceStatus.NOT_AVAILABLE;n.browser.isFirefox||factorReports.mos.inbound.audio.alarmPut(e,c.ExperienceFactor.AUDIO_INBOUND,{},!0),factorReports.mos.inbound.video.alarmPut(e,c.ExperienceFactor.VIDEO_INBOUND,{},!0),n.browser.isFirefox||factorReports.mos.outbound.audio.alarmPut(e,c.ExperienceFactor.AUDIO_OUTBOUND,{},!0),factorReports.mos.outbound.video.alarmPut(e,c.ExperienceFactor.VIDEO_OUTBOUND,{},!0),mosNotify("*")}())},F=function(){h.debug("getDiagnosticMetricsPeriodically.");var t=e.getPeerConnection();null==t||"connected"!==t.iceConnectionState&&"completed"!==t.iceConnectionState?(h.debug("getDiagnosticMetricsPeriodically... schedule next process for pc.iceConnectionState is: ",null!==t?t.iceConnectionState:"unknown, no peer connection"),E=setTimeout(function(){F()},50)):t.getStats(null).then(function(t){try{for(var i in y||e.getCallConfig().shouldReceiveAudio()||(y=!0),T&&A||e.getCallConfig().shouldReceiveVideo()||(T=!0,A=!0),t){var o=t[i];n.browser.isChrome?"audio"==o.mediaType&&o.id.indexOf("_recv")>-1?(h.debug("audio packetsReceived...",o.packetsReceived),!y&&o.packetsReceived&&o.packetsReceived>1&&(e.session.logEventTimestamp("avFirstAudioPktReceived",o.timestamp.getTime()),y=!0)):"video"==o.mediaType&&o.id.indexOf("_recv")>-1&&(h.debug("video packetsReceived...",o.packetsReceived),!T&&o.packetsReceived&&o.packetsReceived>1&&(e.session.logEventTimestamp("avFirstVideoPktReceived",o.timestamp.getTime()),T=!0),h.debug("framesDecoded...",o.framesDecoded),!A&&o.framesDecoded&&o.framesDecoded>1&&(e.session.logEventTimestamp("avFirstVideoDecoded",o.timestamp.getTime()),A=!0)):n.browser.isFirefox||n.browser.isIE||n.browser.isSafari}}catch(e){h.debug("Error happens when getDiagnosticMetricsPeriodically: ",e)}}).catch(function(e){h.debug("Error when get statistics in getDiagnosticMetricsPeriodically.",e)}).finally(function(){y&&T&&A?(h.debug("getDiagnosticMetricsPeriodically... Done."),q()):(h.debug("getDiagnosticMetricsPeriodically... schedule next process."),E=setTimeout(function(){F()},50))})},q=function(){h.debug("getDiagnosticMetricsPeriodically... stop timers."),clearTimeout(E),clearTimeout(R)};this.getReports=function(){return x.cleanProperties(),e.callConfig.hasAudio()||delete x.audio,e.callConfig.hasVideo()||delete x.video,x},this.getIntermidateReports=function(){return O.cleanProperties(),delete O.mos,e.callConfig.hasAudio()||delete O.audio,e.callConfig.hasVideo()||delete O.video,O},this.start=function(){"running"!==d&&(d="running",n.browser.isChrome&&"audiovideo"==e.streamType&&(F(),h.debug("Start timeout for getDiagnosticMetrics."),R=setTimeout(function(){q()},1e4)),u=setInterval(B,p))},this.stop=function(){d="stopped",clearInterval(u),q()}}function o(e){var t=0,i=function(i){if(i&&(null===e.peerConnection||void 0===e.peerConnection))return h.debug("call.peerConnection: "+e.peerConnection+", the call may need to be updated."),!0;var o=e.getIceConnectionState();return"connected"===o&&t>0&&(h.debug("ICE connection state gets to 'connected', reset the counter to 0."),t=0),t>=3?(h.debug("No more updating. Have updated call to restore ICE failure for "+t+" times."),!1):"failed"===o||i&&"closed"===o},o=function(){var t=e.callState;return t.state===c.CALLSTATE.ESTABLISHED||t.state===c.CALLSTATE.UPDATE_FAILED||t.state===c.CALLSTATE.UPDATED||t.state===c.CALLSTATE.ERROR},n=function(){var n="Call state: "+e.callState.state+", ICE connection state: "+(e.peerConnection?e.getIceConnectionState():"peerConnection is null")+", Retry number: "+(t+1);o()&&i(!0)?(e.resumeState=c.RESUME_STATE.updateCallByIceFailure,t+=1,h.debug("Do call update to fix the ICE failure. "+n),e.update(e.callConfig)):h.debug("No update is needed to fix the ICE failure. "+n)};this.updateIceConnectionState=function(t){t.target===e.peerConnection&&i()&&o()&&(h.debug("Waiting for receiving any message from session web socket... "),function(t){var i=e.session.lastActiveTime,o=function(){i!=e.session.lastActiveTime?(h.debug("Waiting for receiving any message from session web socket... Done"),t()):setTimeout(function(){o()},50)};o()}(function(){var t=e.session.sessionState;if(t===c.SESSIONSTATE.CONNECTED)n();else{h.debug("Session state: "+t+", waiting for session state CONNECTED.");var i=e.session.setSessionState.bind(e.session);e.session.setSessionState=function(t){return t===c.SESSIONSTATE.CONNECTED&&(e.session.setSessionState=i,n()),i(t)}}}))}}var n=e._private=e._private||{},a={},r=n.CallStateMachine,s=n.CallCommonUtils,l=n.rtcHelper,c=n.wscConst,d=n.wscUtils,u=n.DataTransfer,h=e.getLogger(),p=(e.getLogLevel(),new WeakMap),v=function(e,t){"use strict";if(!e){var i="The parameter 'session' cannot be null!";throw h.error(i),i}this.packageType=t||c.PACKAGE.CALL,e.registerPackage(this),this.session=e,this.trickleIceMode="off",this.ipv6=!1,this.dscp=!1,this.videoSendBitrate=!1,this.videoRecvBitrate=!1,this.removeVideoFec=!1,this.onIncomingCall=null,this.onResurrect=null};v.prototype={getCalls:function(){"use strict";var e=[],t=this.session.getSubSessionsByPackageType(this.packageType),i=null;if(t){i=t.values();for(var o=0;o<i.length;o++)e[o]=i[o]}return e},createCall:function(e,t,i){"use strict";var o,n,a=this.session,r=this.session.userName;if(null==e||""===e)throw n="The callee cannot be empty!",h.warn(n),"CallPackage.createCall(): Empty callee exception.";return(o=this.prepareCall(a,t,r,e)).subSessionId=a.generateSubSessionId(),o.onCallError=i,o.pkgInstance=this,this.putCall(o.subSessionId,o),o},close:function(){"use strict";for(var e=this.getCalls(),t=0;t<e.length;t++){var i=e[t];i.end(),i=null}},clear:function(){for(var e=this.getCalls(),t=0;t<e.length;t++){var i=e[t];a.clearCall(i),i=null}},onMessage:function(e){"use strict";var t=this.session,i=e.control.subsession_id,o=this.session.getSubSession(i),n=e.getExtHeaders();null==o&&((o=this.prepareCall(t)).pkgInstance=this),n&&(o.lastServerExtHeader=n),o.onMessage(e)},onRehydration:function(t){"use strict";for(var i in t.entry){var o,n=t.entry[i],a=n.caller,r=n.callee,s=n.callConfig,c=new e.CallConfig(s.audioConfig,s.videoConfig,s.dataChannelConfig),d=this.prepareCall(this.session,c,a,r);if(d.pkgInstance=this,d.callState=new e.CallState(n.callState.state,n.callState.status.code,n.callState.status.reason),d.earlyMediaState=n.earlyMediaState,d.subSessionId=n.subSessionId,n.remoteMedias&&n.remoteMedias.length){o=[];for(var u=0;u<n.remoteMedias.length;u++){var h=n.remoteMedias[u],p=new l.Media(h.mode,h.port,h.type);o[u]=p}}d.remoteMedias=o,d.offerAnswerManager.updateState(n.offerAnswerManager.masterState),d.offerAnswerManager.updateState(n.offerAnswerManager.slaveState),d.iceTimeout=n.iceTimeout,d.streamId=n.streamId,d.streamType=n.streamType,d.shortCircuitMode=n.shortCircuitMode,this.putCall(i,d),this.onResurrect(d)}},prepareCall:function(e,t,i,o){"use strict";return new g(e,t,i,o)},putCall:function(e,t){this.session.putSubSession(this.packageType,e,t)},setTrickleIceMode:function(e){this.trickleIceMode=e},setIPv6:function(e){this.ipv6=e},setDSCP:function(e){this.dscp=e},setVideoSendBitrate:function(e){this.videoSendBitrate=e},setVideoRecvBitrate:function(e){this.videoRecvBitrate=e},setRemoveVideoFec:function(e){this.removeVideoFec=e},toJSON:function(){var e={},t={session:""};for(var i in this)i in t||(e[i]=this[i]);return e}};var g=function(t,i,r,d){this.session=t,this.caller=r,this.callee=d,this.callConfig=i,this.dataTransfers=new e.Map,this.lastCallConfig=null,this.callState=new e.CallState(c.CALLSTATE.NONE,null,""),this.earlyMediaState=null,this.resumeState=null,this.peerConnection=null,this.onMediaStreamEvent=null,this.onCallStateChange=null,this.onIceConnectionStateChange=null,this.onDataTransfer=null,this.errorLog=[],this.eventLog=[],this.onUpdate=null,this.onCallError=null,this.streamAddTimes=0,this.hungupCallback=null,this.subSessionId=null,this.conversation=null,this.avStream=null,this.streamId="default",this.streamType="audiovideo",this.shortCircuitMode=!1,this.startReqCorrId=null,this.newRemoteSDP=null,this.newRemoteMedias=null,this.remoteMedias=null,this.localMediaStreams=[],this.temporarySavedStreams=[],this.offerAnswerManager=new n.offerAnswerManager(this),this.userIp=null,this.sessionType=null,this.protocol=null,this.url=null,this.callStartOnIceResponse=!1,this.timeRecording={timeToNewPeerConnection:{},timeToGetUserMedia:{},timeToMakeCall:{},timeToGetIceConnection:{},timeToGetIceCandidates:{},timeToGetRemoteMedia:{}};var u=2e3;this.setIceCheckInterval=function(e){if(e<=0)throw{name:"IllegalArgumentError",message:"The ICE check Interval must be greater than zero."};u=e},this.getIceCheckInterval=function(){return u},this.setCapabilityExchange=function(e){this.capabilityExchange=e},this._template={doStartCallRequest:function(e){var t=e.payload.sdp,i=this.parent,o=l.getCallConfigFromRemoteSDP(t,!1),n=l.getCallConfigFromRemoteSDP(t,!0),a=this.parent.callState,r=e.control.subsession_id,c=e.getExtHeaders();i.callConfig=o,i.newRemoteSDP=e.payload,i.newRemoteMedias=l.getMediaFromSDP(t),i.conversation?i.pkgInstance.putCall(r,i.conversation):i.pkgInstance.putCall(r,i),a.is180Ringing()||s.send180Ringing(i);var d=i.pkgInstance.onIncomingCall;d&&(i.conversation?d(i.conversation,i.avStream,n,c):d(i,n,c))},doUpdateCallRequest:function(e){var t=e.payload.sdp,i=this.parent,o=l.getCallConfigFromRemoteSDP(t),n=e.getExtHeaders();i.lastCallConfig=i.callConfig,i.callConfig=o,i.newRemoteMedias=l.getMediaFromSDP(t),i.newRemoteSDP=e.payload,a.handleUpdateCallRequest(i,n)},doStartUnReliableProvRespWithSDP:function(e){a.handleAnswer(this.parent,e.payload)},doStart2XXResponse:function(e){a.handleAnswer(this.parent,e.payload)},doUpdate200Response:function(e){a.handleAnswer(this.parent,e.payload)},doShutdownMessage:function(){a.clearCall(this.parent)},clearCall:function(){a.clearCall(this.parent)},rollbackUpdate:function(){a.rollbackUpdate(this.parent)},doStartCallError:function(){a.clearCall(this.parent)},doStartReliableProvRespWithSDP:function(e){var t=e.payload,i=this.parent;if(t.type="answer",i.offerAnswerManager.getMasterState()===c.OFFER_ANSWER_STATE.OFFER_SENT){l.setRemoteDescription(i,new RTCSessionDescription(t),function(){i.offerAnswerManager.updateState(c.OFFER_ANSWER_STATE.ANSWER_GOT,t.sdp),i.lastServerCorrelationId=e.control.correlation_id,s.sendPrack(i),i.offerAnswerManager.updateState(c.OFFER_ANSWER_STATE.ACK_SENT)},a.srdError(i))}},doStartReliableProvRespWithoutSDP:function(e){var t=(e.payload,this.parent);t.lastServerCorrelationId=e.control.correlation_id,s.sendPrack(t)},doStart200RespInEarlyPhase:function(e){var i=this.parent;i.earlyMediaState=null,i.setCallState(c.CALLSTATE.RESPONDED,200,"got success response"),e.complete(t),i.setCallState(c.CALLSTATE.ESTABLISHED,null,"sent complete"),s.checkResumeState(i)},doUpdate200RespInEarlyPhase:function(e){var t=this.parent;a.handleAnswer(t,e.payload),t.offerAnswerManager.updateState(c.OFFER_ANSWER_STATE.ANSWER_GOT,e.payload.sdp),e.complete(t.session),t.offerAnswerManager.updateState(c.OFFER_ANSWER_STATE.ACK_SENT),s.checkResumeState(t)},sendOffer:function(){a.sendOfferImpl(this.parent)}},this._template.parent=this;var h={iceFailureHandler:new o(this),statsCollector:null};p.set(this,h)};return g.prototype={start:function(t,i){function o(t){try{n.callConfig.dataChannelConfig&&a.initDataTransfers(n),a.initOfferCtx(n,t,i)}catch(t){h.error("Start exception: "+t),n.onCallError&&l.invokeCallError(n,e.ERRORCODE.PEERCONNECTION_ERROR,t)}}var n=this;if(n.callState.state!==c.CALLSTATE.NONE&&n.resumeState!==c.RESUME_STATE.reStartingCall)throw"The call has already been started";if(i&&(n.extHeaders=i),t&&(n.localMediaStreams=[].concat(t)),this.callStartOnIceResponse||0!==this.session.iceServerListFromServer.length){this.callStartOnIceResponse=!1,this.collectClientLog(c.LOGTYPE.EVENT_LOG,c.EVENTLOG.CALL_START);var r=n.callConfig.shouldSendAudio(),s=n.callConfig.shouldSendVideo();r||s?n.localMediaStreams&&n.localMediaStreams.length>0?o(n.localMediaStreams):a.initUserMedia(n,function(e){o([e])},function(e){h.error("Cannot get local stream... ",e),n.fireMediaStreamEvent(c.MEDIASTREAMEVENT.LOCAL_STREAM_ERROR,null)}):o(n.localMediaStreams)}else h.info("There are no TURN candidates available when starting call"),this.callStartOnIceResponse=!0,this.session.iceServerEnquirer.doIceEnquiry(function(){n.start(n.localMediaStreams,n.extHeaders)})},getDataTransfer:function(e){return this.dataTransfers.get(e)},getCaller:function(){return this.caller},getCallee:function(){return this.callee},getCallState:function(){return this.callState},getCallConfig:function(){return this.callConfig?new e.CallConfig(this.callConfig.audioConfig,this.callConfig.videoConfig,this.callConfig.dataChannelConfig):null},getPeerConnection:function(){return this.peerConnection},getIceConnectionState:function(){return this.peerConnection?""+this.peerConnection.iceConnectionState:"closed"},canUpdate:function(){return h.debug("canUpdate() - ICE connection state is: "+this.getIceConnectionState()+", call state is: "+this.callState.state),this.callState.state===c.CALLSTATE.ESTABLISHED||this.callState.state===c.CALLSTATE.UPDATE_FAILED||this.callState.state===c.CALLSTATE.UPDATED?"checking"===this.getIceConnectionState()?(h.debug("canUpdate() - Update denied, invalid ICE state: "+this.getIceConnectionState()),!1):(h.debug("canUpdate() - Update allowed"),!0):(h.debug("canUpdate() - Update denied, invalid call state: "+this.callState.state),!1)},toJSON:function(){return{caller:this.caller,callee:this.callee,callConfig:this.callConfig,callState:this.callState,earlyMediaState:this.earlyMediaState,subSessionId:this.subSessionId,remoteMedias:this.remoteMedias,offerAnswerManager:this.offerAnswerManager,iceTimeout:this.iceTimeout,onDataTransfer:this.onDataTransfer,onCallError:this.onCallError,onUpdate:this.onUpdate,onCallStateChange:this.onCallStateChange,onMediaStreamEvent:this.onMediaStreamEvent,streamId:this.streamId,streamType:this.streamType}},setCallState:function(e,o,n){if(!this.callState.isFinalState()){try{if(null!=this.conversation&&e===c.CALLSTATE.ESTABLISHED)null==(a=p.get(this).statsCollector)&&(a=p.get(this).statsCollector=new i(this)).start();else if(null!=this.conversation&&(e===c.CALLSTATE.ENDED||e===c.CALLSTATE.FAILED)){var a;null!=(a=p.get(this).statsCollector)&&a.stop()}}catch(e){h.warn("Error happens when doing peer connection stats collector start/stop: "+e)}s.setCallState(this,e,o,n);try{if(null!=this.conversation&&(e===c.CALLSTATE.ENDED||e===c.CALLSTATE.FAILED)){h.debug("verbose logging is enabled? "+this.session.enableVerbose);var r=this.generateAuditData();if(this.session.__externalAuditData__&&this.conversation.streams.size()<=1){var l=r.externalData||{};l.events=this.session.__externalAuditData__.slice(0),r.externalData=l,this.session.__externalAuditData__.length=0}t(this,r)}}catch(e){h.warn("Error happens when sending audit data to server: "+e)}}},fireMediaStreamEvent:function(e,t){"use strict";if(this.onMediaStreamEvent)try{if(this.lastServerExtHeader){var i=this.lastServerExtHeader;this.onMediaStreamEvent(e,t,i),delete this.lastServerExtHeader}else this.onMediaStreamEvent(e,t)}catch(e){h.warn("The callback function 'Call.onMediaStreamEvent()' exception:"+e)}},mute:function(e){return null===this.peerConnection?(h.error("Cannot get the audio track. failed to mute audio!"),!1):(l.getLocalStreams(this.peerConnection).map(function(t){"undefined"!=typeof RTCRtpReceiver&&t instanceof RTCRtpReceiver||"undefined"!=typeof RTCRtpSender&&t instanceof RTCRtpSender?t.track&&"audio"===t.track.kind&&(t.track.enabled=!e):t.getAudioTracks().map(function(t){t.enabled=!e})}),!0)},isMuted:function(){return null===this.peerConnection?(h.debug("Cannot get the audio track, assuming not muted"),!1):l.getLocalStreams(this.peerConnection).some(function(e){return"undefined"!=typeof RTCRtpReceiver&&e instanceof RTCRtpReceiver||"undefined"!=typeof RTCRtpSender&&e instanceof RTCRtpSender?e.track&&"audio"===e.track.kind?!1===e.track.enabled:void 0:e.getAudioTracks().some(function(e){return!1===e.enabled})})},getRemoteStreams:function(){return l.getRemoteStreams(this.peerConnection)},decline:function(e,t){"use strict";try{null==e&&(e=c.ERRORCODE.DECLINED),this.callState.state===c.CALLSTATE.UPDATING?(h.debug("Update declined"),this.callConfig=this.lastCallConfig,this.setCallState(c.CALLSTATE.UPDATE_FAILED,e,"Decline")):(h.debug("Call declined"),l.clearPeerConnection(this),this.peerConnection=null,this.session.removeSubSession(this.subSessionId),this.setCallState(c.CALLSTATE.FAILED,e,"Decline")),s.sendReject(this,e,null,t),h.info("decline call.")}catch(e){h.error("answer error: "+e)}},accept:function(t,i,o){"use strict";function n(t){try{a.initAnswerCtx(r,t,o)}catch(t){h.error("Got exception when accept the call: "+t),r.onCallError&&l.invokeCallError(r,e.ERRORCODE.PEERCONNECTION_ERROR,t)}}var r=this;t||(t=this.callConfig);try{if(this.setCallState(c.CALLSTATE.STARTED,null,"receive call"),!a.isValidAnswerCallConfig(this.callConfig,t))throw{name:"InvalidCallConfig",message:"The parameter 'callConfig' is invalid."};if(this.callState.state===c.CALLSTATE.UPDATING&&null!=this.peerConnection)a.onUpdateCall(this,t,i,o);else{t&&(this.callConfig=t);var s=t.shouldSendAudio(),d=t.shouldSendVideo();s||d?i?n(i):a.initUserMedia(r,function(e){n([e])},function(e){h.error("Cannot get local stream... ",e),r.fireMediaStreamEvent(c.MEDIASTREAMEVENT.LOCAL_STREAM_ERROR,null),r.decline()}):n()}h.debug("accept call")}catch(e){throw h.error("answer error: "+e),e}},end:function(e){this.collectClientLog(c.LOGTYPE.EVENT_LOG,c.EVENTLOG.CALL_END);var t=s.createMessage(this),i="cancelled";t.header.action=c.ACTION.SHUTDOWN,t.addExtHeaders(e),this.callState.state===c.CALLSTATE.NONE||this.callState.isFinalState()||(this.callState.hasEstablished()?(t.control.correlation_id=this.session.genNewCorrelationId(),i="shutdown"):(t.control.correlation_id=this.startReqCorrId,i="cancelled"),this.session.sendMessage(t)),a.clearCall(this),this.setCallState(c.CALLSTATE.ENDED,"",i)},update:function(e,t,i){this.collectClientLog(c.LOGTYPE.EVENT_LOG,c.EVENTLOG.CALL_UPDATE),this.setCallState(c.CALLSTATE.UPDATING,"","update"),a.updateCall(this,e,t,i)},resume:function(e,t){h.info("Begin to resume call");var i=this,o=i.temporarySavedStreams;if(i.resumeSuccessCallback=e,i.resumeFailureCallback=t,i.session.clientIpNotChangedAfterReconnect)return h.debug("Client network was not changed, no further action needed."),void(i.resumeSuccessCallback&&i.resumeSuccessCallback());if(i.resumeState===c.RESUME_STATE.updateCallByIceFailure)return h.debug("The call is under updated by IceFailureHandler, no further action needed."),void(i.resumeSuccessCallback&&i.resumeSuccessCallback());i.collectClientLog(c.LOGTYPE.EVENT_LOG,c.EVENTLOG.NETWORK_SWITCHED);var n=i.offerAnswerManager.getMasterState(),a=i.offerAnswerManager.getSlaveState(),r=c.OFFER_ANSWER_STATE;switch(h.debug("The m/s offer-answer states are: "+n+"/"+a),n){case r.INITIAL:switch(a){case r.OFFER_REJECT:case r.INITIAL:case r.OFFER_GOT:i.resumeSuccessCallback&&i.resumeSuccessCallback();break;case r.ANSWER_SENT:i.resumeState=c.RESUME_STATE.reStartingCall,i.start(o);break;case r.ACK_GOT:i.resumeState=c.RESUME_STATE.reStartingCall,i.start(o)}break;case r.OFFER_SENT:switch(a){case r.OFFER_REJECT:case r.INITIAL:case r.OFFER_GOT:case r.ACK_GOT:i.resumeState=c.RESUME_STATE.waittingFinalResp,i.resumeSuccessCallback&&i.resumeSuccessCallback()}break;case r.ANSWER_GOT:switch(a){case r.OFFER_REJECT:case r.INITIAL:case r.OFFER_GOT:case r.GLARE:case r.ACK_GOT:case r.ANSWER_SENT:i.resumeState=c.RESUME_STATE.reStartingCall,i.start(o)}break;case r.ACK_SENT:switch(a){case r.OFFER_GOT:i.resumeSuccessCallback&&i.resumeSuccessCallback();break;case r.ANSWER_SENT:i.resumeState=c.RESUME_STATE.reStartingCall,i.start(o);break;case r.INITIAL:case r.OFFER_REJECT:case r.ACK_GOT:i.resumeState=c.RESUME_STATE.reStartingCall,i.start(o)}break;case r.OFFER_REJECTED:switch(a){case r.OFFER_REJECT:case r.INITIAL:case r.ACK_GOT:i.resumeState=c.RESUME_STATE.reStartingCall,i.start(o);break;case r.OFFER_GOT:i.resumeSuccessCallback&&i.resumeSuccessCallback();break;case r.ANSWER_SENT:i.resumeState=c.RESUME_STATE.reStartingCall,i.start(o)}}},onMessage:function(e){var t=this,i=[];if(this.session.iceServerListFromServer.length>0&&(i=this.session.iceServerListFromServer),h.debug("iceServers="+JSON.stringify(i,null,2)),this.callStartOnIceResponse||0!==i.length)if(e.isEnquiry()){if(!this.capabilityExchange){var o="No CapabilityExchange registered with this call";throw h.error(o),o}this.capabilityExchange.onMessage(e)}else e.isRequest()?r.doRequest(this,e):e.isResponse()?r.doResponse(this,e):e.isMessage()?r.doMessage(this,e):e.isError()?r.doError(this,e):s.doUnexpectedMsg(this,e);else h.info("There are no TURN candidates available on receiving start"),this.callStartOnIceResponse=!0,this.session.iceServerEnquirer.doIceEnquiry(function(){t.onMessage(e)})},collectClientLog:function(e,t){var i=new Date;t="["+(("0"+(i.getMonth()+1)).slice(-2)+"/"+("0"+i.getDate()).slice(-2)+"/"+i.getFullYear()+" "+("0"+i.getHours()).slice(-2)+":"+("0"+i.getMinutes()).slice(-2)+":"+("0"+i.getSeconds()).slice(-2)+"."+("00"+i.getMilliseconds()).slice(-3))+"]"+t,"error"===e?this.errorLog.push(t):"event"===e&&this.eventLog.push(t)},generateIntermidateAuditData:function(){var e={};e.stream_id=this.avStream.getId();var t=p.get(this).statsCollector,i=null==t?{}:t.getIntermidateReports();for(var o in e.data={},i)e.data[o]=i[o];var n={};return n["conversation-id"]=this.conversation.getLocalId(),n.streams=[],n.streams.push(e),n},generateAuditData:function(){var e={};e.stream_id=this.avStream.getId();var t=p.get(this).statsCollector,i=null==t?{}:t.getReports();for(var o in e.data={},i)e.data[o]=i[o];e.data.timeToNewPeerConnection=this.timeRecording.timeToNewPeerConnection.end-this.timeRecording.timeToNewPeerConnection.start,e.data.timeToGetUserMedia=this.timeRecording.timeToGetUserMedia.end-this.timeRecording.timeToGetUserMedia.start,e.data.timeToSetupSignalingChannel=this.session.timeToInitWebSocket,void 0!==this.timeRecording.timeToMakeCall.end&&void 0!==this.timeRecording.timeToMakeCall.start&&(e.data.timeToMakeCall=this.timeRecording.timeToMakeCall.end-this.timeRecording.timeToMakeCall.start),e.data.timeToGetIceCandidates=this.timeRecording.timeToGetIceCandidates.end-this.timeRecording.timeToGetIceCandidates.start,e.data.timeToGetIceCandidates<0&&(e.data.timeToGetIceCandidates=0),e.data.timeToGetIceConnection=this.timeRecording.timeToGetIceConnection.end-this.timeRecording.timeToGetIceConnection.start,e.data.timeToGetIceConnection<0&&(e.data.timeToGetIceConnection=0);var a=this.timeRecording.timeToGetRemoteMedia.end-this.timeRecording.timeToGetIceCandidates.start;a>=0&&(e.data.timeToGetRemoteMedia=a),e.data.errorLog=this.errorLog,e.data.eventLog=this.eventLog,e.data.userId=this.session.userName,e.data.userIp=this.userIp,e.data.sessionId=this.session.sessionId,e.data.sessionType=this.sessionType,e.data.protocol=this.protocol,e.data.url=this.url;var r={};n.browser.isFirefox?r.clientType="firefox":n.browser.isChrome?r.clientType="chrome":n.browser.isEdge?r.clientType="edge":n.browser.isIE?r.clientType="ie":n.browser.isSafari&&(r.clientType="safari"),r.version=n.browser.version,e.data.deviceInformation=r,e.data.participants=this.conversation.__participantsHistory;var s={};return s["conversation-id"]=this.conversation.getLocalId(),s.streams=[],s.streams.push(e),s}},a.sendOffer=function(e,t){e.offerAnswerManager.canSendOffer()?e.peerConnection&&e.peerConnection.localDescription&&e.peerConnection.localDescription.sdp&&a.sendOfferImpl(e,t):h.debug("Cannot send offer")},a.sendOfferImpl=function(e,t){if(e.callState.state===c.CALLSTATE.ENDED||e.callState.state===c.CALLSTATE.FAILED)h.warn("Call has ended while sending offer, clear the call."),a.clearCall(e);else{var i,o=s.createRequest(e),n=e.session.genNewCorrelationId();if(!e.peerConnection)return void h.warn("The peerConnection of the call is null");i=e.peerConnection.localDescription.sdp,o.header.action=c.ACTION.START,o.control.correlation_id=n,o.payload={sdp:i},t?o.addExtHeaders(t):e.extHeaders&&(o.addExtHeaders(e.extHeaders),e.extHeaders=null);e.authInfo&&(o.header.authorization=e.authInfo,!0,e.authInfo=null);try{e.session.sendMessage(o),e.startReqCorrId=o.control.correlation_id,e.offerAnswerManager.updateState(c.OFFER_ANSWER_STATE.OFFER_SENT,i),e.callState.state===c.CALLSTATE.NONE&&e.setCallState(c.CALLSTATE.STARTED,null,"start call")}catch(e){}}},a.sendAnswer=function(e,t){if(e.callState.state===c.CALLSTATE.ENDED||e.callState.state===c.CALLSTATE.FAILED)h.warn("Call has ended while sending answer, clear the call."),a.clearCall(e);else if(e&&e.peerConnection&&e.peerConnection.localDescription&&e.peerConnection.localDescription.sdp){var i=s.createResponse(e),o=e.peerConnection.localDescription.sdp,n=e.lastServerCorrelationId;i.control.message_state=c.MESSAGESTATE.FINAL,i.header.action=c.ACTION.START,i.control.correlation_id=n,t&&i.addExtHeaders(t),i.payload={sdp:o},e.session.sendMessage(i),h.debug("Answer is sent...\r\n"+o),e.setCallState(c.CALLSTATE.RESPONDED,200,"sent success response"),e.offerAnswerManager.updateState(c.OFFER_ANSWER_STATE.ANSWER_SENT,o)}},a.sendAnswerInComplete=function(e,t){var i=e.peerConnection.localDescription.sdp,o=s.createMessage(e);o.header.action=c.ACTION.COMPLETE,o.control.correlation_id=e.startReqCorrId,o.payload={sdp:i},t&&o.addExtHeaders(t),e.session.sendMessage(o),e.offerAnswerManager.updateState(c.OFFER_ANSWER_STATE.ACK_SENT,i),e.setCallState(c.CALLSTATE.ESTABLISHED,null,"sent complete")},a.initOfferCtx=function(t,i,o){"use strict";var n=t.peerConnection,r=function(){a.sendOffer(t,o),t.timeRecording.timeToMakeCall.end=(new Date).getTime()};null==t.peerConnection&&(l.createPeerConnection(t,i),n=t.peerConnection),t.callConfig.dataChannelConfig&&a.initDataChannel(t);var s={offerToReceiveAudio:t.callConfig.shouldReceiveAudio()?1:0,offerToReceiveVideo:t.callConfig.shouldReceiveVideo()?1:0};h.debug("Creating offer with constraints ",s),t.collectClientLog(c.LOGTYPE.EVENT_LOG,c.EVENTLOG.PEER_CONNECTION_CREATE_OFFER+":"+JSON.stringify(s,null,2)),t.timeRecording.timeToMakeCall.start=(new Date).getTime(),n.createOffer(s).then(function(e){var i=l.changeSdpByCallConfig(e.sdp,t);a.bindIceConnectionStateChangeHandler(t),l.setLocalDescription(t,new RTCSessionDescription({type:"offer",sdp:i}),function(){a.bindIceHandler(t,r,!0)})}).catch(function(i){h.error("Offer error:"+i),l.invokeCallError(t,e.ERRORCODE.GENERATE_SDP_ERROR,i)}),t.peerConnection=n},a.initAnswerCtx=function(t,i,o){"use strict";var n=t.peerConnection;null==t.peerConnection&&(l.createPeerConnection(t,i),n=t.peerConnection),t.callConfig.dataChannelConfig&&a.initReceivedDataChannel(t);var r=t.newRemoteSDP;r.type="offer";var s=new RTCSessionDescription(r);a.bindIceConnectionStateChangeHandler(t),l.setRemoteDescription(t,s,function(){var i=function(){a.sendAnswer(t,o)};t.collectClientLog(c.LOGTYPE.EVENT_LOG,c.EVENTLOG.PEER_CONNECTION_CREATE_ANSWER),n.createAnswer().then(function(o){h.debug("Answer SDP",o);var n=l.changeSdpByCallConfig(o.sdp,t);l.setLocalDescription(t,new RTCSessionDescription({type:"answer",sdp:n}),function(){a.bindIceHandler(t,i,!1)},function(i){h.warn("Set localDescription failed!"),l.invokeCallError(t,e.ERRORCODE.PEERCONNECTION_ERROR,i)})}).catch(function(i){h.error("Answer error:"+i),l.invokeCallError(t,e.ERRORCODE.GENERATE_SDP_ERROR,i)})},a.srdError(t))},a.clearCall=function(e){"use strict";e&&a.clearDataTransfers(e.dataTransfers);try{l.clearPeerConnection(e),e.peerConnection=null}catch(e){h.error("clear call error: "+e)}var t=e.localMediaStreams;if(t)for(var i=0;i<t.length;i++){var o=t[i];h.debug("Media stream "+i+": used by "+o.peerConnectionNum+" peer connections."),o&&(null==o.peerConnectionNum||o.peerConnectionNum<=0)&&("undefined"!=typeof RTCRtpReceiver&&o instanceof RTCRtpReceiver||"undefined"!=typeof RTCRtpSender&&o instanceof RTCRtpSender?(o.track&&"video"===o.track.kind&&(h.debug("Stop this media stream: [video tracks: 1, audio tracks: 0]"),o.track.enabled=!1,o.track.stop()),o.track&&"audio"===o.track.kind&&(h.debug("Stop this media stream: [video tracks: 0, audio tracks: 1]"),o.track.enabled=!1,o.track.stop())):(h.debug("Stop this media stream: [video tracks: "+o.getVideoTracks().length+", audio tracks: "+o.getAudioTracks().length+"]"),o.getAudioTracks().forEach(function(e){e.enabled=!1,e.stop()}),o.getVideoTracks().forEach(function(e){e.enabled=!1,e.stop()})))}e.conversation||e.session.removeSubSession(e.subSessionId)},a.clearDataTransfers=function(e){"use strict";if(e&&0!==e.size())for(var t=e.values(),i=0;i<t.length;i++)t[i].clear()},a.rollbackUpdate=function(e){"use strict";if(e&&e.peerConnection){var t=e.peerConnection.remoteDescription;if(t){h.debug("Altering type of remote SDP via reconstruction (in case original object is ready only)");var i=new RTCSessionDescription({type:"answer",sdp:t.sdp});l.setRemoteDescription(e,i)}e.lastCallConfig&&(e.callConfig=e.lastCallConfig)}},a.updateCall=function(e,t,i,o){e.lastCallConfig=e.callConfig,e.callConfig=t;a.bindIceConnectionStateChangeHandler(e),a.doUpdate(e,t,i,function(t,i,o){h.debug("createOffer with media constraints: "+JSON.stringify(o,null,2)),e.peerConnection.createOffer(t,i,o)},function(){},function(){a.bindIceHandler(e,function(){a.sendOffer(e,o)},!0)},!0)},a.closePcForUpdate=function(e,t){for(var i=l.getLocalStreams(e),o=0;o<i.length;o++){var n=i[o];n.peerConnectionNum&&n.peerConnectionNum--}"closed"!==e.signalingState&&e.close()},a.handleMediaStreamForUpdate=function(e,t,i,o){var n=!1,a=!1,r=(e.peerConnection,e.localMediaStreams),s=!1,c=function(t,i,o){for(var n=!1,a=0;a<t.length;a++){h.debug("round the loop: "+a+" s is "+r);var r=t[a];if(r){var s=!1,c=!1;if("undefined"!=typeof RTCRtpReceiver&&r instanceof RTCRtpReceiver||"undefined"!=typeof RTCRtpSender&&r instanceof RTCRtpSender)r.track&&"audio"===r.track.kind&&(s=!0),r.track&&"video"===r.track.kind&&(c=!0);else{var d=r.getAudioTracks(),u=r.getVideoTracks();s=d&&d.length>0,c=u&&u.length>0}h.debug("hasAudio: "+s),h.debug("hasVideo: "+c),h.debug("handleMediaStreamForUpdate: needAudio="+i+", hasAudio="+s+", needVideo="+o+", hasVideo="+c),i===s&&o===c&&(l.addLocalStream(e,r),n=!0)}}return n};return t&&(s=c(t,i,o)),!s&&r&&(s=c(r,i,o)),i&&!o?n=!s:!i&&o?a=!s:i&&o&&(s||(n=a=!0,t&&(n=!c(t,!0,!1),a=!c(t,!1,!0)),(n||a)&&r&&(n&&(n=!c(r,!0,!1)),a&&(a=!c(r,!1,!0))))),h.debug("handleMediaStreamForUpdate: needNewAudioStream="+n+", needNewVideoStream="+a),{needNewAudioStream:n,needNewVideoStream:a}},a.initUserMedia=function(t,i,o,n){"use strict";n||(n={audio:t.callConfig.shouldSendAudio(),video:t.callConfig.shouldSendVideo()}),h.debug("getUserMedia with media options: "+JSON.stringify(n,null,2));try{var a={};a.start=(new Date).getTime(),t.timeRecording.timeToGetUserMedia=a,navigator.mediaDevices.getUserMedia(n).then(function(e){if(t.collectClientLog(c.LOGTYPE.EVENT_LOG,c.EVENTLOG.GET_USER_MEDIA),t.timeRecording.timeToGetUserMedia.end=(new Date).getTime(),t.callState){var o=t.callState.state;if(o===c.CALLSTATE.END||o===c.CALLSTATE.FAILED)return void h.debug("Got media stream, but the call state is failed or end. So do nothing then.")}i(e)}).catch(function(i){if(h.error("Failed to get access to local media. Error name was "+i.name),t.collectClientLog(c.LOGTYPE.ERROR_LOG,c.ERRORLOG.GET_USER_MEDIA_ERROR+":"+i.name+(""===i.message?"":":"+i.message)),t.callState){var n=t.callState.state;if(n===c.CALLSTATE.END||n===c.CALLSTATE.FAILED)return void h.debug("Failed to get access to local media, but the call state is failed or end. So do nothing then.")}l.invokeCallError(t,e.ERRORCODE.GET_USER_MEDIA_ERROR,i.name+": "+i.message),o&&o(i)})}catch(e){throw h.error("The callConfig is invalid, cause initialize user media exception:"+e),e}},a.handleUpdateCallRequest=function(e,t){"use strict";var i=e.offerAnswerManager.getLatestActiveRemoteSdp();h.debug("The latest active remote SDP is: "+i),h.debug("The latest active remote medias is: "+e.remoteMedias),l.isMediaChanged(e.newRemoteMedias,e.remoteMedias)?(e.setCallState(c.CALLSTATE.UPDATING,null,"onUpdate"),e.onUpdate?e.onUpdate(e.callConfig,t):h.warn("No callback for update call request")):null==e.peerConnection||null==e.peerConnection.localDescription?(h.info("Client is not ready. Reject incoming call."),s.sendReject(e)):(l.createNewPeerConnection(e),e.offerAnswerManager.reset(),e.offerAnswerManager.updateState(c.OFFER_ANSWER_STATE.OFFER_GOT,e.newRemoteSDP.sdp),a.initAnswerCtx(e))},a.handleAnswer=function(e,t){"use strict";if(t.type="answer",e.peerConnection&&t.sdp){l.setRemoteDescription(e,new RTCSessionDescription(t),function(){e&&e.peerConnection&&e.peerConnection.remoteDescription})}},a.onUpdateCall=function(e,t,i,o){a.bindIceConnectionStateChangeHandler(e),a.doUpdate(e,t,i,function(t,i,o){var n=new RTCSessionDescription({type:"offer",sdp:e.newRemoteSDP.sdp});l.setRemoteDescription(e,n,function(){h.debug("[UPDATE] offer is set as remote description...\r\n"+e.newRemoteSDP.sdp),e.peerConnection.createAnswer().then(t).catch(function(t){i(t),e.decline()})},a.srdError(e))},function(){e.decline()},function(){a.bindIceHandler(e,function(){a.sendAnswer(e,o)},!1)},!1)},a.doUpdate=function(t,i,o,n,r,s,d){"use strict";var u=i,p=!1,v=!1,g=!1,m=!1,f=t.peerConnection;a.rollbackUpdate=function(e){var t=e.peerConnection;e.peerConnection=f,a.closePcForUpdate(t,e),e.lastCallConfig&&(e.callConfig=e.lastCallConfig)};var S=t.temporarySavedStreams;t.temporarySavedStreams=[],l.createPeerConnection(t),t.callConfig.dataChannelConfig&&(d?(a.initDataTransfers(t),a.initDataChannel(t)):a.initReceivedDataChannel(t)),t.temporarySavedStreams=S,u.audioConfig!==c.MEDIADIRECTION.NONE&&(p=!0),u.videoConfig!==c.MEDIADIRECTION.NONE&&(v=!0),u.audioConfig!==c.MEDIADIRECTION.RECVONLY&&u.audioConfig!==c.MEDIADIRECTION.SENDRECV||(g=!0),u.videoConfig!==c.MEDIADIRECTION.RECVONLY&&u.videoConfig!==c.MEDIADIRECTION.SENDRECV||(m=!0),h.debug("doUpdate: needAudioStream="+p+", needVideoStream="+v),h.debug("doUpdate: receiveAudio="+g+", receiveVideo="+m);var _=t.peerConnection,C=_.signalingHandlerForUpdate;_.signalingHandlerForUpdate=function(e){h.debug("signalingState : ",_.signalingState),"stable"===_.signalingState&&(a.closePcForUpdate(f,t),h.debug("Upgrade: the old peer connection is closed.",f),_.signalingHandlerForUpdate=C)};var b=a.handleMediaStreamForUpdate(t,o,p,v),E=function(){if(!t.peerConnection)throw h.error("Peer connection of the call is null."),{name:"Error",message:"Peer connection of the call is null."};n(function(e){t.callConfig=u;var i=l.changeSdpByCallConfig(e.sdp,t);e=new RTCSessionDescription({type:e.type,sdp:i}),h.debug("Updating call: "+e.type+" created... "+e.sdp),l.setLocalDescription(t,e,s)},function(i){h.error("Browser failed to create sdp! The error is: ",i),t.collectClientLog(c.LOGTYPE.ERROR_LOG,c.ERRORLOG.GENERATE_SDP_ERROR),t.setCallState(c.CALLSTATE.UPDATE_FAILED,e.ERRORCODE.PEERCONNECTION_ERROR,i),l.invokeCallError(t,e.ERRORCODE.GENERATE_SDP_ERROR,i),a.rollbackUpdate(t)},{OfferToReceiveAudio:g?1:0,OfferToReceiveVideo:m?1:0})};if(b.needNewAudioStream||b.needNewVideoStream){var R={audio:b.needNewAudioStream,video:b.needNewVideoStream};a.initUserMedia(t,function(i){var o=e.getLogLevel();o===c.LOGLEVEL.DEBUG?h.debug("[UPDATE] got local stream..."+i):o<=c.LOGLEVEL.INFO&&h.info("[UPDATE] got local stream..."),l.addLocalStream(t,i),E()},function(e){h.error("[Update] Cannot get local stream... ",e),t.fireMediaStreamEvent(c.MEDIASTREAMEVENT.LOCAL_STREAM_ERROR,null),r&&r(),a.rollbackUpdate(t)},R)}else E()},a.initDataTransfers=function(e){var t,i=e.callConfig.dataChannelConfig,o=i.length;if(0!==o)for(t=0;t<o;t++){var n=i[t],a=e.dataTransfers.get(n.label);a||(a=new u,e.dataTransfers.put(n.label,a));try{e.onDataTransfer?e.onDataTransfer(a):h.warn("The onDataTransfer() callback function is not set when starting.")}catch(e){h.warn("The callback function 'Call.onDataTransfer()' encountered an exception: "+e)}}},a.initDataChannel=function(e){var t,i=e.peerConnection,o=e.callConfig.dataChannelConfig,n=o.length;if(0!==n)for(t=0;t<n;t++){var a=o[t],r=JSON.parse(JSON.stringify(a));for(var s in delete r.label,r)r.hasOwnProperty(s)&&-1===r[s]&&delete r[s];var l=i.createDataChannel(a.label,r);e.dataTransfers.get(a.label).initDataChannel(l,e.callState.state==c.CALLSTATE.UPDATING)}h.debug("DataChannel is initiated")},a.initReceivedDataChannel=function(e){e.peerConnection.ondatachannel=function(t){h.debug("Data channel is received"),e.collectClientLog(c.LOGTYPE.EVENT_LOG,c.EVENTLOG.ON_DATA_CHANNEL+":"+t.channel.label);for(var i=t.channel.label,o=!1,n=0;n<e.callConfig.dataChannelConfig.length;n++)i===e.callConfig.dataChannelConfig[n]&&(o=!0);o||e.callConfig.dataChannelConfig.push({label:i,ordered:t.channel.ordered,maxPacketLifeTime:t.channel.maxPacketLifeTime,maxRetransmits:t.channel.maxRetransmits,protocol:t.channel.protocol,negotiated:t.channel.negotiated,id:t.channel.id});var a=e.getDataTransfer(i);a?h.debug("Data channel is updating."):(a=new u,h.debug("The dataTransfer object with label "+i+" is created"),e.dataTransfers.put(i,a));var r=t.channel;a.initDataChannel(r,!1);try{e.onDataTransfer?e.onDataTransfer(a):h.warn("The onDataTransfer() callback function is not set.")}catch(e){h.warn("The callback function 'Call.onDataTransfer()' exception: "+e)}e.session.saveToStorage()}},a.bindIceHandler=function(e,t,i){function o(){p.onicecandidate=r}function n(){e.peerConnection.onicecandidate=a,t()}function a(t){e.collectClientLog(c.LOGTYPE.EVENT_LOG,c.EVENTLOG.ON_ICE_CANDIDATE+":"+JSON.stringify(t.candidate));var i=t.candidate;i?(h.debug("handleNewIceCandidate: candidate- "+JSON.stringify(i)),function(t){var i,o,n=e.offerAnswerManager.trickledCandidatesMap;if(t.sdpMid)i="a=mid:"+t.sdpMid+"\r\n";else{if(null==t.sdpMLineIndex)return void h.warn("ICE Candidate is invalid, ignore it!");var a=e.offerAnswerManager.getLatestActiveLocalSdp();if(a){var r=l.getMediaFromSDP(a);if(r.length>0){var c=r[t.sdpMLineIndex];i=c.mid+"\r\n"}}}t.candidate&&(o=t.candidate),function(){var e=n.get(i);o?e?e.push(o):((e=[]).push(o),n.put(i,e)):h.warn("sdpCandidate is not valid; not adding to candidatesArray")}(),e.offerAnswerManager.canSendOffer()&&s.sendTrickledCandidates(e)}(i)):(e.timeRecording.timeToGetIceCandidates.end=(new Date).getTime(),h.debug("handleNewIceCandidate: got 'end of candidates' event."),function(){for(var t=e.offerAnswerManager.trickledCandidatesMap,i=t.keys();i.length>0;){var o=i.shift(),n=t.get(o);n.push("end-of-candidates")}e.offerAnswerManager.canSendOffer()&&s.sendTrickledCandidates(e)}())}function r(i){e.collectClientLog(c.LOGTYPE.EVENT_LOG,c.EVENTLOG.ON_ICE_CANDIDATE+":"+JSON.stringify(i.candidate));var o=i.candidate;h.debug("ICE gathering state: "+p.iceGatheringState),o?h.debug("handleEndOfCandidate: candidate- "+JSON.stringify(o)):(e.timeRecording.timeToGetIceCandidates.end=(new Date).getTime(),h.debug("handleEndOfCandidate: got 'end of candidates' event."),t(),p&&(p.onicecandidate=d))}function d(t){e.collectClientLog(c.LOGTYPE.EVENT_LOG,c.EVENTLOG.ON_ICE_CANDIDATE+":"+JSON.stringify(t.candidate)),t.candidate?h.debug("logIceCandidates : candidate- "+JSON.stringify(t.candidate)):h.debug("logIceCandidates : end of candidates.")}function u(e){return e.search("a=ice-options:.*trickle")>-1?(h.debug("SDP supports trickle ICE"),!0):(h.debug("SDP does NOT support trickle ICE"),!1)}var p=(e.offerAnswerManager,e.peerConnection);if(!p)throw{name:"IllegalStateError",message:"There is no peerConnection in the call, cannot bind."};switch(h.debug("Bind ICE handler with trickle ICE mode: "+e.pkgInstance.trickleIceMode),e.pkgInstance.trickleIceMode){case"off":o();break;case"half":i?o():u(e.newRemoteSDP.sdp)?n():o();break;case"full":i||u(e.newRemoteSDP.sdp)?n():o();break;default:o()}p.onsignalingstatechange=function(t){var i=p.signalingHandlerForUpdate;"function"==typeof i&&i(t),e.collectClientLog(c.LOGTYPE.EVENT_LOG,c.EVENTLOG.ON_SIGNALING_STATE_CHANGE+":"+t.target.signalingState)},p.onnegotiationneeded=function(t){e.collectClientLog(c.LOGTYPE.EVENT_LOG,c.EVENTLOG.ON_NEGOTIATION_NEEDED+":"+t.target.signalingState)},p.onicegatheringstatechange=function(t){e.collectClientLog(c.LOGTYPE.EVENT_LOG,c.EVENTLOG.ON_ICE_GATHERING_STATE_CHANGE+":"+t.target.iceGatheringState),function(e){h.debug("ICE gathering state: "+e.target.iceGatheringState)}(t)}},a.bindIceConnectionStateChangeHandler=function(e){var t=e.peerConnection;if(!t)throw{name:"IllegalStateError",message:"There is no peerConnection in the call, cannot bind."};t.oniceconnectionstatechange=function(t){if(e.collectClientLog(c.LOGTYPE.EVENT_LOG,c.EVENTLOG.ON_ICE_CONNECTION_STATE_CHANGE+":"+t.target.iceConnectionState),"failed"===t.target.iceConnectionState){e.collectClientLog(c.LOGTYPE.ERROR_LOG,c.ERRORLOG.ICE_CONNECTION_ERROR+": To "+e.callee);var o=e.onCallError;if(o)o(new d.ErrorInfo(c.ERRORCODE.ICE_CONNECTION_ERROR,"ICE connection state gets failed"))}else if("new"===t.target.iceConnectionState||"checking"===t.target.iceConnectionState)e.timeRecording.timeToGetIceConnection.start=(new Date).getTime();else if("connected"===t.target.iceConnectionState){e.timeRecording.timeToGetIceConnection.end=(new Date).getTime();var n=p.get(e).statsCollector;null==n&&(n=p.get(e).statsCollector=new i(e)).start()}else t.target.iceConnectionState;(function(t){h.debug("ICE connection state: "+t.target.iceConnectionState),e.onIceConnectionStateChange&&e.onIceConnectionStateChange(t.target.iceConnectionState)})(t),e.getCallState().isFinalState()||p.get(e).iceFailureHandler.updateIceConnectionState(t)}},a.isValidAnswerCallConfig=function(e,t){var i={sendrecv:6,sendonly:4,recvonly:2,inactive:1,none:1},o=t.audioConfig,n=t.videoConfig,a=e.audioConfig,r=e.videoConfig,s=!1,l=!1;return h.debug("Old audio = "+a+", video = "+r),h.debug("New audio = "+o+", video = "+n),h.debug("Audio direction values: newAudio="+i[o]+", oldAudio="+i[a]+", newAudio <= oldAudio: "+(i[o]<=i[a])),h.debug("Video direction values: newVideo="+i[n]+", oldVideo="+i[r]+", newVideo <= oldVideo: "+(i[n]<=i[r])),a===c.MEDIADIRECTION.SENDONLY||a===c.MEDIADIRECTION.RECVONLY||a===c.MEDIADIRECTION.NONE?a!==o&&o!==c.MEDIADIRECTION.NONE||(s=!0):i[o]<=i[a]&&(s=!0),r===c.MEDIADIRECTION.SENDONLY||r===c.MEDIADIRECTION.RECVONLY||r===c.MEDIADIRECTION.NONE?r!==n&&n!==c.MEDIADIRECTION.NONE||(l=!0):i[n]<=i[r]&&(l=!0),h.debug("isValidAudio="+s+", isValidVideo="+l),!0},a.srdError=function(t){return function(i){h.warn("Error when set remote description: "+i),t.collectClientLog(c.LOGTYPE.ERROR_LOG,c.ERRORLOG.SET_REMOTE_SDP_ERROR+":"+i),l.invokeCallError(t,e.ERRORCODE.PEERCONNECTION_ERROR,i)}},n.CallPackageHelper=a,e.Call=g,e.CallPackage=v,console.log("wsc-call initialized."),e}(live||{}),live=function(e){"use strict";var t=e._private=e._private||{},i=t.CallPackageHelper,o=t.wscConst,n=t.wscUtils,a=t.rtcHelper,r=e.getLogger(),s={};e.timeoutIfEocNotHappen=1e3;var l=function(t,i,o,n){r.debug("Creating connection for user: '"+t+"' with uri: "+i),this.localParticipantUri=t,this.webSocketUri=i,this.onConnectionSuccess=o,this.onConnectionError=n,this.connectionId=null,this.refresh=!1,this.extHeaders=null,this.extPayloads=null,this.stateInfo=null,this.withConnectionId=function(e){return this.connectionId=e,this.refresh=!!e,this},this.withEarlyCallbacks=function(e,t){return this.onConnectionStateChange=e,this.onAuthRefresh=t,this},this.withExtHeaders=function(e){return this.extHeaders=e,this},this.withExtPayloads=function(e){return this.extPayloads=e,this},this.withStateInfo=function(e){return this.stateInfo=e,this},this.start=function(){r.debug("Starting connection to URI = "+this.webSocketUri+", ID = "+this.connectionId),this.connectionId&&null===sessionStorage.getItem(this.connectionId)&&(r.info("Warning: No stored session found for id: "+this.connectionId),this.connectionId=null,this.refresh=!1),this.session=new e.Session(this.localParticipantUri,this.webSocketUri,this.onConnectionSuccess,this.onConnectionError,this.connectionId,this.extHeaders,this.extPayloads,this.stateInfo),r.debug("Session created with id: "+this.session.sessionId),this.session.onSessionStateChange=this.onConnectionStateChange,this.package=new e.ConversationPackage(this.session,null),this.authHandler=new e.AuthHandler(this.session),this.authHandler.refresh=this.onAuthRefresh;var t=function(e,t){e=e.replace(/[\[\]]/g,"\\$&");var i=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)").exec(t);return i?i[2]?decodeURIComponent(i[2].replace(/\+/g," ")):"":null}("jwt",this.webSocketUri);if(t){r.debug("JWT token: ",t);var i=t.split(".")[1];if(i){var o=i.replace("-","+").replace("_","/");if(o){var n=JSON.parse(atob(o));n&&(r.debug("Parsed JWT:"+JSON.stringify(n,null,2)),r.debug("Found username in JWT: "+n.username),n.username&&(this.package.clientId=n.username))}}}return this}};l.prototype={getLocalParticipantUri:function(){return this.session.userName},getConnectionId:function(){return this.session.sessionId},close:function(){this.session.close()},setTrickleIceMode:function(e){this.package.setTrickleIceMode(e)},setIPv6:function(e){this.package.setIPv6(e)},setShortCircuit:function(e){this.package.setShortCircuit(e)},setDSCP:function(e){this.package.setDSCP(e)},setVideoSendBitrate:function(e){this.package.setVideoSendBitrate(e)},setVideoRecvBitrate:function(e){this.package.setVideoRecvBitrate(e)},setRemoveVideoFec:function(e){this.package.setRemoveVideoFec(e)},setIntervals:function(e,t,i,o){e&&e>0&&this.session.setBusyPingInterval(e),t&&e>0&&this.session.setIdlePingInterval(t),i&&i>0&&this.session.setReconnectInterval(i),o&&o>=0&&(this.session.retryCount=o)},setPingPongMessages:function(e,t){this.session.setPingPongMessages(e,t)},updateWebSocketUri:function(e){r.debug("updateWebSocketUri: "+e),this.webSocketUri=e,this.session&&(this.session.webSocketUri=e)},isRefresh:function(){return this.refresh},initCallbacks:function(e,t,i){this.package.initCallbacks(e,t),i&&(this.onConnectionStateChange=i,this.session.onSessionStateChange=this.onConnectionStateChange)},makeConversation:function(){return this.package.createConversation(null,null,null,null)},getConversations:function(){return this.package.getConversations()},hibernate:function(e,t,i){this.session.hibernate(e,t,i)},getNetworkStatus:function(e,t){this.session.getNetworkStatus(e,t)},subscribeToEntity:function(e,t,i,o){return this.session.subscribeToEntity(e,t,i,o)},unsubscribeFromEntity:function(e){this.session.unsubscribeFromEntity(e)},logEventTimestamp:function(e){s.logEventTimestamp(this.session,e)},setAuditDataModule:function(e){this.session.__auditDataModule__=e}};var c=function(e,t){if(!e){var i="The parameter 'session' cannot be null!";throw r.error(i),i}this.packageType=t||o.PACKAGE.CONVERSATION,e.registerPackage(this),this.session=e,this.trickleIceMode="off",this.ipv6=!1,this.dscp=!1,this.videoSendBitrate=!1,this.videoRecvBitrate=!1,this.removeVideoFec=!1,this.shortCircuitMode=!1,this.onIncoming=null,this.onResurrect=null,this.getConversations=function(){var e=[],t=this.session.getSubSessionsByPackageType(this.packageType),i=null;if(t){i=t.values();for(var o=0;o<i.length;o++)e[o]=i[o]}return e},this.encodeConversationTopic=function(e){return e?((e=e.replace(/[\W]+/g,"_")).indexOf("@")<0&&(e+="@conversation.topic"),e):null}};c.prototype={initCallbacks:function(e,t){this.onIncoming=e,this.onResurrect=t},createConversation:function(e,t,i,o){i||(i="video");var n=this.prepareConversation(e,this.encodeConversationTopic(t),this.session,this.session.userName,i),a=n.localAddParticipant(this.session.userName);return o&&a.localAddStreamInfo(null,null,o,null),n.subSessionId=this.session.generateSubSessionId(),this.putConversation(n.subSessionId,n),e&&(r.debug("Conversation Key provided ("+e+") - joining existing conversation"),n.joiningConversation=!0),this.shortCircuitMode&&(r.debug("Enabling short-circuit communication in conversation"),n.withShortCircuit()),n},clear:function(){var e,t=this.session.getSubSessionsByPackageType(this.packageType).values();for(e=0;e<t.length;e++){for(var o=t[e],n=o.streams.values(),a=0;a<n.length;a++)i.clearCall(n[a].call);o=null}},remove:function(e){var t=this,i=e.subSessionId;e.removed||(e.removed=!0,setTimeout(function(){r.debug("Removing conversation: "+i),t.session.removeSubSession(i)},1e3))},onMessage:function(e){var t=this.session,i=e.control.subsession_id,n=e.header.stream_id,s=e.header.stream_type,l=this.session.getSubSession(i);if(e.isRequest()&&"start"===e.header.action){var c=e.payload.sdp,d=a.getCallConfigFromRemoteSDP(c,!1);if(null===l){var u="video";d&&(u=d.getChannelType()),(l=this.prepareConversation(e.header.conversation_key,e.header.conversation_topic,t,e.header.initiator,u)).subSessionId=i,l.joiningConversation=!0,l.localAddParticipant(t.userName),this.putConversation(l.subSessionId,l),r.debug("Have incoming conversation from: "+e.header.initiator,l)}else r.debug("Have incoming start request from: "+e.header.initiator,l);l&&!l.getStreamForId(n)&&(r.debug("No existing stream for the stream id: "+n+", type: "+s),s===o.STREAMTYPE.SCREENSHARE?l.createScreenShareStream(n):l.createAudioVideoStream(d,n))}l?l.onMessage(e):r.info("Ignoring "+e.control.type+" with action: '"+e.header.action+"' for unknown conversation: "+i)},onRehydration:function(t){function i(t,i){var o,n=t.call,r=i.call;if(n.callState=new e.CallState(r.callState.state,r.callState.status.code,r.callState.status.reason,r.callState.streamId),n.earlyMediaState=r.earlyMediaState,r.remoteMedias&&r.remoteMedias.length){o=[];for(var s=0;s<r.remoteMedias.length;s++){var l=r.remoteMedias[s];o[s]=new a.Media(l.mode,l.port,l.type)}}n.remoteMedias=o,n.offerAnswerManager.updateState(r.offerAnswerManager.masterState),n.offerAnswerManager.updateState(r.offerAnswerManager.slaveState),n.iceTimeout=r.iceTimeout,n.onCallError=r.onCallError,n.onUpdate=r.onUpdate,n.onCallStateChange=r.onCallStateChange,n.onMediaStreamEvent=r.onMediaStreamEvent,n.onIceConnectionStateChange=r.onIceConnectionStateChange}for(var n in t.entry)if(t.entry.hasOwnProperty(n)){var s=t.entry[n];r.debug("onRehydration invoked for conversation: "+s.subSessionId);var l=this.prepareConversation(s.conversationKey,s.conversationTopic,this.session,s.initiator,s.conversationChannel);if(l.joiningConversation=s.joiningConversation,l.shortCircuitMode=s.shortCircuitMode,l.onRecordingStatusChange=s.onRecordingStatusChange,l.onParticipantChange=s.onParticipantChange,l.onError=s.onError,l.onEnquiryResponse=s.onEnquiryResponse,l.subSessionId=s.subSessionId,l.recording=s.recording,l.recordingRules=s.recordingRules,l.alwaysRecordOnCreation=s.alwaysRecordOnCreation,l.neverRecordOnCreation=s.neverRecordOnCreation,l.sentAutomaticRecordingRequest=s.sentAutomaticRecordingRequest,l.recordingStyle=s.recordingStyle,l.lastRemovedParticipant=s.lastRemovedParticipant,l.pendingTargetURI=s.pendingTargetURI,l.pendingTargetStreamId=s.pendingTargetStreamId,l.pendingTargetStreamOptions=s.pendingTargetStreamOptions,l.pendingTargetStreamProfile=s.pendingTargetStreamProfile,l.webContext=s.webContext,l.pendingAVStreams=s.pendingAVStreams,l.iceCheckInterval=s.iceCheckInterval,l.pendingAddStreamRelay=s.pendingAddStreamRelay,l.sidebarId=s.sidebarId,l.clientId=s.clientId,l.clientVersion=s.clientVersion,l.postCallRating=s.postCallRating,l.participants=new e.Map,s.participants){var c=[];for(var d in s.participants.entry)s.participants.entry.hasOwnProperty(d)&&c.push(s.participants.entry[d]);for(var u=0;u<c.length;u++){var h=c[u],v=new e.Participant(l,h.uri);if(v.onParticipantStateChange=h.onParticipantStateChange,v.onAddStream=h.onAddStream,v.onAddRemoteStream=h.onAddRemoteStream,h.uri!==this.session.userName){var g=[];for(var m in h.streams.entry)h.streams.entry.hasOwnProperty(m)&&g.push(h.streams.entry[m]);for(var f=0;f<g.length;f++){var S=p.createStreamOptions(g[f].streamOptions.audioConfig,g[f].streamOptions.videoConfig),_=v.localAddStreamInfo(g[f].streamId,g[f].streamType,S,g[f].streamProfile);_.recording=g[f].recording,_.streamLayout=g[f].streamLayout,_.active=g[f].active}}l.participants.put(h.uri,v)}}if(l.streams=new e.Map,s.streams){var C=[];for(var b in s.streams.entry)s.streams.entry.hasOwnProperty(b)&&C.push(s.streams.entry[b]);for(var E=0;E<C.length;E++){var R,y=C[E];if(y.call.streamType===o.STREAMTYPE.AUDIOVIDEO){var T=p.createStreamOptions(y.call.callConfig.audioConfig,y.call.callConfig.videoConfig);R=l.createAudioVideoStream(T,y.streamId,y.streamInfo.streamProfile)}else{var A=p.createStreamOptions(y.call.callConfig.audioConfig,y.call.callConfig.videoConfig);R=l.createScreenShareStream(y.streamId,A,y.streamInfo.streamProfile)}i(R,y),R.localMediaStreams=y.localMediaStreams,R.extHeaders=y.extHeaders,R.onPauseResumeStream=y.onPauseResumeStream,R.onUpdateStreamOptions=y.onUpdateStreamOptions,R.streamInfo.recording=y.streamInfo.recording,R.streamInfo.streamLayout=y.streamInfo.streamLayout,R.streamInfo.active=y.streamInfo.active,r.debug("Rehydrated stream: "+JSON.stringify(R,null,2))}}if(l.relays=new e.Map,s.relays){var I=[];for(var w in s.relays.entry)s.relays.entry.hasOwnProperty(w)&&I.push(s.relays.entry[w]);for(var k=0;k<I.length;k++){var x=I[k];"string"!=typeof x.relayDest&&(x.relayDest=l.getParticipant(x.relayDest.uri).getStreamInfo(x.relayDest.streamId));var O=new e.Relay(l,x.streamId,x.relayDest,x.relayId);O.responseHandler=x.responseHandler,O.retryHandler=x.retryHandler,O.timeoutHandler=x.timeoutHandler,O.errorHandler=x.errorHandler,O.retries=x.retries,O.timeout=x.timeout,O.timer=x.timer,O.startTime=x.startTime;var L=[];for(var N in x.relayMessages.entry)x.relayMessages.entry.hasOwnProperty(N)&&L.push(x.relayMessages.entry[N]);for(var D=0;D<L.length;D++){var P=new e.RelayMessage(O,L[D].messageType,L[D].messageId);P.responseHandler=L[D].responseHandler,P.retryHandler=L[D].retryHandler,P.timeoutHandler=L[D].timeoutHandler,P.errorHandler=L[D].errorHandler,P.retries=L[D].retries,P.retryCount=L[D].retryCount,P.timeout=L[D].timeout,P.final=L[D].final,P.relayDestinations=L[D].relayDestinations,P.gotRelayResponses=L[D].gotRelayResponses,P.gotAllResponses=L[D].gotAllResponses,P.timestamp=L[D].timestamp,P.message=L[D].message,P.text=L[D].text,P.data=L[D].data,P.commands=L[D].commands,O.relayMessages.put(P.messageId,P)}l.relays.put(O.relayId,O)}}this.putConversation(n,l),r.debug("Completed rehydration of conversation: "+n),this.onResurrect?(r.debug("Conversation has been rehydrated - calling onResurrect"),this.onResurrect(l)):r.debug("onResurrect is not set")}},prepareConversation:function(t,i,n,a,r){var s=new e.Conversation(t,i,n,a,r),l=new Date;return s.startTime=""+l.getHours()+l.getMinutes()+l.getSeconds()+l.getMilliseconds(),s.callPackage=n.getPackage(o.PACKAGE.CALL),s.callPackage||(s.callPackage=new e.CallPackage(n)),s.callPackage.packageType=this.packageType,s.callPackage.setTrickleIceMode(this.trickleIceMode),s.callPackage.setIPv6(this.ipv6),s.callPackage.setDSCP(this.dscp),s.callPackage.setVideoSendBitrate(this.videoSendBitrate),s.callPackage.setVideoRecvBitrate(this.videoRecvBitrate),s.callPackage.setRemoveVideoFec(this.removeVideoFec),s.callPackage.onIncomingCall=this.onIncoming,s.callPackage.onResurrect=this.onResurrect,s.pkgInstance=this,s.clientId=this.clientId,s},putConversation:function(e,t){this.session.putSubSession(this.packageType,e,t)},setTrickleIceMode:function(e){this.trickleIceMode=e},setIPv6:function(e){this.ipv6=e},setDSCP:function(e){this.dscp=e},setVideoSendBitrate:function(e){this.videoSendBitrate=e},setVideoRecvBitrate:function(e){this.videoRecvBitrate=e},setRemoveVideoFec:function(e){this.removeVideoFec=e},setShortCircuit:function(e){this.shortCircuitMode=e},toJSON:function(){var e={},t={session:""};for(var i in this)this.hasOwnProperty(i)&&(i in t||(e[i]=this[i]));return e}};var d=function(t,i,n,a,l){this.conversationKey=t,this.conversationTopic=i,this.session=n,this.initiator=a,this.conversationChannel=l,this.joiningConversation=!1,this.pkgInstance=null,this.callPackage=null,this.streams=new e.Map,this.relays=new e.Map,this.startTime="",this.__participantsHistory=[],this.onRecordingStatusChange=null,this.onParticipantChange=null,this.onError=null,this.onEnquiryResponse=null,this.onRelayCommand=null,this.onRelayText=null,this.onRelayData=null,this.subSessionId=null,this.participants=new e.Map,this.recording=!1,this.recordingRules=null,this.alwaysRecordOnCreation=!1,this.neverRecordOnCreation=!1,this.sentAutomaticRecordingRequest=!1,this.shortCircuitMode=!1,this.recordingStyle="single",this.lastRemovedParticipant=null,this.pendingTargetURI=null,this.pendingTargetStreamId=null,this.pendingTargetStreamOptions=null,this.pendingTargetStreamProfile=null,this.webContext=null,this.pendingAVStreams=[],this.removed=!1,this.pendingAddStreamRelay=null,this.sidebarId=null,this.clientId=null,this.clientVersion=null,this.postCallRating=!1,this.statusCheckTimeout=null,this.statusCheckSuccess=null,this.addStreamScreenSharePromise=null,this.addStreamShareResolve=null,this.screenShareValues=null,this.shortCircuitModeAllowed=!0;var c=2e3;this.setIceCheckInterval=function(e){if(e<=0)throw{name:"IllegalArgumentError",message:"The ICE check Interval must be greater than zero."};c=e},this.getIceCheckInterval=function(){return c},this.getLocalId=function(){return this.subSessionId},this.generateStreamId=function(e){var t=this.streams.values().filter(function(t){return t.getType()===e}).length;r.debug("Found "+t+" streams with type: "+e);var i="av";return e===o.STREAMTYPE.SCREENSHARE&&(i="ss"),i+(t+1)+"-"+this.startTime},this.generateRelayId=function(){var e=this.relays.size();r.debug("Found "+e+" relays");return"r"+(e+1)+"-"+this.startTime},this.withParticipant=function(e,t,i,n){this.pendingTargetURI=e;var a=this.localAddParticipant(e);return t||(t=this.getDefaultStreamOptions()),this.pendingTargetStreamId=a.localAddStreamInfo(null,n||null,t,i).getId(),this.pendingTargetStreamOptions=t,this.pendingTargetStreamProfile=i,this.onParticipantChange&&this.onParticipantChange(this,o.CONVERSATIONSTATE.STREAM_ADDED,a),this},this.withChannel=function(e){return this.conversationChannel=e,this},this.withKey=function(e){return e&&(r.debug("Joining conversation with key="+e),this.conversationKey=e,this.joiningConversation=!0),this},this.withTopic=function(e){return this.conversationTopic=this.pkgInstance.encodeConversationTopic(e),this},this.withContext=function(e){return this.webContext=e,this},this.withVersion=function(e){return this.clientVersion=e,this},this.withCallbacks=function(e,t,i,n,a,r,s){if(this.onRecordingStatusChange=e,this.onParticipantChange=t,this.onError=i,this.onRelayCommand=n,this.onRelayText=a,this.onRelayData=r,this.onEnquiryResponse=s,this.onParticipantChange)for(var l=this.participants.values(),c=0;c<l.length;c++)this.onParticipantChange(this,o.CONVERSATIONSTATE.STREAM_ADDED,l[c]);return this},this.withShortCircuit=function(){return r.debug("Conversation withShortCircuit setting SCM to (allowed): "+this.shortCircuitModeAllowed),this.shortCircuitMode=this.shortCircuitModeAllowed,this},this.withoutShortCircuit=function(){return r.debug("Conversation withoutShortCircuit setting SCM allowed to false"),this.shortCircuitModeAllowed=!1,this},this.isShortCircuit=function(){return this.shortCircuitMode},this.getSidebar=function(){return this.sidebarId},this.withRecording=function(){return this.alwaysRecordOnCreation=!0,this},this.withoutRecording=function(){return this.neverRecordOnCreation=!0,this},this.localSetRecording=function(e){this.recording=e,this.recording?r.debug("Conversation is being recorded"):r.debug("Conversation is not being recorded")},this.localAddParticipant=function(t){var i=new e.Participant(this,t);return this.participants.put(t,i),i},this.localRemoveParticipant=function(e){return this.lastRemovedParticipant=this.getParticipant(e),this.participants.remove(e)&&r.debug("Removed Participant with uri="+e),this.lastRemovedParticipant},this.decodeConversationTopic=function(){if(!this.conversationTopic)return null;var e=this.conversationTopic,t=e.indexOf("@");return t&&(e=e.substring(0,t)),e.replace(/_/g," ")},this.setRecordingStyle=function(e){this.recordingStyle=e},this.getRecordingStyle=function(){return this.recordingStyle},this.setPostCallRating=function(e){r.debug("Post-call rating is required"),this.postCallRating=e},this.isPostCallRatingRequired=function(){return this.postCallRating},this.setRecordingRules=function(e){this.recordingRules=e},this.getRecordingRules=function(){return this.recordingRules},this.getPendingTarget=function(){return{uri:this.pendingTargetURI,streamId:this.pendingTargetStreamId,streamOptions:this.pendingTargetStreamOptions,streamProfile:this.pendingTargetStreamProfile}},this.clearPendingTarget=function(){this.pendingTargetURI=null,this.pendingTargetStreamId=null,this.pendingTargetStreamOptions=null,this.pendingTargetStreamProfile=null},this.replacePendingTarget=function(e){var t=this.getPendingTarget();r.debug("Replacing pending destination: '"+t.uri+"' with actual destination: '"+e+"'"),this.getParticipant(t.uri)&&this.localRemoveParticipant(t.uri);var i=this.localAddParticipant(e);i.localAddStreamInfo(t.streamId,o.STREAMTYPE.AUDIOVIDEO,t.streamOptions,t.streamProfile),r.debug("Replaced pending destination with actual destination: '"+e+"'"),this.clearPendingTarget(),this.onParticipantChange&&this.onParticipantChange(this,o.CONVERSATIONSTATE.STREAM_ADDED,i)},this.defaultEnquiryResponse=function(e){var t=null;if(e){t=JSON.parse("{}"),r.debug("Processing recording rules for conversation: "+JSON.stringify(e,null,2));var i=e.destination_uri;i&&this.replacePendingTarget(i);var o=e.recording_style;o&&(r.debug("Will record using style: "+o),this.setRecordingStyle(o)),e.post_call_rating&&(r.debug("Will request a post-call rating"),this.setPostCallRating(!0));var n=e.exclude_conversation,a=e.include_conversation,s=e.include_associations,l=e.exclude_associations,c=e.include_participants;n?(r.debug("Not recording conversation"),this.withoutRecording().withShortCircuit()):a?(r.debug("Recording conversation"),t.participants=["*"],this.withRecording()):(s&&(r.debug("Including associations: "+JSON.stringify(s,null,2)),t.include_associations=[].concat(s),this.withRecording()),l&&(r.debug("Excluding associations: "+JSON.stringify(l,null,2)),t.exclude_associations=[].concat(l),this.withRecording()),c&&(r.debug("Including participants: "+JSON.stringify(c,null,2)),t.participants=[].concat(c),this.withRecording()))}this.setRecordingRules(t)},this.onIceConnectionStateChange=function(e,t){r.debug("onIceConnectionStateChange: "+t,e);var i=this.getLocalParticipant();if(i){var n=i.getStreamInfo(e.streamId);if(n)if("connected"===t||"completed"===t){if(!n.isActive()){n.localSetActive(!0);var a=[{uri:i.getUri(),streams:[{stream_id:e.getId(),stream_type:e.getType(),stream_options:e.getStreamOptions()}]}];s.relayStreamEvent(e,o.CONVERSATIONSTATE.STREAM_ACTIVE,a),s.handleParticipantChange(this,o.CONVERSATIONSTATE.STREAM_ACTIVE,a[0].uri,a[0].streams)}}else n.isActive()&&n.localSetActive(!1),"failed"===t&&e.call.onCallStateChange&&(r.info("onIceConnectionStateChange: failed - updating stream state to: "+o.CALLSTATE.FAILED),e.call.setCallState(o.CALLSTATE.ERROR,o.ERRORCODE.ICE_CONNECTION_ERROR,"ICE state failed"))}},this.createStreamOfType=function(t,i,n,a){var s=this.callPackage.prepareCall(this.session,n,this.initiator,null);s.subSessionId=this.subSessionId,s.pkgInstance=this.callPackage,s.conversation=this,s.streamId=t,s.streamType=i,s.callState.streamId=t,s.shortCircuitMode=this.shortCircuitMode;var l,c=this.getLocalParticipant().localAddStreamInfo(t,i,n,a);switch(i){case o.STREAMTYPE.AUDIOVIDEO:l=new e.AudioVideoStream(this,s,t,c);break;case o.STREAMTYPE.SCREENSHARE:l=new e.ScreenShareStream(this,s,t,c);break;default:return r.error("Unknown stream type: "+i),null}return this.streams.put(t,l),l.call.onIceConnectionStateChange=this.onIceConnectionStateChange.bind(this,l),l},this.createAudioVideoStream=function(e,t,i){return e||(e=this.getDefaultStreamOptions()),t||(t=this.generateStreamId(o.STREAMTYPE.AUDIOVIDEO)),this.createStreamOfType(t,o.STREAMTYPE.AUDIOVIDEO,e,i)},this.createScreenShareStream=function(t,i,n){return i||(i=new e.StreamOptions(o.MEDIADIRECTION.NONE,o.MEDIADIRECTION.SENDRECV)),t||(t=this.generateStreamId(o.STREAMTYPE.SCREENSHARE)),this.createStreamOfType(t,o.STREAMTYPE.SCREENSHARE,i,n)},this.addScreenShareStream=function(e,t,i){var o=this.createScreenShareStream(e,t,i);if(this.isShortCircuit()){r.debug("Short-circuit conversation - creating sidebar before adding stream"),s.sendCreateSidebar(this),this.screenShareValues={stream:o,options:t};var n=this;return this.addStreamScreenSharePromise=new Promise(function(e,t){r.debug("created addStreamScreenSharePromise"),n.addStreamShareResolve=e}),this.addStreamScreenSharePromise}return Promise.resolve({stream:o,options:t})},this.getDefaultStreamOptions=function(){return"audio"===this.conversationChannel?new e.StreamOptions(o.MEDIADIRECTION.SENDRECV,o.MEDIADIRECTION.NONE):new e.StreamOptions(o.MEDIADIRECTION.SENDRECV,o.MEDIADIRECTION.SENDRECV)},this.getStreamForId=function(e){var t=this.streams.get(e);return t||"default"!==e||(t=this.streams.get("av1-"+this.startTime)),t},this.remove=function(){this.pkgInstance.remove(this)},this.createRelay=function(t,i,o){o||(o=this.generateRelayId());var n=new e.Relay(this,t,i,o);return this.relays.put(o,n),r.debug("Created relay for stream: "+t+" with id: "+o+" and destination: "+JSON.stringify(i,null,2)),n},this.getRelayForId=function(e){var t=this.relays.get(e);return t||"default"!==e||(t=this.getRelay()),t},this.getRelayForStream=function(e){var t=this.relays.values().filter(function(t){return e.getId&&t.getStreamId()===e.getId()},this);return t.length>0?t[0]:null},this.getSpecificRelayForStream=function(e){var t=this.relays.values().filter(function(t){return e.getId&&t.getStreamId()===e.getId()&&t.getDestination()===e.uri},this);return t.length>0?(r.debug("getSpecificRelayForStream ("+e+")found a relay of "+t[0]),t[0]):null},this.getRelayForDestUrl=function(e){var t=function(t){return!(!t.getParticipant||t.getParticipant().getUri()!==e)||t===e},i=this.relays.values().filter(function(e){var i=e.getDestination();return Array.isArray(i)?i.filter(t).length>0:t(i)},this);return i.length>0?i[0]:null},this.getRelay=function(){return this.relays.get("r1-"+this.startTime)}};d.prototype={end:function(e){this.session.sessionState!==o.SESSIONSTATE.CLOSED&&this.session.sessionState!==o.SESSIONSTATE.FAILED&&this.streams.size()>0&&(r.info("Begin to remove all participants",this),s.sendRemoveAllParticipants(this),this.streams.values().forEach(function(t){t.end(e)})),this.participants.clear(),this.remove()},getInitiator:function(){return this.initiator},getTopic:function(){return this.decodeConversationTopic()},getKey:function(){return this.conversationKey},getChannel:function(){return this.conversationChannel},getContext:function(){return this.webContext},addParticipant:function(e,t,i){var o=this.localAddParticipant(e);return t||(t=this.getDefaultStreamOptions()),o.localAddStreamInfo(null,null,t,i),this.streams.size()>0&&(r.info("Begin to add participant: "+e,this),s.sendAddParticipant(this,o)),o},getParticipants:function(){return this.participants.values()},getParticipant:function(e){return this.participants.values().find(function(t){return t.uri===e},this)},getLocalParticipant:function(){return this.getParticipant(this.getLocalParticipantUri())},getRemoteParticipant:function(){for(var e=this.getParticipants(),t=0;t<e.length;t++)if(this.getLocalParticipantUri()!==e[t].getUri())return e[t];return null},getLocalParticipantUri:function(){return this.session.userName},showParticipantsAndStreams:function(e){console.log("---\x3e "+e);for(var t=this.getParticipants(),i=0;i<t.length;i++){var o;o=this.getLocalParticipantUri()===t[i].getUri()?"- Local Participant ["+i+"]: ":"- Remote Participant ["+i+"]: ",r.debug(o);for(var n=0;n<t[i].getStreamInfos().length;n++)r.debug("    - Stream["+n+"]: "+JSON.stringify(t[i].getStreamInfos()[n].toJSON()))}},getAudioVideoStream:function(e){if(!e){var t=this.streams.values().filter(function(e){return e.getType()===o.STREAMTYPE.AUDIOVIDEO&&!e.getStreamState().isFinalState()});t.length>0&&(e=t[0].streamId)}return this.getStreamForId(e)},getScreenShareStream:function(e){if(!e){var t=this.streams.values().filter(function(e){return e.getType()===o.STREAMTYPE.SCREENSHARE&&!e.getStreamState().isFinalState()});t.length>0&&(e=t[0].streamId)}return this.getStreamForId(e)},offerOutboundScreenShare:function(e,t,i){var n=i||this.getRemoteParticipant();if(n){var a=n.getStreamInfos()[0],l=n.getUri();r.debug("offerOutboundScreenShare to remote participant: "+l);var c=this.getRelayForStream(a);null===c?c=this.createRelay(a.getId(),a):r.debug("Found relay with id: "+c.getId());var d=[{stream_type:o.STREAMTYPE.SCREENSHARE,stream_options:{audio:o.MEDIADIRECTION.NONE,video:o.MEDIADIRECTION.SENDONLY}}],u=c.createCommand(o.CONVERSATION.REMOTE_ADD_STREAM,d).withCallbacks(e,t);this.isShortCircuit()?(r.debug("offerOutboundScreenShare: Short-circuit conversation - creating sidebar before requesting outbound stream"),s.sendCreateSidebar(this),this.pendingAddStreamRelay=u):(r.debug("offerOutboundScreenShare: Sending relay to request outbound stream"),u.send())}else r.info("offerOutboundScreenShare: no remote participant - cannot request outbound stream"),"function"==typeof t&&t("no remote participant")},annotateCustomerStream:function(e,t,i,n,a,s){r.debug("annotateCustomerStream");var l=n||this.getRemoteParticipant();if(l){var c=l.getUri();r.debug("annotateCustomerStream to remote participant: "+c),l.conversation.showParticipantsAndStreams("AnnotateCustomerStream");var d=null;s&&(d=l.getStreamInfos().find(s)),d||(r.debug("No stream found; Selecting first stream (Index: [0])"),d=l.getStreamInfos()[0]),r.debug("remoteParticipant stream found: "+JSON.stringify(d.asJSON()));var u=this.getRelayForStream(d);null===u?(r.debug("creating new relay with streamId: "+d.getId()),u=this.createRelay(d.getId(),d)):r.debug("Found relay with id: "+u.getId()),u.createCommand(o.CONVERSATION.ANNOTATE_CUSTOMER_STREAM,e).withOrigStreamOptionsCallback(a).withDestStreamOptionsCallback(s).withCallbacks(t,i).send()}},getStreams:function(){return this.streams.values()},isEstablished:function(){var e=this.streams.values().some(function(e){return e.getStreamState().hasEstablished()});return r.debug("Conversation.isEstablished: "+e),e},updateStreamId:function(e,t){this.streams.remove(t),this.streams.put(e.streamId,e)},toJSON:function(){return{conversationKey:this.conversationKey,conversationTopic:this.conversationTopic,initiator:this.initiator,conversationChannel:this.conversationChannel,joiningConversation:this.joiningConversation,shortCircuitMode:this.shortCircuitMode,streams:this.streams,relays:this.relays,startTime:this.startTime,onRecordingStatusChange:this.onRecordingStatusChange,onParticipantChange:this.onParticipantChange,onError:this.onError,onEnquiryResponse:this.onEnquiryResponse,subSessionId:this.subSessionId,participants:this.participants,recording:this.recording,recordingRules:this.recordingRules,alwaysRecordOnCreation:this.alwaysRecordOnCreation,neverRecordOnCreation:this.neverRecordOnCreation,sentAutomaticRecordingRequest:this.sentAutomaticRecordingRequest,recordingStyle:this.recordingStyle,lastRemovedParticipant:this.lastRemovedParticipant,pendingTargetURI:this.pendingTargetURI,pendingTargetStreamId:this.pendingTargetStreamId,pendingTargetStreamOptions:this.pendingTargetStreamOptions,pendingTargetStreamProfile:this.pendingTargetStreamProfile,webContext:this.webContext,pendingAVStreams:this.pendingAVStreams,iceCheckInterval:this.iceCheckInterval,pendingAddStreamRelay:this.pendingAddStreamRelay,sidebarId:this.sidebarId,clientId:this.clientId,clientVersion:this.clientVersion}},onMessage:function(e){if(r.debug("Received "+e.control.type+" with action: "+e.header.action,this),e.isReliableRelay())s.doReliableRelay(this,e);else if(e.isRequest())s.doRequest(this,e);else if(e.isResponse())s.doResponse(this,e);else if(e.isMessage())s.doMessage(this,e);else if(e.isError())s.doError(this,e);else{var t=this.getAudioVideoStream().call;t&&t.onMessage(e)}},startRecording:function(){r.info("Begin to start recording",this),this.streams.size()>0?s.sendBeginRecording(this):(r.debug("Will start recording conversation on creation"),this.alwaysRecordOnCreation=!0)},stopRecording:function(){r.info("Begin to stop recording",this),this.streams.size()>0?s.sendEndRecording(this):(r.debug("Will NOT start recording conversation on creation"),this.neverRecordOnCreation=!0)},isRecording:function(){return this.recording},switchToSidebar:function(){s.sendCreateSidebar(this)},checkStatus:function(e,t){this.statusCheckSuccess=e,this.statusCheckTimeout&&clearTimeout(this.statusCheckTimeout),this.statusCheckTimeout=setTimeout(function(){r.info("Failed to get status check response"),"function"==typeof t&&t("Timeout")},5e3),s.sendConversationEnquiry(this)},addRemainingStreams:function(){var e=this;if(this.pendingAddStreamRelay){r.debug("addRemainingStreams: pendingAddStreamRelay");var t=this.getRemoteParticipant(),i=null;t&&((i=t.getStreamInfos().find(function(t){return null!==e.getRelayForStream(t)}))&&t.getStreamInfos().forEach(function(t){e.createRelay(t.getId(),t,i.getId())})),s.sendDelayedAddStreamRequest(this)}else this.addStreamShareResolve?(r.debug("addRemainingStreams: addStreamScreenSharePromise"),this.addStreamShareResolve(this.screenShareValues),this.addStreamScreenSharePromise=null,this.addStreamShareResolve=null,this.screenShareValues=null):r.debug("addRemainingStreams: default else")},relayCommandTo:function(e,t,i,o){if(!this.conversationKey)return r.warn("Failed to relay command: "+i+" - conversation not established"),null;if(!e){var n=this.getAudioVideoStream();n&&(e=n.getId())}if(!e){var a=this.getScreenShareStream();a&&(e=a.getId())}return e?this.createRelay(e,t).createRelayMessage().withCommand(i,o).send():(r.warn("Failed to relay command: "+i+" - invalid stream"),null)},relayTextTo:function(e,t,i,o){return this.conversationKey?(e||(e=this.getAudioVideoStream().getId()),this.createRelay(e,t).createRelayMessage().withText(i,o).send()):(r.warn("Failed to relay text: "+o+" - conversation not established"),null)},relayDataTo:function(e,t,i,o){return this.conversationKey?(e||(e=this.getAudioVideoStream().getId()),this.createRelay(e,t).createRelayMessage().withData(i,o).send()):(r.warn("Failed to relay data: "+i+" - conversation not established"),null)}};var u=function(e,t,i){this.audio=e,this.video=t,this.reason=i,this.pausedBy=null};u.prototype={toJSON:function(){return{audio:this.audio,video:this.video,reason:this.reason?this.reason:""}}};var h=function(e,t,i,o){this.upgraded=e&&"true"===e.toString(),this.paused=t&&"true"===t.toString(),this.paused_by=i||"",this.pauseResume=o};h.create=function(t){var i=new e.PauseResume(o.PAUSERESUME.RESUME,o.PAUSERESUME.RESUME,null);if(t){var n=t.paused_by?t.paused_by:"";return t.pause_resume_audio&&t.pause_resume_video?i=new e.PauseResume(t.pause_resume_audio,t.pause_resume_video,t.pause_resume_reason):t.pauseResume&&t.pauseResume.audio&&t.pauseResume.video?i=new e.PauseResume(t.pauseResume.audio,t.pauseResume.video,t.pauseResume.reason):(t.upgraded=!0,t.paused=!1),new e.StreamProfile(t.upgraded,t.paused,n,i)}return new e.StreamProfile(!0,!1,"",i)},h.prototype={toJSON:function(){return{upgraded:this.upgraded,paused:this.paused,paused_by:this.paused_by,pause_resume_audio:this.pauseResume.audio,pause_resume_video:this.pauseResume.video,pause_resume_reason:this.pauseResume.reason?this.pauseResume.reason:""}},updateForPauseResume:function(t,i){var n=t.audio===o.PAUSERESUME.PAUSE&&t.video===o.PAUSERESUME.PAUSE;this.pauseResume=new e.PauseResume(t.audio,t.video,t.reason),t.reason===o.PAUSERESUMEREASON.UPGRADE_DOWNGRADE?this.upgraded=t.video===o.PAUSERESUME.RESUME:(this.paused=n,this.paused_by=i&&n?i:"")}};var p=function(t,i,n,a,s){this.participant=t,this.uri=this.participant.getUri(),this.streamId=i,this.streamType=n,this.streamLayout=o.STREAMSIZE.MIN,this.recording=!1,this.PAUSED=new e.StreamOptions(o.MEDIADIRECTION.NONE,o.MEDIADIRECTION.NONE),this.streamProfile=h.create(s),this.streamOptions=this.PAUSED,this.qualityMonitor=null,this.active=!1,this.localSetStreamOptions=function(e){if(e){var t=e.audio,i=e.video,o=e.audioConfig,n=e.videoConfig;e=t&&i?p.createStreamOptions(t,i):o&&n?p.createStreamOptions(o,n):this.participant.conversation.getDefaultStreamOptions()}else e=this.participant.conversation.getDefaultStreamOptions();r.debug("Changing options for stream: "+this.streamId+", options="+JSON.stringify(e,null,2)),this.streamOptions=e},this.localSetStreamOptions(a),this.localSetStreamLayout=function(e){null!==e&&r.debug("Changing layout '"+e+"' for stream: "+this.streamId),this.streamLayout=e},this.localSetStreamProfile=function(t){r.debug("Changing profile '"+JSON.stringify(t,null,2)+"' for stream: "+this.streamId),this.streamProfile=e.StreamProfile.create(t)},this.localSetRecording=function(e){this.recording=e,this.recording?r.debug("Participant "+this.participant.uri+" is being recorded"):r.debug("Participant "+this.participant.uri+" is not being recorded")},this.localSetActive=function(e){this.active=e,r.debug("Participant "+this.participant.uri+" stream: "+this.streamId+(e?" is active":" is not active"))},this.asJSON=function(){return{stream_id:this.streamId,stream_type:this.streamType,stream_options:this.streamOptions.asJSON(),stream_profile:this.streamProfile}}};p.prototype={toJSON:function(){return{uri:this.uri,streamId:this.streamId,streamType:this.streamType,streamLayout:this.streamLayout,recording:this.recording,streamOptions:this.streamOptions,active:this.active,streamProfile:this.streamProfile}},getParticipant:function(){return this.participant},getId:function(){return this.streamId},getType:function(){return this.streamType},getStreamOptions:function(){return this.streamOptions},getStreamProfile:function(){return this.streamProfile},pauseResumeStream:function(e,t,i){r.debug("pauseResumeStream: pauseResume="+JSON.stringify(this.streamProfile.pauseResume,null,2)+", pauseResumeTargets="+JSON.stringify(e,null,2));var o=this.participant.conversation.getLocalParticipantUri();return this.participant.getUri()!==o?s.sendPauseResume(this.participant.conversation,this,e,t,i):(r.debug("Pausing/Resuming audio/video tracks in stream: "+this.streamId,e),void this.participant.conversation.getAudioVideoStream(this.streamId).pauseResumeStream(e,t,i))},cancelPauseResumeStream:function(e,t){return r.debug("cancelPauseResumeStream"),s.sendCancelRequest(this.participant.conversation,this,o.CONVERSATION.PAUSE_RESUME_STREAM,e,t)},cancelAddStream:function(e,t){return r.debug("cancelAddStream"),s.sendCancelRequest(this.participant.conversation,this,o.CONVERSATION.ADD_STREAM,e,t)},setStreamOptions:function(e,t,i){if(e||(r.debug("Pausing media for stream: "+this.streamId),e=this.PAUSED),s.isPauseResume(this.streamOptions,e))return this.pauseResumeStream(s.getPauseResumeTargets(e),t,i);var n,a=this.participant.getStreamInfos().some(function(e){return e.getStreamOptions().videoConfig===o.MEDIADIRECTION.SENDONLY||e.getStreamOptions().videoConfig===o.MEDIADIRECTION.RECVONLY}),l=e.videoConfig===o.MEDIADIRECTION.SENDONLY;return this.participant.getUri()!==this.participant.conversation.getLocalParticipantUri()?this.participant.conversation.isShortCircuit()?(r.debug("Short-circuit, checking video options: "+e.videoConfig),n=p.createStreamOptions(e.audioConfig,e.videoConfig),a&&l?n.videoConfig=o.MEDIADIRECTION.SENDRECV:a&&!l&&(r.debug("Single video downgrade, do not swap directions"),n.videoConfig=o.MEDIADIRECTION.NONE),s.sendStreamOptions(this.participant.conversation,this,n,t,i)):s.sendStreamOptions(this.participant.conversation,this,e,t,i):(r.debug("Updating local AV stream with new stream options: "+JSON.stringify(e,null,2)),n=p.createStreamOptions(e.audioConfig,e.videoConfig),this.participant.conversation.isShortCircuit()&&(a&&l?n.videoConfig=o.MEDIADIRECTION.SENDRECV:a&&!l&&(n.videoConfig=o.MEDIADIRECTION.NONE)),void this.participant.conversation.getAudioVideoStream(this.streamId).update(n,t,i))},getLayout:function(){return this.streamLayout},setLayout:function(e,t){this.localSetStreamLayout(e),s.sendStreamLayout(this.participant.conversation,this,e,t)},isRecording:function(){return this.recording},isActive:function(){return this.active},startRecording:function(){r.info("Begin to start recording stream: "+this.streamId,this),s.sendBeginRecording(this.participant.conversation,this)},stopRecording:function(){r.info("Begin to stop recording stream: "+this.streamId,this),s.sendEndRecording(this.participant.conversation,this)},remove:function(){this.participant.streams.size()>1?(r.info("Begin to remove stream: "+this.streamId,this),s.sendRemoveParticipant(this.participant.conversation,this.participant,this)):this.participant.remove()},isAudioPaused:function(){return this.streamProfile&&this.streamProfile.pauseResume&&this.streamProfile.pauseResume.audio===o.PAUSERESUME.PAUSE},isVideoPaused:function(){return this.streamProfile&&this.streamProfile.pauseResume&&this.streamProfile.pauseResume.video===o.PAUSERESUME.PAUSE},getQualityMonitor:function(){return this.qualityMonitor||(this.qualityMonitor=new e.QualityMonitor(this))}},p.createStreamOptions=function(t,i){var n=function(e){var t=o.MEDIADIRECTION.NONE;switch(e.toLowerCase()){case"inactive":case"none":t=o.MEDIADIRECTION.NONE;break;case"sendonly":t=o.MEDIADIRECTION.SENDONLY;break;case"recvonly":t=o.MEDIADIRECTION.RECVONLY;break;case"sendrecv":t=o.MEDIADIRECTION.SENDRECV}return t},a=n(t),r=n(i);return new e.StreamOptions(a,r)};var v=function(t,i){this.streams=new e.Map,this.removedStreams=[],this.conversation=t,this.uri=i,r.debug("Participant with URI: "+this.uri),this.onParticipantStateChange=null,this.onAddStream=null,this.onAddRemoteStream=null,this.localAddStreamInfo=function(t,i,n,a){t||(t=this.conversation.generateStreamId(i)),i||(i=o.STREAMTYPE.AUDIOVIDEO),n||(n=this.conversation.getDefaultStreamOptions()),a?a=e.StreamProfile.create(a):(a=e.StreamProfile.create()).upgraded=n.shouldSendVideo(),r.debug("Creating StreamInfo: id="+t+", URI="+this.uri+", type="+i+", options="+JSON.stringify(n,null,2)+", profile="+JSON.stringify(a,null,2));var s=new e.StreamInfo(this,t,i,n,a);return this.streams.put(t,s),r.debug("Found stream length after adding "+this.streams.values().length),s},this.notRemovedStream=function(e){return-1===this.removedStreams.indexOf(e)},this.localRemoveStreamInfo=function(e){return this.streams.remove(e)&&(this.removedStreams.push(e),r.debug("Removed StreamInfo with ="+this.uri+"/"+e)),this.streams.size()}};v.prototype={initCallbacks:function(e,t,i){r.debug("Initialise callbacks for participant: "+this.uri),this.onParticipantStateChange=e,this.onAddStream=t,this.onAddRemoteStream=i},remove:function(e){this.conversation.localRemoveParticipant(this.uri),this.conversation.streams.size()>0&&(this.uri===this.conversation.getLocalParticipantUri()?(this.conversation.streams.values().forEach(function(t){t.end(e)}),this.conversation.remove()):(r.info("Begin to remove participant: "+this.uri,this),s.sendRemoveParticipant(this.conversation,this)))},asJSONArray:function(e){for(var t=this.streams.values(),i=[],o=0;o<t.length;o++){var n={uri:this.uri,stream_id:t[o].getId(),stream_type:e||t[o].getType(),stream_options:t[o].getStreamOptions().asJSON(),stream_profile:t[o].getStreamProfile()},a=t[o].getLayout();a&&(n.size=a),i.push(n)}return i},toJSON:function(){return{streams:this.streams,uri:this.uri,onParticipantStateChange:this.onParticipantStateChange,onAddStream:this.onAddStream,onAddRemoteStream:this.onAddRemoteStream}},getUri:function(){return this.uri},getStreamInfos:function(){return this.streams.values()},getStreamInfo:function(e){var t=this.streams.get(e);return t||"default"!==e||(t=this.streams.get("av1")),t},isRecording:function(){var e=!1;return this.streams.values().forEach(function(t){t.isRecording()&&(e=!0)}),e},addScreenShareStream:function(e,t,i,n,a){if(this.uri===this.conversation.getLocalParticipantUri())return this.conversation.createScreenShareStream(e,n,a);var r=p.createStreamOptions(o.MEDIADIRECTION.INACTIVE,o.MEDIADIRECTION.SENDONLY);return s.sendAddStream(this.conversation,this,o.STREAMTYPE.SCREENSHARE,r,t,i),!0},addAudioVideoStream:function(e,t,i,n,a){return this.uri===this.conversation.getLocalParticipantUri()?this.conversation.createAudioVideoStream(e,t,a):(s.sendAddStream(this.conversation,this,o.STREAMTYPE.AUDIOVIDEO,e,i,n),!0)}};var g=function(e,t,i,o){this.conversation=e,this.call=t,this.call.avStream=this,this.streamId=i,this.extHeaders=null,this.localMediaStreams=null,this.streamInfo=o,this.onPauseResumeStream=null,this.onUpdateStreamOptions=null,this.onQualityMetrics=null};g.prototype={toJSON:function(){return{call:this.call,streamId:this.streamId,extHeaders:this.extHeaders,localMediaStreams:this.localMediaStreams,streamInfo:this.streamInfo,onPauseResumeStream:this.onPauseResumeStream,onUpdateStreamOptions:this.onUpdateStreamOptions}},withCallbacks:function(e,t,i,o,n,a){return this.call.onCallStateChange=e,this.call.onMediaStreamEvent=t,this.call.onUpdate=i,this.call.onCallError=o,this.onPauseResumeStream=n,this.onUpdateStreamOptions=a,this},getConversation:function(){return this.conversation},getId:function(){return this.streamId},getType:function(){return o.STREAMTYPE.AUDIOVIDEO},getStreamOptions:function(){return this.call.callConfig},getStreamState:function(){return this.call.callState},getStreamInfo:function(){return this.streamInfo},isAudioPaused:function(){return this.streamInfo&&this.streamInfo.isAudioPaused()},isVideoPaused:function(){return this.streamInfo&&this.streamInfo.isVideoPaused()},mute:function(e){return r.debug("Muting stream? "+e),this.call.mute(e)},isMuted:function(){return this.call.isMuted()},getRemoteStreams:function(){return a.getRemoteStreams(this.call.peerConnection)},getLocalStreams:function(){return a.getLocalStreams(this.call.peerConnection)},extractVideoForPreview:function(){var e=this.call.peerConnection;e.getSenders().map(function(t){t.track&&"video"===t.track.kind&&e.removeTrack(t)});var t=this.call.localMediaStreams[0];return"undefined"!=typeof RTCRtpSender&&t instanceof RTCRtpSender?t.track&&"video"===t.track.kind&&(t.track.enabled=!0):t.getVideoTracks().map(function(e){e.enabled=!0}),t},addbackVideoAfterPreview:function(e){var t=this.call.localMediaStreams[0],i=this.call.peerConnection;"undefined"!=typeof RTCRtpSender&&t instanceof RTCRtpSender?t.track&&"video"===t.track.kind&&(t.track.enabled=e,i.addTrack(t.track,t)):t.getVideoTracks().map(function(o){o.enabled=e,i.addTrack(o,t)})},start:function(e,t){return this.localMediaStreams=e,this.extHeaders=t,!this.conversation.recordingRules&&s.retrieveRecordingRules(this.conversation)?this.conversation.pendingAVStreams.push(this):s.sendStartRequest(this),this},end:function(e){s.sendEndRequest(this,e)},decline:function(e,t){s.sendDeclineResponse(this,e,t)},accept:function(e,t,i){s.sendAcceptResponse(this,e,t,i)},update:function(e,t,i,o,n){return r.debug("Attempting to update AV stream"),this.call.canUpdate()?(s.isPauseResume(this.getStreamOptions(),e)?this.pauseResumeStream(s.getPauseResumeTargets(e),o,n):(s.sendUpdateRequest(this,e,t,i),"function"==typeof o&&o(!0)),!0):(r.info("Cannot update call - not in correct ICE state: "+this.call.getIceConnectionState()+", call state: "+this.call.getCallState().state,this.call),"function"==typeof n&&n(!1),!1)},pauseResumeStream:function(e,t,i){var n=e.audio===o.PAUSERESUME.PAUSE,a=e.video===o.PAUSERESUME.PAUSE;return r.debug("pauseResumeStream: pauseResume="+JSON.stringify(this.streamInfo.streamProfile.pauseResume,null,2)+", pauseResumeTargets="+JSON.stringify(e,null,2)),r.debug((n?"Pausing":"Resuming")+" audio tracks in AV stream"),r.debug((a?"Pausing":"Resuming")+" video tracks in AV stream"),s.pauseResumeLocalAVStream(this,e),"function"==typeof t&&t(!0),!0},resume:function(e,t){var i=this;r.info("Begin to resume AV stream",i),new Promise(function(e,t){i.call.resume(e,t)}).then(function(){if(r.info("AV stream resumed"),i.isVideoPaused()||i.isAudioPaused()){var t=i.getStreamInfo().getStreamProfile().pauseResume;s.enableDisableTracks(i,t),r.info("Resumed AV stream is paused")}e()}).catch(t)}};var m=function(e,t,i,o){this.conversation=e,this.call=t,this.call.avStream=this,this.streamId=i,this.extHeaders=null,this.localMediaStreams=null,this.streamInfo=o,this.onPauseResumeStream=null,this.onUpdateStreamOptions=null};m.prototype={toJSON:function(){return{call:this.call,streamId:this.streamId,extHeaders:this.extHeaders,localMediaStreams:this.localMediaStreams,streamInfo:this.streamInfo,onPauseResumeStream:this.onPauseResumeStream,onUpdateStreamOptions:this.onUpdateStreamOptions}},withCallbacks:function(e,t,i,o,n,a){return this.call.onCallStateChange=e,this.call.onMediaStreamEvent=t,this.call.onUpdate=i,this.call.onCallError=o,this.onPauseResumeStream=n,this.onUpdateStreamOptions=a,this},getConversation:function(){return this.conversation},getId:function(){return this.streamId},getType:function(){return o.STREAMTYPE.SCREENSHARE},getStreamOptions:function(){return this.call.callConfig},getStreamState:function(){return this.call.callState},getStreamInfo:function(){return this.streamInfo},isAudioPaused:function(){return this.streamInfo&&this.streamInfo.isAudioPaused()},isVideoPaused:function(){return this.streamInfo&&this.streamInfo.isVideoPaused()},mute:function(e){return r.debug("Muting stream? "+e),this.call.mute(e)},isMuted:function(){return this.call.isMuted()},getRemoteStreams:function(){return a.getRemoteStreams(this.call.peerConnection)},getLocalStreams:function(){return a.getLocalStreams(this.call.peerConnection)},start:function(e,t){return this.localMediaStreams=e,t||(t=JSON.parse("{}")),this.extHeaders=t,this.conversation.joiningConversation||this.conversation.recordingRules?s.sendStartRequest(this):s.retrieveRecordingRules(this.conversation)&&this.conversation.pendingAVStreams.push(this),this},end:function(e){s.sendEndRequest(this,e)},accept:function(e,t,i){s.sendAcceptResponse(this,e,t,i)},decline:function(e,t){s.sendDeclineResponse(this,e,t)},update:function(e,t,i,o,n){return r.debug("Attempting to update SS stream"),this.call.canUpdate()?(s.isPauseResume(this.getStreamOptions(),e)?this.pauseResumeStream(s.getPauseResumeTargets(e),o,n):(s.sendUpdateRequest(this,e,t,i),"function"==typeof o&&o(!0)),!0):(r.info("Cannot update call - not in correct ICE state: "+this.call.getIceConnectionState()+", call state: "+this.call.getCallState().state,this.call),"function"==typeof n&&n(!1),!1)},pauseResumeStream:function(e,t,i){var n=e.audio===o.PAUSERESUME.PAUSE,a=e.video===o.PAUSERESUME.PAUSE;return r.debug("pauseResumeStream: pauseResume="+JSON.stringify(this.streamInfo.streamProfile.pauseResume,null,2)+", pauseResumeTargets="+JSON.stringify(e,null,2)),this.streamInfo&&this.streamInfo.streamProfile&&this.streamInfo.streamProfile.pauseResume&&e.audio===this.streamInfo.streamProfile.pauseResume.audio&&e.video===this.streamInfo.streamProfile.pauseResume.video?(e.audio===this.streamInfo.streamProfile.pauseResume.audio&&r.debug("AV stream audio tracks already "+(n?"paused":"resumed")),e.video===this.streamInfo.streamProfile.pauseResume.video&&r.debug("AV stream video tracks already "+(a?"paused":"resumed")),s.enableDisableTracks(this,e)):(r.debug((n?"Pausing":"Resuming")+" audio tracks in AV stream"),r.debug((a?"Pausing":"Resuming")+" video tracks in AV stream"),s.pauseResumeLocalAVStream(this,e)),"function"==typeof t&&t(!0),!0},resume:function(e,t){var i=this;r.info("Begin to resume SS stream",i),new Promise(function(e,t){i.call.resume(e,t)}).then(function(){if(r.info("SS stream resumed"),i.isVideoPaused()||i.isAudioPaused()){var t=i.getStreamInfo().getStreamProfile().pauseResume;s.enableDisableTracks(i,t),r.info("Resumed SS stream is paused")}e()}).catch(t)}};var f=function(t,i,o,n){this.conversation=t,this.responseHandler=null,this.retryHandler=null,this.timeoutHandler=null,this.errorHandler=null,this.relayId=n,this.retries=1,this.timeout=10,this.streamId=i,this.relayDest=o,this.relayMessages=new e.Map,this.timer=null;var a=new Date;this.startTime=""+a.getHours()+a.getMinutes()+a.getSeconds()+a.getMilliseconds()};f.prototype={toJSON:function(){return{responseHandler:this.responseHandler,retryHandler:this.retryHandler,timeoutHandler:this.timeoutHandler,errorHandler:this.errorHandler,relayId:this.relayId,retries:this.retries,timeout:this.timeout,streamId:this.streamId,relayDest:this.relayDest,relayMessages:this.relayMessages,timer:this.timer,startTime:this.startTime}},withCallbacks:function(e,t){return this.responseHandler=e,this.errorHandler=t,this},withTimeout:function(e,t){return t&&(this.timeoutHandler=t),this.timeout=e,this},withRetries:function(e,t){t&&(this.retryHandler=t),this.retries=e},getConversation:function(){return this.conversation},getId:function(){return this.relayId},getDestination:function(){return this.relayDest},getStreamId:function(){return this.streamId},createRelayRequest:function(t){t||(r.debug("Calling generateRelayMessageId with type: "+o.TYPE.REQUEST),t=this.generateRelayMessageId(o.TYPE.REQUEST));var i=new e.RelayMessage(this,o.TYPE.REQUEST,t);return this.relayMessages.put(t,i),i},createRelayMessage:function(t){return t||(r.debug("Calling generateRelayMessageId with type: "+o.TYPE.MESSAGE),t=this.generateRelayMessageId(o.TYPE.MESSAGE)),new e.RelayMessage(this,o.TYPE.MESSAGE,t)},createSubsequentRelayResponse:function(t){return new e.RelayMessage(this,o.TYPE.RESPONSE,t.header.relay.msgId)},createFinalRelayResponse:function(t){return new e.RelayMessage(this,o.TYPE.RESPONSE,t).asFinalMessage()},createRelayError:function(t){return new e.RelayMessage(this,o.TYPE.ERROR,t)},generateRelayMessageId:function(e){var t=this.relayMessages.values().filter(function(t){return t.getMessageType()===e}).length;r.debug("Found "+t+" messages with type: "+e);var i="rly-";return e===o.TYPE.REQUEST?i+="req":e===o.TYPE.RESPONSE?i+="res":e===o.TYPE.ERROR?i+="err":e===o.TYPE.MESSAGE&&(i+="msg"),i+(t+1)+"-"+this.startTime},getRelayMessageForId:function(e){return this.relayMessages.get(e)},end:function(){clearInterval(this.timer),this.conversation.relays.remove(this.relayId)},send:function(e){if(e.isRequest()&&(e.updateTimestamp(),void 0===e.retryCount||null===e.retryCount?(e.retryCount=0,r.debug("Relay sending message: id="+e.getId())):(e.retryCount++,r.debug("Relay sending message: id="+e.getId()+", retry="+e.retryCount))),this.conversation.session.sendMessage(e.getMessage(!1)),e.isRequest()){var t=this;this.timer||(r.debug("Relay "+this.relayId+" starting interval timer for tracking timeouts"),this.timer=setInterval(function(){t.handleIntervalTimeout()},1e3))}return e},handleIntervalTimeout:function(){r.debug("handleIntervalTimeout...");var e=Date.now();if(0===this.relayMessages.size())r.debug("Relay.handleIntervalTimeout no messages being tracked. Stopping interval timer"),clearInterval(this.timer),this.timer=null;else{var t,i,o=this.relayMessages.keys(),n=o.length;r.debug("Relay.handleIntervalTimeout tracking "+n+" relay messages"),o.forEach(function(o){r.debug("Found key="+o+" in relayMessages cache");var a=this.relayMessages.get(o);if(a.gotAllResponses)return r.debug("Got all responses"),void(n-=1);var s=!1,l=1,c=[];if(a&&a.gotRelayResponses)for(l=(c=Object.keys(a.gotRelayResponses)).length,r.debug("Message sent to "+l+" destinations"),t=0;t<c.length;t++)i=c[t],r.debug("relayMessage.gotRelayResponses["+i+"] is set to '"+a.gotRelayResponses[i]+"'"),!0===a.gotRelayResponses[i]&&(s=!0);if(a){var d=e-a.getTimestamp(),u=d/1e3,h=a.timeout;null===h&&(h=this.timeout);var p=a.retries;if(null===p&&(p=this.retries),r.debug("elapsedSeconds="+u),r.debug("       timeout="+h),s){if(u>=h){for(r.debug("Only some relay destinations have responded. Creating separate relays for re-sends"),t=0;t<c.length;t++)if(i=c[t],!1===a.gotRelayResponses[i]){var v=this.getConversation().createRelay(this.streamId,i),g=this.createRelayRequest().withMessage(a);v.send(g)}r.debug("Removing Relay Message "+o+" from cache"),this.relayMessages.remove(o)}}else c.length>1&&r.debug("All relay destinations have not responded"),r.debug("Found cached relay with msgId="+a.getId()+" key="+o),u>=h&&(r.debug("relayMessage.retryCount="+a.retryCount),r.debug("                retries="+p),a.retryCount>=p?(r.debug("Relay: relay message has timed out after "+a.retryCount+" reattempt(s): id="+a.getId()),a.timeoutHandler&&a.timeoutHandler(d,a.retryCount,a),this.timeoutHandler&&this.timeoutHandler(d,a.retryCount,a),a.resetCount(),r.debug("Removing Relay Message "+o+" from cache"),this.relayMessages.remove(o)):(r.debug("Relay: About to retry sending timed out message. Calling retry handlers..."),a.retryHandler&&a.retryHandler(d,a.retryCount,a),this.retryHandler&&this.retryHandler(d,a.retryCount,a),r.debug("relay: re-sending timed out relay message: id="+a.getId()+", reattempts="+a.retryCount),this.send(a)))}},this),n<=0&&(r.debug("Relay.handleIntervalTimeout no messages being tracked. Stopping interval timer"),clearInterval(this.timer),this.timer=null)}},createCommand:function(e,t){return this.createRelayRequest().withCommand(e,t)},createText:function(e,t){return this.createRelayRequest().withText(e,t)},createData:function(e,t){return this.createRelayRequest().withData(e,t)},close:function(){var e=this.createRelayRequest().asFinalMessage();this.send(e)},respond:function(e){var t=this.createSubsequentRelayResponse(e);this.send(t)},processSubsequentResponse:function(e){r.debug("Relay "+this.getId()+" processing subsequent response...");var t=e.header.relay.msgId,i=e.header.relay.from;r.debug("  msgId = "+t);var o=this.getRelayMessageForId(t),n=[],a=1;if(o){o.gotRelayResponses&&(a=(n=Object.keys(o.gotRelayResponses)).length,r.debug("Message was sent to "+a+" destinations")),o.receivedResponseFrom(i);var s=0;if(a>1)for(var l=0;l<n.length;l++){var c=n[l];r.debug("processSubsequentResponse: gotRelayResponses["+c+"] is set to '"+o.gotRelayResponses[c]+"'"),o.gotRelayResponses[c]&&s++}1===a||s===a?(r.debug("Got all expected responses"),o.gotAllResponses=!0):r.debug("Number of destinations="+a+", number of responses received="+s)}},processFinalResponse:function(e){r.debug("Relay "+this.getId()+" processing final response...");var t=e.header.relay.msgId,i=e.header.relay.from,o=e.header.relay.messages[0].commands[0];null===o&&(o=e.header.relay.messages[0].text[0]),null===o&&(o=e.header.relay.messages[0].data[0]),r.debug("  msgId = "+t);var n=this.getRelayMessageForId(t),a=[],s=1;if(n){n.gotRelayResponses&&(s=(a=Object.keys(n.gotRelayResponses)).length,r.debug("Message was sent to "+s+" destinations")),n.receivedResponseFrom(i),n.responseHandler&&(r.debug("  Calling user defined RelayMessage.responseHandler"),n.responseHandler(o)),this.responseHandler&&(r.debug("  Calling user defined Relay.responseHandler"),this.responseHandler(o));var l=0;if(s>1)for(var c=0;c<a.length;c++){var d=a[c];r.debug("processFinalResponse: gotRelayResponses["+d+"] is set to '"+n.gotRelayResponses[d]+"'"),n.gotRelayResponses[d]&&l++}r.debug("Number of destinations="+s+", number of responses received="+l),1!==s&&l!==s||(r.debug("  Removing msgId entry from relayMessages request cache"),this.relayMessages.remove(t))}},processError:function(e){r.debug("Relay "+this.getId()+" processing error...");var t=e.header.relay.msgId,i=e.header.relay.from,o=e.header.relay.messages[0].commands[0];null===o&&(o=e.header.relay.messages[0].text[0]),null===o&&(o=e.header.relay.messages[0].data[0]),!o.reason&&e.header.reason&&(o.reason=e.header.reason),e.header.error_code&&(o.error_code=e.header.error_code),r.debug("  msgId = "+t);var n=this.getRelayMessageForId(t),a=[],s=1;if(n){n.gotRelayResponses&&(s=(a=Object.keys(n.gotRelayResponses)).length,r.debug("Message was sent to "+s+" destinations")),n.receivedResponseFrom(i),n.errorHandler&&(r.debug("  Calling user defined RelayMessage.errorHandler with: "+JSON.stringify(o,null,2)),n.errorHandler(o)),this.errorHandler&&(r.debug("  Calling user defined Relay.errorHandler with: "+JSON.stringify(o,null,2)),this.errorHandler(o));var l=0;if(s>1)for(var c=0;c<a.length;c++){var d=a[c];r.debug("processError: gotRelayResponses["+d+"] is set to '"+n.gotRelayResponses[d]+"'"),n.gotRelayResponses[d]&&l++}r.debug("Number of destinations="+s+", number of responses received="+l),1!==s&&l!==s||(r.debug("  Removing msgId entry from relayMessages request cache"),this.relayMessages.remove(t))}}};var S=function(e,t,i){this.relay=e,this.messageId=i,this.responseHandler=null,this.retryHandler=null,this.timeoutHandler=null,this.errorHandler=null,this.retries=null,this.retryCount=null,this.timeout=null,this.final=!1,this.relayDestinations=[],this.excludeDest=null,this.gotRelayResponses=null,this.gotAllResponses=!1,this.timestamp=Date.now(),this.origStreamOptionsCallback=null,this.destStreamOptionsCallback=null,this.messageType=void 0!==t?t:o.TYPE.REQUEST,this.message=null,this.text=null,this.data=null,this.commands=null};S.prototype={toJSON:function(){return{messageId:this.messageId,responseHandler:this.responseHandler,retryHandler:this.retryHandler,timeoutHandler:this.timeoutHandler,errorHandler:this.errorHandler,retries:this.retries,retryCount:this.retryCount,timeout:this.timeout,final:this.final,relayDestinations:this.relayDestinations,gotRelayResponses:this.gotRelayResponses,gotAllResponses:this.gotAllResponses,timestamp:this.timestamp,messageType:this.messageType,message:this.message,origStreamOptionsCallback:this.origStreamOptionsCallback,destStreamOptionsCallback:this.destStreamOptionsCallback,text:this.text,data:this.data,commands:this.commands}},withCallbacks:function(e,t){return r.debug("RelayMessage.withCallbacks: responseHandler="+e),this.responseHandler=e,this.errorHandler=t,this},withTimeout:function(e,t){return t&&(this.timeoutHandler=t),this.timeout=e,this},withRetries:function(e,t){return t&&(this.retryHandler=t),this.retries=e,this},buildMessage:function(e){if(null===this.gotRelayResponses&&(this.relayDestinations=s.determineRelayDestinations(this.getRelay().getConversation(),this.getRelay().getDestination(),this.excludeDest),this.excludeDest=null,this.isRequest())){this.gotRelayResponses={};for(var t=0;t<this.relayDestinations.length;t++){var i=this.relayDestinations[t].uri;this.gotRelayResponses[i]=!1}}null===this.message&&(this.message=s.buildReliableRelayMsg(this,e))},receivedResponseFrom:function(e){r.debug("receivedResponseFrom "+e),e in this.gotRelayResponses&&(r.debug("Marking tracked destination "+e+" as responded"),this.gotRelayResponses[e]=!0)},getConversation:function(){return this.relay.getConversation()},getRelay:function(){return this.relay},getId:function(){return this.messageId},getMessageType:function(){return this.messageType},isRequest:function(){return this.messageType===o.TYPE.REQUEST},isResponse:function(){return this.messageType===o.TYPE.RESPONSE},isError:function(){return this.messageType===o.TYPE.ERROR},isMessage:function(){return this.messageType===o.TYPE.MESSAGE},asFinalMessage:function(){return this.final=!0,this},isFinalMessage:function(){return this.final},getMessage:function(e){return this.buildMessage(e),this.message},resetCount:function(){this.retryCount=null},withText:function(e,t){return r.debug("text relay on thread: "+e+" with content: "+t),this.text||(this.text=[]),this.text.push({thread:e,content:t}),r.debug("total text messages = "+this.text.length),this},withData:function(e,t){return r.debug("data relay for tag: "+e),this.data||(this.data=[]),this.data.push({tag:e,content:t}),r.debug("total data messages = "+this.data.length),this},withCommand:function(e,t){return r.debug("command relay with directive: "+e),this.commands||(this.commands=[]),this.commands.push({directive:e,arguments:[].concat(t)}),r.debug("total command messages = "+this.commands.length),this},withMessage:function(e){return this.message=e.getMessage(!0),this},withOrigStreamOptionsCallback:function(e){return this.origStreamOptionsCallback=e,this},withDestStreamOptionsCallback:function(e){return this.destStreamOptionsCallback=e,this},excludeDestination:function(e){return this.excludeDest=e,this},getOrigStreamOptionsCallback:function(){return this.origStreamOptionsCallback},getDestStreamOptionsCallback:function(){return this.destStreamOptionsCallback},updateTimestamp:function(){this.timestamp=Date.now()},getTimestamp:function(){return this.timestamp},send:function(){this.relay.send(this)},end:function(){r.debug("Removing message id "+this.messageId+" from relay"),this.relay.relayMessages.remove(this.messageId)}};var _=function(e,t,i,o,n){this.relay=e,this.command=t,this.isRequest=i,this.relayMsgId=o,this.relayFrom=n};_.prototype={from:function(){return this.relayFrom},accept:function(e){this.isRequest&&this.relay&&(r.debug("Accepting relay request from: "+this.relayFrom+", for: "+this.command),this.relay.createFinalRelayResponse(this.relayMsgId).withCommand(this.command,[{status:o.RELAYSTATUS.ACCEPTED,info:e}]).send())},decline:function(e){if(this.isRequest&&this.relay){var t=e;t||(t=o.RELAYSTATUS.DECLINED),r.debug("Declining relay request from: "+this.relayFrom+", for: "+this.command),this.relay.createRelayError(this.relayMsgId).withCommand(this.command,[{status:o.RELAYSTATUS.DECLINED,reason:t}]).send()}}};var C=function(e){this.factorMonitors={},this.streamInfo=e,this.onNewInboundFrameRate=null,this.onNewOutboundFrameRate=null,this.onNewInboundResolution=null,this.onNewOutboundResolution=null,this.__audioOutboundRttThreshold=500,this.__videoOutboundRttThreshold=500,this.__videoPacketLossRateThreshold=.3,this.__audioPacketLossRateThreshold=.3,this.__frameRateThreshold=10,this.__jitterThreshold=500,this.__keepCount=3,this.__audioPacketsLostKeepLimit=7,this.__videoPacketsLostKeepLimit=3};return C.prototype={onNewStatus:function(e,t){var i=!1;for(var n in o.ExperienceFactor)if(o.ExperienceFactor.hasOwnProperty(n)&&o.ExperienceFactor[n]===e){this.factorMonitors[e]=t,i=!0;break}i||r.warn("The given factor: "+e+" is not valid.")},withCallbacks:function(e,t,i,o){return this.onNewInboundFrameRate=e,this.onNewOutboundFrameRate=t,this.onNewInboundResolution=i,this.onNewOutboundResolution=o,this},getStreamInfo:function(){return this.streamInfo}},s.isPauseResume=function(e,t){var i=e.shouldSendVideo(),o=t.shouldSendVideo(),n=e.shouldReceiveVideo(),a=t.shouldReceiveVideo(),s=e.shouldSendAudio(),l=t.shouldSendAudio(),c=t.isPaused();return r.debug("isPauseResume: isPaused="+c+", oldAudio="+s+", oldVideo="+i+", oldVideoRecv="+n+", newAudio="+l+", newVideo="+o+", newVideoRecv="+a),!!c||s===l&&i===o&&n===a},s.enableDisableTracks=function(e,t){var i=t.audio===o.PAUSERESUME.PAUSE,n=t.video===o.PAUSERESUME.PAUSE;r.debug((i?"Disable":"Enable")+" audio tracks for stream: "+e.getId()),r.debug((n?"Disable":"Enable")+" video tracks for stream: "+e.getId()),e.paused=t,e.getLocalStreams().map(function(e){"undefined"!=typeof RTCRtpReceiver&&e instanceof RTCRtpReceiver||"undefined"!=typeof RTCRtpSender&&e instanceof RTCRtpSender?e.track&&"audio"===e.track.kind?e.track.enabled=!i:e.track&&"video"===e.track.kind&&(e.track.enabled=!n):(e.getAudioTracks().map(function(e){e.enabled=!i}),e.getVideoTracks().map(function(e){e.enabled=!n}))})},s.pauseResumeLocalAVStream=function(e,t){s.enableDisableTracks(e,t);var i=e.conversation.getLocalParticipantUri();t.pausedBy&&(i=t.pausedBy,t.pausedBy=null),e.streamInfo.streamProfile.updateForPauseResume(t,i),s.sendProfileUpdate(e.conversation,e.streamInfo)},s.relayStreamEvent=function(e,t,i){var o=e.conversation.getRelayForDestUrl("*");null===o&&(o=e.conversation.createRelay(e.getId(),"*")),o.createRelayMessage().withCommand(t,i).send()},s.handleParticipantChange=function(t,i,n,a,s){r.debug("handleParticipantChange: uri="+n+", change="+i,a);var l,c,d,u=!1,h=o.CONVERSATIONSTATE.STREAM_CHANGED;switch(i){case o.CONVERSATION.ADD_STREAM:if(t.__participantsHistory.indexOf(n)<0&&t.__participantsHistory.push(n),(l=t.getParticipant(n))||(u=!0,l=t.localAddParticipant(n)),a&&a.length>0)for(r.debug("Adding streams: "+JSON.stringify(a,null,2)),c=0;c<a.length;c++)a[c].stream_id&&((d=l.getStreamInfo(a[c].stream_id))||(h=o.CONVERSATIONSTATE.STREAM_ADDED,d=l.localAddStreamInfo(a[c].stream_id,a[c].stream_type,a[c].stream_options,a[c].stream_profile)),d&&(void 0!==a[c].stream_options&&d.localSetStreamOptions(a[c].stream_options),void 0!==a[c].stream_profile&&d.localSetStreamProfile(a[c].stream_profile),void 0!==a[c].size&&d.localSetStreamLayout(a[c].size),void 0!==a[c].recording_status&&d.localSetRecording(a[c].recording_status),l.onParticipantStateChange&&!u&&(r.debug("Invoking onParticipantStateChange callback for change: "+h),l.onParticipantStateChange(h,d))));t.onParticipantChange&&u&&(r.debug("Invoking onParticipantChange callback for change: "+o.CONVERSATIONSTATE.STREAM_ADDED),t.onParticipantChange(t,o.CONVERSATIONSTATE.STREAM_ADDED,l));break;case o.CONVERSATION.REMOVE_STREAM:var p=0;if((l=t.getParticipant(n))&&a&&a.length>0)for(r.debug("Removing streams: "+JSON.stringify(a,null,2)),c=0;c<a.length;c++)a[c].stream_id&&(r.debug("Removing stream ("+a[c].stream_id+") from participant: "+JSON.stringify(l,null,2)),(d=l.getStreamInfo(a[c].stream_id))||(d=new e.StreamInfo(l,a[c].stream_id,a[c].stream_type,a[c].stream_options,a[c].stream_profile)),p=l.localRemoveStreamInfo(a[c].stream_id),l.onParticipantStateChange&&(r.debug("Invoking onParticipantStateChange callback for change: "+o.CONVERSATIONSTATE.STREAM_REMOVED),l.onParticipantStateChange(o.CONVERSATIONSTATE.STREAM_REMOVED,d)));if(p<=0&&(t.localRemoveParticipant(n),t.onParticipantChange)){l||(l=new e.Participant(t,n));var v=o.CONVERSATIONSTATE.STREAM_REMOVED;s&&(v=o.CONVERSATIONSTATE.STREAM_REJECTED),r.debug("Invoking onParticipantChange callback for change: "+v),t.onParticipantChange(t,v,l)}break;case o.CONVERSATION.STREAM_OPTIONS:case o.CONVERSATIONSTATE.STREAM_JOINED:case o.CONVERSATIONSTATE.STREAM_CHANGED:case o.CONVERSATIONSTATE.STREAM_ACTIVE:case o.CONVERSATIONSTATE.PROFILE_UPDATED:case o.CONVERSATIONSTATE.SIDEBAR_CREATED:if(i===o.CONVERSATIONSTATE.SIDEBAR_CREATED&&(r.debug("Sidebar created - disable short-circuit mode"),t.shortCircuitMode=!1),(l=t.getParticipant(n))&&a&&a.length>0)for(r.debug("Updating streams: "+JSON.stringify(a,null,2)),c=0;c<a.length;c++)a[c].stream_id&&(!(d=l.getStreamInfo(a[c].stream_id))&&l.notRemovedStream(a[c].stream_id)&&(d=l.localAddStreamInfo(a[c].stream_id,a[c].stream_type,a[c].stream_options,a[c].stream_profile)),d&&(void 0!==a[c].stream_options&&d.localSetStreamOptions(a[c].stream_options),void 0!==a[c].stream_profile&&d.localSetStreamProfile(a[c].stream_profile),void 0!==a[c].size&&d.localSetStreamLayout(a[c].size),void 0!==a[c].recording_status&&d.localSetRecording(a[c].recording_status),i===o.CONVERSATIONSTATE.STREAM_ACTIVE&&(d.localSetActive(!0),d.streamType===o.STREAMTYPE.AUDIOVIDEO&&a[c].stream_type===o.STREAMTYPE.SCREENSHARE&&(d.streamType=a[c].stream_type,r.debug("Stream "+d.getId()+" is active (updating type to: "+d.getType()+")"))),l.onParticipantStateChange&&(i===o.CONVERSATION.STREAM_OPTIONS?(r.debug("Invoking onParticipantStateChange callback for change: "+o.CONVERSATIONSTATE.STREAM_CHANGED,d),l.onParticipantStateChange(o.CONVERSATIONSTATE.STREAM_CHANGED,d)):(r.debug("Invoking onParticipantStateChange callback for change: "+i,d),l.onParticipantStateChange(i,d)))));else console.log("Failed to process instruction - no participant found for: "+n)}},s.doRequest=function(e,t){var i=t.header,n=i.action,a=i.conversation_key,l=i.conversation_topic,c=i.instructions,d=i.conversation_info,u=i.stream_id,h=i.sidebar,p=i.allow_direct_calls,v=null,g=[],m=0;switch(r.debug("Have conversation request with action: "+n),c&&(g=[].concat(c),r.debug("Have conversation instructions: "+JSON.stringify(g,null,2))),u?(r.debug("Have conversation request for stream: "+u),(v=e.getStreamForId(u))||(v=e.getAudioVideoStream())):v=e.getAudioVideoStream(),n){case o.ACTION.START:for(r.debug("Conversation start request with conversation key: "+a),e.conversationKey=a,l&&(r.debug("Have conversation name: "+l),e.conversationTopic=l),void 0!==p&&r.debug("Have short-circuit mode: "+p),p&&e.withShortCircuit(),h&&(r.debug("Have sidebar: "+h),e.sidebarId=h),m=0;m<g.length;m++)if(g[m].participants){r.debug("Conversation start request with participants: "+g[m].participants);for(var f=[].concat(g[m].participants),S=0;S<f.length;S++)s.handleParticipantChange(e,o.CONVERSATION.ADD_STREAM,f[S].uri,f[m].streams)}d&&s.processConversationInfo(e,d),r.debug("Conversation has "+e.getParticipants().length+" participants (including initiator)"),v.call.onMessage(t);break;case o.ACTION.MODIFY:g.length>0&&function(){var t,i;for(m=0;m<g.length;m++)switch(r.debug("Conversation modify request with instruction: "+g[m].instruction_name),g[m].instruction_name){case o.CONVERSATION.ADD_STREAM:case o.CONVERSATION.REMOVE_STREAM:if(g[m].participants)for(r.debug("Conversation modify request with participants: "+g[m].participants),t=[].concat(g[m].participants),i=0;i<t.length;i++)s.handleParticipantChange(e,g[m].instruction_name,t[i].uri,t[m].streams);break;case o.CONVERSATION.BEGIN_RECORD:e.onRecordingStatusChange&&e.onRecordingStatusChange(e,!0);break;case o.CONVERSATION.END_RECORD:e.onRecordingStatusChange&&e.onRecordingStatusChange(e,!1)}}();break;default:v.call.onMessage(t)}},s.doResponse=function(e,t){var i=t.header,n=i.action,a=i.conversation_key,l=i.conversation_topic,c=i.response_code,d=t.control.message_state,u=i.conversation_info,h=i.enquiry_data,p=i.stream_id,v=i.allow_direct_calls,g=i.sidebar,m=null;switch(r.debug("Have conversation response with action: "+n+" and code: "+c),p?(r.debug("Have conversation response for stream: "+p),(m=e.getStreamForId(p))||(m=e.getAudioVideoStream())):m=e.getAudioVideoStream(),n){case o.ACTION.START:r.debug("Conversation start response with conversation key: "+a),!e.conversationKey&&a&&(e.conversationKey=a),l&&(r.debug("Have conversation name: "+l),e.conversationTopic=l),void 0!==v&&r.debug("Have short-circuit mode: "+v),v&&e.withShortCircuit(),g&&(r.debug("Have sidebar: "+g),e.sidebarId=g),m.call.onMessage(t);var f=200===c&&"final"===d;u?s.processConversationInfo(e,u):f&&s.sendConversationEnquiry(e);break;case o.ACTION.ENQUIRY:r.debug("Conversation enquiry response with conversation key: "+a),!e.conversationKey&&a&&(e.conversationKey=a),u||h?(s.processConversationInfo(e,u),s.processEnquiryResponse(e,h),"function"==typeof e.statusCheckSuccess&&(r.debug("Successful status check response"),e.statusCheckSuccess(),clearTimeout(e.statusCheckTimeout),e.statusCheckTimeout=null,e.statusCheckSuccess=null)):m.call.onMessage(t);break;case o.ACTION.MODIFY:r.debug("Received modify response with code: "+c);break;default:m.call.onMessage(t)}},s.processConversationInfo=function(e,t){if(t){if(r.debug("Have some conversation info: "+JSON.stringify(t,null,2)),t.participants&&t.participants.length>0){var i=[].concat(t.participants);r.debug("Have some participants: "+JSON.stringify(i,null,2));for(var n=0;n<i.length;n++){var a=i[n].uri,l=i[n].streams;s.handleParticipantChange(e,o.CONVERSATION.ADD_STREAM,a,l)}if(e.isEstablished())for(var c=e.getParticipants(),d=0;d<c.length;d++){var u=c[d].getUri();r.debug("Checking if participant is present: "+u),i.some(function(e){return e.uri===u})||(r.info("Participant left the conversation: "+u),s.handleParticipantChange(e,o.CONVERSATION.REMOVE_STREAM,u,c[d].getStreamInfos()))}}t.recording_status&&(e.localSetRecording(t.recording_status),e.onRecordingStatusChange&&e.onRecordingStatusChange(e,e.isRecording())),t.web_context&&!e.webContext&&(r.debug("Have some web context information: "+JSON.stringify(t.web_context)),e.webContext=t.web_context)}},s.processEnquiryResponse=function(e,t){if(t){var i=JSON.parse(t);r.debug("Received some enquiry data: "+JSON.stringify(i,null,2)),e.defaultEnquiryResponse(i),e.onEnquiryResponse&&(r.debug("Invoking conversation.onEnquiryResponse",e),e.onEnquiryResponse(i)),s.sendDelayedStartRequests(e)}},s.processInstructions=function(e,t,i){var n,a,l,c=[];for(n=0;n<t.length;n++){r.debug("Processing conversation instruction: "+t[n].instruction_name);var d,u=null;switch(t[n].instruction_name){case o.CONVERSATION.ADD_STREAM:case o.CONVERSATIONSTATE.STREAM_ADDED:case o.CONVERSATIONSTATE.STREAM_STARTED:if(i)for(c=[].concat(i),r.debug("Adding participants to conversation: "+JSON.stringify(c,null,2)),a=0;a<c.length;a++)(l=c[a].streams)||(l=[{stream_id:c[a].stream_id,stream_type:c[a].stream_type,stream_options:c[a].stream_options,recording_status:c[a].recording_status}]),s.handleParticipantChange(e,o.CONVERSATION.ADD_STREAM,c[a].uri,l);break;case o.CONVERSATION.REMOVE_STREAM:case o.CONVERSATIONSTATE.STREAM_REMOVED:case o.CONVERSATIONSTATE.STREAM_LEFT:case o.CONVERSATIONSTATE.STREAM_REJECTED:if(i)for(c=[].concat(i),r.debug("Removing participants from conversation: "+JSON.stringify(c,null,2)),a=0;a<c.length;a++)(l=c[a].streams)&&(l=l.filter(function(e){return e.stream_id===c[a].stream_id})),d&&0!==l.length||(l=[{stream_id:c[a].stream_id,stream_type:c[a].stream_type}]),s.handleParticipantChange(e,o.CONVERSATION.REMOVE_STREAM,c[a].uri,l,t[n].instruction_name===o.CONVERSATIONSTATE.STREAM_REJECTED);break;case o.CONVERSATION.BEGIN_RECORD:case o.CONVERSATIONSTATE.RECORDING_STARTED:if(i)if((c=[].concat(i)).length>0&&"*"!==c[0].uri)for(a=0;a<c.length;a++)(u=e.getParticipant(c[a].uri))?(d=u.getStreamInfo(c[a].stream_id))?(d.localSetRecording(!0),u.onParticipantStateChange&&u.onParticipantStateChange(o.CONVERSATIONSTATE.RECORDING_STARTED,d)):console.log("Failed to process instruction - no stream with id: "+c[a].stream_id+" found for participant: "+c[a].uri):console.log("Failed to process instruction - no participant found for: "+c[a].uri);else e.localSetRecording(!0),e.onRecordingStatusChange&&e.onRecordingStatusChange(e,!0);break;case o.CONVERSATION.END_RECORD:case o.CONVERSATIONSTATE.RECORDING_ENDED:if(e.localSetRecording(!1),i)if((c=[].concat(i)).length>0&&"*"!==c[0].uri)for(a=0;a<c.length;a++)(u=e.getParticipant(c[a].uri))?(d=u.getStreamInfo(c[a].stream_id))?(d.localSetRecording(!1),u.onParticipantStateChange&&(r.debug("Invoking onParticipantStateChange callback for change: "+o.CONVERSATIONSTATE.RECORDING_ENDED),u.onParticipantStateChange(o.CONVERSATIONSTATE.RECORDING_ENDED,d))):console.log("Failed to process instruction - no stream with id: "+c[a].stream_id+" found for participant: "+c[a].uri):console.log("Failed to process instruction - no participant found for: "+c[a].uri);else e.onRecordingStatusChange&&e.onRecordingStatusChange(e,!1);break;case o.CONVERSATION.STREAM_OPTIONS:case o.CONVERSATIONSTATE.STREAM_JOINED:case o.CONVERSATIONSTATE.STREAM_CHANGED:case o.CONVERSATIONSTATE.PROFILE_UPDATED:case o.CONVERSATIONSTATE.SIDEBAR_CREATED:if(i)for(c=[].concat(i),r.debug("Updating participants in conversation: "+JSON.stringify(c,null,2)),a=0;a<c.length;a++)(l=c[a].streams)||(l=[{stream_id:c[a].stream_id,stream_type:c[a].stream_type,stream_options:c[a].stream_options,recording_status:c[a].recording_status}]),s.handleParticipantChange(e,t[n].instruction_name,c[a].uri,l);break;case o.CONVERSATIONSTATE.STREAM_ACTIVE:if(i)for(c=[].concat(i),r.debug("Processing participants in conversation: "+JSON.stringify(c,null,2)),a=0;a<c.length;a++)l=[{stream_id:c[a].stream_id,stream_type:c[a].stream_type}],s.handleParticipantChange(e,t[n].instruction_name,c[a].uri,l);break;default:r.info("Unknown conversation instruction: "+t[n].instruction_name)}}},s.doMessage=function(e,t){var i=t.header,n=i.action,l=i.conversation_key,c=i.conversation_topic,d=i.conversation_info,u=i.participant,h=i.event,p=i.relay,v=i.stream_id,g=i.stream_type,m=i.sidebar,f=null,S=!1,_=[],C=[];switch(r.debug("Have conversation message with action: "+n),v?(r.debug("Have conversation message for stream: "+v+" (type: "+g+")"),S=null!==(f=e.getStreamForId(v)),f||(f=e.getAudioVideoStream())):f=e.getAudioVideoStream(),i.instructions&&(C=[].concat(i.instructions)),i.instruction_name&&(C=[].concat({instruction_name:i.instruction_name})),h&&h.event_name&&(C=[].concat({instruction_name:h.event_name})),C&&C.length>0&&r.debug("Have conversation instructions: "+JSON.stringify(C,null,2)),h&&h.participants&&(r.debug("Have event participants: "+JSON.stringify(h.participants,null,2)),_=[].concat(h.participants)),u&&(r.debug("Have target participant: "+u+", stream: "+v+"/"+g),_=[].concat({uri:u,stream_id:v,stream_type:g})),n){case o.ACTION.COMPLETE:null===e.conversationKey&&null!==l?e.conversationKey=l:null!==e.conversationKey&&(l=e.conversationKey),r.debug("Conversation complete message with key: "+l),c&&(r.debug("Have conversation name: "+c),e.conversationTopic=c),m&&(r.debug("Have sidebar: "+m),e.sidebarId=m);for(var b=0;b<C.length;b++)switch(r.debug("Conversation message with instruction: "+C[b].instruction_name),C[b].instruction_name){case o.CONVERSATION.BEGIN_RECORD:case o.CONVERSATIONSTATE.RECORDING_STARTED:e.localSetRecording(!0),e.onRecordingStatusChange&&e.onRecordingStatusChange(e,!0)}f.call.onMessage(t),d?s.processConversationInfo(e,d):s.sendConversationEnquiry(e);break;case o.ACTION.NOTIFY:C.length>0?s.processInstructions(e,C,_):l?r.warn("Ignoring notify message with no conversation instructions"):f.call.onMessage(t);break;case o.ACTION.RELAY:e.getLocalParticipantUri();p.from&&p.from,[].concat(p.messages).forEach(function(i){s.processRelay(e,f,t,i)});break;case o.ACTION.SHUTDOWN:S&&function(i){if(!i)return r.debug("Failed to process shutdown for invalid AV stream - ending conversation"),void e.end();var n=i.getStreamState().state;if(r.debug("Processing shutdown for conversation with "+e.streams.size()+" streams, AV stream to shutdown has id: "+i.getId()+", type:"+i.getType()+", state: "+n),e.streams.size()>1)switch(n){case o.CALLSTATE.ESTABLISHED:case o.CALLSTATE.UPDATED:case o.CALLSTATE.UPDATE_FAILED:case o.CALLSTATE.ERROR:r.debug("=== (conversation) doShutdownMessage ==="),i.call.setCallState(o.CALLSTATE.ENDED,"","shutdown");try{a.clearPeerConnection(i.call),i.call.peerConnection=null}catch(e){r.error("clear peer connection error: "+e)}for(var s=i.call.localMediaStreams,l=0;l<s.length;l++){var c=s[l];r.debug("Media stream "+l+": used by "+c.peerConnectionNum+" peer connections."),c&&(null===c.peerConnectionNum||c.peerConnectionNum<=0)&&("undefined"!=typeof RTCRtpReceiver&&c instanceof RTCRtpReceiver||"undefined"!=typeof RTCRtpSender&&c instanceof RTCRtpSender?(c.track&&"video"===c.track.kind&&(r.debug("Stop this media stream: [video tracks: 1, audio tracks: 0]"),c.track.stop()),c.track&&"audio"===c.track.kind&&(r.debug("Stop this media stream: [video tracks: 0, audio tracks: 1]"),c.track.stop())):(r.debug("Stop this media stream: [video tracks: "+c.getVideoTracks().length+", audio tracks: "+c.getAudioTracks().length+"]"),c.getTracks().forEach(function(e){e.stop()})))}e.streams.remove(i.getId());var d=e.getLocalParticipant();d&&(r.debug("Remove stream from local participants: "+i.getId()),d.localRemoveStreamInfo(i.getId())),0===e.streams.size()&&e.remove();break;default:i.call.onMessage(t)}else i.call.onMessage(t)}(f);break;default:f.call.onMessage(t)}},s.processRelay=function(t,i,n,a){var l=n.header,c=l.relay,d=c.from,u=c.msgId,h=c.relayId,v=l.stream_id,g=t.getRelayForId(h);r.debug("Processing Relay: Relay message from "+d,a);var m=a.commands;if(m){var f=[].concat(m);f.length>0&&r.debug("Have relay command message: "+JSON.stringify(f,null,2)),f.forEach(function(a){r.debug("Processing relay command: "+JSON.stringify(a,null,2));var l,c,h,v=a.directive,m=new e.StreamRequest(g,v,n.isRequest(),u,d),f=[].concat(a.arguments);switch(v){case o.CONVERSATION.STREAM_OPTIONS:var S=p.createStreamOptions(f[0].audio,f[0].video);r.debug("Request to modify media direction: "+JSON.stringify(S,null,2)),i.onUpdateStreamOptions?(r.debug("Calling onUpdateStreamOptions callback with arguments: options="+JSON.stringify(S,null,2)+", streamRequest="+JSON.stringify(m,null,2)),i.onUpdateStreamOptions(t,i,m,S)):m.decline("Not implemented");break;case o.CONVERSATION.PAUSE_RESUME_STREAM:(l=f[0]).pausedBy=m.from(),r.debug((l?"Pausing":"Resuming")+" local AV stream"),i.onPauseResumeStream?(r.debug("Calling onPauseResumeStream callback with arguments: paused="+JSON.stringify(l,null,2)+", streamRequest="+JSON.stringify(m,null,2)),i.onPauseResumeStream(t,i,m,l)):m.decline("Not implemented");break;case o.CONVERSATIONSTATE.STREAM_ACTIVE:h=f[0],s.handleParticipantChange(t,o.CONVERSATIONSTATE.STREAM_ACTIVE,h.uri,h.streams);break;case o.CONVERSATION.ADD_STREAM:h=t.getLocalParticipant(),c=f[0],r.debug("Adding "+c.stream_type+" stream to local participant with options: "+c.stream_options),h.onAddStream?(r.debug("Calling onAddStream callback with arguments: type="+c.stream_type+", options="+c.stream_options+", from="+d),h.onAddStream(t,h,m,c.stream_type,c.stream_options)):m.decline("Not implemented");break;case o.CONVERSATION.REMOTE_ADD_STREAM:c=f[0],(h=t.getParticipant(d))?(r.debug("Request to add "+c.stream_type+" stream to remote participant ("+d+") with options: "+c.stream_options),h.onAddRemoteStream?(r.debug("Calling onAddRemoteStream callback with arguments: type="+c.stream_type+", options="+c.stream_options+", from="+d),h.onAddRemoteStream(t,h,m,c.stream_type,c.stream_options)):m.decline("Not implemented")):(r.debug("No remote participant - cannot handle 'remote add stream' request"),m.decline("No remote participant"));break;default:r.debug("Unknown relay command directive: "+v),t.onRelayCommand&&t.onRelayCommand(t,i,m,v,f)}})}var S=a.text;if(S){var _=[].concat(S);_.length>0&&r.debug("Have relay text message: "+JSON.stringify(_,null,2)),_.forEach(function(e){r.debug("Processing relay text: "+e);var i=e.thread,o=e.content;t.onRelayText&&t.onRelayText(t,d,i,o)})}var C=a.data;if(C){var b=[].concat(C);b.length>0&&r.debug("Have relay data message: "+JSON.stringify(b,null,2)),b.forEach(function(e){r.debug("Processing relay data: "+e);var i=e.tag,o=e.content;if(0===i.indexOf("__wsc_internal_")){if("__wsc_internal_quality_monitor_new_status__"===i){var n=t.getParticipant(d);if(n){var a=n.getStreamInfo(v);if(a){var s=a.getQualityMonitor();for(var l in o)if(o.hasOwnProperty(l)){var c=s.factorMonitors[l];"function"==typeof c&&c.call(s,o[l].value,o[l].hints)}}}}}else t.onRelayData&&t.onRelayData(t,d,i,o)})}},s.doReliableRelay=function(e,t){var i=t.header,o=i.relay,n=o.from,a=o.relayId;r.debug("doReliableRelay received relay message from: "+n+" (with id: "+a+")",t);var l=null,c=i.stream_id,d=i.stream_type,u=null;return c?(r.debug("Have reliable relay message for stream: "+c+" (type: "+d+")"),(l=e.getStreamForId(c))||(l=e.getAudioVideoStream())):l=e.getAudioVideoStream(),t.isFinalResponse()?(r.debug("Processing reliable relay final response..."),void((u=e.getRelayForId(a))&&u.processFinalResponse(t))):t.isResponse()?(r.debug("Processing reliable relay subsequent response..."),void((u=e.getRelayForId(a))&&u.processSubsequentResponse(t))):t.isError()?(r.debug("Processing reliable relay error..."),void((u=e.getRelayForId(a))&&u.processError(t))):(t.isRequest()&&(r.debug("Attempting to respond to reliable relay request..."),void 0!==(u=e.getRelayForId(a))&&null!==u||(r.debug("Creating new relay to respond to new incoming message"),u=e.createRelay(l.getId(),n,a)),r.debug("Responding to request message:"),u.respond(t)),r.debug("Iterating over relay messages..."),void[].concat(o.messages).forEach(function(i){s.processRelay(e,l,t,i)}))},s.doError=function(e,t){function i(){for(r.debug("=== doErrorMessage ==="),t.ack(e.session),m=0;m<g.length;m++){r.debug("Conversation error with instruction: "+g[m].instruction_name);var i;switch(g[m].instruction_name){case o.CONVERSATION.ADD_STREAM:h&&s.handleParticipantChange(e,o.CONVERSATION.REMOVE_STREAM,h,null);break;case o.CONVERSATION.REMOVE_STREAM:if(e.lastRemovedParticipant&&e.lastRemovedParticipant.uri===h){var l=e.lastRemovedParticipant.streams;s.handleParticipantChange(e,o.CONVERSATION.ADD_STREAM,h,l)}break;case o.CONVERSATION.BEGIN_RECORD:h&&"*"!==h?(a=e.getParticipant(h))&&((i=a.getStreamInfo(p)).localSetRecording(!1),a.onParticipantStateChange&&a.onParticipantStateChange(o.CONVERSATIONSTATE.RECORDING_ENDED,i)):(e.localSetRecording(!1),e.onRecordingStatusChange&&e.onRecordingStatusChange(e,!1)),o.CONVERSATION.END_RECORD;break;case o.CONVERSATION.END_RECORD:h&&"*"!==h?(a=e.getParticipant(h))&&((i=a.getStreamInfo(p)).localSetRecording(!0),a.onParticipantStateChange&&(r.debug("Invoking onParticipantStateChange callback for change: "+o.CONVERSATIONSTATE.RECORDING_STARTED),a.onParticipantStateChange(o.CONVERSATIONSTATE.RECORDING_STARTED,i))):(e.localSetRecording(!0),e.onRecordingStatusChange&&e.onRecordingStatusChange(e,!0))}}var c=new n.ErrorInfo(d,u);try{e.onError(c)}catch(e){r.error("Exception occurred while invoking onError callback: "+e)}}var a,l=t.header,c=l.action,d=l.error_code,u=l.reason,h=String(l.participant),p=l.stream_id,v=null,g=[],m=0;if(r.warn("Have conversation error with action: "+c+", code: "+d+" and reason: "+u),p)if(r.debug("Have conversation error for stream: "+p),v=e.getStreamForId(p)){v&&v.call&&v.call.collectClientLog(o.LOGTYPE.ERROR_LOG,o.ERRORLOG.ERROR_FROM_SERVER+":"+JSON.stringify(t));var f=v.call&&v.call.onCallError;if(f)f(new n.ErrorInfo(o.ERRORCODE.SIGNALING_ERROR,d+"/"+u))}else v=e.getAudioVideoStream();else v=e.getAudioVideoStream();switch(l.instructions&&(g=[].concat(l.instructions)),l.instruction_name&&(g=[].concat({instruction_name:l.instruction_name})),g&&g.length>0&&r.debug("Have conversation instructions: "+JSON.stringify(g,null,2)),h&&r.debug("Have target participant: "+h),c){case o.ACTION.START:v?v.call.onMessage(t):(r.error("Failed to forward error message to stream"),i());break;default:i()}},s.retrieveRecordingRules=function(e){return e.joiningConversation?(r.debug("Joining conversation, not retrieving recording rules"),!1):(r.info("Begin to retrieve recording rules",e),s.logEventTimestamp(e.session,"enquiryRequestSent"),s.sendConversationEnquiry(e),!0)},s.sendDelayedStartRequests=function(e){for(r.debug("Sending "+e.pendingAVStreams.length+" delayed start requests");e.pendingAVStreams.length>0;){var t=e.pendingAVStreams.pop();t&&s.sendStartRequest(t)}},s.sendStartRequest=function(e){var t=e.conversation;r.debug("Starting stream with key: "+t.conversationKey);var i,n=JSON.parse("{}");e.extHeaders&&(n=e.extHeaders);var a=[];if(t.joiningConversation)r.debug("Joining conversation - not adding participants");else if(t.streams.size()<=1){var s=t.getParticipants().filter(function(e){return e.uri!==t.initiator});if(s.length>0){var l=[];for(i=0;i<s.length;i++)Array.prototype.push.apply(l,s[i].asJSONArray(e.getType()));r.debug("Adding participants to conversation: "+JSON.stringify(l,null,2)),a.push({instruction_name:o.CONVERSATION.ADD_STREAM,participants:l})}}r.debug("Checking recording rules for automatic recording");var c=t.recordingRules;if(c&&t.alwaysRecordOnCreation&&!t.neverRecordOnCreation){r.info("Conversation will be recorded (with rules) "+JSON.stringify(c,null,2));var d={instruction_name:o.CONVERSATION.BEGIN_RECORD,recording_style:t.recordingStyle};if(c.participants){d.participants=[];for(var u=0;u<c.participants.length;u++)d.participants.push({uri:c.participants[u]})}c.include_associations&&(r.info("Adding associations "+c.include_associations),d.include_associations=c.include_associations),c.exclude_associations&&(r.info("Adding exclude associations "+c.exclude_associations),d.exclude_associations=c.exclude_associations),a.push(d)}else t.alwaysRecordOnCreation&&!t.neverRecordOnCreation&&(r.debug("Conversation will be recorded (without rules)"),a.push({instruction_name:o.CONVERSATION.BEGIN_RECORD,recording_style:t.recordingStyle}));if(n.instructions=a,t.conversationTopic&&(n.conversation_topic=t.conversationTopic),t.shortCircuitMode&&(n.allow_direct_calls=t.shortCircuitMode),t.conversationChannel&&(n.conversation_channel=t.conversationChannel),t.conversationKey&&(n.conversation_key=t.conversationKey),t.webContext?n.web_context=t.webContext:n.web_context={},t.clientId&&(n.web_context.clientId=t.clientId),t.clientId&&(n.web_context.clientVersion=t.clientVersion),t.sidebarId&&(n.sidebar=t.sidebarId),n.stream_id&&n.stream_type){var h=e.streamId;e.streamId=n.stream_id,e.call.streamId=n.stream_id,e.call.callState.streamId=n.stream_id,e.call.streamType=n.stream_type,h!==e.streamId&&t.updateStreamId(e,h)}else n.stream_id=e.getId(),n.stream_type=e.getType();n.stream_profile=t.getLocalParticipant().getStreamInfo(n.stream_id).getStreamProfile(),r.debug("start with extHeaders: "+JSON.stringify(n,null,2)),e.call.shortCircuitMode=t.shortCircuitMode,e.call.start(e.localMediaStreams,n)},s.sendUpdateRequest=function(e,t,i,o){r.info("Begin to update stream with streamOptions: "+JSON.stringify(t),e);var n=e.conversation.getLocalParticipant().getStreamInfo(e.getId()),a=n.getStreamOptions();n.localSetStreamOptions(t),r.debug("Updating participant stream options from: "+JSON.stringify(a,null,2)+" to: "+JSON.stringify(t,null,2));var s=JSON.parse("{}");o&&(s=o),s.stream_id=e.getId(),s.stream_type=e.getType(),s.stream_options=t.asJSON(),e.conversation.conversationKey&&(s.conversation_key=e.conversation.conversationKey),e.conversation.webContext&&(s.web_context=e.conversation.webContext),e.conversation.sidebarId&&(s.sidebar=e.conversation.sidebarId),r.debug("update with extHeaders: "+JSON.stringify(s,null,2)),e.call.shortCircuitMode=e.conversation.shortCircuitMode,e.call.update(t,i,s)},s.sendAcceptResponse=function(e,t,i,o){r.info("Begin to accept request for stream with streamOptions: "+JSON.stringify(t,null,2),e);var n=e.conversation.getLocalParticipant().getStreamInfo(e.getId());n.localSetStreamOptions(t);var a=JSON.parse("{}");o&&(a=o),a.stream_id=e.getId(),a.stream_type=e.getType(),a.stream_options=t.asJSON(),a.stream_profile=n.getStreamProfile().toJSON(),r.debug("accept with extHeaders: "+JSON.stringify(a,null,2)),e.call.shortCircuitMode=e.conversation.shortCircuitMode,e.call.accept(t,i,a)},s.sendDeclineResponse=function(t,i,o){var n=t.getStreamState().state;r.info("Begin to decline request for stream in state: "+n,t);var a=JSON.parse("{}");if(o&&(a=o),a.stream_id=t.getId(),a.stream_type=t.getType(),n===e.CALLSTATE.UPDATING){var s=t.call.lastCallConfig;r.debug("accept with incoming streamOptions and extHeaders: "+JSON.stringify(a,null,2)),t.call.accept(null,null,a),setTimeout(function(){r.debug("accept with original streamOptions: "+JSON.stringify(s,null,2)+" and extHeaders: "+JSON.stringify(a,null,2)),t.update(s,null,a)},1e3)}else r.debug("decline with code: "+i+" and extHeaders: "+JSON.stringify(a,null,2)),t.call.decline(i,a),t.conversation.remove()},s.sendEndRequest=function(e,t){if(r.info("Begin to end stream",e),e.call){var i=JSON.parse("{}");t&&(i=t),e.conversation.webContext&&(i.web_context=e.conversation.webContext),e.conversation.sidebarId&&(i.sidebar=e.conversation.sidebarId),i.stream_id=e.getId(),i.stream_type=e.getType(),r.debug("end with extHeaders: "+JSON.stringify(i,null,2));var o=e.conversation.getLocalParticipant();o&&(r.debug("Remove stream from local participants: "+e.getId()),o.localRemoveStreamInfo(e.getId())),e.call.end(i),e.conversation.streams.remove(e.getId()),0===e.conversation.streams.size()&&e.conversation.remove()}},s.sendBeginRecording=function(e,t){var i=s.conversationRequest(e),n=[{instruction_name:o.CONVERSATION.BEGIN_RECORD,recording_style:e.recordingStyle}];t?(n[0].participants=[].concat({uri:t.getParticipant().getUri(),stream_id:t.getId(),stream_type:t.getType()}),i.header.stream_id=t.getId(),i.header.stream_type=t.getType()):(t=e.getAudioVideoStream())&&(i.header.stream_id=t.getId(),i.header.stream_type=t.getType()),i.header.instructions=n,r.debug("Sending conversation modify request to begin recording"),e.session.sendMessage(i)},s.sendEndRecording=function(e,t){var i=s.conversationRequest(e),n=[{instruction_name:o.CONVERSATION.END_RECORD}];t?(n[0].participants=[].concat({uri:t.getParticipant().getUri(),stream_id:t.getId(),stream_type:t.getType()}),i.header.stream_id=t.getId(),i.header.stream_type=t.getType()):(t=e.getAudioVideoStream())&&(i.header.stream_id=t.getId(),i.header.stream_type=t.getType()),i.header.instructions=n,r.debug("Sending conversation modify request to end recording"),e.session.sendMessage(i)},s.sendAddParticipant=function(e,t){var i=s.conversationRequest(e),n=[{instruction_name:o.CONVERSATION.ADD_STREAM,participants:t.asJSONArray()}];t.isRecording()&&n.push({instruction_name:o.CONVERSATION.BEGIN_RECORD,recording_style:e.recordingStyle,participants:[{uri:t.getUri()}]}),i.header.instructions=n;var a=e.getAudioVideoStream();a&&(i.header.stream_id=a.getId(),i.header.stream_type=a.getType()),r.debug("Sending conversation modify request to add participant"),e.session.sendMessage(i),e.onParticipantChange&&(r.debug("Invoking onParticipantChange callback for change: "+o.CONVERSATIONSTATE.STREAM_ADDED),e.onParticipantChange(e,o.CONVERSATIONSTATE.STREAM_ADDED,t))},s.sendRemoveParticipant=function(e,t,i){var n=s.conversationRequest(e),a=[{instruction_name:o.CONVERSATION.REMOVE_STREAM}];i?(a[0].participants=[].concat({uri:i.getParticipant().getUri(),stream_id:i.getId(),stream_type:i.getType()}),n.header.stream_id=i.getId(),n.header.stream_type=i.getType()):(a[0].participants=t.asJSONArray(),(i=e.getAudioVideoStream())&&(n.header.stream_id=i.getId(),n.header.stream_type=i.getType())),n.header.instructions=a,r.debug("Sending conversation modify request to remove participant"),e.session.sendMessage(n)},s.sendRemoveAllParticipants=function(e){for(var t=s.conversationRequest(e),i=e.getParticipants(),n=[],a=0;a<i.length;a++)e.getLocalParticipantUri()!==i[a].getUri()&&Array.prototype.push.apply(n,i[a].asJSONArray());t.header.instructions=[{instruction_name:o.CONVERSATION.REMOVE_STREAM,participants:n},{instruction_name:o.CONVERSATION.END_RECORD}];var l=e.getAudioVideoStream();l&&(t.header.stream_id=l.getId(),t.header.stream_type=l.getType()),r.debug("Sending conversation modify request to remove all participants"),e.session.sendMessage(t)},s.sendProfileUpdate=function(e,t){var i=s.conversationRequest(e),n=[{instruction_name:o.CONVERSATION.UPDATE_PROFILE}];n[0].participants=[].concat({uri:t.getParticipant().getUri(),stream_id:t.getId(),stream_type:t.getType(),stream_profile:t.getStreamProfile()}),i.header.stream_id=t.getId(),i.header.stream_type=t.getType(),i.header.stream_profile=t.getStreamProfile(),i.header.instructions=n,r.debug("Sending conversation modify request to update profile"),e.session.sendMessage(i)},s.sendConversationEnquiry=function(e){var t=s.conversationRequest(e);t.header.action=o.ACTION.ENQUIRY,t.header.enquiry_data={},e.pendingTargetURI&&(t.header.enquiry_data.target=e.pendingTargetURI),e.conversationChannel&&(t.header.enquiry_data.channel=e.conversationChannel),e.webContext?t.header.enquiry_data.web_context=e.webContext:t.header.enquiry_data.web_context={},e.clientId&&(t.header.enquiry_data.web_context.clientId=e.clientId),e.clientVersion&&(t.header.enquiry_data.web_context.clientVersion=e.clientVersion),t.header.web_context=t.header.enquiry_data.web_context;var i=e.getAudioVideoStream();i&&(t.header.stream_id=i.getId(),t.header.stream_type=i.getType()),r.debug("Sending conversation enquiry request"),e.session.sendMessage(t)},s.buildRelayMsg=function(e,t,i,n){r.debug("Building relay message for: "+JSON.stringify(t,null,2));var a,l=s.conversationRequest(e);if(l.control.type=o.TYPE.MESSAGE,l.header.action=o.ACTION.RELAY,"string"==typeof t)a="*"===t?"*":[{uri:t}];else{a=[];for(var c,d=[].concat(t),u=null,h=0;h<d.length;h++)d[h]&&(c=d[h].getParticipant(),n&&(u=c.getStreamInfos().find(n)),u||(u=c.getStreamInfos()[0]),a.push({uri:c.getUri(),stream_id:u.getId(),stream_type:u.getType()}))}var p=e.getLocalParticipant(),v=null;return i&&(v=p.getStreamInfos().find(i)),v||(v=p.getStreamInfos()[0]),r.debug("Building relay message with fromStream id : "+v.getId()),l.header.relay={from:p.getUri(),messages:[{participants:a}]},l.header.stream_id=v.getId(),l.header.stream_type=v.getType(),l},s.determineRelayDestinations=function(e,t,i){var o,n=[];if(i&&r.debug("Excluding relay destination: "+i),"string"==typeof t)if("*"===t){var a=e.getParticipants();for(o=0;o<a.length;o++){var s=a[o].getUri();e.getLocalParticipantUri()===s||i&&i===s||(r.debug("- relay destination: "+s),n.push({uri:s}))}}else n=[{uri:t}];else{n=[];var l=[].concat(t);for(o=0;o<l.length;o++)l[o]&&n.push({uri:l[o].participant.uri,stream_id:l[o].id,stream_type:l[o].type})}return n},s.buildReliableRelayMsg=function(e,t){var i=e.getMessageType(),n=e.getRelay(),a=e.getId(),l=e.isFinalMessage(),c=n.getDestination();r.debug("Building reliable relay "+i+" with: msgId="+a+" and relayId="+n.getId());var d=s.buildRelayMsg(n.getConversation(),c,e.getOrigStreamOptionsCallback(),e.getDestStreamOptionsCallback());return d.control.type=i,d.header.action=o.ACTION.RELIABLE_RELAY,i===o.TYPE.MESSAGE&&(d.header.action=o.ACTION.RELAY),d.header.relay.msgId=a,d.header.relay.relayId=n.getId(),t&&e.message&&(r.debug("Resending original message with correlation_id: "+e.message.control.correlation_id),d.control.sequence=e.message.control.sequence,d.control.correlation_id=e.message.control.correlation_id),i===o.TYPE.RESPONSE&&(r.debug("  as "+(l?"final":"subsequent")+" response"),d.control.message_state=l?o.MESSAGESTATE.FINAL:o.MESSAGESTATE.SUBSEQUENT),i===o.TYPE.ERROR&&(d.header.error_code=406),e.text&&(d.header.relay.messages[0].text=e.text),e.data&&(d.header.relay.messages[0].data=e.data),e.commands&&(d.header.relay.messages[0].commands=e.commands,i===o.TYPE.ERROR&&(d.header.reason=e.commands[0].arguments[0].reason)),d},s.sendStreamOptions=function(e,t,i,n,a){var s=e.getRelayForStream(t);null===s?s=e.createRelay(t.getId(),t):r.debug("Found relay with id: "+s.getId()),s.createCommand(o.CONVERSATION.STREAM_OPTIONS,[i.asJSON()]).withCallbacks(n,a).send()},s.sendPauseResume=function(e,t,i,n,a){var s=e.getSpecificRelayForStream(t);null===s?s=e.createRelay(t.getId(),t):r.debug("Found relay with id: "+s.getId()),s.createCommand(o.CONVERSATION.PAUSE_RESUME_STREAM,[i]).withCallbacks(n,a).send()},s.sendCancelRequest=function(e,t,i,n,a){var s=e.getRelayForStream(t);null===s?console.warn("No previous command for stream",t):(r.debug("Found relay with id: "+s.getId()),s.createCommand(o.CONVERSATION.CANCEL,[{original_directive:i}]).withCallbacks(n,a).send())},s.sendAddStream=function(e,t,i,n,a,l){var c=t.getStreamInfos()[0],d=t.getUri();r.debug("sendAddStream to participant: "+d+" with type: "+i);var u=e.getRelayForStream(c);null===u?u=e.createRelay(c.getId(),c):r.debug("Found relay with id: "+u.getId());var h={stream_type:i,stream_options:n.asJSON()},p=u.createCommand(o.CONVERSATION.ADD_STREAM,[h]).withCallbacks(a,l);e.isShortCircuit()?(r.debug("Short-circuit conversation - creating sidebar before adding stream"),s.sendCreateSidebar(e),e.pendingAddStreamRelay=p):(r.debug("Sending relay to add stream"),p.send())},s.sendDelayedAddStreamRequest=function(e){r.debug("sendDelayedAddStreamRequest",e.pendingAddStreamRelay),e.pendingAddStreamRelay&&(r.debug("Sending delayed relay to add stream"),e.pendingAddStreamRelay.send(),e.pendingAddStreamRelay=null)},s.sendStreamLayout=function(e,t,i,n){if(n||(n=e.getAudioVideoStream())){var a=s.conversationRequest(e);a.header.instructions=[{instruction_name:o.CONVERSATION.STREAM_LAYOUT,participants:[{uri:t.getParticipant().getUri(),stream_id:t.getId(),stream_type:t.getType(),size:i}]}],n&&(a.header.stream_id=n.getId(),a.header.stream_type=n.getType()),r.debug("Sending conversation modify request to set stream size for "+t.participant.uri),e.session.sendMessage(a)}else r.debug("Failed to set stream size for stream - invalid local AV stream",t)},s.sendCreateSidebar=function(e){var t=e.getAudioVideoStream(),i=s.conversationRequest(e);i.header.instructions=[{instruction_name:o.CONVERSATION.CREATE_SIDEBAR}],i.header.stream_id=t.getId(),i.header.stream_type=t.getType(),r.debug("Sending conversation modify request to create sidebar"),e.session.sendMessage(i)},s.conversationRequest=function(e){var t=new n.Message;return t.control.type=o.TYPE.REQUEST,t.control.subsession_id=e.subSessionId,t.control.package_type=e.pkgInstance.packageType,t.control.ack_sequence=e.session.lastInboundSeq,t.header.initiator=e.session.userName,t.header.action=o.ACTION.MODIFY,e.conversationKey&&(t.header.conversation_key=e.conversationKey),e.conversationTopic&&(t.header.conversation_topic=e.conversationTopic),e.sidebarId&&(t.header.sidebar=e.sidebarId),t},s.getPauseResumeTargets=function(t){var i=t.audioConfig===o.MEDIADIRECTION.NONE,n=t.videoConfig===o.MEDIADIRECTION.NONE;return new e.PauseResume(i?o.PAUSERESUME.PAUSE:o.PAUSERESUME.RESUME,n?o.PAUSERESUME.PAUSE:o.PAUSERESUME.RESUME,o.PAUSERESUMEREASON.PAUSE_RESUME)},s.logEventTimestamp=function(e,t){e.logEventTimestamp(t)},t.ConversationStateMachine=s,e.StreamInfo=p,e.AudioVideoStream=g,e.ScreenShareStream=m,e.Participant=v,e.Conversation=d,e.ConversationPackage=c,e.Connection=l,e.Relay=f,e.RelayMessage=S,e.QualityMonitor=C,e.PauseResume=u,e.StreamRequest=_,e.StreamProfile=h,console.log("conversation initialized."),e}(live||{});liveRequire.define("oracle.live.sdk",function(){}),function(e,t){"use strict";"object"==typeof module&&"object"==typeof module.exports?module.exports=e.document?t(e,!0):function(e){if(!e.document)throw new Error("jQuery requires a window with a document");return t(e)}:t(e)}("undefined"!=typeof window?window:this,function(e,t){"use strict";var i=[],o=e.document,n=Object.getPrototypeOf,a=i.slice,r=i.concat,s=i.push,l=i.indexOf,c={},d=c.toString,u=c.hasOwnProperty,h=u.toString,p=h.call(Object),v={};function g(e,t){var i=(t=t||o).createElement("script");i.text=e,t.head.appendChild(i).parentNode.removeChild(i)}var m="3.1.1",f=function(e,t){return new f.fn.init(e,t)},S=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,_=/^-ms-/,C=/-([a-z])/g,b=function(e,t){return t.toUpperCase()};function E(e){var t=!!e&&"length"in e&&e.length,i=f.type(e);return"function"!==i&&!f.isWindow(e)&&("array"===i||0===t||"number"==typeof t&&t>0&&t-1 in e)}f.fn=f.prototype={jquery:m,constructor:f,length:0,toArray:function(){return a.call(this)},get:function(e){return null==e?a.call(this):e<0?this[e+this.length]:this[e]},pushStack:function(e){var t=f.merge(this.constructor(),e);return t.prevObject=this,t},each:function(e){return f.each(this,e)},map:function(e){return this.pushStack(f.map(this,function(t,i){return e.call(t,i,t)}))},slice:function(){return this.pushStack(a.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(e){var t=this.length,i=+e+(e<0?t:0);return this.pushStack(i>=0&&i<t?[this[i]]:[])},end:function(){return this.prevObject||this.constructor()},push:s,sort:i.sort,splice:i.splice},f.extend=f.fn.extend=function(){var e,t,i,o,n,a,r=arguments[0]||{},s=1,l=arguments.length,c=!1;for("boolean"==typeof r&&(c=r,r=arguments[s]||{},s++),"object"==typeof r||f.isFunction(r)||(r={}),s===l&&(r=this,s--);s<l;s++)if(null!=(e=arguments[s]))for(t in e)i=r[t],r!==(o=e[t])&&(c&&o&&(f.isPlainObject(o)||(n=f.isArray(o)))?(n?(n=!1,a=i&&f.isArray(i)?i:[]):a=i&&f.isPlainObject(i)?i:{},r[t]=f.extend(c,a,o)):void 0!==o&&(r[t]=o));return r},f.extend({expando:"jQuery"+(m+Math.random()).replace(/\D/g,""),isReady:!0,error:function(e){throw new Error(e)},noop:function(){},isFunction:function(e){return"function"===f.type(e)},isArray:Array.isArray,isWindow:function(e){return null!=e&&e===e.window},isNumeric:function(e){var t=f.type(e);return("number"===t||"string"===t)&&!isNaN(e-parseFloat(e))},isPlainObject:function(e){var t,i;return!(!e||"[object Object]"!==d.call(e)||(t=n(e))&&(i=u.call(t,"constructor")&&t.constructor,"function"!=typeof i||h.call(i)!==p))},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},type:function(e){return null==e?e+"":"object"==typeof e||"function"==typeof e?c[d.call(e)]||"object":typeof e},globalEval:function(e){g(e)},camelCase:function(e){return e.replace(_,"ms-").replace(C,b)},nodeName:function(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()},each:function(e,t){var i,o=0;if(E(e))for(i=e.length;o<i&&!1!==t.call(e[o],o,e[o]);o++);else for(o in e)if(!1===t.call(e[o],o,e[o]))break;return e},trim:function(e){return null==e?"":(e+"").replace(S,"")},makeArray:function(e,t){var i=t||[];return null!=e&&(E(Object(e))?f.merge(i,"string"==typeof e?[e]:e):s.call(i,e)),i},inArray:function(e,t,i){return null==t?-1:l.call(t,e,i)},merge:function(e,t){for(var i=+t.length,o=0,n=e.length;o<i;o++)e[n++]=t[o];return e.length=n,e},grep:function(e,t,i){for(var o=[],n=0,a=e.length,r=!i;n<a;n++)!t(e[n],n)!==r&&o.push(e[n]);return o},map:function(e,t,i){var o,n,a=0,s=[];if(E(e))for(o=e.length;a<o;a++)null!=(n=t(e[a],a,i))&&s.push(n);else for(a in e)null!=(n=t(e[a],a,i))&&s.push(n);return r.apply([],s)},guid:1,proxy:function(e,t){var i,o,n;if("string"==typeof t&&(i=e[t],t=e,e=i),f.isFunction(e))return o=a.call(arguments,2),(n=function(){return e.apply(t||this,o.concat(a.call(arguments)))}).guid=e.guid=e.guid||f.guid++,n},now:Date.now,support:v}),"function"==typeof Symbol&&(f.fn[Symbol.iterator]=i[Symbol.iterator]),f.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),function(e,t){c["[object "+t+"]"]=t.toLowerCase()});var R=function(e){var t,i,o,n,a,r,s,l,c,d,u,h,p,v,g,m,f,S,_,C="sizzle"+1*new Date,b=e.document,E=0,R=0,y=re(),T=re(),A=re(),I=function(e,t){return e===t&&(u=!0),0},w={}.hasOwnProperty,k=[],x=k.pop,O=k.push,L=k.push,N=k.slice,D=function(e,t){for(var i=0,o=e.length;i<o;i++)if(e[i]===t)return i;return-1},P="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",M="[\\x20\\t\\r\\n\\f]",V="(?:\\\\.|[\\w-]|[^\0-\\xa0])+",U="\\["+M+"*("+V+")(?:"+M+"*([*^$|!~]?=)"+M+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+V+"))|)"+M+"*\\]",B=":("+V+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+U+")*)|.*)\\)|)",F=new RegExp(M+"+","g"),q=new RegExp("^"+M+"+|((?:^|[^\\\\])(?:\\\\.)*)"+M+"+$","g"),z=new RegExp("^"+M+"*,"+M+"*"),H=new RegExp("^"+M+"*([>+~]|"+M+")"+M+"*"),W=new RegExp("="+M+"*([^\\]'\"]*?)"+M+"*\\]","g"),j=new RegExp(B),G=new RegExp("^"+V+"$"),Y={ID:new RegExp("^#("+V+")"),CLASS:new RegExp("^\\.("+V+")"),TAG:new RegExp("^("+V+"|[*])"),ATTR:new RegExp("^"+U),PSEUDO:new RegExp("^"+B),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+M+"*(even|odd|(([+-]|)(\\d*)n|)"+M+"*(?:([+-]|)"+M+"*(\\d+)|))"+M+"*\\)|)","i"),bool:new RegExp("^(?:"+P+")$","i"),needsContext:new RegExp("^"+M+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+M+"*((?:-\\d)?\\d*)"+M+"*\\)|)(?=[^-]|$)","i")},J=/^(?:input|select|textarea|button)$/i,Q=/^h\d$/i,K=/^[^{]+\{\s*\[native \w/,X=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,$=/[+~]/,Z=new RegExp("\\\\([\\da-f]{1,6}"+M+"?|("+M+")|.)","ig"),ee=function(e,t,i){var o="0x"+t-65536;return o!=o||i?t:o<0?String.fromCharCode(o+65536):String.fromCharCode(o>>10|55296,1023&o|56320)},te=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\0-\x1f\x7f-\uFFFF\w-]/g,ie=function(e,t){return t?"\0"===e?"�":e.slice(0,-1)+"\\"+e.charCodeAt(e.length-1).toString(16)+" ":"\\"+e},oe=function(){h()},ne=Se(function(e){return!0===e.disabled&&("form"in e||"label"in e)},{dir:"parentNode",next:"legend"});try{L.apply(k=N.call(b.childNodes),b.childNodes),k[b.childNodes.length].nodeType}catch(e){L={apply:k.length?function(e,t){O.apply(e,N.call(t))}:function(e,t){for(var i=e.length,o=0;e[i++]=t[o++];);e.length=i-1}}}function ae(e,t,o,n){var a,s,c,d,u,v,f,S=t&&t.ownerDocument,E=t?t.nodeType:9;if(o=o||[],"string"!=typeof e||!e||1!==E&&9!==E&&11!==E)return o;if(!n&&((t?t.ownerDocument||t:b)!==p&&h(t),t=t||p,g)){if(11!==E&&(u=X.exec(e)))if(a=u[1]){if(9===E){if(!(c=t.getElementById(a)))return o;if(c.id===a)return o.push(c),o}else if(S&&(c=S.getElementById(a))&&_(t,c)&&c.id===a)return o.push(c),o}else{if(u[2])return L.apply(o,t.getElementsByTagName(e)),o;if((a=u[3])&&i.getElementsByClassName&&t.getElementsByClassName)return L.apply(o,t.getElementsByClassName(a)),o}if(i.qsa&&!A[e+" "]&&(!m||!m.test(e))){if(1!==E)S=t,f=e;else if("object"!==t.nodeName.toLowerCase()){for((d=t.getAttribute("id"))?d=d.replace(te,ie):t.setAttribute("id",d=C),s=(v=r(e)).length;s--;)v[s]="#"+d+" "+fe(v[s]);f=v.join(","),S=$.test(e)&&ge(t.parentNode)||t}if(f)try{return L.apply(o,S.querySelectorAll(f)),o}catch(e){}finally{d===C&&t.removeAttribute("id")}}}return l(e.replace(q,"$1"),t,o,n)}function re(){var e=[];return function t(i,n){return e.push(i+" ")>o.cacheLength&&delete t[e.shift()],t[i+" "]=n}}function se(e){return e[C]=!0,e}function le(e){var t=p.createElement("fieldset");try{return!!e(t)}catch(e){return!1}finally{t.parentNode&&t.parentNode.removeChild(t),t=null}}function ce(e,t){for(var i=e.split("|"),n=i.length;n--;)o.attrHandle[i[n]]=t}function de(e,t){var i=t&&e,o=i&&1===e.nodeType&&1===t.nodeType&&e.sourceIndex-t.sourceIndex;if(o)return o;if(i)for(;i=i.nextSibling;)if(i===t)return-1;return e?1:-1}function ue(e){return function(t){return"input"===t.nodeName.toLowerCase()&&t.type===e}}function he(e){return function(t){var i=t.nodeName.toLowerCase();return("input"===i||"button"===i)&&t.type===e}}function pe(e){return function(t){return"form"in t?t.parentNode&&!1===t.disabled?"label"in t?"label"in t.parentNode?t.parentNode.disabled===e:t.disabled===e:t.isDisabled===e||t.isDisabled!==!e&&ne(t)===e:t.disabled===e:"label"in t&&t.disabled===e}}function ve(e){return se(function(t){return t=+t,se(function(i,o){for(var n,a=e([],i.length,t),r=a.length;r--;)i[n=a[r]]&&(i[n]=!(o[n]=i[n]))})})}function ge(e){return e&&void 0!==e.getElementsByTagName&&e}for(t in i=ae.support={},a=ae.isXML=function(e){var t=e&&(e.ownerDocument||e).documentElement;return!!t&&"HTML"!==t.nodeName},h=ae.setDocument=function(e){var t,n,r=e?e.ownerDocument||e:b;return r!==p&&9===r.nodeType&&r.documentElement?(v=(p=r).documentElement,g=!a(p),b!==p&&(n=p.defaultView)&&n.top!==n&&(n.addEventListener?n.addEventListener("unload",oe,!1):n.attachEvent&&n.attachEvent("onunload",oe)),i.attributes=le(function(e){return e.className="i",!e.getAttribute("className")}),i.getElementsByTagName=le(function(e){return e.appendChild(p.createComment("")),!e.getElementsByTagName("*").length}),i.getElementsByClassName=K.test(p.getElementsByClassName),i.getById=le(function(e){return v.appendChild(e).id=C,!p.getElementsByName||!p.getElementsByName(C).length}),i.getById?(o.filter.ID=function(e){var t=e.replace(Z,ee);return function(e){return e.getAttribute("id")===t}},o.find.ID=function(e,t){if(void 0!==t.getElementById&&g){var i=t.getElementById(e);return i?[i]:[]}}):(o.filter.ID=function(e){var t=e.replace(Z,ee);return function(e){var i=void 0!==e.getAttributeNode&&e.getAttributeNode("id");return i&&i.value===t}},o.find.ID=function(e,t){if(void 0!==t.getElementById&&g){var i,o,n,a=t.getElementById(e);if(a){if((i=a.getAttributeNode("id"))&&i.value===e)return[a];for(n=t.getElementsByName(e),o=0;a=n[o++];)if((i=a.getAttributeNode("id"))&&i.value===e)return[a]}return[]}}),o.find.TAG=i.getElementsByTagName?function(e,t){return void 0!==t.getElementsByTagName?t.getElementsByTagName(e):i.qsa?t.querySelectorAll(e):void 0}:function(e,t){var i,o=[],n=0,a=t.getElementsByTagName(e);if("*"===e){for(;i=a[n++];)1===i.nodeType&&o.push(i);return o}return a},o.find.CLASS=i.getElementsByClassName&&function(e,t){if(void 0!==t.getElementsByClassName&&g)return t.getElementsByClassName(e)},f=[],m=[],(i.qsa=K.test(p.querySelectorAll))&&(le(function(e){v.appendChild(e).innerHTML="<a id='"+C+"'></a><select id='"+C+"-\r\\' msallowcapture=''><option selected=''></option></select>",e.querySelectorAll("[msallowcapture^='']").length&&m.push("[*^$]="+M+"*(?:''|\"\")"),e.querySelectorAll("[selected]").length||m.push("\\["+M+"*(?:value|"+P+")"),e.querySelectorAll("[id~="+C+"-]").length||m.push("~="),e.querySelectorAll(":checked").length||m.push(":checked"),e.querySelectorAll("a#"+C+"+*").length||m.push(".#.+[+~]")}),le(function(e){e.innerHTML="<a href='' disabled='disabled'></a><select disabled='disabled'><option/></select>";var t=p.createElement("input");t.setAttribute("type","hidden"),e.appendChild(t).setAttribute("name","D"),e.querySelectorAll("[name=d]").length&&m.push("name"+M+"*[*^$|!~]?="),2!==e.querySelectorAll(":enabled").length&&m.push(":enabled",":disabled"),v.appendChild(e).disabled=!0,2!==e.querySelectorAll(":disabled").length&&m.push(":enabled",":disabled"),e.querySelectorAll("*,:x"),m.push(",.*:")})),(i.matchesSelector=K.test(S=v.matches||v.webkitMatchesSelector||v.mozMatchesSelector||v.oMatchesSelector||v.msMatchesSelector))&&le(function(e){i.disconnectedMatch=S.call(e,"*"),S.call(e,"[s!='']:x"),f.push("!=",B)}),m=m.length&&new RegExp(m.join("|")),f=f.length&&new RegExp(f.join("|")),t=K.test(v.compareDocumentPosition),_=t||K.test(v.contains)?function(e,t){var i=9===e.nodeType?e.documentElement:e,o=t&&t.parentNode;return e===o||!(!o||1!==o.nodeType||!(i.contains?i.contains(o):e.compareDocumentPosition&&16&e.compareDocumentPosition(o)))}:function(e,t){if(t)for(;t=t.parentNode;)if(t===e)return!0;return!1},I=t?function(e,t){if(e===t)return u=!0,0;var o=!e.compareDocumentPosition-!t.compareDocumentPosition;return o||(1&(o=(e.ownerDocument||e)===(t.ownerDocument||t)?e.compareDocumentPosition(t):1)||!i.sortDetached&&t.compareDocumentPosition(e)===o?e===p||e.ownerDocument===b&&_(b,e)?-1:t===p||t.ownerDocument===b&&_(b,t)?1:d?D(d,e)-D(d,t):0:4&o?-1:1)}:function(e,t){if(e===t)return u=!0,0;var i,o=0,n=e.parentNode,a=t.parentNode,r=[e],s=[t];if(!n||!a)return e===p?-1:t===p?1:n?-1:a?1:d?D(d,e)-D(d,t):0;if(n===a)return de(e,t);for(i=e;i=i.parentNode;)r.unshift(i);for(i=t;i=i.parentNode;)s.unshift(i);for(;r[o]===s[o];)o++;return o?de(r[o],s[o]):r[o]===b?-1:s[o]===b?1:0},p):p},ae.matches=function(e,t){return ae(e,null,null,t)},ae.matchesSelector=function(e,t){if((e.ownerDocument||e)!==p&&h(e),t=t.replace(W,"='$1']"),i.matchesSelector&&g&&!A[t+" "]&&(!f||!f.test(t))&&(!m||!m.test(t)))try{var o=S.call(e,t);if(o||i.disconnectedMatch||e.document&&11!==e.document.nodeType)return o}catch(e){}return ae(t,p,null,[e]).length>0},ae.contains=function(e,t){return(e.ownerDocument||e)!==p&&h(e),_(e,t)},ae.attr=function(e,t){(e.ownerDocument||e)!==p&&h(e);var n=o.attrHandle[t.toLowerCase()],a=n&&w.call(o.attrHandle,t.toLowerCase())?n(e,t,!g):void 0;return void 0!==a?a:i.attributes||!g?e.getAttribute(t):(a=e.getAttributeNode(t))&&a.specified?a.value:null},ae.escape=function(e){return(e+"").replace(te,ie)},ae.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)},ae.uniqueSort=function(e){var t,o=[],n=0,a=0;if(u=!i.detectDuplicates,d=!i.sortStable&&e.slice(0),e.sort(I),u){for(;t=e[a++];)t===e[a]&&(n=o.push(a));for(;n--;)e.splice(o[n],1)}return d=null,e},n=ae.getText=function(e){var t,i="",o=0,a=e.nodeType;if(a){if(1===a||9===a||11===a){if("string"==typeof e.textContent)return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)i+=n(e)}else if(3===a||4===a)return e.nodeValue}else for(;t=e[o++];)i+=n(t);return i},(o=ae.selectors={cacheLength:50,createPseudo:se,match:Y,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(Z,ee),e[3]=(e[3]||e[4]||e[5]||"").replace(Z,ee),"~="===e[2]&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),"nth"===e[1].slice(0,3)?(e[3]||ae.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*("even"===e[3]||"odd"===e[3])),e[5]=+(e[7]+e[8]||"odd"===e[3])):e[3]&&ae.error(e[0]),e},PSEUDO:function(e){var t,i=!e[6]&&e[2];return Y.CHILD.test(e[0])?null:(e[3]?e[2]=e[4]||e[5]||"":i&&j.test(i)&&(t=r(i,!0))&&(t=i.indexOf(")",i.length-t)-i.length)&&(e[0]=e[0].slice(0,t),e[2]=i.slice(0,t)),e.slice(0,3))}},filter:{TAG:function(e){var t=e.replace(Z,ee).toLowerCase();return"*"===e?function(){return!0}:function(e){return e.nodeName&&e.nodeName.toLowerCase()===t}},CLASS:function(e){var t=y[e+" "];return t||(t=new RegExp("(^|"+M+")"+e+"("+M+"|$)"))&&y(e,function(e){return t.test("string"==typeof e.className&&e.className||void 0!==e.getAttribute&&e.getAttribute("class")||"")})},ATTR:function(e,t,i){return function(o){var n=ae.attr(o,e);return null==n?"!="===t:!t||(n+="","="===t?n===i:"!="===t?n!==i:"^="===t?i&&0===n.indexOf(i):"*="===t?i&&n.indexOf(i)>-1:"$="===t?i&&n.slice(-i.length)===i:"~="===t?(" "+n.replace(F," ")+" ").indexOf(i)>-1:"|="===t&&(n===i||n.slice(0,i.length+1)===i+"-"))}},CHILD:function(e,t,i,o,n){var a="nth"!==e.slice(0,3),r="last"!==e.slice(-4),s="of-type"===t;return 1===o&&0===n?function(e){return!!e.parentNode}:function(t,i,l){var c,d,u,h,p,v,g=a!==r?"nextSibling":"previousSibling",m=t.parentNode,f=s&&t.nodeName.toLowerCase(),S=!l&&!s,_=!1;if(m){if(a){for(;g;){for(h=t;h=h[g];)if(s?h.nodeName.toLowerCase()===f:1===h.nodeType)return!1;v=g="only"===e&&!v&&"nextSibling"}return!0}if(v=[r?m.firstChild:m.lastChild],r&&S){for(_=(p=(c=(d=(u=(h=m)[C]||(h[C]={}))[h.uniqueID]||(u[h.uniqueID]={}))[e]||[])[0]===E&&c[1])&&c[2],h=p&&m.childNodes[p];h=++p&&h&&h[g]||(_=p=0)||v.pop();)if(1===h.nodeType&&++_&&h===t){d[e]=[E,p,_];break}}else if(S&&(_=p=(c=(d=(u=(h=t)[C]||(h[C]={}))[h.uniqueID]||(u[h.uniqueID]={}))[e]||[])[0]===E&&c[1]),!1===_)for(;(h=++p&&h&&h[g]||(_=p=0)||v.pop())&&((s?h.nodeName.toLowerCase()!==f:1!==h.nodeType)||!++_||(S&&((d=(u=h[C]||(h[C]={}))[h.uniqueID]||(u[h.uniqueID]={}))[e]=[E,_]),h!==t)););return(_-=n)===o||_%o==0&&_/o>=0}}},PSEUDO:function(e,t){var i,n=o.pseudos[e]||o.setFilters[e.toLowerCase()]||ae.error("unsupported pseudo: "+e);return n[C]?n(t):n.length>1?(i=[e,e,"",t],o.setFilters.hasOwnProperty(e.toLowerCase())?se(function(e,i){for(var o,a=n(e,t),r=a.length;r--;)e[o=D(e,a[r])]=!(i[o]=a[r])}):function(e){return n(e,0,i)}):n}},pseudos:{not:se(function(e){var t=[],i=[],o=s(e.replace(q,"$1"));return o[C]?se(function(e,t,i,n){for(var a,r=o(e,null,n,[]),s=e.length;s--;)(a=r[s])&&(e[s]=!(t[s]=a))}):function(e,n,a){return t[0]=e,o(t,null,a,i),t[0]=null,!i.pop()}}),has:se(function(e){return function(t){return ae(e,t).length>0}}),contains:se(function(e){return e=e.replace(Z,ee),function(t){return(t.textContent||t.innerText||n(t)).indexOf(e)>-1}}),lang:se(function(e){return G.test(e||"")||ae.error("unsupported lang: "+e),e=e.replace(Z,ee).toLowerCase(),function(t){var i;do{if(i=g?t.lang:t.getAttribute("xml:lang")||t.getAttribute("lang"))return(i=i.toLowerCase())===e||0===i.indexOf(e+"-")}while((t=t.parentNode)&&1===t.nodeType);return!1}}),target:function(t){var i=e.location&&e.location.hash;return i&&i.slice(1)===t.id},root:function(e){return e===v},focus:function(e){return e===p.activeElement&&(!p.hasFocus||p.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},enabled:pe(!1),disabled:pe(!0),checked:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&!!e.checked||"option"===t&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,!0===e.selected},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeType<6)return!1;return!0},parent:function(e){return!o.pseudos.empty(e)},header:function(e){return Q.test(e.nodeName)},input:function(e){return J.test(e.nodeName)},button:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&"button"===e.type||"button"===t},text:function(e){var t;return"input"===e.nodeName.toLowerCase()&&"text"===e.type&&(null==(t=e.getAttribute("type"))||"text"===t.toLowerCase())},first:ve(function(){return[0]}),last:ve(function(e,t){return[t-1]}),eq:ve(function(e,t,i){return[i<0?i+t:i]}),even:ve(function(e,t){for(var i=0;i<t;i+=2)e.push(i);return e}),odd:ve(function(e,t){for(var i=1;i<t;i+=2)e.push(i);return e}),lt:ve(function(e,t,i){for(var o=i<0?i+t:i;--o>=0;)e.push(o);return e}),gt:ve(function(e,t,i){for(var o=i<0?i+t:i;++o<t;)e.push(o);return e})}}).pseudos.nth=o.pseudos.eq,{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})o.pseudos[t]=ue(t);for(t in{submit:!0,reset:!0})o.pseudos[t]=he(t);function me(){}function fe(e){for(var t=0,i=e.length,o="";t<i;t++)o+=e[t].value;return o}function Se(e,t,i){var o=t.dir,n=t.next,a=n||o,r=i&&"parentNode"===a,s=R++;return t.first?function(t,i,n){for(;t=t[o];)if(1===t.nodeType||r)return e(t,i,n);return!1}:function(t,i,l){var c,d,u,h=[E,s];if(l){for(;t=t[o];)if((1===t.nodeType||r)&&e(t,i,l))return!0}else for(;t=t[o];)if(1===t.nodeType||r)if(d=(u=t[C]||(t[C]={}))[t.uniqueID]||(u[t.uniqueID]={}),n&&n===t.nodeName.toLowerCase())t=t[o]||t;else{if((c=d[a])&&c[0]===E&&c[1]===s)return h[2]=c[2];if(d[a]=h,h[2]=e(t,i,l))return!0}return!1}}function _e(e){return e.length>1?function(t,i,o){for(var n=e.length;n--;)if(!e[n](t,i,o))return!1;return!0}:e[0]}function Ce(e,t,i,o,n){for(var a,r=[],s=0,l=e.length,c=null!=t;s<l;s++)(a=e[s])&&(i&&!i(a,o,n)||(r.push(a),c&&t.push(s)));return r}function be(e,t,i,o,n,a){return o&&!o[C]&&(o=be(o)),n&&!n[C]&&(n=be(n,a)),se(function(a,r,s,l){var c,d,u,h=[],p=[],v=r.length,g=a||function(e,t,i){for(var o=0,n=t.length;o<n;o++)ae(e,t[o],i);return i}(t||"*",s.nodeType?[s]:s,[]),m=!e||!a&&t?g:Ce(g,h,e,s,l),f=i?n||(a?e:v||o)?[]:r:m;if(i&&i(m,f,s,l),o)for(c=Ce(f,p),o(c,[],s,l),d=c.length;d--;)(u=c[d])&&(f[p[d]]=!(m[p[d]]=u));if(a){if(n||e){if(n){for(c=[],d=f.length;d--;)(u=f[d])&&c.push(m[d]=u);n(null,f=[],c,l)}for(d=f.length;d--;)(u=f[d])&&(c=n?D(a,u):h[d])>-1&&(a[c]=!(r[c]=u))}}else f=Ce(f===r?f.splice(v,f.length):f),n?n(null,r,f,l):L.apply(r,f)})}function Ee(e){for(var t,i,n,a=e.length,r=o.relative[e[0].type],s=r||o.relative[" "],l=r?1:0,d=Se(function(e){return e===t},s,!0),u=Se(function(e){return D(t,e)>-1},s,!0),h=[function(e,i,o){var n=!r&&(o||i!==c)||((t=i).nodeType?d(e,i,o):u(e,i,o));return t=null,n}];l<a;l++)if(i=o.relative[e[l].type])h=[Se(_e(h),i)];else{if((i=o.filter[e[l].type].apply(null,e[l].matches))[C]){for(n=++l;n<a&&!o.relative[e[n].type];n++);return be(l>1&&_e(h),l>1&&fe(e.slice(0,l-1).concat({value:" "===e[l-2].type?"*":""})).replace(q,"$1"),i,l<n&&Ee(e.slice(l,n)),n<a&&Ee(e=e.slice(n)),n<a&&fe(e))}h.push(i)}return _e(h)}function Re(e,t){var i=t.length>0,n=e.length>0,a=function(a,r,s,l,d){var u,v,m,f=0,S="0",_=a&&[],C=[],b=c,R=a||n&&o.find.TAG("*",d),y=E+=null==b?1:Math.random()||.1,T=R.length;for(d&&(c=r===p||r||d);S!==T&&null!=(u=R[S]);S++){if(n&&u){for(v=0,r||u.ownerDocument===p||(h(u),s=!g);m=e[v++];)if(m(u,r||p,s)){l.push(u);break}d&&(E=y)}i&&((u=!m&&u)&&f--,a&&_.push(u))}if(f+=S,i&&S!==f){for(v=0;m=t[v++];)m(_,C,r,s);if(a){if(f>0)for(;S--;)_[S]||C[S]||(C[S]=x.call(l));C=Ce(C)}L.apply(l,C),d&&!a&&C.length>0&&f+t.length>1&&ae.uniqueSort(l)}return d&&(E=y,c=b),_};return i?se(a):a}return me.prototype=o.filters=o.pseudos,o.setFilters=new me,r=ae.tokenize=function(e,t){var i,n,a,r,s,l,c,d=T[e+" "];if(d)return t?0:d.slice(0);for(s=e,l=[],c=o.preFilter;s;){for(r in i&&!(n=z.exec(s))||(n&&(s=s.slice(n[0].length)||s),l.push(a=[])),i=!1,(n=H.exec(s))&&(i=n.shift(),a.push({value:i,type:n[0].replace(q," ")}),s=s.slice(i.length)),o.filter)!(n=Y[r].exec(s))||c[r]&&!(n=c[r](n))||(i=n.shift(),a.push({value:i,type:r,matches:n}),s=s.slice(i.length));if(!i)break}return t?s.length:s?ae.error(e):T(e,l).slice(0)},s=ae.compile=function(e,t){var i,o=[],n=[],a=A[e+" "];if(!a){for(t||(t=r(e)),i=t.length;i--;)(a=Ee(t[i]))[C]?o.push(a):n.push(a);(a=A(e,Re(n,o))).selector=e}return a},l=ae.select=function(e,t,i,n){var a,l,c,d,u,h="function"==typeof e&&e,p=!n&&r(e=h.selector||e);if(i=i||[],1===p.length){if((l=p[0]=p[0].slice(0)).length>2&&"ID"===(c=l[0]).type&&9===t.nodeType&&g&&o.relative[l[1].type]){if(!(t=(o.find.ID(c.matches[0].replace(Z,ee),t)||[])[0]))return i;h&&(t=t.parentNode),e=e.slice(l.shift().value.length)}for(a=Y.needsContext.test(e)?0:l.length;a--&&(c=l[a],!o.relative[d=c.type]);)if((u=o.find[d])&&(n=u(c.matches[0].replace(Z,ee),$.test(l[0].type)&&ge(t.parentNode)||t))){if(l.splice(a,1),!(e=n.length&&fe(l)))return L.apply(i,n),i;break}}return(h||s(e,p))(n,t,!g,i,!t||$.test(e)&&ge(t.parentNode)||t),i},i.sortStable=C.split("").sort(I).join("")===C,i.detectDuplicates=!!u,h(),i.sortDetached=le(function(e){return 1&e.compareDocumentPosition(p.createElement("fieldset"))}),le(function(e){return e.innerHTML="<a href='#'></a>","#"===e.firstChild.getAttribute("href")})||ce("type|href|height|width",function(e,t,i){if(!i)return e.getAttribute(t,"type"===t.toLowerCase()?1:2)}),i.attributes&&le(function(e){return e.innerHTML="<input/>",e.firstChild.setAttribute("value",""),""===e.firstChild.getAttribute("value")})||ce("value",function(e,t,i){if(!i&&"input"===e.nodeName.toLowerCase())return e.defaultValue}),le(function(e){return null==e.getAttribute("disabled")})||ce(P,function(e,t,i){var o;if(!i)return!0===e[t]?t.toLowerCase():(o=e.getAttributeNode(t))&&o.specified?o.value:null}),ae}(e);f.find=R,f.expr=R.selectors,f.expr[":"]=f.expr.pseudos,f.uniqueSort=f.unique=R.uniqueSort,f.text=R.getText,f.isXMLDoc=R.isXML,f.contains=R.contains,f.escapeSelector=R.escape;var y=function(e,t,i){for(var o=[],n=void 0!==i;(e=e[t])&&9!==e.nodeType;)if(1===e.nodeType){if(n&&f(e).is(i))break;o.push(e)}return o},T=function(e,t){for(var i=[];e;e=e.nextSibling)1===e.nodeType&&e!==t&&i.push(e);return i},A=f.expr.match.needsContext,I=/^<([a-z][^\/\0>:\x20\t\r\n\f]*)[\x20\t\r\n\f]*\/?>(?:<\/\1>|)$/i,w=/^.[^:#\[\.,]*$/;function k(e,t,i){return f.isFunction(t)?f.grep(e,function(e,o){return!!t.call(e,o,e)!==i}):t.nodeType?f.grep(e,function(e){return e===t!==i}):"string"!=typeof t?f.grep(e,function(e){return l.call(t,e)>-1!==i}):w.test(t)?f.filter(t,e,i):(t=f.filter(t,e),f.grep(e,function(e){return l.call(t,e)>-1!==i&&1===e.nodeType}))}f.filter=function(e,t,i){var o=t[0];return i&&(e=":not("+e+")"),1===t.length&&1===o.nodeType?f.find.matchesSelector(o,e)?[o]:[]:f.find.matches(e,f.grep(t,function(e){return 1===e.nodeType}))},f.fn.extend({find:function(e){var t,i,o=this.length,n=this;if("string"!=typeof e)return this.pushStack(f(e).filter(function(){for(t=0;t<o;t++)if(f.contains(n[t],this))return!0}));for(i=this.pushStack([]),t=0;t<o;t++)f.find(e,n[t],i);return o>1?f.uniqueSort(i):i},filter:function(e){return this.pushStack(k(this,e||[],!1))},not:function(e){return this.pushStack(k(this,e||[],!0))},is:function(e){return!!k(this,"string"==typeof e&&A.test(e)?f(e):e||[],!1).length}});var x,O=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]+))$/;(f.fn.init=function(e,t,i){var n,a;if(!e)return this;if(i=i||x,"string"==typeof e){if(!(n="<"===e[0]&&">"===e[e.length-1]&&e.length>=3?[null,e,null]:O.exec(e))||!n[1]&&t)return!t||t.jquery?(t||i).find(e):this.constructor(t).find(e);if(n[1]){if(t=t instanceof f?t[0]:t,f.merge(this,f.parseHTML(n[1],t&&t.nodeType?t.ownerDocument||t:o,!0)),I.test(n[1])&&f.isPlainObject(t))for(n in t)f.isFunction(this[n])?this[n](t[n]):this.attr(n,t[n]);return this}return(a=o.getElementById(n[2]))&&(this[0]=a,this.length=1),this}return e.nodeType?(this[0]=e,this.length=1,this):f.isFunction(e)?void 0!==i.ready?i.ready(e):e(f):f.makeArray(e,this)}).prototype=f.fn,x=f(o);var L=/^(?:parents|prev(?:Until|All))/,N={children:!0,contents:!0,next:!0,prev:!0};function D(e,t){for(;(e=e[t])&&1!==e.nodeType;);return e}f.fn.extend({has:function(e){var t=f(e,this),i=t.length;return this.filter(function(){for(var e=0;e<i;e++)if(f.contains(this,t[e]))return!0})},closest:function(e,t){var i,o=0,n=this.length,a=[],r="string"!=typeof e&&f(e);if(!A.test(e))for(;o<n;o++)for(i=this[o];i&&i!==t;i=i.parentNode)if(i.nodeType<11&&(r?r.index(i)>-1:1===i.nodeType&&f.find.matchesSelector(i,e))){a.push(i);break}return this.pushStack(a.length>1?f.uniqueSort(a):a)},index:function(e){return e?"string"==typeof e?l.call(f(e),this[0]):l.call(this,e.jquery?e[0]:e):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(e,t){return this.pushStack(f.uniqueSort(f.merge(this.get(),f(e,t))))},addBack:function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}}),f.each({parent:function(e){var t=e.parentNode;return t&&11!==t.nodeType?t:null},parents:function(e){return y(e,"parentNode")},parentsUntil:function(e,t,i){return y(e,"parentNode",i)},next:function(e){return D(e,"nextSibling")},prev:function(e){return D(e,"previousSibling")},nextAll:function(e){return y(e,"nextSibling")},prevAll:function(e){return y(e,"previousSibling")},nextUntil:function(e,t,i){return y(e,"nextSibling",i)},prevUntil:function(e,t,i){return y(e,"previousSibling",i)},siblings:function(e){return T((e.parentNode||{}).firstChild,e)},children:function(e){return T(e.firstChild)},contents:function(e){return e.contentDocument||f.merge([],e.childNodes)}},function(e,t){f.fn[e]=function(i,o){var n=f.map(this,t,i);return"Until"!==e.slice(-5)&&(o=i),o&&"string"==typeof o&&(n=f.filter(o,n)),this.length>1&&(N[e]||f.uniqueSort(n),L.test(e)&&n.reverse()),this.pushStack(n)}});var P=/[^\x20\t\r\n\f]+/g;function M(e){return e}function V(e){throw e}function U(e,t,i){var o;try{e&&f.isFunction(o=e.promise)?o.call(e).done(t).fail(i):e&&f.isFunction(o=e.then)?o.call(e,t,i):t.call(void 0,e)}catch(e){i.call(void 0,e)}}f.Callbacks=function(e){e="string"==typeof e?function(e){var t={};return f.each(e.match(P)||[],function(e,i){t[i]=!0}),t}(e):f.extend({},e);var t,i,o,n,a=[],r=[],s=-1,l=function(){for(n=e.once,o=t=!0;r.length;s=-1)for(i=r.shift();++s<a.length;)!1===a[s].apply(i[0],i[1])&&e.stopOnFalse&&(s=a.length,i=!1);e.memory||(i=!1),t=!1,n&&(a=i?[]:"")},c={add:function(){return a&&(i&&!t&&(s=a.length-1,r.push(i)),function t(i){f.each(i,function(i,o){f.isFunction(o)?e.unique&&c.has(o)||a.push(o):o&&o.length&&"string"!==f.type(o)&&t(o)})}(arguments),i&&!t&&l()),this},remove:function(){return f.each(arguments,function(e,t){for(var i;(i=f.inArray(t,a,i))>-1;)a.splice(i,1),i<=s&&s--}),this},has:function(e){return e?f.inArray(e,a)>-1:a.length>0},empty:function(){return a&&(a=[]),this},disable:function(){return n=r=[],a=i="",this},disabled:function(){return!a},lock:function(){return n=r=[],i||t||(a=i=""),this},locked:function(){return!!n},fireWith:function(e,i){return n||(i=[e,(i=i||[]).slice?i.slice():i],r.push(i),t||l()),this},fire:function(){return c.fireWith(this,arguments),this},fired:function(){return!!o}};return c},f.extend({Deferred:function(t){var i=[["notify","progress",f.Callbacks("memory"),f.Callbacks("memory"),2],["resolve","done",f.Callbacks("once memory"),f.Callbacks("once memory"),0,"resolved"],["reject","fail",f.Callbacks("once memory"),f.Callbacks("once memory"),1,"rejected"]],o="pending",n={state:function(){return o},always:function(){return a.done(arguments).fail(arguments),this},catch:function(e){return n.then(null,e)},pipe:function(){var e=arguments;return f.Deferred(function(t){f.each(i,function(i,o){var n=f.isFunction(e[o[4]])&&e[o[4]];a[o[1]](function(){var e=n&&n.apply(this,arguments);e&&f.isFunction(e.promise)?e.promise().progress(t.notify).done(t.resolve).fail(t.reject):t[o[0]+"With"](this,n?[e]:arguments)})}),e=null}).promise()},then:function(t,o,n){var a=0;function r(t,i,o,n){return function(){var s=this,l=arguments,c=function(){var e,c;if(!(t<a)){if((e=o.apply(s,l))===i.promise())throw new TypeError("Thenable self-resolution");c=e&&("object"==typeof e||"function"==typeof e)&&e.then,f.isFunction(c)?n?c.call(e,r(a,i,M,n),r(a,i,V,n)):(a++,c.call(e,r(a,i,M,n),r(a,i,V,n),r(a,i,M,i.notifyWith))):(o!==M&&(s=void 0,l=[e]),(n||i.resolveWith)(s,l))}},d=n?c:function(){try{c()}catch(e){f.Deferred.exceptionHook&&f.Deferred.exceptionHook(e,d.stackTrace),t+1>=a&&(o!==V&&(s=void 0,l=[e]),i.rejectWith(s,l))}};t?d():(f.Deferred.getStackHook&&(d.stackTrace=f.Deferred.getStackHook()),e.setTimeout(d))}}return f.Deferred(function(e){i[0][3].add(r(0,e,f.isFunction(n)?n:M,e.notifyWith)),i[1][3].add(r(0,e,f.isFunction(t)?t:M)),i[2][3].add(r(0,e,f.isFunction(o)?o:V))}).promise()},promise:function(e){return null!=e?f.extend(e,n):n}},a={};return f.each(i,function(e,t){var r=t[2],s=t[5];n[t[1]]=r.add,s&&r.add(function(){o=s},i[3-e][2].disable,i[0][2].lock),r.add(t[3].fire),a[t[0]]=function(){return a[t[0]+"With"](this===a?void 0:this,arguments),this},a[t[0]+"With"]=r.fireWith}),n.promise(a),t&&t.call(a,a),a},when:function(e){var t=arguments.length,i=t,o=Array(i),n=a.call(arguments),r=f.Deferred(),s=function(e){return function(i){o[e]=this,n[e]=arguments.length>1?a.call(arguments):i,--t||r.resolveWith(o,n)}};if(t<=1&&(U(e,r.done(s(i)).resolve,r.reject),"pending"===r.state()||f.isFunction(n[i]&&n[i].then)))return r.then();for(;i--;)U(n[i],s(i),r.reject);return r.promise()}});var B=/^(Eval|Internal|Range|Reference|Syntax|Type|URI)Error$/;f.Deferred.exceptionHook=function(t,i){e.console&&e.console.warn&&t&&B.test(t.name)&&e.console.warn("jQuery.Deferred exception: "+t.message,t.stack,i)},f.readyException=function(t){e.setTimeout(function(){throw t})};var F=f.Deferred();function q(){o.removeEventListener("DOMContentLoaded",q),e.removeEventListener("load",q),f.ready()}f.fn.ready=function(e){return F.then(e).catch(function(e){f.readyException(e)}),this},f.extend({isReady:!1,readyWait:1,holdReady:function(e){e?f.readyWait++:f.ready(!0)},ready:function(e){(!0===e?--f.readyWait:f.isReady)||(f.isReady=!0,!0!==e&&--f.readyWait>0||F.resolveWith(o,[f]))}}),f.ready.then=F.then,"complete"===o.readyState||"loading"!==o.readyState&&!o.documentElement.doScroll?e.setTimeout(f.ready):(o.addEventListener("DOMContentLoaded",q),e.addEventListener("load",q));var z=function(e,t,i,o,n,a,r){var s=0,l=e.length,c=null==i;if("object"===f.type(i))for(s in n=!0,i)z(e,t,s,i[s],!0,a,r);else if(void 0!==o&&(n=!0,f.isFunction(o)||(r=!0),c&&(r?(t.call(e,o),t=null):(c=t,t=function(e,t,i){return c.call(f(e),i)})),t))for(;s<l;s++)t(e[s],i,r?o:o.call(e[s],s,t(e[s],i)));return n?e:c?t.call(e):l?t(e[0],i):a},H=function(e){return 1===e.nodeType||9===e.nodeType||!+e.nodeType};function W(){this.expando=f.expando+W.uid++}W.uid=1,W.prototype={cache:function(e){var t=e[this.expando];return t||(t={},H(e)&&(e.nodeType?e[this.expando]=t:Object.defineProperty(e,this.expando,{value:t,configurable:!0}))),t},set:function(e,t,i){var o,n=this.cache(e);if("string"==typeof t)n[f.camelCase(t)]=i;else for(o in t)n[f.camelCase(o)]=t[o];return n},get:function(e,t){return void 0===t?this.cache(e):e[this.expando]&&e[this.expando][f.camelCase(t)]},access:function(e,t,i){return void 0===t||t&&"string"==typeof t&&void 0===i?this.get(e,t):(this.set(e,t,i),void 0!==i?i:t)},remove:function(e,t){var i,o=e[this.expando];if(void 0!==o){if(void 0!==t){f.isArray(t)?t=t.map(f.camelCase):t=(t=f.camelCase(t))in o?[t]:t.match(P)||[],i=t.length;for(;i--;)delete o[t[i]]}(void 0===t||f.isEmptyObject(o))&&(e.nodeType?e[this.expando]=void 0:delete e[this.expando])}},hasData:function(e){var t=e[this.expando];return void 0!==t&&!f.isEmptyObject(t)}};var j=new W,G=new W,Y=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,J=/[A-Z]/g;function $(e,t,i){var o;if(void 0===i&&1===e.nodeType)if(o="data-"+t.replace(J,"-$&").toLowerCase(),"string"==typeof(i=e.getAttribute(o))){try{i=function(e){return"true"===e||"false"!==e&&("null"===e?null:e===+e+""?+e:Y.test(e)?JSON.parse(e):e)}(i)}catch(e){}G.set(e,t,i)}else i=void 0;return i}f.extend({hasData:function(e){return G.hasData(e)||j.hasData(e)},data:function(e,t,i){return G.access(e,t,i)},removeData:function(e,t){G.remove(e,t)},_data:function(e,t,i){return j.access(e,t,i)},_removeData:function(e,t){j.remove(e,t)}}),f.fn.extend({data:function(e,t){var i,o,n,a=this[0],r=a&&a.attributes;if(void 0===e){if(this.length&&(n=G.get(a),1===a.nodeType&&!j.get(a,"hasDataAttrs"))){for(i=r.length;i--;)r[i]&&(0===(o=r[i].name).indexOf("data-")&&(o=f.camelCase(o.slice(5)),$(a,o,n[o])));j.set(a,"hasDataAttrs",!0)}return n}return"object"==typeof e?this.each(function(){G.set(this,e)}):z(this,function(t){var i;if(a&&void 0===t){if(void 0!==(i=G.get(a,e)))return i;if(void 0!==(i=$(a,e)))return i}else this.each(function(){G.set(this,e,t)})},null,t,arguments.length>1,null,!0)},removeData:function(e){return this.each(function(){G.remove(this,e)})}}),f.extend({queue:function(e,t,i){var o;if(e)return t=(t||"fx")+"queue",o=j.get(e,t),i&&(!o||f.isArray(i)?o=j.access(e,t,f.makeArray(i)):o.push(i)),o||[]},dequeue:function(e,t){t=t||"fx";var i=f.queue(e,t),o=i.length,n=i.shift(),a=f._queueHooks(e,t);"inprogress"===n&&(n=i.shift(),o--),n&&("fx"===t&&i.unshift("inprogress"),delete a.stop,n.call(e,function(){f.dequeue(e,t)},a)),!o&&a&&a.empty.fire()},_queueHooks:function(e,t){var i=t+"queueHooks";return j.get(e,i)||j.access(e,i,{empty:f.Callbacks("once memory").add(function(){j.remove(e,[t+"queue",i])})})}}),f.fn.extend({queue:function(e,t){var i=2;return"string"!=typeof e&&(t=e,e="fx",i--),arguments.length<i?f.queue(this[0],e):void 0===t?this:this.each(function(){var i=f.queue(this,e,t);f._queueHooks(this,e),"fx"===e&&"inprogress"!==i[0]&&f.dequeue(this,e)})},dequeue:function(e){return this.each(function(){f.dequeue(this,e)})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,t){var i,o=1,n=f.Deferred(),a=this,r=this.length,s=function(){--o||n.resolveWith(a,[a])};for("string"!=typeof e&&(t=e,e=void 0),e=e||"fx";r--;)(i=j.get(a[r],e+"queueHooks"))&&i.empty&&(o++,i.empty.add(s));return s(),n.promise(t)}});var Q=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,K=new RegExp("^(?:([+-])=|)("+Q+")([a-z%]*)$","i"),X=["Top","Right","Bottom","Left"],Z=function(e,t){return"none"===(e=t||e).style.display||""===e.style.display&&f.contains(e.ownerDocument,e)&&"none"===f.css(e,"display")},ee=function(e,t,i,o){var n,a,r={};for(a in t)r[a]=e.style[a],e.style[a]=t[a];for(a in n=i.apply(e,o||[]),t)e.style[a]=r[a];return n};function te(e,t,i,o){var n,a=1,r=20,s=o?function(){return o.cur()}:function(){return f.css(e,t,"")},l=s(),c=i&&i[3]||(f.cssNumber[t]?"":"px"),d=(f.cssNumber[t]||"px"!==c&&+l)&&K.exec(f.css(e,t));if(d&&d[3]!==c){c=c||d[3],i=i||[],d=+l||1;do{d/=a=a||".5",f.style(e,t,d+c)}while(a!==(a=s()/l)&&1!==a&&--r)}return i&&(d=+d||+l||0,n=i[1]?d+(i[1]+1)*i[2]:+i[2],o&&(o.unit=c,o.start=d,o.end=n)),n}var ie={};function oe(e){var t,i=e.ownerDocument,o=e.nodeName,n=ie[o];return n||(t=i.body.appendChild(i.createElement(o)),n=f.css(t,"display"),t.parentNode.removeChild(t),"none"===n&&(n="block"),ie[o]=n,n)}function ne(e,t){for(var i,o,n=[],a=0,r=e.length;a<r;a++)(o=e[a]).style&&(i=o.style.display,t?("none"===i&&(n[a]=j.get(o,"display")||null,n[a]||(o.style.display="")),""===o.style.display&&Z(o)&&(n[a]=oe(o))):"none"!==i&&(n[a]="none",j.set(o,"display",i)));for(a=0;a<r;a++)null!=n[a]&&(e[a].style.display=n[a]);return e}f.fn.extend({show:function(){return ne(this,!0)},hide:function(){return ne(this)},toggle:function(e){return"boolean"==typeof e?e?this.show():this.hide():this.each(function(){Z(this)?f(this).show():f(this).hide()})}});var ae=/^(?:checkbox|radio)$/i,re=/<([a-z][^\/\0>\x20\t\r\n\f]+)/i,se=/^$|\/(?:java|ecma)script/i,le={option:[1,"<select multiple='multiple'>","</select>"],thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};function ce(e,t){var i;return i=void 0!==e.getElementsByTagName?e.getElementsByTagName(t||"*"):void 0!==e.querySelectorAll?e.querySelectorAll(t||"*"):[],void 0===t||t&&f.nodeName(e,t)?f.merge([e],i):i}function de(e,t){for(var i=0,o=e.length;i<o;i++)j.set(e[i],"globalEval",!t||j.get(t[i],"globalEval"))}le.optgroup=le.option,le.tbody=le.tfoot=le.colgroup=le.caption=le.thead,le.th=le.td;var ue=/<|&#?\w+;/;function he(e,t,i,o,n){for(var a,r,s,l,c,d,u=t.createDocumentFragment(),h=[],p=0,v=e.length;p<v;p++)if((a=e[p])||0===a)if("object"===f.type(a))f.merge(h,a.nodeType?[a]:a);else if(ue.test(a)){for(r=r||u.appendChild(t.createElement("div")),s=(re.exec(a)||["",""])[1].toLowerCase(),l=le[s]||le._default,r.innerHTML=l[1]+f.htmlPrefilter(a)+l[2],d=l[0];d--;)r=r.lastChild;f.merge(h,r.childNodes),(r=u.firstChild).textContent=""}else h.push(t.createTextNode(a));for(u.textContent="",p=0;a=h[p++];)if(o&&f.inArray(a,o)>-1)n&&n.push(a);else if(c=f.contains(a.ownerDocument,a),r=ce(u.appendChild(a),"script"),c&&de(r),i)for(d=0;a=r[d++];)se.test(a.type||"")&&i.push(a);return u}!function(){var e=o.createDocumentFragment().appendChild(o.createElement("div")),t=o.createElement("input");t.setAttribute("type","radio"),t.setAttribute("checked","checked"),t.setAttribute("name","t"),e.appendChild(t),v.checkClone=e.cloneNode(!0).cloneNode(!0).lastChild.checked,e.innerHTML="<textarea>x</textarea>",v.noCloneChecked=!!e.cloneNode(!0).lastChild.defaultValue}();var pe=o.documentElement,ve=/^key/,ge=/^(?:mouse|pointer|contextmenu|drag|drop)|click/,me=/^([^.]*)(?:\.(.+)|)/;function fe(){return!0}function Se(){return!1}function _e(){try{return o.activeElement}catch(e){}}function Ce(e,t,i,o,n,a){var r,s;if("object"==typeof t){for(s in"string"!=typeof i&&(o=o||i,i=void 0),t)Ce(e,s,i,o,t[s],a);return e}if(null==o&&null==n?(n=i,o=i=void 0):null==n&&("string"==typeof i?(n=o,o=void 0):(n=o,o=i,i=void 0)),!1===n)n=Se;else if(!n)return e;return 1===a&&(r=n,(n=function(e){return f().off(e),r.apply(this,arguments)}).guid=r.guid||(r.guid=f.guid++)),e.each(function(){f.event.add(this,t,n,o,i)})}f.event={global:{},add:function(e,t,i,o,n){var a,r,s,l,c,d,u,h,p,v,g,m=j.get(e);if(m)for(i.handler&&(i=(a=i).handler,n=a.selector),n&&f.find.matchesSelector(pe,n),i.guid||(i.guid=f.guid++),(l=m.events)||(l=m.events={}),(r=m.handle)||(r=m.handle=function(t){return void 0!==f&&f.event.triggered!==t.type?f.event.dispatch.apply(e,arguments):void 0}),c=(t=(t||"").match(P)||[""]).length;c--;)p=g=(s=me.exec(t[c])||[])[1],v=(s[2]||"").split(".").sort(),p&&(u=f.event.special[p]||{},p=(n?u.delegateType:u.bindType)||p,u=f.event.special[p]||{},d=f.extend({type:p,origType:g,data:o,handler:i,guid:i.guid,selector:n,needsContext:n&&f.expr.match.needsContext.test(n),namespace:v.join(".")},a),(h=l[p])||((h=l[p]=[]).delegateCount=0,u.setup&&!1!==u.setup.call(e,o,v,r)||e.addEventListener&&e.addEventListener(p,r)),u.add&&(u.add.call(e,d),d.handler.guid||(d.handler.guid=i.guid)),n?h.splice(h.delegateCount++,0,d):h.push(d),f.event.global[p]=!0)},remove:function(e,t,i,o,n){var a,r,s,l,c,d,u,h,p,v,g,m=j.hasData(e)&&j.get(e);if(m&&(l=m.events)){for(c=(t=(t||"").match(P)||[""]).length;c--;)if(p=g=(s=me.exec(t[c])||[])[1],v=(s[2]||"").split(".").sort(),p){for(u=f.event.special[p]||{},h=l[p=(o?u.delegateType:u.bindType)||p]||[],s=s[2]&&new RegExp("(^|\\.)"+v.join("\\.(?:.*\\.|)")+"(\\.|$)"),r=a=h.length;a--;)d=h[a],!n&&g!==d.origType||i&&i.guid!==d.guid||s&&!s.test(d.namespace)||o&&o!==d.selector&&("**"!==o||!d.selector)||(h.splice(a,1),d.selector&&h.delegateCount--,u.remove&&u.remove.call(e,d));r&&!h.length&&(u.teardown&&!1!==u.teardown.call(e,v,m.handle)||f.removeEvent(e,p,m.handle),delete l[p])}else for(p in l)f.event.remove(e,p+t[c],i,o,!0);f.isEmptyObject(l)&&j.remove(e,"handle events")}},dispatch:function(e){var t,i,o,n,a,r,s=f.event.fix(e),l=new Array(arguments.length),c=(j.get(this,"events")||{})[s.type]||[],d=f.event.special[s.type]||{};for(l[0]=s,t=1;t<arguments.length;t++)l[t]=arguments[t];if(s.delegateTarget=this,!d.preDispatch||!1!==d.preDispatch.call(this,s)){for(r=f.event.handlers.call(this,s,c),t=0;(n=r[t++])&&!s.isPropagationStopped();)for(s.currentTarget=n.elem,i=0;(a=n.handlers[i++])&&!s.isImmediatePropagationStopped();)s.rnamespace&&!s.rnamespace.test(a.namespace)||(s.handleObj=a,s.data=a.data,void 0!==(o=((f.event.special[a.origType]||{}).handle||a.handler).apply(n.elem,l))&&!1===(s.result=o)&&(s.preventDefault(),s.stopPropagation()));return d.postDispatch&&d.postDispatch.call(this,s),s.result}},handlers:function(e,t){var i,o,n,a,r,s=[],l=t.delegateCount,c=e.target;if(l&&c.nodeType&&!("click"===e.type&&e.button>=1))for(;c!==this;c=c.parentNode||this)if(1===c.nodeType&&("click"!==e.type||!0!==c.disabled)){for(a=[],r={},i=0;i<l;i++)void 0===r[n=(o=t[i]).selector+" "]&&(r[n]=o.needsContext?f(n,this).index(c)>-1:f.find(n,this,null,[c]).length),r[n]&&a.push(o);a.length&&s.push({elem:c,handlers:a})}return c=this,l<t.length&&s.push({elem:c,handlers:t.slice(l)}),s},addProp:function(e,t){Object.defineProperty(f.Event.prototype,e,{enumerable:!0,configurable:!0,get:f.isFunction(t)?function(){if(this.originalEvent)return t(this.originalEvent)}:function(){if(this.originalEvent)return this.originalEvent[e]},set:function(t){Object.defineProperty(this,e,{enumerable:!0,configurable:!0,writable:!0,value:t})}})},fix:function(e){return e[f.expando]?e:new f.Event(e)},special:{load:{noBubble:!0},focus:{trigger:function(){if(this!==_e()&&this.focus)return this.focus(),!1},delegateType:"focusin"},blur:{trigger:function(){if(this===_e()&&this.blur)return this.blur(),!1},delegateType:"focusout"},click:{trigger:function(){if("checkbox"===this.type&&this.click&&f.nodeName(this,"input"))return this.click(),!1},_default:function(e){return f.nodeName(e.target,"a")}},beforeunload:{postDispatch:function(e){void 0!==e.result&&e.originalEvent&&(e.originalEvent.returnValue=e.result)}}}},f.removeEvent=function(e,t,i){e.removeEventListener&&e.removeEventListener(t,i)},f.Event=function(e,t){return this instanceof f.Event?(e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||void 0===e.defaultPrevented&&!1===e.returnValue?fe:Se,this.target=e.target&&3===e.target.nodeType?e.target.parentNode:e.target,this.currentTarget=e.currentTarget,this.relatedTarget=e.relatedTarget):this.type=e,t&&f.extend(this,t),this.timeStamp=e&&e.timeStamp||f.now(),void(this[f.expando]=!0)):new f.Event(e,t)},f.Event.prototype={constructor:f.Event,isDefaultPrevented:Se,isPropagationStopped:Se,isImmediatePropagationStopped:Se,isSimulated:!1,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=fe,e&&!this.isSimulated&&e.preventDefault()},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=fe,e&&!this.isSimulated&&e.stopPropagation()},stopImmediatePropagation:function(){var e=this.originalEvent;this.isImmediatePropagationStopped=fe,e&&!this.isSimulated&&e.stopImmediatePropagation(),this.stopPropagation()}},f.each({altKey:!0,bubbles:!0,cancelable:!0,changedTouches:!0,ctrlKey:!0,detail:!0,eventPhase:!0,metaKey:!0,pageX:!0,pageY:!0,shiftKey:!0,view:!0,char:!0,charCode:!0,key:!0,keyCode:!0,button:!0,buttons:!0,clientX:!0,clientY:!0,offsetX:!0,offsetY:!0,pointerId:!0,pointerType:!0,screenX:!0,screenY:!0,targetTouches:!0,toElement:!0,touches:!0,which:function(e){var t=e.button;return null==e.which&&ve.test(e.type)?null!=e.charCode?e.charCode:e.keyCode:!e.which&&void 0!==t&&ge.test(e.type)?1&t?1:2&t?3:4&t?2:0:e.which}},f.event.addProp),f.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(e,t){f.event.special[e]={delegateType:t,bindType:t,handle:function(e){var i,o=e.relatedTarget,n=e.handleObj;return o&&(o===this||f.contains(this,o))||(e.type=n.origType,i=n.handler.apply(this,arguments),e.type=t),i}}}),f.fn.extend({on:function(e,t,i,o){return Ce(this,e,t,i,o)},one:function(e,t,i,o){return Ce(this,e,t,i,o,1)},off:function(e,t,i){var o,n;if(e&&e.preventDefault&&e.handleObj)return o=e.handleObj,f(e.delegateTarget).off(o.namespace?o.origType+"."+o.namespace:o.origType,o.selector,o.handler),this;if("object"==typeof e){for(n in e)this.off(n,t,e[n]);return this}return!1!==t&&"function"!=typeof t||(i=t,t=void 0),!1===i&&(i=Se),this.each(function(){f.event.remove(this,e,i,t)})}});var be=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([a-z][^\/\0>\x20\t\r\n\f]*)[^>]*)\/>/gi,Ee=/<script|<style|<link/i,Re=/checked\s*(?:[^=]|=\s*.checked.)/i,ye=/^true\/(.*)/,Te=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g;function Ae(e,t){return f.nodeName(e,"table")&&f.nodeName(11!==t.nodeType?t:t.firstChild,"tr")&&e.getElementsByTagName("tbody")[0]||e}function Ie(e){return e.type=(null!==e.getAttribute("type"))+"/"+e.type,e}function we(e){var t=ye.exec(e.type);return t?e.type=t[1]:e.removeAttribute("type"),e}function ke(e,t){var i,o,n,a,r,s,l,c;if(1===t.nodeType){if(j.hasData(e)&&(a=j.access(e),r=j.set(t,a),c=a.events))for(n in delete r.handle,r.events={},c)for(i=0,o=c[n].length;i<o;i++)f.event.add(t,n,c[n][i]);G.hasData(e)&&(s=G.access(e),l=f.extend({},s),G.set(t,l))}}function xe(e,t){var i=t.nodeName.toLowerCase();"input"===i&&ae.test(e.type)?t.checked=e.checked:"input"!==i&&"textarea"!==i||(t.defaultValue=e.defaultValue)}function Oe(e,t,i,o){t=r.apply([],t);var n,a,s,l,c,d,u=0,h=e.length,p=h-1,m=t[0],S=f.isFunction(m);if(S||h>1&&"string"==typeof m&&!v.checkClone&&Re.test(m))return e.each(function(n){var a=e.eq(n);S&&(t[0]=m.call(this,n,a.html())),Oe(a,t,i,o)});if(h&&(a=(n=he(t,e[0].ownerDocument,!1,e,o)).firstChild,1===n.childNodes.length&&(n=a),a||o)){for(l=(s=f.map(ce(n,"script"),Ie)).length;u<h;u++)c=n,u!==p&&(c=f.clone(c,!0,!0),l&&f.merge(s,ce(c,"script"))),i.call(e[u],c,u);if(l)for(d=s[s.length-1].ownerDocument,f.map(s,we),u=0;u<l;u++)c=s[u],se.test(c.type||"")&&!j.access(c,"globalEval")&&f.contains(d,c)&&(c.src?f._evalUrl&&f._evalUrl(c.src):g(c.textContent.replace(Te,""),d))}return e}function Le(e,t,i){for(var o,n=t?f.filter(t,e):e,a=0;null!=(o=n[a]);a++)i||1!==o.nodeType||f.cleanData(ce(o)),o.parentNode&&(i&&f.contains(o.ownerDocument,o)&&de(ce(o,"script")),o.parentNode.removeChild(o));return e}f.extend({htmlPrefilter:function(e){return e.replace(be,"<$1></$2>")},clone:function(e,t,i){var o,n,a,r,s=e.cloneNode(!0),l=f.contains(e.ownerDocument,e);if(!(v.noCloneChecked||1!==e.nodeType&&11!==e.nodeType||f.isXMLDoc(e)))for(r=ce(s),o=0,n=(a=ce(e)).length;o<n;o++)xe(a[o],r[o]);if(t)if(i)for(a=a||ce(e),r=r||ce(s),o=0,n=a.length;o<n;o++)ke(a[o],r[o]);else ke(e,s);return(r=ce(s,"script")).length>0&&de(r,!l&&ce(e,"script")),s},cleanData:function(e){for(var t,i,o,n=f.event.special,a=0;void 0!==(i=e[a]);a++)if(H(i)){if(t=i[j.expando]){if(t.events)for(o in t.events)n[o]?f.event.remove(i,o):f.removeEvent(i,o,t.handle);i[j.expando]=void 0}i[G.expando]&&(i[G.expando]=void 0)}}}),f.fn.extend({detach:function(e){return Le(this,e,!0)},remove:function(e){return Le(this,e)},text:function(e){return z(this,function(e){return void 0===e?f.text(this):this.empty().each(function(){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||(this.textContent=e)})},null,e,arguments.length)},append:function(){return Oe(this,arguments,function(e){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||Ae(this,e).appendChild(e)})},prepend:function(){return Oe(this,arguments,function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=Ae(this,e);t.insertBefore(e,t.firstChild)}})},before:function(){return Oe(this,arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this)})},after:function(){return Oe(this,arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling)})},empty:function(){for(var e,t=0;null!=(e=this[t]);t++)1===e.nodeType&&(f.cleanData(ce(e,!1)),e.textContent="");return this},clone:function(e,t){return e=null!=e&&e,t=null==t?e:t,this.map(function(){return f.clone(this,e,t)})},html:function(e){return z(this,function(e){var t=this[0]||{},i=0,o=this.length;if(void 0===e&&1===t.nodeType)return t.innerHTML;if("string"==typeof e&&!Ee.test(e)&&!le[(re.exec(e)||["",""])[1].toLowerCase()]){e=f.htmlPrefilter(e);try{for(;i<o;i++)1===(t=this[i]||{}).nodeType&&(f.cleanData(ce(t,!1)),t.innerHTML=e);t=0}catch(e){}}t&&this.empty().append(e)},null,e,arguments.length)},replaceWith:function(){var e=[];return Oe(this,arguments,function(t){var i=this.parentNode;f.inArray(this,e)<0&&(f.cleanData(ce(this)),i&&i.replaceChild(t,this))},e)}}),f.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,t){f.fn[e]=function(e){for(var i,o=[],n=f(e),a=n.length-1,r=0;r<=a;r++)i=r===a?this:this.clone(!0),f(n[r])[t](i),s.apply(o,i.get());return this.pushStack(o)}});var Ne=/^margin/,De=new RegExp("^("+Q+")(?!px)[a-z%]+$","i"),Pe=function(t){var i=t.ownerDocument.defaultView;return i&&i.opener||(i=e),i.getComputedStyle(t)};function Me(e,t,i){var o,n,a,r,s=e.style;return(i=i||Pe(e))&&(""!==(r=i.getPropertyValue(t)||i[t])||f.contains(e.ownerDocument,e)||(r=f.style(e,t)),!v.pixelMarginRight()&&De.test(r)&&Ne.test(t)&&(o=s.width,n=s.minWidth,a=s.maxWidth,s.minWidth=s.maxWidth=s.width=r,r=i.width,s.width=o,s.minWidth=n,s.maxWidth=a)),void 0!==r?r+"":r}function Ve(e,t){return{get:function(){return e()?void delete this.get:(this.get=t).apply(this,arguments)}}}!function(){function t(){if(l){l.style.cssText="box-sizing:border-box;position:relative;display:block;margin:auto;border:1px;padding:1px;top:1%;width:50%",l.innerHTML="",pe.appendChild(s);var t=e.getComputedStyle(l);i="1%"!==t.top,r="2px"===t.marginLeft,n="4px"===t.width,l.style.marginRight="50%",a="4px"===t.marginRight,pe.removeChild(s),l=null}}var i,n,a,r,s=o.createElement("div"),l=o.createElement("div");l.style&&(l.style.backgroundClip="content-box",l.cloneNode(!0).style.backgroundClip="",v.clearCloneStyle="content-box"===l.style.backgroundClip,s.style.cssText="border:0;width:8px;height:0;top:0;left:-9999px;padding:0;margin-top:1px;position:absolute",s.appendChild(l),f.extend(v,{pixelPosition:function(){return t(),i},boxSizingReliable:function(){return t(),n},pixelMarginRight:function(){return t(),a},reliableMarginLeft:function(){return t(),r}}))}();var Ue=/^(none|table(?!-c[ea]).+)/,Be={position:"absolute",visibility:"hidden",display:"block"},Fe={letterSpacing:"0",fontWeight:"400"},qe=["Webkit","Moz","ms"],ze=o.createElement("div").style;function He(e){if(e in ze)return e;for(var t=e[0].toUpperCase()+e.slice(1),i=qe.length;i--;)if((e=qe[i]+t)in ze)return e}function We(e,t,i){var o=K.exec(t);return o?Math.max(0,o[2]-(i||0))+(o[3]||"px"):t}function je(e,t,i,o,n){var a,r=0;for(a=i===(o?"border":"content")?4:"width"===t?1:0;a<4;a+=2)"margin"===i&&(r+=f.css(e,i+X[a],!0,n)),o?("content"===i&&(r-=f.css(e,"padding"+X[a],!0,n)),"margin"!==i&&(r-=f.css(e,"border"+X[a]+"Width",!0,n))):(r+=f.css(e,"padding"+X[a],!0,n),"padding"!==i&&(r+=f.css(e,"border"+X[a]+"Width",!0,n)));return r}function Ge(e,t,i){var o,n=!0,a=Pe(e),r="border-box"===f.css(e,"boxSizing",!1,a);if(e.getClientRects().length&&(o=e.getBoundingClientRect()[t]),o<=0||null==o){if(((o=Me(e,t,a))<0||null==o)&&(o=e.style[t]),De.test(o))return o;n=r&&(v.boxSizingReliable()||o===e.style[t]),o=parseFloat(o)||0}return o+je(e,t,i||(r?"border":"content"),n,a)+"px"}function Ye(e,t,i,o,n){return new Ye.prototype.init(e,t,i,o,n)}f.extend({cssHooks:{opacity:{get:function(e,t){if(t){var i=Me(e,"opacity");return""===i?"1":i}}}},cssNumber:{animationIterationCount:!0,columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{float:"cssFloat"},style:function(e,t,i,o){if(e&&3!==e.nodeType&&8!==e.nodeType&&e.style){var n,a,r,s=f.camelCase(t),l=e.style;return t=f.cssProps[s]||(f.cssProps[s]=He(s)||s),r=f.cssHooks[t]||f.cssHooks[s],void 0===i?r&&"get"in r&&void 0!==(n=r.get(e,!1,o))?n:l[t]:("string"===(a=typeof i)&&(n=K.exec(i))&&n[1]&&(i=te(e,t,n),a="number"),void(null!=i&&i==i&&("number"===a&&(i+=n&&n[3]||(f.cssNumber[s]?"":"px")),v.clearCloneStyle||""!==i||0!==t.indexOf("background")||(l[t]="inherit"),r&&"set"in r&&void 0===(i=r.set(e,i,o))||(l[t]=i))))}},css:function(e,t,i,o){var n,a,r,s=f.camelCase(t);return t=f.cssProps[s]||(f.cssProps[s]=He(s)||s),(r=f.cssHooks[t]||f.cssHooks[s])&&"get"in r&&(n=r.get(e,!0,i)),void 0===n&&(n=Me(e,t,o)),"normal"===n&&t in Fe&&(n=Fe[t]),""===i||i?(a=parseFloat(n),!0===i||isFinite(a)?a||0:n):n}}),f.each(["height","width"],function(e,t){f.cssHooks[t]={get:function(e,i,o){if(i)return!Ue.test(f.css(e,"display"))||e.getClientRects().length&&e.getBoundingClientRect().width?Ge(e,t,o):ee(e,Be,function(){return Ge(e,t,o)})},set:function(e,i,o){var n,a=o&&Pe(e),r=o&&je(e,t,o,"border-box"===f.css(e,"boxSizing",!1,a),a);return r&&(n=K.exec(i))&&"px"!==(n[3]||"px")&&(e.style[t]=i,i=f.css(e,t)),We(0,i,r)}}}),f.cssHooks.marginLeft=Ve(v.reliableMarginLeft,function(e,t){if(t)return(parseFloat(Me(e,"marginLeft"))||e.getBoundingClientRect().left-ee(e,{marginLeft:0},function(){return e.getBoundingClientRect().left}))+"px"}),f.each({margin:"",padding:"",border:"Width"},function(e,t){f.cssHooks[e+t]={expand:function(i){for(var o=0,n={},a="string"==typeof i?i.split(" "):[i];o<4;o++)n[e+X[o]+t]=a[o]||a[o-2]||a[0];return n}},Ne.test(e)||(f.cssHooks[e+t].set=We)}),f.fn.extend({css:function(e,t){return z(this,function(e,t,i){var o,n,a={},r=0;if(f.isArray(t)){for(o=Pe(e),n=t.length;r<n;r++)a[t[r]]=f.css(e,t[r],!1,o);return a}return void 0!==i?f.style(e,t,i):f.css(e,t)},e,t,arguments.length>1)}}),f.Tween=Ye,Ye.prototype={constructor:Ye,init:function(e,t,i,o,n,a){this.elem=e,this.prop=i,this.easing=n||f.easing._default,this.options=t,this.start=this.now=this.cur(),this.end=o,this.unit=a||(f.cssNumber[i]?"":"px")},cur:function(){var e=Ye.propHooks[this.prop];return e&&e.get?e.get(this):Ye.propHooks._default.get(this)},run:function(e){var t,i=Ye.propHooks[this.prop];return this.options.duration?this.pos=t=f.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):this.pos=t=e,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),i&&i.set?i.set(this):Ye.propHooks._default.set(this),this}},Ye.prototype.init.prototype=Ye.prototype,Ye.propHooks={_default:{get:function(e){var t;return 1!==e.elem.nodeType||null!=e.elem[e.prop]&&null==e.elem.style[e.prop]?e.elem[e.prop]:(t=f.css(e.elem,e.prop,""))&&"auto"!==t?t:0},set:function(e){f.fx.step[e.prop]?f.fx.step[e.prop](e):1!==e.elem.nodeType||null==e.elem.style[f.cssProps[e.prop]]&&!f.cssHooks[e.prop]?e.elem[e.prop]=e.now:f.style(e.elem,e.prop,e.now+e.unit)}}},Ye.propHooks.scrollTop=Ye.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},f.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2},_default:"swing"},f.fx=Ye.prototype.init,f.fx.step={};var Je,Qe,Ke=/^(?:toggle|show|hide)$/,$e=/queueHooks$/;function Xe(){Qe&&(e.requestAnimationFrame(Xe),f.fx.tick())}function Ze(){return e.setTimeout(function(){Je=void 0}),Je=f.now()}function et(e,t){var i,o=0,n={height:e};for(t=t?1:0;o<4;o+=2-t)n["margin"+(i=X[o])]=n["padding"+i]=e;return t&&(n.opacity=n.width=e),n}function tt(e,t,i){for(var o,n=(it.tweeners[t]||[]).concat(it.tweeners["*"]),a=0,r=n.length;a<r;a++)if(o=n[a].call(i,t,e))return o}function it(e,t,i){var o,n,a=0,r=it.prefilters.length,s=f.Deferred().always(function(){delete l.elem}),l=function(){if(n)return!1;for(var t=Je||Ze(),i=Math.max(0,c.startTime+c.duration-t),o=1-(i/c.duration||0),a=0,r=c.tweens.length;a<r;a++)c.tweens[a].run(o);return s.notifyWith(e,[c,o,i]),o<1&&r?i:(s.resolveWith(e,[c]),!1)},c=s.promise({elem:e,props:f.extend({},t),opts:f.extend(!0,{specialEasing:{},easing:f.easing._default},i),originalProperties:t,originalOptions:i,startTime:Je||Ze(),duration:i.duration,tweens:[],createTween:function(t,i){var o=f.Tween(e,c.opts,t,i,c.opts.specialEasing[t]||c.opts.easing);return c.tweens.push(o),o},stop:function(t){var i=0,o=t?c.tweens.length:0;if(n)return this;for(n=!0;i<o;i++)c.tweens[i].run(1);return t?(s.notifyWith(e,[c,1,0]),s.resolveWith(e,[c,t])):s.rejectWith(e,[c,t]),this}}),d=c.props;for(function(e,t){var i,o,n,a,r;for(i in e)if(n=t[o=f.camelCase(i)],a=e[i],f.isArray(a)&&(n=a[1],a=e[i]=a[0]),i!==o&&(e[o]=a,delete e[i]),(r=f.cssHooks[o])&&"expand"in r)for(i in a=r.expand(a),delete e[o],a)i in e||(e[i]=a[i],t[i]=n);else t[o]=n}(d,c.opts.specialEasing);a<r;a++)if(o=it.prefilters[a].call(c,e,d,c.opts))return f.isFunction(o.stop)&&(f._queueHooks(c.elem,c.opts.queue).stop=f.proxy(o.stop,o)),o;return f.map(d,tt,c),f.isFunction(c.opts.start)&&c.opts.start.call(e,c),f.fx.timer(f.extend(l,{elem:e,anim:c,queue:c.opts.queue})),c.progress(c.opts.progress).done(c.opts.done,c.opts.complete).fail(c.opts.fail).always(c.opts.always)}f.Animation=f.extend(it,{tweeners:{"*":[function(e,t){var i=this.createTween(e,t);return te(i.elem,e,K.exec(t),i),i}]},tweener:function(e,t){f.isFunction(e)?(t=e,e=["*"]):e=e.match(P);for(var i,o=0,n=e.length;o<n;o++)i=e[o],it.tweeners[i]=it.tweeners[i]||[],it.tweeners[i].unshift(t)},prefilters:[function(e,t,i){var o,n,a,r,s,l,c,d,u="width"in t||"height"in t,h=this,p={},v=e.style,g=e.nodeType&&Z(e),m=j.get(e,"fxshow");for(o in i.queue||(null==(r=f._queueHooks(e,"fx")).unqueued&&(r.unqueued=0,s=r.empty.fire,r.empty.fire=function(){r.unqueued||s()}),r.unqueued++,h.always(function(){h.always(function(){r.unqueued--,f.queue(e,"fx").length||r.empty.fire()})})),t)if(n=t[o],Ke.test(n)){if(delete t[o],a=a||"toggle"===n,n===(g?"hide":"show")){if("show"!==n||!m||void 0===m[o])continue;g=!0}p[o]=m&&m[o]||f.style(e,o)}if((l=!f.isEmptyObject(t))||!f.isEmptyObject(p))for(o in u&&1===e.nodeType&&(i.overflow=[v.overflow,v.overflowX,v.overflowY],null==(c=m&&m.display)&&(c=j.get(e,"display")),"none"===(d=f.css(e,"display"))&&(c?d=c:(ne([e],!0),c=e.style.display||c,d=f.css(e,"display"),ne([e]))),("inline"===d||"inline-block"===d&&null!=c)&&"none"===f.css(e,"float")&&(l||(h.done(function(){v.display=c}),null==c&&(d=v.display,c="none"===d?"":d)),v.display="inline-block")),i.overflow&&(v.overflow="hidden",h.always(function(){v.overflow=i.overflow[0],v.overflowX=i.overflow[1],v.overflowY=i.overflow[2]})),l=!1,p)l||(m?"hidden"in m&&(g=m.hidden):m=j.access(e,"fxshow",{display:c}),a&&(m.hidden=!g),g&&ne([e],!0),h.done(function(){for(o in g||ne([e]),j.remove(e,"fxshow"),p)f.style(e,o,p[o])})),l=tt(g?m[o]:0,o,h),o in m||(m[o]=l.start,g&&(l.end=l.start,l.start=0))}],prefilter:function(e,t){t?it.prefilters.unshift(e):it.prefilters.push(e)}}),f.speed=function(e,t,i){var n=e&&"object"==typeof e?f.extend({},e):{complete:i||!i&&t||f.isFunction(e)&&e,duration:e,easing:i&&t||t&&!f.isFunction(t)&&t};return f.fx.off||o.hidden?n.duration=0:"number"!=typeof n.duration&&(n.duration in f.fx.speeds?n.duration=f.fx.speeds[n.duration]:n.duration=f.fx.speeds._default),null!=n.queue&&!0!==n.queue||(n.queue="fx"),n.old=n.complete,n.complete=function(){f.isFunction(n.old)&&n.old.call(this),n.queue&&f.dequeue(this,n.queue)},n},f.fn.extend({fadeTo:function(e,t,i,o){return this.filter(Z).css("opacity",0).show().end().animate({opacity:t},e,i,o)},animate:function(e,t,i,o){var n=f.isEmptyObject(e),a=f.speed(t,i,o),r=function(){var t=it(this,f.extend({},e),a);(n||j.get(this,"finish"))&&t.stop(!0)};return r.finish=r,n||!1===a.queue?this.each(r):this.queue(a.queue,r)},stop:function(e,t,i){var o=function(e){var t=e.stop;delete e.stop,t(i)};return"string"!=typeof e&&(i=t,t=e,e=void 0),t&&!1!==e&&this.queue(e||"fx",[]),this.each(function(){var t=!0,n=null!=e&&e+"queueHooks",a=f.timers,r=j.get(this);if(n)r[n]&&r[n].stop&&o(r[n]);else for(n in r)r[n]&&r[n].stop&&$e.test(n)&&o(r[n]);for(n=a.length;n--;)a[n].elem!==this||null!=e&&a[n].queue!==e||(a[n].anim.stop(i),t=!1,a.splice(n,1));!t&&i||f.dequeue(this,e)})},finish:function(e){return!1!==e&&(e=e||"fx"),this.each(function(){var t,i=j.get(this),o=i[e+"queue"],n=i[e+"queueHooks"],a=f.timers,r=o?o.length:0;for(i.finish=!0,f.queue(this,e,[]),n&&n.stop&&n.stop.call(this,!0),t=a.length;t--;)a[t].elem===this&&a[t].queue===e&&(a[t].anim.stop(!0),a.splice(t,1));for(t=0;t<r;t++)o[t]&&o[t].finish&&o[t].finish.call(this);delete i.finish})}}),f.each(["toggle","show","hide"],function(e,t){var i=f.fn[t];f.fn[t]=function(e,o,n){return null==e||"boolean"==typeof e?i.apply(this,arguments):this.animate(et(t,!0),e,o,n)}}),f.each({slideDown:et("show"),slideUp:et("hide"),slideToggle:et("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,t){f.fn[e]=function(e,i,o){return this.animate(t,e,i,o)}}),f.timers=[],f.fx.tick=function(){var e,t=0,i=f.timers;for(Je=f.now();t<i.length;t++)(e=i[t])()||i[t]!==e||i.splice(t--,1);i.length||f.fx.stop(),Je=void 0},f.fx.timer=function(e){f.timers.push(e),e()?f.fx.start():f.timers.pop()},f.fx.interval=13,f.fx.start=function(){Qe||(Qe=e.requestAnimationFrame?e.requestAnimationFrame(Xe):e.setInterval(f.fx.tick,f.fx.interval))},f.fx.stop=function(){e.cancelAnimationFrame?e.cancelAnimationFrame(Qe):e.clearInterval(Qe),Qe=null},f.fx.speeds={slow:600,fast:200,_default:400},f.fn.delay=function(t,i){return t=f.fx&&f.fx.speeds[t]||t,i=i||"fx",this.queue(i,function(i,o){var n=e.setTimeout(i,t);o.stop=function(){e.clearTimeout(n)}})},function(){var e=o.createElement("input"),t=o.createElement("select").appendChild(o.createElement("option"));e.type="checkbox",v.checkOn=""!==e.value,v.optSelected=t.selected,(e=o.createElement("input")).value="t",e.type="radio",v.radioValue="t"===e.value}();var ot,nt=f.expr.attrHandle;f.fn.extend({attr:function(e,t){return z(this,f.attr,e,t,arguments.length>1)},removeAttr:function(e){return this.each(function(){f.removeAttr(this,e)})}}),f.extend({attr:function(e,t,i){var o,n,a=e.nodeType;if(3!==a&&8!==a&&2!==a)return void 0===e.getAttribute?f.prop(e,t,i):(1===a&&f.isXMLDoc(e)||(n=f.attrHooks[t.toLowerCase()]||(f.expr.match.bool.test(t)?ot:void 0)),void 0!==i?null===i?void f.removeAttr(e,t):n&&"set"in n&&void 0!==(o=n.set(e,i,t))?o:(e.setAttribute(t,i+""),i):n&&"get"in n&&null!==(o=n.get(e,t))?o:null==(o=f.find.attr(e,t))?void 0:o)},attrHooks:{type:{set:function(e,t){if(!v.radioValue&&"radio"===t&&f.nodeName(e,"input")){var i=e.value;return e.setAttribute("type",t),i&&(e.value=i),t}}}},removeAttr:function(e,t){var i,o=0,n=t&&t.match(P);if(n&&1===e.nodeType)for(;i=n[o++];)e.removeAttribute(i)}}),ot={set:function(e,t,i){return!1===t?f.removeAttr(e,i):e.setAttribute(i,i),i}},f.each(f.expr.match.bool.source.match(/\w+/g),function(e,t){var i=nt[t]||f.find.attr;nt[t]=function(e,t,o){var n,a,r=t.toLowerCase();return o||(a=nt[r],nt[r]=n,n=null!=i(e,t,o)?r:null,nt[r]=a),n}});var at=/^(?:input|select|textarea|button)$/i,rt=/^(?:a|area)$/i;function st(e){return(e.match(P)||[]).join(" ")}function lt(e){return e.getAttribute&&e.getAttribute("class")||""}f.fn.extend({prop:function(e,t){return z(this,f.prop,e,t,arguments.length>1)},removeProp:function(e){return this.each(function(){delete this[f.propFix[e]||e]})}}),f.extend({prop:function(e,t,i){var o,n,a=e.nodeType;if(3!==a&&8!==a&&2!==a)return 1===a&&f.isXMLDoc(e)||(t=f.propFix[t]||t,n=f.propHooks[t]),void 0!==i?n&&"set"in n&&void 0!==(o=n.set(e,i,t))?o:e[t]=i:n&&"get"in n&&null!==(o=n.get(e,t))?o:e[t]},propHooks:{tabIndex:{get:function(e){var t=f.find.attr(e,"tabindex");return t?parseInt(t,10):at.test(e.nodeName)||rt.test(e.nodeName)&&e.href?0:-1}}},propFix:{for:"htmlFor",class:"className"}}),v.optSelected||(f.propHooks.selected={get:function(e){var t=e.parentNode;return t&&t.parentNode&&t.parentNode.selectedIndex,null},set:function(e){var t=e.parentNode;t&&(t.selectedIndex,t.parentNode&&t.parentNode.selectedIndex)}}),f.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){f.propFix[this.toLowerCase()]=this}),f.fn.extend({addClass:function(e){var t,i,o,n,a,r,s,l=0;if(f.isFunction(e))return this.each(function(t){f(this).addClass(e.call(this,t,lt(this)))});if("string"==typeof e&&e)for(t=e.match(P)||[];i=this[l++];)if(n=lt(i),o=1===i.nodeType&&" "+st(n)+" "){for(r=0;a=t[r++];)o.indexOf(" "+a+" ")<0&&(o+=a+" ");n!==(s=st(o))&&i.setAttribute("class",s)}return this},removeClass:function(e){var t,i,o,n,a,r,s,l=0;if(f.isFunction(e))return this.each(function(t){f(this).removeClass(e.call(this,t,lt(this)))});if(!arguments.length)return this.attr("class","");if("string"==typeof e&&e)for(t=e.match(P)||[];i=this[l++];)if(n=lt(i),o=1===i.nodeType&&" "+st(n)+" "){for(r=0;a=t[r++];)for(;o.indexOf(" "+a+" ")>-1;)o=o.replace(" "+a+" "," ");n!==(s=st(o))&&i.setAttribute("class",s)}return this},toggleClass:function(e,t){var i=typeof e;return"boolean"==typeof t&&"string"===i?t?this.addClass(e):this.removeClass(e):f.isFunction(e)?this.each(function(i){f(this).toggleClass(e.call(this,i,lt(this),t),t)}):this.each(function(){var t,o,n,a;if("string"===i)for(o=0,n=f(this),a=e.match(P)||[];t=a[o++];)n.hasClass(t)?n.removeClass(t):n.addClass(t);else void 0!==e&&"boolean"!==i||((t=lt(this))&&j.set(this,"__className__",t),this.setAttribute&&this.setAttribute("class",t||!1===e?"":j.get(this,"__className__")||""))})},hasClass:function(e){var t,i,o=0;for(t=" "+e+" ";i=this[o++];)if(1===i.nodeType&&(" "+st(lt(i))+" ").indexOf(t)>-1)return!0;return!1}});var ct=/\r/g;f.fn.extend({val:function(e){var t,i,o,n=this[0];return arguments.length?(o=f.isFunction(e),this.each(function(i){var n;1===this.nodeType&&(null==(n=o?e.call(this,i,f(this).val()):e)?n="":"number"==typeof n?n+="":f.isArray(n)&&(n=f.map(n,function(e){return null==e?"":e+""})),(t=f.valHooks[this.type]||f.valHooks[this.nodeName.toLowerCase()])&&"set"in t&&void 0!==t.set(this,n,"value")||(this.value=n))})):n?(t=f.valHooks[n.type]||f.valHooks[n.nodeName.toLowerCase()])&&"get"in t&&void 0!==(i=t.get(n,"value"))?i:"string"==typeof(i=n.value)?i.replace(ct,""):null==i?"":i:void 0}}),f.extend({valHooks:{option:{get:function(e){var t=f.find.attr(e,"value");return null!=t?t:st(f.text(e))}},select:{get:function(e){var t,i,o,n=e.options,a=e.selectedIndex,r="select-one"===e.type,s=r?null:[],l=r?a+1:n.length;for(o=a<0?l:r?a:0;o<l;o++)if(((i=n[o]).selected||o===a)&&!i.disabled&&(!i.parentNode.disabled||!f.nodeName(i.parentNode,"optgroup"))){if(t=f(i).val(),r)return t;s.push(t)}return s},set:function(e,t){for(var i,o,n=e.options,a=f.makeArray(t),r=n.length;r--;)((o=n[r]).selected=f.inArray(f.valHooks.option.get(o),a)>-1)&&(i=!0);return i||(e.selectedIndex=-1),a}}}}),f.each(["radio","checkbox"],function(){f.valHooks[this]={set:function(e,t){if(f.isArray(t))return e.checked=f.inArray(f(e).val(),t)>-1}},v.checkOn||(f.valHooks[this].get=function(e){return null===e.getAttribute("value")?"on":e.value})});var dt=/^(?:focusinfocus|focusoutblur)$/;f.extend(f.event,{trigger:function(t,i,n,a){var r,s,l,c,d,h,p,v=[n||o],g=u.call(t,"type")?t.type:t,m=u.call(t,"namespace")?t.namespace.split("."):[];if(s=l=n=n||o,3!==n.nodeType&&8!==n.nodeType&&!dt.test(g+f.event.triggered)&&(g.indexOf(".")>-1&&(g=(m=g.split(".")).shift(),m.sort()),d=g.indexOf(":")<0&&"on"+g,(t=t[f.expando]?t:new f.Event(g,"object"==typeof t&&t)).isTrigger=a?2:3,t.namespace=m.join("."),t.rnamespace=t.namespace?new RegExp("(^|\\.)"+m.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,t.result=void 0,t.target||(t.target=n),i=null==i?[t]:f.makeArray(i,[t]),p=f.event.special[g]||{},a||!p.trigger||!1!==p.trigger.apply(n,i))){if(!a&&!p.noBubble&&!f.isWindow(n)){for(c=p.delegateType||g,dt.test(c+g)||(s=s.parentNode);s;s=s.parentNode)v.push(s),l=s;l===(n.ownerDocument||o)&&v.push(l.defaultView||l.parentWindow||e)}for(r=0;(s=v[r++])&&!t.isPropagationStopped();)t.type=r>1?c:p.bindType||g,(h=(j.get(s,"events")||{})[t.type]&&j.get(s,"handle"))&&h.apply(s,i),(h=d&&s[d])&&h.apply&&H(s)&&(t.result=h.apply(s,i),!1===t.result&&t.preventDefault());return t.type=g,a||t.isDefaultPrevented()||p._default&&!1!==p._default.apply(v.pop(),i)||!H(n)||d&&f.isFunction(n[g])&&!f.isWindow(n)&&((l=n[d])&&(n[d]=null),f.event.triggered=g,n[g](),f.event.triggered=void 0,l&&(n[d]=l)),t.result}},simulate:function(e,t,i){var o=f.extend(new f.Event,i,{type:e,isSimulated:!0});f.event.trigger(o,null,t)}}),f.fn.extend({trigger:function(e,t){return this.each(function(){f.event.trigger(e,t,this)})},triggerHandler:function(e,t){var i=this[0];if(i)return f.event.trigger(e,t,i,!0)}}),f.each("blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu".split(" "),function(e,t){f.fn[t]=function(e,i){return arguments.length>0?this.on(t,null,e,i):this.trigger(t)}}),f.fn.extend({hover:function(e,t){return this.mouseenter(e).mouseleave(t||e)}}),v.focusin="onfocusin"in e,v.focusin||f.each({focus:"focusin",blur:"focusout"},function(e,t){var i=function(e){f.event.simulate(t,e.target,f.event.fix(e))};f.event.special[t]={setup:function(){var o=this.ownerDocument||this,n=j.access(o,t);n||o.addEventListener(e,i,!0),j.access(o,t,(n||0)+1)},teardown:function(){var o=this.ownerDocument||this,n=j.access(o,t)-1;n?j.access(o,t,n):(o.removeEventListener(e,i,!0),j.remove(o,t))}}});var ut=e.location,ht=f.now(),pt=/\?/;f.parseXML=function(t){var i;if(!t||"string"!=typeof t)return null;try{i=(new e.DOMParser).parseFromString(t,"text/xml")}catch(e){i=void 0}return i&&!i.getElementsByTagName("parsererror").length||f.error("Invalid XML: "+t),i};var vt=/\[\]$/,gt=/\r?\n/g,mt=/^(?:submit|button|image|reset|file)$/i,ft=/^(?:input|select|textarea|keygen)/i;function St(e,t,i,o){var n;if(f.isArray(t))f.each(t,function(t,n){i||vt.test(e)?o(e,n):St(e+"["+("object"==typeof n&&null!=n?t:"")+"]",n,i,o)});else if(i||"object"!==f.type(t))o(e,t);else for(n in t)St(e+"["+n+"]",t[n],i,o)}f.param=function(e,t){var i,o=[],n=function(e,t){var i=f.isFunction(t)?t():t;o[o.length]=encodeURIComponent(e)+"="+encodeURIComponent(null==i?"":i)};if(f.isArray(e)||e.jquery&&!f.isPlainObject(e))f.each(e,function(){n(this.name,this.value)});else for(i in e)St(i,e[i],t,n);return o.join("&")},f.fn.extend({serialize:function(){return f.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var e=f.prop(this,"elements");return e?f.makeArray(e):this}).filter(function(){var e=this.type;return this.name&&!f(this).is(":disabled")&&ft.test(this.nodeName)&&!mt.test(e)&&(this.checked||!ae.test(e))}).map(function(e,t){var i=f(this).val();return null==i?null:f.isArray(i)?f.map(i,function(e){return{name:t.name,value:e.replace(gt,"\r\n")}}):{name:t.name,value:i.replace(gt,"\r\n")}}).get()}});var _t=/%20/g,Ct=/#.*$/,bt=/([?&])_=[^&]*/,Et=/^(.*?):[ \t]*([^\r\n]*)$/gm,Rt=/^(?:GET|HEAD)$/,yt=/^\/\//,Tt={},At={},It="*/".concat("*"),wt=o.createElement("a");function kt(e){return function(t,i){"string"!=typeof t&&(i=t,t="*");var o,n=0,a=t.toLowerCase().match(P)||[];if(f.isFunction(i))for(;o=a[n++];)"+"===o[0]?(o=o.slice(1)||"*",(e[o]=e[o]||[]).unshift(i)):(e[o]=e[o]||[]).push(i)}}function xt(e,t,i,o){var n={},a=e===At;function r(s){var l;return n[s]=!0,f.each(e[s]||[],function(e,s){var c=s(t,i,o);return"string"!=typeof c||a||n[c]?a?!(l=c):void 0:(t.dataTypes.unshift(c),r(c),!1)}),l}return r(t.dataTypes[0])||!n["*"]&&r("*")}function Ot(e,t){var i,o,n=f.ajaxSettings.flatOptions||{};for(i in t)void 0!==t[i]&&((n[i]?e:o||(o={}))[i]=t[i]);return o&&f.extend(!0,e,o),e}wt.href=ut.href,f.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:ut.href,type:"GET",isLocal:/^(?:about|app|app-storage|.+-extension|file|res|widget):$/.test(ut.protocol),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":It,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":JSON.parse,"text xml":f.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(e,t){return t?Ot(Ot(e,f.ajaxSettings),t):Ot(f.ajaxSettings,e)},ajaxPrefilter:kt(Tt),ajaxTransport:kt(At),ajax:function(t,i){"object"==typeof t&&(i=t,t=void 0),i=i||{};var n,a,r,s,l,c,d,u,h,p,v=f.ajaxSetup({},i),g=v.context||v,m=v.context&&(g.nodeType||g.jquery)?f(g):f.event,S=f.Deferred(),_=f.Callbacks("once memory"),C=v.statusCode||{},b={},E={},R="canceled",y={readyState:0,getResponseHeader:function(e){var t;if(d){if(!s)for(s={};t=Et.exec(r);)s[t[1].toLowerCase()]=t[2];t=s[e.toLowerCase()]}return null==t?null:t},getAllResponseHeaders:function(){return d?r:null},setRequestHeader:function(e,t){return null==d&&(e=E[e.toLowerCase()]=E[e.toLowerCase()]||e,b[e]=t),this},overrideMimeType:function(e){return null==d&&(v.mimeType=e),this},statusCode:function(e){var t;if(e)if(d)y.always(e[y.status]);else for(t in e)C[t]=[C[t],e[t]];return this},abort:function(e){var t=e||R;return n&&n.abort(t),T(0,t),this}};if(S.promise(y),v.url=((t||v.url||ut.href)+"").replace(yt,ut.protocol+"//"),v.type=i.method||i.type||v.method||v.type,v.dataTypes=(v.dataType||"*").toLowerCase().match(P)||[""],null==v.crossDomain){c=o.createElement("a");try{c.href=v.url,c.href=c.href,v.crossDomain=wt.protocol+"//"+wt.host!=c.protocol+"//"+c.host}catch(e){v.crossDomain=!0}}if(v.data&&v.processData&&"string"!=typeof v.data&&(v.data=f.param(v.data,v.traditional)),xt(Tt,v,i,y),d)return y;for(h in(u=f.event&&v.global)&&0==f.active++&&f.event.trigger("ajaxStart"),v.type=v.type.toUpperCase(),v.hasContent=!Rt.test(v.type),a=v.url.replace(Ct,""),v.hasContent?v.data&&v.processData&&0===(v.contentType||"").indexOf("application/x-www-form-urlencoded")&&(v.data=v.data.replace(_t,"+")):(p=v.url.slice(a.length),v.data&&(a+=(pt.test(a)?"&":"?")+v.data,delete v.data),!1===v.cache&&(a=a.replace(bt,"$1"),p=(pt.test(a)?"&":"?")+"_="+ht+++p),v.url=a+p),v.ifModified&&(f.lastModified[a]&&y.setRequestHeader("If-Modified-Since",f.lastModified[a]),f.etag[a]&&y.setRequestHeader("If-None-Match",f.etag[a])),(v.data&&v.hasContent&&!1!==v.contentType||i.contentType)&&y.setRequestHeader("Content-Type",v.contentType),y.setRequestHeader("Accept",v.dataTypes[0]&&v.accepts[v.dataTypes[0]]?v.accepts[v.dataTypes[0]]+("*"!==v.dataTypes[0]?", "+It+"; q=0.01":""):v.accepts["*"]),v.headers)y.setRequestHeader(h,v.headers[h]);if(v.beforeSend&&(!1===v.beforeSend.call(g,y,v)||d))return y.abort();if(R="abort",_.add(v.complete),y.done(v.success),y.fail(v.error),n=xt(At,v,i,y)){if(y.readyState=1,u&&m.trigger("ajaxSend",[y,v]),d)return y;v.async&&v.timeout>0&&(l=e.setTimeout(function(){y.abort("timeout")},v.timeout));try{d=!1,n.send(b,T)}catch(e){if(d)throw e;T(-1,e)}}else T(-1,"No Transport");function T(t,i,o,s){var c,h,p,b,E,R=i;d||(d=!0,l&&e.clearTimeout(l),n=void 0,r=s||"",y.readyState=t>0?4:0,c=t>=200&&t<300||304===t,o&&(b=function(e,t,i){for(var o,n,a,r,s=e.contents,l=e.dataTypes;"*"===l[0];)l.shift(),void 0===o&&(o=e.mimeType||t.getResponseHeader("Content-Type"));if(o)for(n in s)if(s[n]&&s[n].test(o)){l.unshift(n);break}if(l[0]in i)a=l[0];else{for(n in i){if(!l[0]||e.converters[n+" "+l[0]]){a=n;break}r||(r=n)}a=a||r}if(a)return a!==l[0]&&l.unshift(a),i[a]}(v,y,o)),b=function(e,t,i,o){var n,a,r,s,l,c={},d=e.dataTypes.slice();if(d[1])for(r in e.converters)c[r.toLowerCase()]=e.converters[r];for(a=d.shift();a;)if(e.responseFields[a]&&(i[e.responseFields[a]]=t),!l&&o&&e.dataFilter&&(t=e.dataFilter(t,e.dataType)),l=a,a=d.shift())if("*"===a)a=l;else if("*"!==l&&l!==a){if(!(r=c[l+" "+a]||c["* "+a]))for(n in c)if((s=n.split(" "))[1]===a&&(r=c[l+" "+s[0]]||c["* "+s[0]])){!0===r?r=c[n]:!0!==c[n]&&(a=s[0],d.unshift(s[1]));break}if(!0!==r)if(r&&e.throws)t=r(t);else try{t=r(t)}catch(e){return{state:"parsererror",error:r?e:"No conversion from "+l+" to "+a}}}return{state:"success",data:t}}(v,b,y,c),c?(v.ifModified&&((E=y.getResponseHeader("Last-Modified"))&&(f.lastModified[a]=E),(E=y.getResponseHeader("etag"))&&(f.etag[a]=E)),204===t||"HEAD"===v.type?R="nocontent":304===t?R="notmodified":(R=b.state,h=b.data,c=!(p=b.error))):(p=R,!t&&R||(R="error",t<0&&(t=0))),y.status=t,y.statusText=(i||R)+"",c?S.resolveWith(g,[h,R,y]):S.rejectWith(g,[y,R,p]),y.statusCode(C),C=void 0,u&&m.trigger(c?"ajaxSuccess":"ajaxError",[y,v,c?h:p]),_.fireWith(g,[y,R]),u&&(m.trigger("ajaxComplete",[y,v]),--f.active||f.event.trigger("ajaxStop")))}return y},getJSON:function(e,t,i){return f.get(e,t,i,"json")},getScript:function(e,t){return f.get(e,void 0,t,"script")}}),f.each(["get","post"],function(e,t){f[t]=function(e,i,o,n){return f.isFunction(i)&&(n=n||o,o=i,i=void 0),f.ajax(f.extend({url:e,type:t,dataType:n,data:i,success:o},f.isPlainObject(e)&&e))}}),f._evalUrl=function(e){return f.ajax({url:e,type:"GET",dataType:"script",cache:!0,async:!1,global:!1,throws:!0})},f.fn.extend({wrapAll:function(e){var t;return this[0]&&(f.isFunction(e)&&(e=e.call(this[0])),t=f(e,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&t.insertBefore(this[0]),t.map(function(){for(var e=this;e.firstElementChild;)e=e.firstElementChild;return e}).append(this)),this},wrapInner:function(e){return f.isFunction(e)?this.each(function(t){f(this).wrapInner(e.call(this,t))}):this.each(function(){var t=f(this),i=t.contents();i.length?i.wrapAll(e):t.append(e)})},wrap:function(e){var t=f.isFunction(e);return this.each(function(i){f(this).wrapAll(t?e.call(this,i):e)})},unwrap:function(e){return this.parent(e).not("body").each(function(){f(this).replaceWith(this.childNodes)}),this}}),f.expr.pseudos.hidden=function(e){return!f.expr.pseudos.visible(e)},f.expr.pseudos.visible=function(e){return!!(e.offsetWidth||e.offsetHeight||e.getClientRects().length)},f.ajaxSettings.xhr=function(){try{return new e.XMLHttpRequest}catch(e){}};var Lt={0:200,1223:204},Nt=f.ajaxSettings.xhr();v.cors=!!Nt&&"withCredentials"in Nt,v.ajax=Nt=!!Nt,f.ajaxTransport(function(t){var i,o;if(v.cors||Nt&&!t.crossDomain)return{send:function(n,a){var r,s=t.xhr();if(s.open(t.type,t.url,t.async,t.username,t.password),t.xhrFields)for(r in t.xhrFields)s[r]=t.xhrFields[r];for(r in t.mimeType&&s.overrideMimeType&&s.overrideMimeType(t.mimeType),t.crossDomain||n["X-Requested-With"]||(n["X-Requested-With"]="XMLHttpRequest"),n)s.setRequestHeader(r,n[r]);i=function(e){return function(){i&&(i=o=s.onload=s.onerror=s.onabort=s.onreadystatechange=null,"abort"===e?s.abort():"error"===e?"number"!=typeof s.status?a(0,"error"):a(s.status,s.statusText):a(Lt[s.status]||s.status,s.statusText,"text"!==(s.responseType||"text")||"string"!=typeof s.responseText?{binary:s.response}:{text:s.responseText},s.getAllResponseHeaders()))}},s.onload=i(),o=s.onerror=i("error"),void 0!==s.onabort?s.onabort=o:s.onreadystatechange=function(){4===s.readyState&&e.setTimeout(function(){i&&o()})},i=i("abort");try{s.send(t.hasContent&&t.data||null)}catch(e){if(i)throw e}},abort:function(){i&&i()}}}),f.ajaxPrefilter(function(e){e.crossDomain&&(e.contents.script=!1)}),f.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(e){return f.globalEval(e),e}}}),f.ajaxPrefilter("script",function(e){void 0===e.cache&&(e.cache=!1),e.crossDomain&&(e.type="GET")}),f.ajaxTransport("script",function(e){var t,i;if(e.crossDomain)return{send:function(n,a){t=f("<script>").prop({charset:e.scriptCharset,src:e.url}).on("load error",i=function(e){t.remove(),i=null,e&&a("error"===e.type?404:200,e.type)}),o.head.appendChild(t[0])},abort:function(){i&&i()}}});var Dt=[],Pt=/(=)\?(?=&|$)|\?\?/;function Mt(e){return f.isWindow(e)?e:9===e.nodeType&&e.defaultView}f.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=Dt.pop()||f.expando+"_"+ht++;return this[e]=!0,e}}),f.ajaxPrefilter("json jsonp",function(t,i,o){var n,a,r,s=!1!==t.jsonp&&(Pt.test(t.url)?"url":"string"==typeof t.data&&0===(t.contentType||"").indexOf("application/x-www-form-urlencoded")&&Pt.test(t.data)&&"data");if(s||"jsonp"===t.dataTypes[0])return n=t.jsonpCallback=f.isFunction(t.jsonpCallback)?t.jsonpCallback():t.jsonpCallback,s?t[s]=t[s].replace(Pt,"$1"+n):!1!==t.jsonp&&(t.url+=(pt.test(t.url)?"&":"?")+t.jsonp+"="+n),t.converters["script json"]=function(){return r||f.error(n+" was not called"),r[0]},t.dataTypes[0]="json",a=e[n],e[n]=function(){r=arguments},o.always(function(){void 0===a?f(e).removeProp(n):e[n]=a,t[n]&&(t.jsonpCallback=i.jsonpCallback,Dt.push(n)),r&&f.isFunction(a)&&a(r[0]),r=a=void 0}),"script"}),v.createHTMLDocument=function(){var e=o.implementation.createHTMLDocument("").body;return e.innerHTML="<form></form><form></form>",2===e.childNodes.length}(),f.parseHTML=function(e,t,i){return"string"!=typeof e?[]:("boolean"==typeof t&&(i=t,t=!1),t||(v.createHTMLDocument?((n=(t=o.implementation.createHTMLDocument("")).createElement("base")).href=o.location.href,t.head.appendChild(n)):t=o),a=I.exec(e),r=!i&&[],a?[t.createElement(a[1])]:(a=he([e],t,r),r&&r.length&&f(r).remove(),f.merge([],a.childNodes)));var n,a,r},f.fn.load=function(e,t,i){var o,n,a,r=this,s=e.indexOf(" ");return s>-1&&(o=st(e.slice(s)),e=e.slice(0,s)),f.isFunction(t)?(i=t,t=void 0):t&&"object"==typeof t&&(n="POST"),r.length>0&&f.ajax({url:e,type:n||"GET",dataType:"html",data:t}).done(function(e){a=arguments,r.html(o?f("<div>").append(f.parseHTML(e)).find(o):e)}).always(i&&function(e,t){r.each(function(){i.apply(this,a||[e.responseText,t,e])})}),this},f.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(e,t){f.fn[t]=function(e){return this.on(t,e)}}),f.expr.pseudos.animated=function(e){return f.grep(f.timers,function(t){return e===t.elem}).length},f.offset={setOffset:function(e,t,i){var o,n,a,r,s,l,c=f.css(e,"position"),d=f(e),u={};"static"===c&&(e.style.position="relative"),s=d.offset(),a=f.css(e,"top"),l=f.css(e,"left"),("absolute"===c||"fixed"===c)&&(a+l).indexOf("auto")>-1?(r=(o=d.position()).top,n=o.left):(r=parseFloat(a)||0,n=parseFloat(l)||0),f.isFunction(t)&&(t=t.call(e,i,f.extend({},s))),null!=t.top&&(u.top=t.top-s.top+r),null!=t.left&&(u.left=t.left-s.left+n),"using"in t?t.using.call(e,u):d.css(u)}},f.fn.extend({offset:function(e){if(arguments.length)return void 0===e?this:this.each(function(t){f.offset.setOffset(this,e,t)});var t,i,o,n,a=this[0];return a?a.getClientRects().length?(o=a.getBoundingClientRect()).width||o.height?(i=Mt(n=a.ownerDocument),t=n.documentElement,{top:o.top+i.pageYOffset-t.clientTop,left:o.left+i.pageXOffset-t.clientLeft}):o:{top:0,left:0}:void 0},position:function(){if(this[0]){var e,t,i=this[0],o={top:0,left:0};return"fixed"===f.css(i,"position")?t=i.getBoundingClientRect():(e=this.offsetParent(),t=this.offset(),f.nodeName(e[0],"html")||(o=e.offset()),o={top:o.top+f.css(e[0],"borderTopWidth",!0),left:o.left+f.css(e[0],"borderLeftWidth",!0)}),{top:t.top-o.top-f.css(i,"marginTop",!0),left:t.left-o.left-f.css(i,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var e=this.offsetParent;e&&"static"===f.css(e,"position");)e=e.offsetParent;return e||pe})}}),f.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(e,t){var i="pageYOffset"===t;f.fn[e]=function(o){return z(this,function(e,o,n){var a=Mt(e);return void 0===n?a?a[t]:e[o]:void(a?a.scrollTo(i?a.pageXOffset:n,i?n:a.pageYOffset):e[o]=n)},e,o,arguments.length)}}),f.each(["top","left"],function(e,t){f.cssHooks[t]=Ve(v.pixelPosition,function(e,i){if(i)return i=Me(e,t),De.test(i)?f(e).position()[t]+"px":i})}),f.each({Height:"height",Width:"width"},function(e,t){f.each({padding:"inner"+e,content:t,"":"outer"+e},function(i,o){f.fn[o]=function(n,a){var r=arguments.length&&(i||"boolean"!=typeof n),s=i||(!0===n||!0===a?"margin":"border");return z(this,function(t,i,n){var a;return f.isWindow(t)?0===o.indexOf("outer")?t["inner"+e]:t.document.documentElement["client"+e]:9===t.nodeType?(a=t.documentElement,Math.max(t.body["scroll"+e],a["scroll"+e],t.body["offset"+e],a["offset"+e],a["client"+e])):void 0===n?f.css(t,i,s):f.style(t,i,n,s)},t,r?n:void 0,r)}})}),f.fn.extend({bind:function(e,t,i){return this.on(e,null,t,i)},unbind:function(e,t){return this.off(e,null,t)},delegate:function(e,t,i,o){return this.on(t,e,i,o)},undelegate:function(e,t,i){return 1===arguments.length?this.off(e,"**"):this.off(t,e||"**",i)}}),f.parseJSON=JSON.parse,"function"==typeof liveRequire.define&&liveRequire.define.amd&&liveRequire.define("jquery",[],function(){return f});var Vt=e.jQuery,Ut=e.$;return f.noConflict=function(t){return e.$===f&&(e.$=Ut),t&&e.jQuery===f&&(e.jQuery=Vt),f},t||(e.jQuery=e.$=f),f}),liveRequire.define("LiveSessionStore",[],function(){"use strict";const e="OracleLive_SessionState_";return new class{constructor(){this.stateMap=new Map,window.addEventListener("beforeunload",()=>{this.saveState()})}initState(e,t){this.stateMap.set(e,t),console.log("LiveSessionStore.initState: "+e)}loadState(t,i,o){console.log("LiveSessionStore.loadState: "+t);const n=sessionStorage.getItem(e+t);n?(console.log("LiveSessionStore.loadState: found key: "+t,n),i(JSON.parse(n))):o&&o()}saveState(){console.log("LiveSessionStore.saveState"),this.stateMap.forEach((t,i)=>{console.log("LiveSessionStore.saveState: "+i),t.toJSON()?sessionStorage.setItem(e+i,t.toJSON()):sessionStorage.removeItem(e+i),"function"==typeof t.beforeUnload&&(console.log("LiveSessionStore.beforeUnload: "+i),t.beforeUnload())})}loadStateCompleted(){console.log("LiveSessionStore.loadStateCompleted"),this.stateMap.forEach((e,t)=>{"function"==typeof e.loadComplete&&(console.log("LiveSessionStore.loadStateCompleted: "+t),e.loadComplete())})}clearState(){console.log("LiveSessionStore.clearState"),this.stateMap.forEach((t,i)=>{console.log("LiveSessionStore.clearState: "+i),sessionStorage.removeItem(e+i)}),this.stateMap.clear()}}}),liveRequire.define("LiveService",["LiveSessionStore"],function(e){"use strict";const t=1200;return class{constructor(t){this._impl=t,this._address="https://live.oraclecloud.com",this._userID="",this._tenantID="",this._authToken=null,this._tokenRefreshInterval=null,this._language=null,this._startCallDirectly=!1,e.initState("LiveService",this),$(()=>{console.log("LiveService: Loading"),e.loadState("LiveService",e=>{this._address=e.address,this._userID=e.userID,this._tenantID=e.tenantID,this._language=e.language?e.language:null,this.__startCallDirectly=e.startCallDirectly,console.log("LiveService: Loaded")})})}toJSON(){return JSON.stringify({address:this._address,userID:this._userID,tenantID:this._tenantID,language:this._language,startCallDirectly:this._startCallDirectly})}set language(e){this._language=e}get language(){return this._language}set address(e){this._address=e}get address(){return this._address}set userID(e){this._userID=e}get userID(){return this._userID}set tenantID(e){this._tenantID=e}get tenantID(){return this._tenantID}set startCallDirectly(e){this._startCallDirectly=e}get startCallDirectly(){return this._startCallDirectly}set authToken(e){console.log("LiveService::set authToken: ",e),this._authToken=e,this._impl.updateAuthToken(this._authToken)}get authToken(){return this._authToken}authRefresh(e,i){if("function"==typeof i){e<60&&(e=t);const o=e>200?e-120:e;console.log("Will refresh token every "+o+" seconds"),this._tokenRefreshInterval&&(clearInterval(this._tokenRefreshInterval),this._tokenRefreshInterval=null),this._tokenRefreshInterval=setInterval(()=>{console.log("Refreshing auth token..."),i()},1e3*o)}else console.error("Invalid token refresh function")}isValid(){let e=!0;return null!==this._authToken&&""!==this._authToken||(console.error("Live Experience - controller.service invalid: authToken not set"),e=!1),null!==this._userID&&""!==this._userID||(console.error("Live Experience - controller.service invalid: userID not set"),e=!1),null!==this._tenantID&&""!==this._tenantID||(console.error("Live Experience - controller.service invalid: tenantID not set"),e=!1),null!==this._address&&""!==this._address||(console.error("Live Experience - controller.service invalid: address not set"),e=!1),void 0!==this._language&&""!==this._language||(console.error("Live Experience - controller.service invalid: language must be null or set",this._language),e=!1),e}}}),liveRequire.define("LiveContextAttributes",[],function(){"use strict";return class{constructor(e){this._impl=e,this._entries=new Map}set(e,t){this._entries.set(e,t),this._impl.sendUpdatedContextAttribute(e,t)}get(e){return this._entries.get(e)}removeAll(){this._entries.clear()}remove(e){this._entries.delete(e)}isValid(){return 0===this._entries.size&&console.error("Live Experience - controller.contextAttributes invalid: No context attributes defined"),this._entries.size>0}toJSON(){let e=Object.create(null);for(let[t,i]of this._entries)e[t]=i;return JSON.stringify(e)}toWebContext(){let e=Object.create(null);for(let[t,i]of this._entries)console.log("Create web context with",t,i),i&&"behaviours"!==t&&"messages"!==t&&(e[t]=i,console.log("Adding key"));return e}populateContext(e,t,i){this.set("browser",t),this.set("browserVersion",""+i),this.set("clientVersion",e);const o=document.URL;console.log("current URL: "+o),this.set("url",o),console.log("populateContext:",this)}}}),liveRequire.define("LiveSettings",["LiveSessionStore"],function(e){"use strict";return class{constructor(){this._startVideoWithFrontCamera=!1,this._startVideoInFullScreen=!1,this._hideEndCallButton=!1,this._hidePauseButton=!1,this._hideQueueLengthIndicator=!1,e.initState("LiveSettings",this),$(()=>{console.log("LiveSettings: Loading"),e.loadState("LiveSettings",e=>{this._startVideoWithFrontCamera=e.startVideoWithFrontCamera,this._startVideoInFullScreen=e.startVideoInFullScreen,this._hideEndCallButton=e.hideEndCallButton,this._hidePauseButton=e.hidePauseButton,this._hideQueueLengthIndicator=e.hideQueueLengthIndicator})})}toJSON(){return JSON.stringify({startVideoWithFrontCamera:this._startVideoWithFrontCamera,startVideoInFullScreen:this._startVideoInFullScreen,hideEndCallButton:this._hideEndCallButton,hidePauseButton:this._hidePauseButton,hideQueueLengthIndicator:this._hideQueueLengthIndicator})}reset(){this._startVideoWithFrontCamera=!1,this._startVideoInFullScreen=!1,this._hideEndCallButton=!1,this._hidePauseButton=!1,this._hideQueueLengthIndicator=!1}get startVideoWithFrontCamera(){return this._startVideoWithFrontCamera}set startVideoWithFrontCamera(e){this._startVideoWithFrontCamera=e}get startVideoInFullScreen(){return this._startVideoInFullScreen}set startVideoInFullScreen(e){this._startVideoInFullScreen=e}get hideEndCallButton(){return this._hideEndCallButton}set hideEndCallButton(e){this._hideEndCallButton=e}get hidePauseButton(){return this._hidePauseButton}set hidePauseButton(e){this._hidePauseButton=e}get hideQueueLengthIndicator(){return this._hideQueueLengthIndicator}set hideQueueLengthIndicator(e){this._hideQueueLengthIndicator=e}}}),liveRequire.define("LiveApiVersion",[],function(){"use strict";return class{constructor(){this.TEST_VERSION="99.12",this.LATEST_KNOWN_RELEASE="19.11",this.COMMIT_BRANCH="support/19.11.2",this.COMMIT_HASH="66603d972d1f37e61f88c512e6016248cc7cd18a",this.BUILD_TAG="heads/support/19.11.2",this.appVersion=null}get version(){if(!this.appVersion){console.log("build info: "+this.buildInfo);const e=this.buildTag,t=e.lastIndexOf("/");this.appVersion=t>-1?e.substring(t+1):e,console.log("appVersion="+this.appVersion)}return this.appVersion&&"UNKNOWN_BRANCH"!==this.appVersion||(this.appVersion=this.LATEST_KNOWN_RELEASE),this.appVersion}get commitBranch(){return this.COMMIT_BRANCH}get commitHash(){return this.COMMIT_HASH}get buildTag(){let e=this.BUILD_TAG;return"unknown"!==e&&-1===e.indexOf("BUILD_TAG")||"unknown"!==(e=this.COMMIT_BRANCH)&&-1===e.indexOf("COMMIT_BRANCH")||(e=this.TEST_VERSION),e}get buildInfo(){const e=this.buildTag,t=""!==e?" @ "+e:"";return this.commitHash+" : "+this.commitBranch+t}}}),liveRequire.define("LiveEvents",[],function(){"use strict";const e={LiveConnecting:"LiveConnecting",LiveCanceled:"LiveCanceled",LiveConnected:"LiveConnected",LiveStreamError:"LiveStreamError",LiveEnded:"LiveEnded",LiveLoginSuccess:"LiveLoginSuccess",LiveLoginError:"LiveLoginError",LiveStartCall:"LiveStartCall",LiveStateReloaded:"LiveStateReloaded",LiveWaiting:"LiveWaiting",LiveConnectingNoAnswer:"LiveConnectingNoAnswer",LivePausedLocally:"LivePausedLocally",LiveResumedLocally:"LiveResumedLocally",LiveRatingRequired:"LiveRatingRequired",LiveRatingCompleted:"LiveRatingCompleted",LiveParticipantLeft:"LiveParticipantLeft",LiveStreamActive:"LiveStreamActive",LiveReconnectingRemote:"LiveReconnectingRemote",LiveReconnectedRemote:"LiveReconnectedRemote",LiveRecordingStarted:"LiveRecordingStarted",LiveRecordingStopped:"LiveRecordingStopped",LivePausedRemotely:"LivePausedRemotely",LiveResumedRemotely:"LiveResumedRemotely",LiveReconnectingLocal:"LiveReconnectingLocal",LiveReconnectedLocal:"LiveReconnectedLocal",LiveStartVideoRequested:"LiveStartVideoRequested",LiveStartVideoRequestCancelled:"LiveStartVideoRequestCancelled",LiveStartScreenShareRequested:"LiveStartScreenShareRequested",LiveStartScreenShareRequestCancelled:"LiveStartScreenShareRequestCancelled",LiveScreenSharePluginRequired:"LiveScreenSharePluginRequired",LiveScreenSharePluginInstalling:"LiveScreenSharePluginInstalling",LiveScreenSharePluginInstalled:"LiveScreenSharePluginInstalled",LiveSystemScreenShareDialogShowing:"LiveSystemScreenShareDialogShowing",LiveSystemScreenShareDialogRemoved:"LiveSystemScreenShareDialogRemoved",LiveRemoteVideoStarted:"LiveRemoteVideoStarted",LiveRemoteVideoStopped:"LiveRemoteVideoStopped",LiveRemoteVideoLoading:"LiveRemoteVideoLoading",LiveRemoteVideoLoaded:"LiveRemoteVideoLoaded",LiveLocalVideoStarted:"LiveLocalVideoStarted",LiveLocalVideoStopped:"LiveLocalVideoStopped",LiveNetworkPoor:"LiveNetworkPoor",LiveNetworkNormal:"LiveNetworkNormal",LiveRemoteScreenShareRequested:"LiveRemoteScreenShareRequested",LiveRemoteScreenShareCancelled:"LiveRemoteScreenShareCancelled",LiveLocalScreenStarted:"LiveLocalScreenStarted",LiveLocalScreenStopped:"LiveLocalScreenStopped",LiveRemoteScreenStarted:"LiveRemoteScreenStarted",LiveRemoteScreenStopped:"LiveRemoteScreenStopped",LiveRemoteScreenActive:"LiveRemoteScreenActive",LiveDiagnosticsAudioVideoStarted:"LiveDiagnosticsAudioVideoStarted",LiveDiagnosticsAudioStarted:"LiveDiagnosticsAudioStarted",LiveDiagnosticsComplete:"LiveDiagnosticsComplete",LiveDiagnosticsFailed:"LiveDiagnosticsFailed",LiveScreenShareAnnotationStarted:"LiveScreenShareAnnotationStarted",LiveScreenShareAnnotationStopped:"LiveScreenShareAnnotationStopped",LiveAssociateAnnotationStarted:"LiveAssociateAnnotationStarted",LiveAssociateAnnotationStopped:"LiveAssociateAnnotationStopped",LiveAssociateAnnotationReceived:"LiveAssociateAnnotationReceived",LiveAssociateVideoAnnotationStarted:"LiveAssociateVideoAnnotationStarted",LiveAssociateVideoAnnotationStopped:"LiveAssociateVideoAnnotationStopped",LiveAssociateFreezeCustomerStream:"LiveAssociateFreezeCustomerStream",LiveAssociateUnfreezeCustomerStream:"LiveAssociateUnfreezeCustomerStream",LiveAssociateVideoAnnotationReceived:"LiveAssociateVideoAnnotationReceived",LiveMessageEmitted:"LiveMessageEmitted",LivePreCallIDCheckStarted:"LivePreCallIDCheckStarted",LivePreCallIDCheckComplete:"LivePreCallIDCheckComplete",LivePreCallIDCheckError:"LivePreCallIDCheckError",LiveStartVerificationCall:"LiveStartVerificationCall",LiveCallQueuePositionUpdate:"LiveCallQueuePositionUpdate",LiveAssociateTransferStarted:"LiveAssociateTransferStarted",LiveAssociateTransferStartStream:"LiveAssociateTransferStartStream",LiveAssociateTransferCompleted:"LiveAssociateTransferCompleted",LiveAssociateTransferFailed:"LiveAssociateTransferFailed",LiveAssociateTransferStopped:"LiveAssociateTransferStopped"};return Object.freeze(e),e}),liveRequire.define("LiveExposedEvents",["LiveEvents"],function(e){"use strict";return[e.LiveConnecting,e.LiveConnected,e.LiveCanceled,e.LiveEnded,e.LiveStreamError]}),liveRequire.define("text",["module"],function(e){"use strict";var t,i,o,n,a,r=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],s=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,l=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,c="undefined"!=typeof location&&location.href,d=c&&location.protocol&&location.protocol.replace(/\:/,""),u=c&&location.hostname,h=c&&(location.port||void 0),p={},v=e.config&&e.config()||{};function g(e,t){return void 0===e||""===e?t:e}return t={version:"2.0.15",strip:function(e){if(e){var t=(e=e.replace(s,"")).match(l);t&&(e=t[1])}else e="";return e},jsEscape:function(e){return e.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r").replace(/[\u2028]/g,"\\u2028").replace(/[\u2029]/g,"\\u2029")},createXhr:v.createXhr||function(){var e,t,i;if("undefined"!=typeof XMLHttpRequest)return new XMLHttpRequest;if("undefined"!=typeof ActiveXObject)for(t=0;t<3;t+=1){i=r[t];try{e=new ActiveXObject(i)}catch(e){}if(e){r=[i];break}}return e},parseName:function(e){var t,i,o,n=!1,a=e.lastIndexOf("."),r=0===e.indexOf("./")||0===e.indexOf("../");return-1!==a&&(!r||a>1)?(t=e.substring(0,a),i=e.substring(a+1)):t=e,-1!==(a=(o=i||t).indexOf("!"))&&(n="strip"===o.substring(a+1),o=o.substring(0,a),i?i=o:t=o),{moduleName:t,ext:i,strip:n}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(e,i,o,n){var a,r,s,l=t.xdRegExp.exec(e);return!l||(a=l[2],s=(r=(r=l[3]).split(":"))[1],r=r[0],(!a||a===i)&&(!r||r.toLowerCase()===o.toLowerCase())&&(!s&&!r||function(e,t,i,o){if(t===o)return!0;if(e===i){if("http"===e)return g(t,"80")===g(o,"80");if("https"===e)return g(t,"443")===g(o,"443")}return!1}(a,s,i,n)))},finishLoad:function(e,i,o,n){o=i?t.strip(o):o,v.isBuild&&(p[e]=o),n(o)},load:function(e,i,o,n){if(n&&n.isBuild&&!n.inlineText)o();else{v.isBuild=n&&n.isBuild;var a=t.parseName(e),r=a.moduleName+(a.ext?"."+a.ext:""),s=i.toUrl(r),l=v.useXhr||t.useXhr;0!==s.indexOf("empty:")?!c||l(s,d,u,h)?t.get(s,function(i){t.finishLoad(e,a.strip,i,o)},function(e){o.error&&o.error(e)}):i([r],function(e){t.finishLoad(a.moduleName+"."+a.ext,a.strip,e,o)}):o()}},write:function(e,i,o,n){if(p.hasOwnProperty(i)){var a=t.jsEscape(p[i]);o.asModule(e+"!"+i,"define(function () { return '"+a+"';});\n")}},writeFile:function(e,i,o,n,a){var r=t.parseName(i),s=r.ext?"."+r.ext:"",l=r.moduleName+s,c=o.toUrl(r.moduleName+s)+".js";t.load(l,o,function(i){var o=function(e){return n(c,e)};o.asModule=function(e,t){return n.asModule(e,c,t)},t.write(e,l,o,a)},a)}},"node"===v.env||!v.env&&"undefined"!=typeof process&&process.versions&&process.versions.node&&!process.versions["node-webkit"]&&!process.versions["atom-shell"]?(i=require.nodeRequire("fs"),t.get=function(e,t,o){try{var n=i.readFileSync(e,"utf8");"\ufeff"===n[0]&&(n=n.substring(1)),t(n)}catch(e){o&&o(e)}}):"xhr"===v.env||!v.env&&t.createXhr()?t.get=function(e,i,o,n){var a,r=t.createXhr();if(r.open("GET",e,!0),n)for(a in n)n.hasOwnProperty(a)&&r.setRequestHeader(a.toLowerCase(),n[a]);v.onXhr&&v.onXhr(r,e),r.onreadystatechange=function(t){var n,a;4===r.readyState&&((n=r.status||0)>399&&n<600?((a=new Error(e+" HTTP status: "+n)).xhr=r,o&&o(a)):i(r.responseText),v.onXhrComplete&&v.onXhrComplete(r,e))},r.send(null)}:"rhino"===v.env||!v.env&&"undefined"!=typeof Packages&&"undefined"!=typeof java?t.get=function(e,t){var i,o,n=new java.io.File(e),a=java.lang.System.getProperty("line.separator"),r=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(n),"utf-8")),s="";try{for(i=new java.lang.StringBuffer,(o=r.readLine())&&o.length()&&65279===o.charAt(0)&&(o=o.substring(1)),null!==o&&i.append(o);null!==(o=r.readLine());)i.append(a),i.append(o);s=String(i.toString())}finally{r.close()}t(s)}:("xpconnect"===v.env||!v.env&&"undefined"!=typeof Components&&Components.classes&&Components.interfaces)&&(o=Components.classes,n=Components.interfaces,Components.utils.import("resource://gre/modules/FileUtils.jsm"),a="@mozilla.org/windows-registry-key;1"in o,t.get=function(e,t){var i,r,s,l={};a&&(e=e.replace(/\//g,"\\")),s=new FileUtils.File(e);try{(i=o["@mozilla.org/network/file-input-stream;1"].createInstance(n.nsIFileInputStream)).init(s,1,0,!1),(r=o["@mozilla.org/intl/converter-input-stream;1"].createInstance(n.nsIConverterInputStream)).init(i,"utf-8",i.available(),n.nsIConverterInputStream.DEFAULT_REPLACEMENT_CHARACTER),r.readString(i.available(),l),r.close(),i.close(),t(l.value)}catch(e){throw new Error((s&&s.path||"")+": "+e)}}),t}),liveRequire.define("text!oracle.live.button.html",[],function(){return'\x3c!--\n  ~ Copyright (c) 2018 Oracle. All rights reserved.\n  ~\n  ~ This material is the confidential property of Oracle Corporation or its\n  ~ licensors and may be used, reproduced, stored or transmitted only in\n  ~ accordance with a valid Oracle license or sublicense agreement.\n--\x3e\n\n<div class="oracle-live">\n  <div class="oracle-live-menu">\n    <div class="oracle-live-menu-leftspacer" role="presentation"></div>\n    <div class="oracle-live-pause-button oracle-live-buttonbar-button" role="button" tabindex=0>\n      <div class="oracle-live-buttonbar-icon" role="presentation"/>\n    </div>\n    <div class="oracle-live-video-button oracle-live-buttonbar-button" role="button" tabindex=0>\n      <div class="oracle-live-buttonbar-icon" role="presentation"/>\n    </div>\n    <div class="oracle-live-screenshare-button oracle-live-buttonbar-button" role="button" tabindex=0>\n      <div class="oracle-live-buttonbar-icon" role="presentation"/>\n    </div>\n    <div class="oracle-live-annotate-button oracle-live-buttonbar-button" role="button" tabindex=0>\n      <div class="oracle-live-buttonbar-icon" role="presentation"/>\n    </div>\n    <div class="oracle-live-exit-button" role="button" tabindex=0>\n      <div class="oracle-live-exitbutton-icon" role="presentation"/>\n    </div>\n    <div class="oracle-live-menu-rightspacer" role="presentation"></div>\n  </div>\n  <div role="application" class="oracle-live-cancel-rejoin-buttons">\n    <div class="oracle-live-cancel-button" role="button" tabindex=0></div>\n    <div class="oracle-live-rejoin-button" role="button" tabindex=0></div>\n  </div>\n  <div class="oracle-live-main-button" role="button" tabindex=0>\n    <div class="oracle-live-mainbutton-spinner"></div>\n    <div class="oracle-live-mainbutton-icon" role="presentation"></div>\n    <span class="oracle-live-initials"></span>\n    <img class="oracle-live-agent-image" src=""/>\n    <div class="oracle-live-mainbutton-badge"></div>\n  </div>\n  <div class="oracle-live-callinfo">\n    <div class="oracle-live-callinfo-icon">\n      <span class="oracle-live-associate oracle-live-callinfo-associate"></span>\n    </div>\n    <div role="recindicator" class="oracle-live-recording oracle-live-callinfo-recording">Rec</div>\n    <label class="oracle-live-duration-label"></label>\n    <span role="timer" class="oracle-live-callinfo-timer">00:00</span>\n  </div>\n  <div class="oracle-live-call-queue-info">\n    <label class="oracle-live-position-in-queue-label"></label>\n    <span class="oracle-live-position-in-queue"></span>\n  </div>\n  <div class="oracle-live-popmessage" role="status">\n    <div role="alert" class="oracle-live-popmessage-text"></div>\n    <div class="oracle-live-popmessage-shortcode">ABCDEF</div>\n  </div>\n  <div role="alert" class="oracle-live-notificationmessage">\n    <span role="presentation"></span>\n    <div class="oracle-live-notification"></div>\n    <div role="button" tabindex=0></div>\n  </div>\n  <div role="alert" class="oracle-live-dialog">\n    <div class="oracle-live-dialog-title" role="heading"></div>\n    <div class="oracle-live-dialog-message" role="note"></div>\n    <div class="oracle-live-dialog-feedback">\n      <div id="oracle-live-dialog-question" class="oracle-live-dialog-question"></div>\n      <div class="oracle-live-dialog-options" role="radiogroup" aria-labelledby="oracle-live-dialog-question">\n        <div class="oracle-live-dialog-option-poor oracle-live-label-ellipsis" \n             role="radio" \n             aria-checked="false"\n             tabindex=0>\n          <div role="presentation"/>\n          <label/>\n        </div>\n        <div class="oracle-live-dialog-option-good oracle-live-label-ellipsis" \n             role="radio" \n             aria-checked="false"\n             tabindex=-1>\n          <div role="presentation"/>\n          <label/>\n        </div>\n        <div class="oracle-live-dialog-option-excellent oracle-live-label-ellipsis"\n             role="radio" \n             aria-checked="false"\n             tabindex=-1>\n          <div role="presentation"/>\n          <label/>\n        </div>\n      </div>\n    </div>\n    <div role="application" class="oracle-live-dialog-buttons">\n      <div role="button" tabindex=0 class="oracle-live-dialog-cancel oracle-live-label-ellipsis"></div>\n      <div role="button" tabindex=0 class="oracle-live-dialog-ok oracle-live-label-ellipsis"></div>\n    </div>\n  </div>\n\n  \x3c!-- audio and video tags --\x3e\n  <div id="oracle-live-audio" class="oracle-live-audio">\n    <audio id="oracle-live-local-audio" class="oracle-live-local-audio" autoplay muted preload="metadata"></audio>\n    <audio id="oracle-live-remote-audio" class="oracle-live-remote-audio" autoplay preload="metadata"></audio>\n    <audio id="connectingAudio" preload="auto">\n      <source src="" type="audio/wav" loop="true">\n    </audio>\n  </div>\n\n  <div class="oracle-live-audio-panel">\n    <div>\n      <div role="heading"></div>\n      <div role="timer">00:00</div>\n      <div role="recindicator" class="oracle-live-recording">Rec</div>\n    </div>\n    <div class="oracle-live-video-pause-graphic">\n    </div>\n    <span class="oracle-live-audio-panel-message"></span>\n    <hr/>\n  </div>\n\n   <div class="oracle-live-video-panel oracle-live-screenshare-panel-enduser">\n      <div class="oracle-live-video-pause-graphic">\n      </div>\n      <video id="oracle-live-local-screenshare" class="oracle-live-local-screenshare"\n             autoplay muted playsinline preload="metadata"></video>\n  </div>\n\n  \x3c!-- This is where you connect the local video (customer camera) --\x3e\n  \x3c!-- TODO: I just want one of these which we clone twice --\x3e\n  <div class="oracle-live-video-panel oracle-live-video-panel-enduser">\n   <div class="oracle-live-video-pause-graphic">\n   </div>\n    <div class="oracle-live-call-queue-info">\n      <label class="oracle-live-position-in-queue-label"></label>\n      <span class="oracle-live-position-in-queue"></span>\n    </div>\n    <div class="oracle-live-video-no-connection-graphic">\n   </div>\n    <video id="oracle-live-local-video" class="oracle-live-local-video"\n           autoplay muted playsinline preload="metadata"></video>\n    <div role="presentation"></div>\n    <div role="presentation"></div>\n    <div role="application" class="oracle-live-video-buttons-preview">\n      <div role="button" tabindex=0 class="oracle-live-preview-start-button"></div>\n      <div role="button" tabindex=0 class="oracle-live-preview-cancel-button"></div>\n    </div>\n    <div role="toolbar" class="oracle-live-video-toolbar oracle-live-video-toolbar-enduser">\n      <div name="endUserVideo" class="oracle-live-video-maximize oracle-live-video-toolbar-enduser" role="button" tabindex=0></div>\n      <div role="heading" class="oracle-live-video-associate-maximized-title"></div>\n      <div role="recindicator" class="oracle-live-recording oracle-live-video-toolbar-recording">Rec</div>\n      <div role="timer" class="oracle-live-video-toolbar-timer">00:00</div>\n      <div name="swapCamera" class="oracle-live-swap-camera oracle-live-hide-camera-swap-button" role="button" tabindex="0"></div>\n    </div>\n    <div role="toolbar" class="oracle-live-video-toolbar oracle-live-video-toolbar-enduser-unfreeze" style="top: 44px; background-color: transparent;">\n      <div tabindex="0" role="main" class="oracle-live-unfreeze-annotation-camera">\n        <div name="unfreezeAnnotationCamera" class="oracle-live-unfreeze-annotation-camera" role="button"></div>\n      </div>\n      <div name="unfreezeAnnotationCross" class="oracle-live-unfreeze-annotation-cross" role="button" tabindex=0></div>\n    </div>\n    <div class="oracle-live-video-associate-name"></div>\n    <div role="heading"></div>\n    <div class="oracle-live-video-panel-message"></div>\n    <canvas class="oracle-live-annotation-video-canvas"></canvas>\n  </div>\n\n  \x3c!-- This is where you connect the remote video (associate camera) --\x3e\n  <div class="oracle-live-video-panel oracle-live-video-panel-associate">\n    <div class="oracle-live-video-pause-graphic">\n    </div>\n    <div class="oracle-live-video-no-connection-graphic">\n    </div>\n    <video id="oracle-live-remote-video" class="oracle-live-remote-video"\n           autoplay playsinline preload="metadata"></video>\n    <div role="presentation"></div>\n    <div role="presentation"></div>\n    <div role="toolbar" class="oracle-live-video-toolbar oracle-live-video-toolbar-associate">\n      <div name="associateVideo" class="oracle-live-video-maximize oracle-live-video-toolbar-associate" role="button" tabindex=0></div>\n      <div role="heading" class="oracle-live-video-associate-maximized-title oracle-live-video-toolbar-associate"></div>\n      <div role="recindicator" class="oracle-live-recording oracle-live-video-toolbar-recording oracle-live-video-toolbar-associate">Rec</div>\n      <div role="timer" class="oracle-live-video-toolbar-timer oracle-live-video-toolbar-associate">00:00</div>\n      <div name="swapCamera" class="oracle-live-swap-camera" role="button" tabindex="0"></div>\n    </div>\n    <div class="oracle-live-video-associate-name"></div>\n    <div class="oracle-live-video-panel-message"></div>\n    <div role="progressbar" class="oracle-live-video-loading-spinner"></div>\n  </div>\n\n  \x3c!-- This is where you connect the remote screenshare video (associate screenshare) --\x3e\n  <div class="oracle-live-video-panel oracle-live-screenshare-panel-associate">\n    <div class="oracle-live-video-pause-graphic">\n    </div>\n    <div class="oracle-live-video-no-connection-graphic">\n    </div>\n    <div class="oracle-live-video-scroller">\n      <video id="oracle-live-remote-screenshare" class="oracle-live-remote-screenshare"\n             autoplay muted playsinline preload="metadata"></video>\n    </div>\n    <div role="presentation"></div>\n    <div role="presentation"></div>\n    <div role="toolbar" class="oracle-live-video-toolbar oracle-live-video-toolbar-screenshare">\n      <div name="associateScreenShare" class="oracle-live-video-maximize oracle-live-video-toolbar-screenshare" role="button" tabindex=0></div>\n      <div role="heading" class="oracle-live-video-associate-maximized-title oracle-live-video-toolbar-screenshare"></div>\n      <div role="recindicator" class="oracle-live-recording oracle-live-video-toolbar-recording oracle-live-video-toolbar-screenshare">Rec</div>\n      <div role="timer" class="oracle-live-video-toolbar-timer oracle-live-video-toolbar-screenshare">00:00</div>\n    </div>\n    <div class="oracle-live-video-associate-name"></div>\n    <div class="oracle-live-video-panel-message"></div>\n  </div>\n\n  <div class="oracle-live-video-buttons-zoom">\n    <div role="button" tabindex=0 class="oracle-live-video-zoomin-button"></div>\n    <div role="button" tabindex=0 class="oracle-live-video-default-button" aria-disabled=true></div>\n    <div role="button" tabindex=0 class="oracle-live-video-zoomout-button" aria-disabled=true></div>\n  </div>\n  <canvas class="oracle-live-annotation-canvas"></canvas>\n  <canvas id="screen-share-arriving" class="oracle-live-screen-share-canvas"></canvas>\n\n  \x3c!-- This is where we show the Jumio ID Verification screens in an iframe. --\x3e\n  <div class="oracle-live-know-your-customer">\n    <iframe id="kyc-iframe" class="kyc-jumio-iframe"\n      src=""\n      allow="camera">\n    </iframe>\n  </div>\n\n  \x3c!-- This is where we display the preCallIDCheck verifying screens. --\x3e\n  <div class="oracle-live-verification-panel oracle-live-verification-identity">\n    <div role="toolbar">\n      <div name="kyc-verifying" class="oracle-live-verification-close" role="button" tabindex="0"></div>\n    </div>\n    <div class="oracle-live-verification-container">\n      <div class="oracle-live-verification-image oracle-live-verification-verifying-image"></div>\n      <div class="oracle-live-verification-heading" role="heading">Verifying Identity</div>\n      <div class="oracle-live-verification-message" role="message">This process can take up to 4 minutes.</div>\n      <div role="progressbar" class="oracle-live-verification-spinner"></div>\n    </div>\n  </div>\n\n  <div class="oracle-live-verification-panel oracle-live-verification-success">\n    <div class="oracle-live-verification-container">\n      <div class="oracle-live-verification-image oracle-live-verification-success-image"></div>\n      <div class="oracle-live-verification-heading" role="heading">Verification Complete</div>\n      <div class="oracle-live-verification-message" role="message">\n        Congratulations! You have completed the process of verifying your ID.\n      </div>\n      <div class="oracle-live-verification-success-button" role="button"\n           title="Continue" aria-disabled="false">Continue</div>\n    </div>\n  </div>\n\n  <div class="oracle-live-verification-panel oracle-live-verification-failed">\n    <div class="oracle-live-verification-container">\n      <div class="oracle-live-verification-image oracle-live-verification-failed-image"></div>\n      <div class="oracle-live-verification-heading" role="heading">Verification Failed</div>\n      <div class="oracle-live-verification-message" role="message">\n        We were unable to verify your ID. You can try again using a different form of identification.\n      </div>\n      <div class="oracle-live-verification-try-again-button" role="button"\n           title="Continue" aria-disabled="false">Try Again</div>\n    </div>\n  </div>\n\n  <div class="oracle-live-verification-panel oracle-live-verification-verified">\n    <div role="toolbar">\n      <div name="kyc-verifying" class="oracle-live-verification-close" role="button" tabindex="0"></div>\n    </div>\n    <div class="oracle-live-verification-container">\n      <div class="oracle-live-verification-image oracle-live-verification-almost-done-image"></div>\n      <div class="oracle-live-verification-heading" role="heading">Almost Done</div>\n      <div class="oracle-live-verification-message" role="message">\n        We just need to have a quick video call with you to complete the verification process.\n      </div>\n      <div class="oracle-live-verification-continue-button" role="button"\n           title="Continue" aria-disabled="false">Continue</div>\n    </div>\n  </div>\n\n\n</div>\n'}),liveRequire.define("LiveCallTimer",["LiveSessionStore"],function(e){"use strict";class t{constructor(){this._timer=null,this._restartTimer=!1,this._now=0,this._startTime=0,e.initState("LiveCallTimer",this),$(()=>{console.log("LiveCallTimer: Loading"),e.loadState("LiveCallTimer",e=>{if(this._startTime=e.startTime,e.timer){this._restartTimer=!0,this._now=this.getTimeNow();const e=t.formatDuration(this._startTime,this._now);$(".oracle-live [role='timer']").each(function(){$(this).text(e)})}console.log("LiveCallTimer: Loaded, startTime="+this._startTime)})})}toJSON(){return JSON.stringify({startTime:this._startTime,timer:this._timer})}loadComplete(){console.log("LiveCallTimer: Load complete, restartTimer="+this._restartTimer),this._restartTimer&&this.resumeTimer()}static formatDuration(e,t){let i=Math.floor(t-e);const o=Math.floor(i/3600);i=Math.floor(i-3600*o);const n=Math.floor(i/60),a=Math.floor(i-60*n),r=(e,t,i)=>(new Array(i+1).join(t)+e).slice(-i);return(o>0?r(o,"",2)+":":"")+(n>0?r(n,"0",2):"00")+":"+r(a,"0",2)}startTimer(){this._timer&&this.stopTimer(),this._startTime=this.getTimeNow(),this.resumeTimer()}resumeTimer(){this._timer=setInterval(()=>{this._now=this.getTimeNow();const e=t.formatDuration(this._startTime,this._now);$(".oracle-live [role='timer']").each(function(){$(this).text(e)})},1e3),console.log("Started timer... startTime="+this._startTime,this._timer)}stopTimer(){console.log("Stopping timer...",this._timer),this._timer&&(clearInterval(this._timer),this._timer=null)}resetTimer(){console.log("Resetting timer"),$(".oracle-live [role='timer']").each(function(){$(this).text("00:00")}),this._startTime=0,this.stopTimer()}getTimeNow(){return Math.floor(Date.now()/1e3)}}return t}),liveRequire.define("LiveIconColours",[],function(){"use strict";return class{_hex2dec(e){let t=parseInt(e,16);return isNaN(t)&&(t=-2),t}_hex2rgba(e){console.log("_hex2rgba: incoming",e);let t=[-1,-1,-1,-1],i=!0;if(e)switch(e.length){case 4:case 5:t[0]=this._hex2dec("0x"+e[1]+e[1]),t[1]=this._hex2dec("0x"+e[2]+e[2]),t[2]=this._hex2dec("0x"+e[3]+e[3]),5===e.length&&(t[3]=this._hex2dec("0x"+e[4]+e[4]));break;case 7:case 9:t[0]=this._hex2dec("0x"+e[1]+e[2]),t[1]=this._hex2dec("0x"+e[3]+e[4]),t[2]=this._hex2dec("0x"+e[5]+e[6]),9===e.length&&(t[3]=this._hex2dec("0x"+e[7]+e[8]));break;default:i=!1}return!i||-2!==t[0]&&-2!==t[1]&&-2!==t[2]&&-2!==t[3]||(i=!1),i||(console.log("_hex2rgba: returning null"),t=null),console.log("_hex2rgba: returning",t),t}constructor(){this._mainButtonInitial=null,this._mainButtonInitial_rgba=[-1,-1,-1,-1],this._mainButtonInitialInverse=null,this._mainButtonInitialInverse_rgba=[-1,-1,-1,-1],this._mainButtonInline=null,this._mainButtonInline_rgba=[-1,-1,-1,-1],this._menuButtonDefault=null,this._menuButtonDefault_rgba=[-1,-1,-1,-1],this._menuButtonInverse=null,this._menuButtonInverse_rgba=[-1,-1,-1,-1],this._menuButtonDisabled=null,this._menuButtonDisabled_rgba=[-1,-1,-1,-1],this._menuEndButtonDefault=null,this._menuEndButtonDefault_rgba=[-1,-1,-1,-1],this._menuEndButtonInverse=null,this._menuEndButtonInverse_rgba=[-1,-1,-1,-1],this._maximizedTopBar=null,this._maximizedTopBar_rgba=[-1,-1,-1,-1],this._callInfoIcon=null,this._callInfoIcon_rgba=[-1,-1,-1,-1]}restoreAll(e){this.mainButtonInitial=e._mainButtonInitial,this.mainButtonInitialInverse=e._mainButtonInitialInverse,this.mainButtonInline=e._mainButtonInline,this.menuButtonDefault=e._menuButtonDefault,this.menuButtonInverse=e._menuButtonInverse,this.menuButtonDisabled=e._menuButtonDisabled,this.menuEndButtonDefault=e._menuEndButtonDefault,this.menuEndButtonInverse=e._menuEndButtonInverse,this.maximizedTopBar=e._maximizedTopBar,this.callInfoIcon=e._callInfoIcon}get mainButtonInitial(){return this._mainButtonInitial}set mainButtonInitial(e){this._mainButtonInitial=e,this._mainButtonInitial_rgba=this._hex2rgba(e),Object.defineProperty(this,"mainButtonInitial_rgba",{value:this._mainButtonInitial_rgba})}get mainButtonInitialInverse(){return this._mainButtonInitialInverse}set mainButtonInitialInverse(e){this._mainButtonInitialInverse=e,this._mainButtonInitialInverse_rgba=this._hex2rgba(e),Object.defineProperty(this,"mainButtonInitialInverse_rgba",{value:this._mainButtonInitialInverse_rgba})}get mainButtonInline(){return this._mainButtonInline}set mainButtonInline(e){this._mainButtonInline=e,this._mainButtonInline_rgba=this._hex2rgba(e),Object.defineProperty(this,"mainButtonInline_rgba",{value:this._mainButtonInline_rgba})}get menuButtonDefault(){return this._menuButtonDefault}set menuButtonDefault(e){this._menuButtonDefault=e,this._menuButtonDefault_rgba=this._hex2rgba(e),Object.defineProperty(this,"menuButtonDefault_rgba",{value:this._menuButtonDefault_rgba})}get menuButtonInverse(){return this._menuButtonInverse}set menuButtonInverse(e){this._menuButtonInverse=e,this._menuButtonInverse_rgba=this._hex2rgba(e),Object.defineProperty(this,"menuButtonInverse_rgba",{value:this._menuButtonInverse_rgba})}get menuButtonDisabled(){return this._menuButtonDisabled}set menuButtonDisabled(e){this._menuButtonDisabled=e,this._menuButtonDisabled_rgba=this._hex2rgba(e),Object.defineProperty(this,"menuButtonDisabled_rgba",{value:this._menuButtonDisabled_rgba})}get menuEndButtonDefault(){return this._menuEndButtonDefault}set menuEndButtonDefault(e){this._menuEndButtonDefault=e,this._menuEndButtonDefault_rgba=this._hex2rgba(e),Object.defineProperty(this,"menuEndButtonDefault_rgba",{value:this._menuEndButtonDefault_rgba})}get menuEndButtonInverse(){return this._menuEndButtonInverse}set menuEndButtonInverse(e){this._menuEndButtonInverse=e,this._menuEndButtonInverse_rgba=this._hex2rgba(e),Object.defineProperty(this,"menuEndButtonInverse_rgba",{value:this._menuEndButtonInverse_rgba})}get maximizedTopBar(){return this._maximizedTopBar}set maximizedTopBar(e){this._maximizedTopBar=e,this._maximizedTopBar_rgba=this._hex2rgba(e),Object.defineProperty(this,"maximizedTopBar_rgba",{value:this._maximizedTopBar_rgba})}get callInfoIcon(){return this._callInfoIcon}set callInfoIcon(e){this._callInfoIcon=e,this._callInfoIcon_rgba=this._hex2rgba(e),Object.defineProperty(this,"callInfoIcon_rgba",{value:this._callInfoIcon_rgba})}}}),liveRequire.define("LiveScenarioCustomization",["LiveIconColours"],function(e){"use strict";return class{constructor(t){if(this.pinnedTo=null,this.verticalMargin=null,this.horizontalMargin=null,this.iconColours=new e,this.mainButtonInitialBackgroundColour=null,this.mainButtonInitialInverseBackgroundColour=null,this.mainButtonInlineBackgroundColour=null,this.mainButtonInlineFontColour=null,this.initialMessageBackgroundColour=null,this.initialMessageFontColour=null,this.infoPanelBackgroundColour=null,this.infoPanelFontColour=null,this.maximizedTopBarBackgroundColour=null,this.maximizedTopBarFontColour=null,this.buttonBarBackgroundColour=null,this.menuButtonDefaultBackgroundColour=null,this.menuButtonActiveBackgroundColour=null,this.menuButtonDisabledBackgroundColour=null,this.menuEndButtonDefaultBackgroundColour=null,this.menuEndButtonActiveBackgroundColour=null,this.dialogPrimaryButtonBackgroundColour=null,this.dialogPrimaryButtonBorderColour=null,this.dialogPrimaryButtonFontColour=null,this.dialogPrimaryButtonInverseBackgroundColour=null,this.dialogPrimaryButtonInverseBorderColour=null,this.dialogPrimaryButtonInverseFontColour=null,this.dialogSecondaryButtonBackgroundColour=null,this.dialogSecondaryButtonBorderColour=null,this.dialogSecondaryButtonFontColour=null,this.dialogSecondaryButtonInverseBackgroundColour=null,this.dialogSecondaryButtonInverseBorderColour=null,this.dialogSecondaryButtonInverseFontColour=null,t){if(console.log("Incoming customization:",t),t.iconColours&&this.iconColours.restoreAll(t.iconColours),t.position){const e=t.position;e.pinnedTo&&(this.pinnedTo=e.pinnedTo),e.verticalMargin&&(this.verticalMargin=e.verticalMargin),e.horizontalMargin&&(this.horizontalMargin=e.horizontalMargin)}else this.pinnedTo=t.pinnedTo?t.pinnedTo:null,this.verticalMargin=t.verticalMargin>=0?t.verticalMargin:null,this.horizontalMargin=t.horizontalMargin>=0?t.horizontalMargin:null;if(t.mainButton){const e=t.mainButton;if(e.initial&&e.initial.colors){const t=e.initial.colors;t.background&&(this.mainButtonInitialBackgroundColour=t.background),t.icon&&(this.iconColours.mainButtonInitial=t.icon)}if(e.initial&&e.initial.inverse){const t=e.initial.inverse;t.background&&(this.mainButtonInitialInverseBackgroundColour=t.background),t.icon&&(this.iconColours.mainButtonInitialInverse=t.icon)}if(e.inline&&e.inline.colors){const t=e.inline.colors;t.background&&(this.mainButtonInlineBackgroundColour=t.background),t.font&&(this.mainButtonInlineFontColour=t.font),t.icon&&(this.iconColours.mainButtonInline=t.icon)}}else this.mainButtonInitialBackgroundColour=t.mainButtonInitialBackgroundColour?t.mainButtonInitialBackgroundColour:null,this.mainButtonInitialInverseBackgroundColour=t.mainButtonInitialInverseBackgroundColour?t.mainButtonInitialInverseBackgroundColour:null,this.mainButtonInlineBackgroundColour=t.mainButtonInlineBackgroundColour?t.mainButtonInlineBackgroundColour:null,this.mainButtonInlineFontColour=t.mainButtonInlineFontColour?t.mainButtonInlineFontColour:null;if(t.initialMessage&&t.initialMessage.colors){const e=t.initialMessage.colors;e.background&&(this.initialMessageBackgroundColour=e.background),e.font&&(this.initialMessageFontColour=e.font)}else this.initialMessageBackgroundColour=t.initialMessageBackgroundColour?t.initialMessageBackgroundColour:null,this.initialMessageFontColour=t.initialMessageFontColour?t.initialMessageFontColour:null;if(t.infoPanel&&t.infoPanel.colors){const e=t.infoPanel.colors;e.background&&(this.infoPanelBackgroundColour=e.background),e.font&&(this.infoPanelFontColour=e.font,this.iconColours.callInfoIcon=e.font)}else this.infoPanelBackgroundColour=t.infoPanelBackgroundColour?t.infoPanelBackgroundColour:null,this.infoPanelFontColour=t.infoPanelFontColour?t.infoPanelFontColour:null;if(t.maximisedComponent&&t.maximisedComponent.colors){const e=t.maximisedComponent.colors;e.background&&(this.maximizedTopBarBackgroundColour=e.background),e.font&&(this.maximizedTopBarFontColour=e.font),e.icon&&(this.iconColours.maximizedTopBar=e.icon)}else this.maximizedTopBarBackgroundColour=t.maximizedTopBarBackgroundColour?t.maximizedTopBarBackgroundColour:null,this.maximizedTopBarFontColour=t.maximizedTopBarFontColour?t.maximizedTopBarFontColour:null;if(t.buttonBar){const e=t.buttonBar;if(e.bar&&e.bar.colors&&e.bar.colors.background&&(this.buttonBarBackgroundColour=e.bar.colors.background),e.buttons){const t=e.buttons;t.default&&t.default.colors&&(t.default.colors.background&&(this.menuButtonDefaultBackgroundColour=t.default.colors.background),t.default.colors.icon&&(this.iconColours.menuButtonDefault=t.default.colors.icon)),t.inverse&&t.inverse.colors&&(t.inverse.colors.background&&(this.menuButtonInverseBackgroundColour=t.inverse.colors.background),t.inverse.colors.icon&&(this.iconColours.menuButtonInverse=t.inverse.colors.icon)),t.disabled&&t.disabled.colors&&(t.disabled.colors.background&&(this.menuButtonDisabledBackgroundColour=t.disabled.colors.background),t.disabled.colors.icon&&(this.iconColours.menuButtonDisabled=t.disabled.colors.icon)),t.end&&(t.end.colors&&(t.end.colors.background&&(this.menuEndButtonDefaultBackgroundColour=t.end.colors.background),t.end.colors.icon&&(this.iconColours.menuEndButtonDefault=t.end.colors.icon)),t.end.inverse&&(t.end.inverse.background&&(this.menuEndButtonInverseBackgroundColour=t.end.inverse.background),t.end.inverse.icon&&(this.iconColours.menuEndButtonInverse=t.end.inverse.icon)))}}else this.buttonBarBackgroundColour=t.buttonBarBackgroundColour?t.buttonBarBackgroundColour:null,this.menuButtonDefaultBackgroundColour=t.menuButtonDefaultBackgroundColour?t.menuButtonDefaultBackgroundColour:null,this.menuButtonInverseBackgroundColour=t.menuButtonInverseBackgroundColour?t.menuButtonInverseBackgroundColour:null,this.menuButtonDisabledBackgroundColour=t.menuButtonDisabledBackgroundColour?t.menuButtonDisabledBackgroundColour:null,this.menuEndButtonDefaultBackgroundColour=t.menuEndButtonDefaultBackgroundColour?t.menuEndButtonDefaultBackgroundColour:null,this.menuEndButtonInverseBackgroundColour=t.menuEndButtonInverseBackgroundColour?t.menuEndButtonInverseBackgroundColour:null;if(t.dialogs){if(t.dialogs.primaryButton){if(t.dialogs.primaryButton.colors){const e=t.dialogs.primaryButton.colors;e.background&&(this.dialogPrimaryButtonBackgroundColour=e.background),e.border&&(this.dialogPrimaryButtonBorderColour=e.border),e.font&&(this.dialogPrimaryButtonFontColour=e.font)}if(t.dialogs.primaryButton.inverse){const e=t.dialogs.primaryButton.inverse;e.background&&(this.dialogPrimaryButtonInverseBackgroundColour=e.background),e.border&&(this.dialogPrimaryButtonInverseBorderColour=e.border),e.font&&(this.dialogPrimaryButtonInverseFontColour=e.font)}}if(t.dialogs.secondaryButton){if(t.dialogs.secondaryButton.colors){const e=t.dialogs.secondaryButton.colors;e.background&&(this.dialogSecondaryButtonBackgroundColour=e.background),e.border&&(this.dialogSecondaryButtonBorderColour=e.border),e.font&&(this.dialogSecondaryButtonFontColour=e.font)}if(t.dialogs.secondaryButton.inverse){const e=t.dialogs.secondaryButton.inverse;e.background&&(this.dialogSecondaryButtonInverseBackgroundColour=e.background),e.border&&(this.dialogSecondaryButtonInverseBorderColour=e.border),e.font&&(this.dialogSecondaryButtonInverseFontColour=e.font)}}}else this.dialogPrimaryButtonBackgroundColour=t.dialogPrimaryButtonBackgroundColour?t.dialogPrimaryButtonBackgroundColour:null,this.dialogPrimaryButtonBorderColour=t.dialogPrimaryButtonBorderColour?t.dialogPrimaryButtonBorderColour:null,this.dialogPrimaryButtonFontColour=t.dialogPrimaryButtonFontColour?t.dialogPrimaryButtonFontColour:null,this.dialogPrimaryButtonInverseBackgroundColour=t.dialogPrimaryButtonInverseBackgroundColour?t.dialogPrimaryButtonInverseBackgroundColour:null,this.dialogPrimaryButtonInverseBorderColour=t.dialogPrimaryButtonInverseBorderColour?t.dialogPrimaryButtonInverseBorderColour:null,this.dialogPrimaryButtonInverseFontColour=t.dialogPrimaryButtonInverseFontColour?t.dialogPrimaryButtonInverseFontColour:null,this.dialogSecondaryButtonBackgroundColour=t.dialogSecondaryButtonBackgroundColour?t.dialogSecondaryButtonBackgroundColour:null,this.dialogSecondaryButtonBorderColour=t.dialogSecondaryButtonBorderColour?t.dialogSecondaryButtonBorderColour:null,this.dialogSecondaryButtonFontColour=t.dialogSecondaryButtonFontColour?t.dialogSecondaryButtonFontColour:null,this.dialogSecondaryButtonInverseBackgroundColour=t.dialogSecondaryButtonInverseBackgroundColour?t.dialogSecondaryButtonInverseBackgroundColour:null,this.dialogSecondaryButtonInverseBorderColour=t.dialogSecondaryButtonInverseBorderColour?t.dialogSecondaryButtonInverseBorderColour:null,this.dialogSecondaryButtonInverseFontColour=t.dialogSecondaryButtonInverseFontColour?t.dialogSecondaryButtonInverseFontColour:null}console.log("mainButtonInitialBackgroundColour",this.mainButtonInitialBackgroundColour),console.log("iconColours.mainButtonInitial",this.iconColours.mainButtonInitial),console.log("mainButtonInitialInverseBackgroundColour",this.mainButtonInitialInverseBackgroundColour),console.log("iconColours.mainButtonInitialInverse",this.iconColours.mainButtonInitialInverse),console.log("mainButtonInlineBackgroundColour",this.mainButtonInlineBackgroundColour),console.log("mainButtonInlineFontColour",this.mainButtonInlineFontColour),console.log("iconColours.mainButtonInline",this.iconColours.mainButtonInline),console.log("initialMessageBackgroundColour",this.initialMessageBackgroundColour),console.log("initialMessageFontColour",this.initialMessageFontColour),console.log("infoPanelBackgroundColour",this.infoPanelBackgroundColour),console.log("infoPanelFontColour",this.infoPanelFontColour),console.log("iconColours.callInfoIcon",this.iconColours.callInfoIcon),console.log("maximizedTopBarBackgroundColour",this.maximizedTopBarBackgroundColour),console.log("maximizedTopBarFontColour",this.maximizedTopBarFontColour),console.log("iconColours.maximizedTopBar",this.iconColours.maximizedTopBar),console.log("buttonBarBackgroundColour",this.buttonBarBackgroundColour),console.log("menuButtonDefaultBackgroundColour",this.menuButtonDefaultBackgroundColour),console.log("iconColours.menuButtonDefault",this.iconColours.menuButtonDefault),console.log("menuButtonActiveBackgroundColour",this.menuButtonActiveBackgroundColour),console.log("iconColours.menuButtonActive",this.iconColours.menuButtonActive),console.log("menuButtonDisabledBackgroundColour",this.menuButtonDisabledBackgroundColour),console.log("iconColours.menuButtonDisabled",this.iconColours.menuButtonDisabled),console.log("menuEndButtonDefaultBackgroundColour",this.menuEndButtonDefaultBackgroundColour),console.log("iconColours.menuEndButtonDefault",this.iconColours.menuEndButtonDefault),console.log("menuEndButtonActiveBackgroundColour",this.menuEndButtonActiveBackgroundColour),console.log("iconColours.menuEndButtonActive",this.iconColours.menuEndButtonActive),console.log("dialogPrimaryButtonBackgroundColour",this.dialogPrimaryButtonBackgroundColour),console.log("dialogPrimaryButtonBorderColour",this.dialogPrimaryButtonBorderColour),console.log("dialogPrimaryButtonFontColour",this.dialogPrimaryButtonFontColour),console.log("dialogPrimaryButtonInverseBackgroundColour",this.dialogPrimaryButtonInverseBackgroundColour),console.log("dialogPrimaryButtonInverseBorderColour",this.dialogPrimaryButtonInverseBorderColour),console.log("dialogPrimaryButtonInverseFontColour",this.dialogPrimaryButtonInverseFontColour),console.log("dialogSecondaryButtonBackgroundColour",this.dialogSecondaryButtonBackgroundColour),console.log("dialogSecondaryButtonBorderColour",this.dialogSecondaryButtonBorderColour),console.log("dialogSecondaryButtonFontColour",this.dialogSecondaryButtonFontColour),console.log("dialogSecondaryButtonInverseBackgroundColour",this.dialogSecondaryButtonInverseBackgroundColour),console.log("dialogSecondaryButtonInverseBorderColour",this.dialogSecondaryButtonInverseBorderColour),console.log("dialogSecondaryButtonInverseFontColour",this.dialogSecondaryButtonInverseFontColour)}}}),liveRequire.define("LiveZoom",["LiveScenarioCustomization"],function(e){"use strict";return class{constructor(e){console.log("LiveZoom: constructing.."),this._customization=e,this._customization&&$(".oracle-live-video-buttons-zoom").css("background-color",this._customization.buttonBarBackgroundColour).css("border-color",this._customization.buttonBarBackgroundColour),this.ZOOM_FACTOR=1.25,this.CONTENT_SHRINK_FACTOR=1-1/this.ZOOM_FACTOR,this.reset()}disable(e){!0===e?(this.reset(),$(".oracle-live-screenshare-panel-associate video").off("click"),$(".oracle-live-video-zoomin-button").off("click"),$(".oracle-live-video-zoomout-button").off("click"),$(".oracle-live-video-default-button").off("click")):($(".oracle-live-screenshare-panel-associate video").off("click").click(e=>{this.centreOnClickedPoint(e.offsetX,e.offsetY)}),$(".oracle-live-video-zoomin-button").off("click").click(this.zoomIn.bind(this)),$(".oracle-live-video-zoomout-button").off("click").click(this.zoomOut.bind(this)),$(".oracle-live-video-default-button").off("click").click(this.reset.bind(this)))}reset(){console.log("LiveZoom: ---- Reset ----"),this.zoomPercent=100,this.scrolledLeft=0,this.scrolledTop=0,this.targetTag?this.assertCameraPanAndZoom():this.sensitizeButtons()}centreOnClickedPoint(e,t,i){this.captureCurrentScrolledValues();let o=this.parentTag.width(),n=this.parentTag.height(),a=i;if(!a){let i=e>this.innerWidth/2?this.innerWidth-e:e,r=t>this.innerHeight/2?this.innerHeight-t:t,s=i<o?o/i:1,l=r<n?n/r:1;(a=s>l?s/2:l/2)<this.ZOOM_FACTOR&&(a=this.ZOOM_FACTOR)}this.zoomPercent*=a,console.log("Zoom percent is ",this.zoomPercent),this.scrolledLeft=e*a-o/2,this.scrolledTop=t*a-n/2,this.assertCameraPanAndZoom()}zoomIn(){console.log("LiveZoom: ---- Zoom In ----"),this.captureCurrentScrolledValues();let e=this.parentTag.width(),t=this.parentTag.height();console.log("viewerWidthScaled="+e+", viewerHeightScaled="+t);let i=this.scrolledLeft+e/2,o=this.scrolledTop+t/2;this.centreOnClickedPoint(i,o,this.ZOOM_FACTOR)}zoomOut(){if(this.zoomPercent>100){console.log("LiveZoom: ---- Zoom Out ----"),this.captureCurrentScrolledValues(),this.zoomPercent/=this.ZOOM_FACTOR,this.zoomPercent<100&&(this.zoomPercent=100);let e=this.innerWidth*this.CONTENT_SHRINK_FACTOR,t=this.innerHeight*this.CONTENT_SHRINK_FACTOR;console.log("Our content will shrink via this zoom by width="+e+", height="+t),this.scrolledLeft=this.scrolledLeft-e/2,this.scrolledTop=this.scrolledTop-t/2,this.assertCameraPanAndZoom()}else console.log("LiveZoom: Zoom out request ignored - already fully 'out'")}assertCameraPanAndZoom(){console.log("LiveZoom: ===> Asserting: zoom="+this.zoomPercent+"%, scrollLeft="+this.scrolledLeft+", scrollTop="+this.scrolledTop);let e={width:this.zoomPercent+"%",height:this.zoomPercent+"%"};console.log("LiveZoom: Setting pan/zoom related styles to..",e),this.targetTag.css(e),console.log("LiveZoom: (re-styled) targetTag:",this.targetTag),this.sensitizeButtons(),this.parentTag.scrollLeft(this.scrolledLeft),this.parentTag.scrollTop(this.scrolledTop)}ensureTagsAreValid(){this.targetTag||(console.log("LiveZoom: no targetTag yet, resolving.."),this.targetTag=$(".oracle-live-remote-screenshare"),console.log("LiveZoom: targetTag:",this.targetTag)),this.parentTag||(console.log("LiveZoom: no parentTag yet, resolving.."),this.parentTag=$(".oracle-live-video-scroller"),console.log("LiveZoom: parentTag:",this.parentTag)),this.zoomInButton||(console.log("LiveZoom: no zoomInButton yet, resolving.."),this.zoomInButton=$(".oracle-live-video-zoomin-button"),console.log("LiveZoom: zoomInButton:",this.zoomInButton)),this.zoomOutButton||(console.log("LiveZoom: no zoomOutButton yet, resolving.."),this.zoomOutButton=$(".oracle-live-video-zoomout-button"),console.log("LiveZoom: zoomOutButton:",this.zoomOutButton)),this.resetButton||(console.log("LiveZoom: no resetButton yet, resolving.."),this.resetButton=$(".oracle-live-video-default-button"),console.log("LiveZoom: resetButton:",this.resetButton))}captureCurrentScrolledValues(){console.log("LiveZoom: captureCurrentScrolledValues"),this.ensureTagsAreValid(),this.scrolledLeft=this.parentTag.scrollLeft()||0,this.scrolledTop=this.parentTag.scrollTop()||0,console.log("scrolledLeft="+this.scrolledLeft+", scrolledTop="+this.scrolledTop),this.innerWidth=this.targetTag.width(),this.innerHeight=this.targetTag.height(),console.log("innerWidth="+this.innerWidth+", innerHeight="+this.innerHeight)}sensitizeButtons(){this.ensureTagsAreValid();const e=this.zoomPercent>100,t=100!==this.zoomPercent;if(console.log("LiveZoom: sensitizeButtons: canZoomIn=true, canZoomOut="+e+", canReset="+t),this.zoomInButton.attr("aria-disabled",!1),this.zoomOutButton.attr("aria-disabled",!e),this.resetButton.attr("aria-disabled",!t),this._customization){const i=this._customization.menuButtonDefaultBackgroundColour,o=this._customization.iconColours.menuButtonDefault,n=e?this._customization.menuButtonDefaultBackgroundColour:this._customization.menuButtonDisabledBackgroundColour,a=e?this._customization.iconColours.menuButtonDefault:this._customization.iconColours.menuButtonDisabled,r=t?this._customization.menuButtonDefaultBackgroundColour:this._customization.menuButtonDisabledBackgroundColour,s=t?this._customization.iconColours.menuButtonDefault:this._customization.iconColours.menuButtonDisabled;this.zoomInButton.css("background-color",i).css("border-color",i).css("color",o),this.zoomOutButton.css("background-color",n).css("border-color",n).css("color",a),this.resetButton.css("background-color",r).css("border-color",r).css("color",s)}}}}),liveRequire.define("LiveIconColourChange",["LiveIconColours"],function(e){"use strict";return class{constructor(e,t,i,o){if(console.log("LiveIconColourChange",e,t),console.log("rgbas.menuButtonDefault_rgba1",t.menuButtonDefault_rgba),this._updatedImg=null,!e)return void(o?o("Missing icon file url"):console.error("Missing icon file url"));let n=e.startsWith("url")?e.replace(/^url\(['"](.+)['"]\)/,"$1"):e,a=new Image;a.setAttribute("crossOrigin",""),a.onload=(()=>{console.log("LiveIconColourChange: url:",n);let e=document.createElement("canvas"),o=e.getContext("2d"),r=a.width,s=a.height;e.width=r,e.height=s,o.drawImage(a,0,0,r,s);let l=(e,t,i,n,a)=>{console.log("LiveIconColourChange: onload.replaceImage: x, y, w, h, rgba",e,t,i,n,a);let r=o.getImageData(e,t,i,n);for(let e=0;e<r.data.length;e+=4)if(0!==r.data[e+3]&&(r.data[e]=a[0],r.data[e+1]=a[1],r.data[e+2]=a[2],a[3]>=0)){const t=100-a[3]/255*100;r.data[e+3]-=r.data[e+3]/100*t}o.putImageData(r,e,t)};t.mainButtonInitial&&t.mainButtonInitial_rgba&&l(8,8,r-8,41,t.mainButtonInitial_rgba),t.mainButtonInitialInverse&&t.mainButtonInitialInverse_rgba&&l(8,50,r-8,41,t.mainButtonInitialInverse_rgba),t.mainButtonInline&&t.mainButtonInline_rgba&&l(8,746,r-8,20,t.mainButtonInline_rgba),t.menuButtonDefault&&t.menuButtonDefault_rgba&&l(30,686,r-30,20,t.menuButtonDefault_rgba),t.menuButtonInverse&&t.menuButtonInverse_rgba&&l(30,706,r-30,20,t.menuButtonInverse_rgba),t.menuButtonDisabled&&t.menuButtonDisabled_rgba&&(l(7,666,r-7,20,t.menuButtonDisabled_rgba),l(7,726,r-7,20,t.menuButtonDisabled_rgba)),t.menuEndButtonDefault&&t.menuEndButtonDefault_rgba&&l(7,686,20,20,t.menuEndButtonDefault_rgba),t.menuEndButtonInverse&&t.menuEndButtonInverse_rgba&&l(7,706,20,20,t.menuEndButtonInverse_rgba),t.maximizedTopBar&&t.maximizedTopBar_rgba&&l(8,970,50,16,t.maximizedTopBar_rgba),t.callInfoIcon&&t.callInfoIcon_rgba&&l(54,771,10,15,t.callInfoIcon_rgba),this._updatedImg="url("+e.toDataURL("image/png")+")",Object.defineProperty(this,"icons",{value:this._updatedImg}),i&&i(this._updatedImg)}),a.src=n,console.log("LiveIconColourChange: image:",a)}}}),function(){"use strict";var e=/(^.*(^|\/)nls(\/|$))([^\/]*)\/?([^\/]*)/;function t(e,t,i,o,n,a){t[e]&&(i.push(e),!0!==t[e]&&1!==t[e]||o.push(n+e+"/"+a))}function i(e,t,i,o,n){var a=o+t+"/"+n;require._fileExists(e.toUrl(a+".js"))&&i.push(a)}function o(e,t,i){var n;for(n in t)!t.hasOwnProperty(n)||e.hasOwnProperty(n)&&!i?"object"==typeof t[n]&&o(e[n],t[n],i):e[n]=t[n]}liveRequire.define("i18n",["module"],function(n){var a=n.config?n.config():{};return{version:"2.0.2",load:function(n,r,s,l){(l=l||{}).locale&&(a.locale=l.locale);var c,d,u,h=e.exec(n),p=h[1],v=h[4],g=h[5],m=v.split("-"),f=[],S={},_="";if(h[5]?c=(p=h[1])+g:(c=n,g=h[4],(v=a.locale)||(v=a.locale="undefined"==typeof navigator?"root":(navigator.language||navigator.userLanguage||"root").toLowerCase()),m=v.split("-")),l.isBuild){for(f.push(c),i(r,"root",f,p,g),d=0;d<m.length;d++)u=m[d],i(r,_+=(_?"-":"")+u,f,p,g);r(f,function(){s()})}else r([c],function(e){var i,n=[];for(t("root",e,n,f,p,g),d=0;d<m.length;d++)i=m[d],t(_+=(_?"-":"")+i,e,n,f,p,g);r(f,function(){var t,i,a;for(t=n.length-1;t>-1&&n[t];t--)!0!==(i=e[a=n[t]])&&1!==i||(i=r(p+a+"/"+g)),o(S,i);s(S)})})}}})}(),liveRequire.define("nls/oracle.live.messages",{root:{"Hey, I am here to help if you need it!":"Hey, I am here to help if you need it!","Provide this code to the associate and they will begin the meeting:":"Provide this code to the associate and they will begin the meeting:","We are connecting you with our next available representative...":"We are connecting you with our next available representative...","When prompted, provide the following code to the representative:":"When prompted, provide the following code to the representative:",application_diagnostic_label_checking:"Checking...",application_diagnostic_label_video_preview:"Video Preview",application_diagnostics_message_failed:"The diagnostics failed, please check that you have a microphone (and camera) and you have allowed them to be used.",application_diagnostics_message_mic_camera_check:"We are checking your microphone and camera, please wait a moment...",application_diagnostics_message_mic_check:"We are checking your microphone, please wait a moment...",application_get_latest_browser_versionMessage:"Please ensure you are using the latest version of your browser then try again",application_get_latest_browser_versionTitle:"Unable to share your screen",application_meeting_button_join:"Join",application_meeting_label_join:"Tap 'Join' when you are ready to start the meeting",application_meeting_label_left:"You have left the meeting.",application_meeting_label_title:"My Meeting",application_meeting_label_wait:"Waiting for the other participant to join...",application_meeting_label_with:"Connected with",application_meeting_message_invalid_url:"Invalid meeting URL",application_meeting_message_request_to_join:"You have been invited to join a meeting.\nWould you like to join?\n\nNote: This call may be recorded.",application_meeting_title_invalid_url:"Meeting",application_meeting_title_request_to_join:"Join Meeting",application_preview_label_share:"Tap share when you are ready",application_preview_label_start:"Tap start when you are ready",application_screen_share_plugin_install_chrome:"Chrome Extension Required",application_screen_share_plugin_install_extension:"Install Extension",application_screen_share_plugin_install_permission_chrome:'In order to take advantage of the screen sharing feature you need to install the "Oracle Live Experience Screen Sharing Plugin for Chrome"',application_screen_share_plugin_installed_message_chrome:"You can now use the screen sharing features.",application_screen_share_plugin_installed_share_screen:"Share Screen",application_screen_share_plugin_installed_title_chrome:"Screen Sharing Extension Installed",application_screen_share_plugin_installing_message_chrome:'Waiting for the "Oracle Live Experience Screen Sharing Plugin for Chrome" to be installed...',application_short_code_message_provide_code:"When prompted, provide the following code to the representative:",application_short_code_message_provide_code_audio:"Provide the following code to the associate and they will start the call:",application_short_code_message_share_screen:"Tap to share your screen with the representative",application_universal_button_allow:"Allow",application_universal_button_cancel:"Cancel",application_universal_button_close:"Close",application_universal_button_continue:"Continue",application_universal_button_deny:"Deny",application_universal_button_meeting_close:"Close",application_universal_button_no:"No",application_universal_button_ok:"OK",application_universal_button_rejoin:"Rejoin",application_universal_button_share:"Share",application_universal_button_start:"Start",application_universal_button_submit:"Submit",application_universal_button_yes:"Yes",application_universal_label_waiting_for_associate:"Waiting for an associate...",application_universal_label_connecting:"Connecting...",application_universal_label_duration:"Duration",application_universal_label_position_in_queue:"Position in queue",application_universal_label_reconnecting:"Reconnecting...",application_universal_label_record:"Rec",application_universal_label_service_quality_bad:"Bad",application_universal_label_service_quality_excellent:"Excellent",application_universal_label_service_quality_good:"Good",application_universal_label_support_unavailable:"Live support unavailable. Check your network connection.",application_universal_label_transferring:"Transferring...",application_universal_message_associate_disconnected:"The associate has been disconnected. Waiting for them to reconnect...",application_universal_message_associate_reconnected:"The associate has reconnected.",application_universal_message_audio_call_in_progress:"Call in progress",application_universal_message_call_paused:"The call is paused",application_universal_message_camera_error:"The camera is currently unavailable, Please try again.",application_universal_message_check_network_connection:"Please check your network connection",application_universal_message_connecting_next_associate:"We are connecting you with our next available associate...",application_universal_message_transferring_to_another_associate:"We are transferring you to another associate...",application_universal_message_continue:"Do you wish to continue?",application_universal_message_earpiece_enable:"Please use the earpiece to continue conversation. Use the speaker button for loud speakers",application_universal_message_enable_loudspeaker:"Please use the loud speaker to continue conversation. Use the speaker button for earpiece.",application_universal_message_exit_session:"Are you sure you want to exit the customer service session?",application_universal_message_failed_to_connect:"Network unavailable. Please check your data connection and try again",application_universal_message_headset_unplugged:"You've unplugged the headphones. Please use the earpiece to continue your conversation, or tap the speaker button to use the loudspeaker.",application_universal_message_hold:"We will use your device's camera to better assess your needs. You can stop the video and mute the audio at any time by tapping on 'Hold'.",application_universal_message_insufficient_permissions:"The app permissions are insufficient.",application_universal_message_limited_connectivity:"  Your network connection might not be fast enough for the service. Do you want to continue?",application_universal_message_local_attempting_to_reconnect:"You have been disconnected. Attempting to reconnect...",application_universal_message_local_hold:"Your communication with the associate is on hold.",application_universal_message_local_reconnected:"You have been reconnected.",application_universal_message_local_reconnected_connecting:"The network connection has been recovered. Attempting to connect the call...",application_universal_message_local_reconnecting_connecting:"The network connection of this device is currently poor. Connecting the call will take longer than usual...",application_universal_message_local_reconnection_failure:"We were unable to re-establish your connection to the service.",application_universal_message_local_reconnection_failure_connecting:"Please check your network connection and try again.",application_universal_message_network_connectivity_issue:"You are experiencing network issues. Please check the connectivity.",application_universal_message_network_connectivity_restored:"Your network connectivity is back to normal.",application_universal_message_no_agent_available:"No associate is available at this moment.",application_universal_message_no_answer:"No answer",application_universal_message_no_mic_permission:"Turn on Microphone in Settings to start a call",application_universal_message_picture_description:"Picture of {0}",application_universal_message_plugin_headphone:"Please use the headphones to continue conversation.",application_universal_message_poor_network_connection:"Poor network connection",application_universal_message_remote_add_screen_share:"You can minimize or close the shared screen at any time",application_universal_message_remote_hold:"Your communication with the associate is on hold.",application_universal_message_remote_reconnected_connecting:"The associate's network connection has been recovered. Attempting to connect the call...",application_universal_message_remote_reconnecting_connecting:"The associate's network connection is currently poor. Connecting the call will take longer than usual...",application_universal_message_remote_reconnection_failure:"The associate was unable to reconnect.",application_universal_message_remote_screen_share_ended_message:"",application_universal_message_remote_screen_share_stopped:"The other party has stopped sharing their screen",application_universal_message_request_for_camera:"We need your camera to make a video call",application_universal_message_request_for_camera_and_microphone:"We need your camera and microphone to make a video call",application_universal_message_request_for_microphone:"We need your microphone to make an audio call",application_universal_message_request_for_recording:"Please note, this session may be recorded",application_universal_message_reset:"",application_universal_message_resource_limit_reached:"Sorry, but we're really busy at the moment. Please try again later.",application_universal_message_screen_share_tap_to_stop:"Screen sharing is active,Tap to stop.",application_universal_message_screenshare_stopped:"Screen sharing has been stopped.",application_universal_message_service_ended:"Thank you for using our service today!",application_universal_message_service_ended_in_error:"The call ended due to an error",application_universal_message_service_quality_rating:"How was the call quality?",application_universal_message_service_unavailable:"Service is unavailable at this time",application_universal_message_start_screen_share:"You can stop sharing at any time by tapping the screen share status bar.",application_universal_message_stop_screen_share:"Do you want to stop sharing your screen with the associate?",application_universal_message_system_busy:"System busy, please try again later.",application_universal_message_try_later:"Sorry we are having trouble reconnecting. Please try again later.",application_universal_message_welcome:"Hey, I am here to help if you need it!",application_universal_message_zoom_default_text:"100%",application_universal_title_exit_session:"Exit the Session",application_universal_title_headphone_enabled:"Headset enabled",application_universal_title_headphone_unplugged:"Using internal speaker",application_universal_title_limited_connectivity:"Limited Connectivity",application_universal_title_loudspeaker_disabled:"Using internal speaker",application_universal_title_loudspeaker_enabled:"Using loudspeaker",application_universal_title_no_mic_permission:"Microphone Access Off",application_universal_title_poor_connection:"Poor network connection",application_universal_title_remote_add_screen_share:"The other party would like to share their screen",application_universal_title_remote_video_stopped:"The agent disabled the video sharing",application_universal_title_request_for_recording:"This session may be recorded",application_universal_title_service_ended:"Service Ended",application_universal_title_service_failed:"Service Failed",application_universal_title_service_notstarted:"Service not started",application_universal_title_share_screen:"Would you like to share your screen?",application_universal_title_start_call:"This session may be recorded",application_universal_title_stop_screen_share:"Stop Sharing Screen",application_universal_title_system_message:"System Message",application_universal_tooltip_end_call:"End the call",application_universal_tooltip_end_call_disabled:"End the call (disabled)",application_universal_tooltip_pause_call:"Pause the call",application_universal_tooltip_pause_call_disabled:"Pause the call (disabled)",application_universal_tooltip_resume_call:"Resume the call",application_video_call_message_camera_turned_off:"Your video has been turned off",application_video_call_message_finished_using_camera:"Thank you! We've finished using your camera.",application_video_call_message_incoming_video:"Accept incoming video?",application_video_call_message_loading_video:"Loading video...",application_video_call_message_loading_video_preview:"Loading video preview...",application_video_call_message_no_camera_permission:"Camera must be turned on in Settings to start a video call. Changing this while a call is in progress ends the call.",application_video_call_message_no_pause:"You can stop the video at any time by clicking the video button.",application_video_call_message_pause:"You can stop the video and mute the audio at any time by clicking the pause button.",application_video_call_message_remote_annotation_started:"The associate has started to annotate on this page",application_video_call_message_remote_annotation_stopped:"The associate has stopped annotating on this page",application_video_call_message_remote_annotation_video_started:"Associate is annotating on your video at the moment",application_video_call_message_remote_annotation_video_stopped:"Associate has stopped annotating on your video",application_video_call_message_remote_frozen_annotation_started:"The associate is sharing a screen image taken from your video call.",application_video_call_message_remote_frozen_annotation_stopped:"The associate has stopped sharing the frozen screen image",application_video_call_message_screen_share_active:"Screen sharing is active",application_video_call_message_screen_share_declined:"If you did not cancel it, please check your browser settings to ensure screen sharing is allowed.",application_video_call_message_screen_share_in_progress:"Screenshare in progress",application_video_call_message_see_again:"Allow us to see your camera again",application_video_call_message_see_surroundings:"Allow us to see your surroundings",application_video_call_message_video_call_in_progress:"Video call in progress",application_video_call_message_you_can_stop_screen_share:"You can stop sharing the screen at any time.",application_video_call_title_no_camera_permission:"Camera Access Off",application_video_call_title_screen_share_declined:"Screen sharing canceled",application_video_call_title_share_screen_request:"Allow us to see your screen",application_video_call_tooltip_annotate:"Annotate",application_video_call_tooltip_annotation_disabled:"Annotate (disabled)",application_video_call_tooltip_hide:"Hide all camera feeds",application_video_call_tooltip_hide_local_video:"Hide your camera feed",application_video_call_tooltip_maximize:"Maximize the video",application_video_call_tooltip_minimize_video:"Minimize the video",application_video_call_tooltip_screen_share_disabled:"Share screen (disabled)",application_video_call_tooltip_share_camera:"Share camera",application_video_call_tooltip_share_camera_disabled:"Share camera (disabled)",application_video_call_tooltip_share_screen:"Share screen",application_video_call_tooltip_stop_annotation:"Stop annotation",application_video_call_tooltip_stop_camera_share:"Stop sharing camera",application_video_call_tooltip_stop_screen_share:"Stop sharing screen"}}),liveRequire.define("normalize",[],function(){var e=/([^:])\/+/g,t=function(t){return t.replace(e,"$1/")},o=/[^\:\/]*:\/\/([^\/])*/,n=/^(\/|data:)/;function a(e,i,a){if(e.match(n)||e.match(o))return e;e=t(e);var l=a.match(o),c=i.match(o);return!c||l&&l[1]==c[1]&&l[2]==c[2]?s(r(e,i),a):r(e,i)}function r(e,t){if("./"==e.substr(0,2)&&(e=e.substr(2)),e.match(n)||e.match(o))return e;var i=t.split("/"),a=e.split("/");for(i.pop();curPart=a.shift();)".."==curPart?i.pop():i.push(curPart);return i.join("/")}function s(e,t){var o=t.split("/");for(o.pop(),t=o.join("/")+"/",i=0;t.substr(i,1)==e.substr(i,1);)i++;for(;"/"!=t.substr(i,1);)i--;t=t.substr(i+1),e=e.substr(i+1),o=t.split("/");var n=e.split("/");for(out="";o.shift();)out+="../";for(;curPart=n.shift();)out+=curPart+"/";return out.substr(0,out.length-1)}var l=function(e,i,o){i=t(i),o=t(o);for(var n,r,s=/@import\s*("([^"]*)"|'([^']*)')|url\s*\((?!#)\s*(\s*"([^"]*)"|'([^']*)'|[^\)]*\s*)\s*\)/gi;n=s.exec(e);){var l;l=a(r=n[3]||n[2]||n[5]||n[6]||n[4],i,o);var c=n[5]||n[6]?1:0;e=e.substr(0,s.lastIndex-r.length-c-1)+l+e.substr(s.lastIndex-c-1),s.lastIndex=s.lastIndex+(l.length-r.length)}return e};return l.convertURIBase=a,l.absoluteURI=r,l.relativeURI=s,l}),liveRequire.define("css",[],function(){if("undefined"==typeof window)return{load:function(e,t,i){i()}};var e=document.getElementsByTagName("head")[0],t=window.navigator.userAgent.match(/Trident\/([^ ;]*)|AppleWebKit\/([^ ;]*)|Opera\/([^ ;]*)|rv\:([^ ;]*)(.*?)Gecko\/([^ ;]*)|MSIE\s([^ ;]*)|AndroidWebKit\/([^ ;]*)/)||0,i=!1,o=!0;t[1]||t[7]?i=parseInt(t[1])<6||parseInt(t[7])<=9:t[2]||t[8]||"WebkitAppearance"in document.documentElement.style?o=!1:t[4]&&(i=parseInt(t[4])<18);var n,a,r={};r.pluginBuilder="./css-builder";var s,l=function(){n=document.createElement("style"),e.appendChild(n),a=n.styleSheet||n.sheet},c=0,d=[],u=function(e){a.addImport(e),n.onload=function(){h()},31==++c&&(l(),c=0)},h=function(){s();var e=d.shift();e?(s=e[1],u(e[0])):s=null};return r.normalize=function(e,t){return".css"==e.substr(e.length-4,4)&&(e=e.substr(0,e.length-4)),t(e)},r.load=function(t,r,c,h){(i?function(e,t){if(a&&a.addImport||l(),a&&a.addImport)s?d.push([e,t]):(u(e),s=t);else{n.textContent='@import "'+e+'";';var i=setInterval(function(){try{n.sheet.cssRules,clearInterval(i),t()}catch(e){}},10)}}:function(t,i){var n=document.createElement("link");if(n.type="text/css",n.rel="stylesheet",o)n.onload=function(){n.onload=function(){},setTimeout(i,7)};else var a=setInterval(function(){for(var e=0;e<document.styleSheets.length;e++)if(document.styleSheets[e].href==n.href)return clearInterval(a),i()},10);n.href=t,e.appendChild(n)})(r.toUrl(t+".css"),c)},r}),liveRequire.define("css!oracle.live.style",[],function(){}),liveRequire.define("LiveButtonMenu",["jquery","text!oracle.live.button.html","LiveCallTimer","LiveEvents","LiveZoom","LiveIconColourChange","LiveIconColours","i18n!nls/oracle.live.messages","css!oracle.live.style.css"],function($,e,t,i,o,n,a,r){"use strict";return class{constructor(e){this._impl=e,this._messages=r,console.log("Language is: "+navigator.language),this._callTimer=new t,this._agentName="",this._avatarImageUrl=null,this._connectingAudioSrc=null,this._isMeeting=!1,this._meetingTitle=null,this._greetingMessage=null,this._connectingMessage=null,this._transferringMessage=null,this._notificationUptime=8e3,this._shortCode=null,this._shortCodeMode=!1,this._preCallIDCheck=!1,this._connectingAudioTimer=null,this._startInVideo=!1,this._startVideoInFullScreen=!1,this._startVideoWithFrontCamera=!1,this._startInScreenShare=!1,this._endUserControlsCamera=!1,this._endUserControlsScreenShare=!1,this._previousMaximizedFeed=null,this._havePausedResumed=!1,this._canRejoinMeeting=!0,this._annotationList=[],this._videoAnnotationList=[],this._maximizedFeedWhenScreenShareAdded=null,this._liveUpdatedIcons=null,this._iconColours=null,this._positionsDefined=!1,this._vertpx=null,this._horzpx=null,this._vertpn=null,this._horzpn=null,this._hideEndCallButton=!1,this._hidePauseButton=!1,this._cameraDefaultOn=null,this._addedOracleLiveVideoControlEnduser=!1,this._hideQueueLengthIndicator=!1,this._diagnosticsRunning=!1,this._resumeConnectedStatus=!1,this._originMaximizedVideo="NONE"}addComponent(e,t,i){this._addComponent(),this.updateMessages(e,i),this._browser=t}setMessages(e){console.log("Installing messages downloaded from REST service",e),this._messages=e,this._populateMessages()}setPopMessageText(e,t){e&&t?($(".oracle-live-popmessage").attr("tabindex",0),$(".oracle-live-popmessage").attr("aria-label",e+" "+t),$(".oracle-live-popmessage-text").attr("tabindex",null),$(".oracle-live-popmessage-text").text(e),$(".oracle-live-popmessage-text").attr("aria-label",null),$(".oracle-live-popmessage-shortcode").attr("tabindex",null),$(".oracle-live-popmessage-shortcode").text(t),$(".oracle-live-popmessage-shortcode").attr("aria-label",null)):($(".oracle-live-popmessage").attr("tabindex",null),$(".oracle-live-popmessage").attr("aria-label",null),e?($(".oracle-live-popmessage-text").attr("tabindex",0),$(".oracle-live-popmessage-text").text(e),$(".oracle-live-popmessage-text").attr("aria-label",e)):($(".oracle-live-popmessage-text").attr("tabindex",null),$(".oracle-live-popmessage-text").text(""),$(".oracle-live-popmessage-text").attr("aria-label",null)),t?($(".oracle-live-popmessage-shortcode").attr("tabindex",0),$(".oracle-live-popmessage-shortcode").text(t),$(".oracle-live-popmessage-shortcode").attr("aria-label",t)):($(".oracle-live-popmessage-shortcode").attr("tabindex",null),$(".oracle-live-popmessage-shortcode").text(""),$(".oracle-live-popmessage-shortcode").attr("aria-label",null)))}setPopMessageAriaDisabled(e){let t="false";!0===e&&(t="true",this.setPopMessageText(null,null)),$(".oracle-live-popmessage").attr("aria-disabled",t),$(".oracle-live-popmessage-text").attr("aria-disabled",t),$(".oracle-live-popmessage-shortcode").attr("aria-disabled",t)}updateMessages(e,t){console.log("updateMessages: "+JSON.stringify(e,null,2)+", meetingTitle: "+t),e&&(this._greetingMessage=this._messages.hasOwnProperty(e.greetingMessage)?this._messages[e.greetingMessage]:e.greetingMessage,e.connectingMessage&&(this._connectingMessage=this._messages.hasOwnProperty(e.connectingMessage)?this._messages[e.connectingMessage]:e.connectingMessage),this.setPopMessageText(this._greetingMessage,null)),t&&(this._meetingTitle=t)}setCustomization(e){console.log("Installing customization downloaded from REST service",e),this._customization=e,this._customize()}resetClass(e){const t=$(".oracle-live"),i=t.hasClass("oracle-live-hidden");t.removeClass().addClass(e),this._isMeeting&&t.addClass("oracle-live-meeting"),i&&t.addClass("oracle-live-hidden"),console.log("resetClass to: "+t.attr("class"))}_addComponent(){console.log("Menu::addComponent, meeting=",this._isMeeting);let t=$("body");t.length?(t.prepend(e),this.resetClass("oracle-live"),this._populateMessages(),this._customize(),console.log("Attaching mouse listeners to ",$(".oracle-live-video-panel")),$(".oracle-live-video-panel").off("click").on("click",e=>{console.log("Clicked the video panel");const t=$(".oracle-live"),i=t.hasClass("oracle-live-paused-associate");return!(!t.hasClass("oracle-live-video-preview")&&!this.getMaximizedFeed()&&!i&&(t.hasClass("oracle-live-videopanel-toolbars-hidden")?t.removeClass("oracle-live-videopanel-toolbars-hidden"):t.addClass("oracle-live-videopanel-toolbars-hidden"),0))}),$(".oracle-live-video-panel .oracle-live-local-video").off("click").on("click",e=>{console.log("Clicked the video panel when in maximized status of end user");const t=$(".oracle-live");if(t.hasClass("oracle-live-frozen-annotation")||t.hasClass("oracle-live-annotation-associate-video-on"))return this._toggleTopbarAndToolbar(),!0})):console.warn("No body element on this page - there's nowhere to attach LX component")}_toggleTopbarAndToolbar(){$(".oracle-live").hasClass("oracle-live-videopanel-topbar-toolbar-hidden")?this._unHideTopbarAndToolbar():this._hideTopbarAndToolbar()}_hideTopbarAndToolbar(){const e=$(".oracle-live");e.hasClass("oracle-live-videopanel-topbar-toolbar-hidden")||e.addClass("oracle-live-videopanel-topbar-toolbar-hidden"),$(".oracle-live-menu").css("display","none"),$(".oracle-live-video-toolbar-enduser").css("display","none")}_unHideTopbarAndToolbar(){this._topBarShowTimer&&clearTimeout(this._topBarShowTimer);const e=$(".oracle-live");e.hasClass("oracle-live-videopanel-topbar-toolbar-hidden")&&e.removeClass("oracle-live-videopanel-topbar-toolbar-hidden"),$(".oracle-live-menu").css("display","block"),$(".oracle-live-video-toolbar-enduser").css("display","block"),this._topBarShowTimer=setTimeout(()=>{this._hideTopbarAndToolbar()},5e3)}_clearCustomPositionCss(e){e.css("left","").css("right","").css("top","").css("bottom","").css("width","").css("height","")}_clearCustomColourCss(e){e.css("background-color","").css("border-color","").css("color","")}_setIconColourCss(){this._liveUpdatedIcons&&($(".oracle-live-mainbutton-icon").css("background-image",this._liveUpdatedIcons.icons),$(".oracle-live-mainbutton-badge").css("background-image",this._liveUpdatedIcons.icons),$(".oracle-live-buttonbar-icon").css("background-image",this._liveUpdatedIcons.icons),$(".oracle-live-exitbutton-icon").css("background-image",this._liveUpdatedIcons.icons),$(".oracle-live-video-maximize").css("background-image",this._liveUpdatedIcons.icons),$(".oracle-live-unfreeze-annotation-camera").css("background-image",this._liveUpdatedIcons.icons),$(".oracle-live-unfreeze-annotation-cross").css("background-image",this._liveUpdatedIcons.icons),$(".oracle-live-callinfo-icon").css("background-image",this._liveUpdatedIcons.icons))}_setCustomColourCssMinMax(e){this._customization&&(this._clearCustomColourCss($(".oracle-live-video-toolbar-minimized")),this._clearCustomColourCss($(".oracle-live-video-toolbar-maximized")),$(".oracle-live-video-toolbar-enduser").removeClass("oracle-live-video-toolbar-minimized"),$(".oracle-live-video-toolbar-associate").removeClass("oracle-live-video-toolbar-minimized"),$(".oracle-live-video-toolbar-screenshare").removeClass("oracle-live-video-toolbar-minimized"),$(".oracle-live-video-toolbar-enduser").removeClass("oracle-live-video-toolbar-maximized"),$(".oracle-live-video-toolbar-associate").removeClass("oracle-live-video-toolbar-maximized"),$(".oracle-live-video-toolbar-screenshare").removeClass("oracle-live-video-toolbar-maximized"),e?$(".oracle-live").hasClass("oracle-live-video-enduser-maximized")?($(".oracle-live-video-toolbar-enduser").addClass("oracle-live-video-toolbar-maximized"),$(".oracle-live-video-toolbar-associate").addClass("oracle-live-video-toolbar-minimized"),$(".oracle-live-video-toolbar-screenshare").addClass("oracle-live-video-toolbar-minimized")):$(".oracle-live").hasClass("oracle-live-video-associate-maximized")?($(".oracle-live-video-toolbar-associate").addClass("oracle-live-video-toolbar-maximized"),$(".oracle-live-video-toolbar-enduser").addClass("oracle-live-video-toolbar-minimized"),$(".oracle-live-video-toolbar-screenshare").addClass("oracle-live-video-toolbar-minimized")):$(".oracle-live").hasClass("oracle-live-screenshare-associate-maximized")&&($(".oracle-live-video-toolbar-screenshare").addClass("oracle-live-video-toolbar-maximized"),$(".oracle-live-video-toolbar-enduser").addClass("oracle-live-video-toolbar-minimized"),$(".oracle-live-video-toolbar-associate").addClass("oracle-live-video-toolbar-minimized")):($(".oracle-live-video-toolbar-enduser").addClass("oracle-live-video-toolbar-minimized"),$(".oracle-live-video-toolbar-associate").addClass("oracle-live-video-toolbar-minimized"),$(".oracle-live-video-toolbar-screenshare").addClass("oracle-live-video-toolbar-minimized")),this._customization.maximizedTopBarBackgroundColour&&$(".oracle-live-video-toolbar-maximized:not(.oracle-live-unfreeze-annotation-camera):not(.oracle-live-unfreeze-annotation-cross)").css("background-color",this._customization.maximizedTopBarBackgroundColour).css("border-color",this._customization.maximizedTopBarBackgroundColour),this._customization.maximizedTopBarFontColour&&$(".oracle-live-video-toolbar-maximized").css("color",this._customization.maximizedTopBarFontColour),$(".oracle-live-video-toolbar-minimized").css("color","white"),$(".oracle-live-video-maximize").css("background-color","transparent"),$(".oracle-live-video-maximize").css("border-color","transparent"),$(".oracle-live-video-associate-maximized-title").css("background-color","transparent"),$(".oracle-live-video-associate-maximized-title").css("border-color","transparent"),$(".oracle-live-video-toolbar-recording").css("background-color","transparent"),$(".oracle-live-video-toolbar-recording").css("border-color","transparent"),$(".oracle-live-video-toolbar-timer").css("background-color","transparent"),$(".oracle-live-video-toolbar-timer").css("border-color","transparent"))}_setButtonBarButtonColourCss(e,t,i){this._customization&&(t||i?t&&!i?e.css("background-color",this._customization.menuButtonInverseBackgroundColour).css("border-color",this._customization.menuButtonInverseBackgroundColour):i&&e.css("background-color",this._customization.menuButtonDisabledBackgroundColour).css("border-color",this._customization.menuButtonDisabledBackgroundColour):e.css("background-color",this._customization.menuButtonDefaultBackgroundColour).css("border-color",this._customization.menuButtonDefaultBackgroundColour))}_defineCustomPosition(){if(!this._positionsDefined&&this._customization){if(this._vertpx=12,this._horzpx=12,this._vertpn="bottom",this._horzpn="right",this._customization.pinnedTo&&this._customization.pinnedTo.indexOf("-")>-1){let e=this._customization.pinnedTo.split("-");this._vertpn=e[0],this._horzpn=e[1]}this._customization.verticalMargin&&(this._vertpx=parseInt(this._customization.verticalMargin),isNaN(this._vertpx)&&(this._vertpx=12)),this._customization.horizontalMargin&&(this._horzpx=parseInt(this._customization.horizontalMargin),isNaN(this._horzpx)&&(this._horzpx=12)),console.log("Custom _vertpx",this._vertpx),console.log("Custom _horzpx",this._horzpx),console.log("Custom _vertpn",this._vertpn),console.log("Custom _horzpn",this._horzpn),this._positionsDefined=!0}}_setDialogButtonColourCss(e,t,i){this._customization&&(t?i?e.css("background-color",this._customization.dialogPrimaryButtonInverseBackgroundColour).css("border-color",this._customization.dialogPrimaryButtonInverseBorderColour).css("color",this._customization.dialogPrimaryButtonInverseFontColour):e.css("background-color",this._customization.dialogPrimaryButtonBackgroundColour).css("border-color",this._customization.dialogPrimaryButtonBorderColour).css("color",this._customization.dialogPrimaryButtonFontColour):i?e.css("background-color",this._customization.dialogSecondaryButtonInverseBackgroundColour).css("border-color",this._customization.dialogSecondaryButtonInverseBorderColour).css("color",this._customization.dialogSecondaryButtonInverseFontColour):e.css("background-color",this._customization.dialogSecondaryButtonBackgroundColour).css("border-color",this._customization.dialogSecondaryButtonBorderColour).css("color",this._customization.dialogSecondaryButtonFontColour))}_setButtonBarEndButtonColourCss(e,t){this._customization&&(e||t?e&&!t?$(".oracle-live-exit-button").css("background-color",this._customization.menuEndButtonInverseBackgroundColour).css("border-color",this._customization.menuEndButtonInverseBackgroundColour):t&&$(".oracle-live-exit-button").css("background-color",this._customization.menuButtonDisabledBackgroundColour).css("border-color",this._customization.menuButtonDisabledBackgroundColour):$(".oracle-live-exit-button").css("background-color",this._customization.menuEndButtonDefaultBackgroundColour).css("border-color",this._customization.menuEndButtonDefaultBackgroundColour))}_setButtonBarEndButtonIconCss(e){this._customization&&(e?$(".oracle-live-exitbutton-icon").css("background-position-x","-7px").css("background-position-y","-728px").css("width","20px").css("height","16px"):$(".oracle-live-exitbutton-icon").css("background-position-x","-7px").css("background-position-y","-688px").css("width","20px").css("height","16px"))}_isMaximized(){return $(".oracle-live").hasClass("oracle-live-video-enduser-maximized")||$(".oracle-live").hasClass("oracle-live-video-associate-maximized")||$(".oracle-live").hasClass("oracle-live-screenshare-associate-maximized")}_setCustomPositionCssMinMax(e){if(void 0!==e&&null!==e||(e=this._isMaximized()),this._customization)if(console.log("_setCustomPositionCssMinMax",e),this._defineCustomPosition(),e)$(".oracle-live-video-panel").removeClass("oracle-live-video-panel-minimized"),this._clearCustomPositionCss($(".oracle-live-video-panel")),$(".oracle-live-video-panel").addClass("oracle-live-video-panel-maximized"),this._clearCustomPositionCss($(".oracle-live-menu")),$(".oracle-live-menu-rightspacer").hide(),$(".oracle-live-menu-leftspacer").hide(),this._clearCustomPositionCss($(".oracle-live-dialog"));else{$(".oracle-live-video-panel").removeClass("oracle-live-video-panel-maximized"),this._clearCustomPositionCss($(".oracle-live-video-panel")),$(".oracle-live-video-panel").addClass("oracle-live-video-panel-minimized"),this._clearCustomPositionCss($(".oracle-live-menu"));let e="",t="",i="",o="",n="",a="",r="",s="",l="",c="",d="",u="",h="",p="",v="",g="",m="",f="";"left"===this._horzpn?($(".oracle-live-menu-rightspacer").hide(),$(".oracle-live-menu-leftspacer").show(),$(".oracle-live-menu-leftspacer").css("display","inline-block"),e=this._horzpx+38+"px",t="unset",n=this._horzpx+10+"px",a=e,r=this._horzpx+"px",s="unset",d=this._horzpx+10+"px",u="unset",v=this._horzpx+"px",g="unset"):($(".oracle-live-menu-rightspacer").show(),$(".oracle-live-menu-rightspacer").css("display","inline-block"),$(".oracle-live-menu-leftspacer").hide(),e="unset",t=this._horzpx+38+"px",n=this._horzpx+10+"px",a=t,r="unset",s=this._horzpx+"px",d="unset",u=this._horzpx+242+"px",v="unset",g=this._horzpx+"px"),"top"===this._vertpn?(i=this._vertpx+18+"px",o="unset",l=this._vertpx+100+"px",c="unset",h=this._vertpx+278+"px",p="unset",m=this._vertpx+95+"px",f="unset"):(i="unset",o=this._vertpx+18+"px",l="unset",c=this._vertpx+100+"px",h="unset",p=this._vertpx+110+"px",m="unset",f=this._vertpx+95+"px");let S=document.querySelector(".oracle-live-menu");if(S){let e=document.getElementById("oracle-live-menu-animation"),t=document.createElement("style");t.id="oracle-live-menu-animation",t.textContent="@keyframes oracle-live-buttonmenu-show-keyframes {0% { opacity: 0; "+this._horzpn+": "+n+"; width: 0px } 100% { opacity: 1; "+this._horzpn+" : "+a+"; width: fit-content } }\n@keyframes oracle-live-buttonmenu-hide-keyframes {0% { opacity: 1; "+this._horzpn+": "+a+"; width: fit-content } 100% { opacity: 0; "+this._horzpn+": "+n+"; width: 0px } }",e&&e.parentNode.removeChild(e),S.appendChild(t)}$(".oracle-live-menu").css("left",e).css("right",t).css("top",i).css("bottom",o).css("width","fit-content").css("overflow","hidden"),$(".oracle-live").hasClass("oracle-live-video-associate-on")&&$(".oracle-live").hasClass("oracle-live-video-enduser-on")||$(".oracle-live").hasClass("oracle-live-screenshare-associate-on")&&$(".oracle-live").hasClass("oracle-live-video-enduser-on")?$(".oracle-live-video-panel-enduser").css("left",d).css("right",u).css("top",h).css("bottom",p):$(".oracle-live-video-panel-enduser").css("left",r).css("right",s).css("top",l).css("bottom",c),$(".oracle-live-video-panel-associate").css("left",r).css("right",s).css("top",l).css("bottom",c),$(".oracle-live-screenshare-panel-associate").css("left",r).css("right",s).css("top",l).css("bottom",c),$(".oracle-live-dialog").css("left",v).css("right",g).css("top",m).css("bottom",f)}else{let e=document.querySelector(".oracle-live-menu");if(e){let t=document.getElementById("oracle-live-menu-animation"),i=document.createElement("style");i.id="oracle-live-menu-animation",i.textContent="@keyframes oracle-live-buttonmenu-show-keyframes {0% { opacity: 0; right: 0px; width: 0px } 100% { opacity: 1; right: 58px; width: fit-content } }\n@keyframes oracle-live-buttonmenu-hide-keyframes {0% { opacity: 1; right: 58px; width: fit-content } 100% { opacity: 0; right: 0px; width: 0px } }",t&&t.parentNode.removeChild(t),e.appendChild(i)}}}_setCustomCssMinMax(e){void 0!==e&&null!==e||(e=this._isMaximized()),this._setCustomPositionCssMinMax(e),this._setCustomColourCssMinMax(e)}_setHover(e,t,i,o,n,a,r,s,l,c,d,u){e.mouseenter(()=>{"true"!==e.attr("aria-disabled")&&(i&&e.css("background-color",i).css("border-color",i),o&&(l>=0&&o.css("background-position-x",-1*l+"px"),c>=0&&o.css("background-position-y",-1*c+"px"),d>=0&&o.css("width",d+"px"),u>=0&&o.css("height",u+"px")))}),e.mouseleave(()=>{"true"!==e.attr("aria-disabled")&&(t&&e.css("background-color",t).css("border-color",t),o&&(n>=0&&o.css("background-position-x",-1*n+"px"),a>=0&&o.css("background-position-y",-1*a+"px"),r>=0&&o.css("width",r+"px"),s>=0&&o.css("height",s+"px")))}),e.keypress(()=>{e.mouseenter()})}_setCustomPositionCss(){if(this._customization){this._defineCustomPosition();let e="",t="",i="",o="",n="",a="",r="",s="",l="",c="",d="",u="",h="",p="",v="",g="",m="";"left"===this._horzpn?(e=this._horzpx+"px",t="unset",n=this._horzpx+92+"px",a="unset",c=this._horzpx+"px",d="unset",p=this._horzpx+"px",v="unset"):(e="unset",t=this._horzpx+"px",n="unset",a=this._horzpx+92+"px",c="unset",d=this._horzpx+"px",p="unset",v=this._horzpx+"px"),"top"===this._vertpn?(i=this._vertpx+"px",o="unset",r=this._vertpx+40+"px",s="unset",l="translate(0, -50%)",u=this._vertpx+100+"px",h="unset",g=this._vertpx+100+"px",m="unset"):(i="unset",o=this._vertpx+"px",r="unset",s=this._vertpx+40+"px",l="translate(0, 50%)",u="unset",h=this._vertpx+100+"px",g="unset",m=this._vertpx+100+"px"),$(".oracle-live-main-button").css("left",e).css("right",t).css("top",i).css("bottom",o),$(".oracle-live-popmessage").css("left",n).css("right",a).css("top",r).css("bottom",s).css("transform",l).css("-ms-transform",l),$(".oracle-live-callinfo").css("left",c).css("right",d).css("top",u).css("bottom",h),$(".oracle-live-call-queue-info").css("left",p).css("right",v).css("top",g).css("bottom",m),this._setCustomPositionCssMinMax(!1)}}_setMainButtonColourCss(e){if(this._customization){let t=!1,i=!1;$(".oracle-live").hasClass("oracle-live-precall-dialog")||$(".oracle-live").hasClass("oracle-live-video-preview")||$(".oracle-live").hasClass("oracle-live-shortcode")||$(".oracle-live").hasClass("oracle-live-connecting")||$(".oracle-live").hasClass("oracle-live-transferring")||$(".oracle-live").hasClass("oracle-live-waiting")||$(".oracle-live").hasClass("oracle-live-disconnected")?(t=!0,i=!0):$(".oracle-live").hasClass("oracle-live-connected")||(t=!0,e&&(i=!0)),t?i?($(".oracle-live-main-button").css("background-color",this._customization.mainButtonInitialInverseBackgroundColour).css("border-color",this._customization.mainButtonInitialInverseBackgroundColour),$(".oracle-live-mainbutton-icon").css("background-position-y","-50px")):($(".oracle-live-main-button").css("background-color",this._customization.mainButtonInitialBackgroundColour).css("border-color",this._customization.mainButtonInitialBackgroundColour),$(".oracle-live-mainbutton-icon").css("background-position-y","-8px")):($(".oracle-live-main-button").css("background-color",this._customization.mainButtonInlineBackgroundColour).css("border-color",this._customization.mainButtonInlineBackgroundColour).css("color",this._customization.mainButtonInlineFontColour),$(".oracle-live-initials").css("color",this._customization.mainButtonInlineFontColour))}}_setCustomColourCss(){if(this._customization){this._customization.initialMessageBackgroundColour&&$(".oracle-live-popmessage").css("background-color",this._customization.initialMessageBackgroundColour).css("border-color",this._customization.initialMessageBackgroundColour),this._customization.initialMessageFontColour&&($(".oracle-live-popmessage").css("color",this._customization.initialMessageFontColour),$(".oracle-live-popmessage-text").css("color",this._customization.initialMessageFontColour),$(".oracle-live-popmessage-shortcode").css("color",this._customization.initialMessageFontColour)),this._customization.infoPanelBackgroundColour&&$(".oracle-live-callinfo").css("background-color",this._customization.infoPanelBackgroundColour).css("border-color",this._customization.infoPanelBackgroundColour),this._customization.infoPanelFontColour&&($(".oracle-live-callinfo").css("color",this._customization.infoPanelFontColour),$(".oracle-live-callinfo-associate").css("color",this._customization.infoPanelFontColour),$(".oracle-live-callinfo-recording").css("color",this._customization.infoPanelFontColour),$(".oracle-live-callinfo-icon").css("color",this._customization.infoPanelFontColour),$(".oracle-live-callinfo-timer").css("color",this._customization.infoPanelFontColour),$(".oracle-live-call-queue-info").css("color",this._customization.infoPanelFontColour),$(".oracle-live-position-in-queue").css("color",this._customization.infoPanelFontColour)),this._customization.buttonBarBackgroundColour&&$(".oracle-live-menu").css("background-color",this._customization.buttonBarBackgroundColour).css("border-color",this._customization.buttonBarBackgroundColour),this._customization.menuButtonDefaultBackgroundColour&&$(".oracle-live-buttonbar-button").css("background-color",this._customization.menuButtonDefaultBackgroundColour).css("border-color",this._customization.menuButtonDefaultBackgroundColour),this._customization.menuEndButtonDefaultBackgroundColour&&($(".oracle-live-exit-button").css("background-color",this._customization.menuEndButtonDefaultBackgroundColour).css("border-color",this._customization.menuEndButtonDefaultBackgroundColour),this._customization.menuEndButtonInverseBackgroundColour&&(this._setHover($(".oracle-live-exit-button"),this._customization.menuEndButtonDefaultBackgroundColour,this._customization.menuEndButtonInverseBackgroundColour,$(".oracle-live-exitbutton-icon"),7,688,20,16,7,708,20,16),$(".oracle-live-exit-button").click(()=>{this._setButtonBarEndButtonIconCss(!0)}),$(".oracle-live-dialog-cancel").click(()=>{this._setButtonBarEndButtonIconCss(!1)}),$(".oracle-live-dialog-ok").click(()=>{$(".oracle-live").hasClass("oracle-live-disconnected")||$(".oracle-live").hasClass("oracle-live-disconnecting")||this._setButtonBarEndButtonIconCss(!1)}))),this._customization.dialogPrimaryButtonBackgroundColour&&$(".oracle-live-dialog-ok").css("background-color",this._customization.dialogPrimaryButtonBackgroundColour),this._customization.dialogPrimaryButtonBorderColour&&$(".oracle-live-dialog-ok").css("border-color",this._customization.dialogPrimaryButtonBorderColour),this._customization.dialogPrimaryButtonFontColour&&$(".oracle-live-dialog-ok").css("color",this._customization.dialogPrimaryButtonFontColour),this._customization.dialogSecondaryButtonBackgroundColour&&$(".oracle-live-dialog-cancel").css("background-color",this._customization.dialogSecondaryButtonBackgroundColour),this._customization.dialogSecondaryButtonBorderColour&&$(".oracle-live-dialog-cancel").css("border-color",this._customization.dialogSecondaryButtonBorderColour),this._customization.dialogSecondaryButtonFontColour&&$(".oracle-live-dialog-cancel").css("color",this._customization.dialogSecondaryButtonFontColour);let e=(e,t,i)=>{this._setDialogButtonColourCss(e,t,i)};$(".oracle-live-dialog-ok").mousedown(t=>{1===t.which&&e($(".oracle-live-dialog-ok"),!0,!0)}),$(".oracle-live-dialog-ok").mouseleave(()=>{e($(".oracle-live-dialog-ok"),!0,!1)}),$(".oracle-live-dialog-cancel").mousedown(t=>{1===t.which&&e($(".oracle-live-dialog-cancel"),!1,!0)}),$(".oracle-live-dialog-cancel").mouseleave(()=>{e($(".oracle-live-dialog-cancel"),!1,!1)})}this._setButtonBarEndButtonIconCss(!1),this._setCustomColourCssMinMax(!1)}_setIconColour(){this._customization&&(this._liveUpdatedIcons?this._setIconColourCss():new Promise((e,t)=>{let i=$(".oracle-live-mainbutton-icon").css("background-image");i&&(this._liveUpdatedIcons=new n(i,this._iconColours,e,t))}).then(e=>{this._setIconColourCss()}).catch(e=>{console.error("Error updating icons:",e),this._liveUpdatedIcons=null}))}_customize(){if(console.log("_customize",this._customization),this._customization){this._iconColours=this._customization.iconColours,this._setIconColour(),this._setMainButtonColourCss(!1),this._setCustomColourCss(),this._setCustomPositionCss();let e=e=>{this._setMainButtonColourCss(e)};$(".oracle-live-main-button").mouseenter(()=>{e(!0)}),$(".oracle-live-main-button").mouseleave(()=>{e(!1)})}else $(".oracle-live-menu-leftspacer").hide()}_populateMessages(){this._greetingMessage=this._messages.application_universal_message_welcome,this._connectingMessage=this._messages.application_universal_message_connecting_next_associate,this._messages.application_universal_message_transferring_to_another_associate="We are transferring you to another associate...",this._transferringMessage=this._messages.application_universal_message_transferring_to_another_associate,this._meetingTitle=this._messages.application_meeting_label_title,$(".oracle-live-dialog-cancel").text(this._messages.application_universal_button_cancel),$(".oracle-live-dialog-cancel").prop("title",this._messages.application_universal_button_cancel),$(".oracle-live-dialog-ok").text(this._messages.application_universal_button_ok),$(".oracle-live-dialog-ok").prop("title",this._messages.application_universal_button_ok),$(".oracle-live-dialog-question").text(this._messages.application_universal_message_service_quality_rating),$(".oracle-live-dialog-option-poor label").text(this._messages.application_universal_label_service_quality_bad),$(".oracle-live-dialog-option-poor").prop("title",this._messages.application_universal_label_service_quality_bad),$(".oracle-live-dialog-option-good label").text(this._messages.application_universal_label_service_quality_good),$(".oracle-live-dialog-option-good").prop("title",this._messages.application_universal_label_service_quality_good),$(".oracle-live-dialog-option-excellent label").text(this._messages.application_universal_label_service_quality_excellent),$(".oracle-live-dialog-option-excellent").prop("title",this._messages.application_universal_label_service_quality_excellent),$(".oracle-live-cancel-button").text(this._messages.application_universal_button_cancel),$(".oracle-live-rejoin-button").text(this._messages.application_universal_button_rejoin),$(".oracle-live-exit-button").prop("title",this._messages.application_universal_tooltip_end_call),$(".oracle-live-video-zoomin-button").text("+"),$(".oracle-live-video-zoomout-button").text("-"),$(".oracle-live-video-default-button").text(this._messages.application_universal_message_zoom_default_text),$(".oracle-live-video-closeall").prop("title",this._messages.application_video_call_tooltip_hide),$(".oracle-live-video-closelocal").prop("title",this._messages.application_video_call_tooltip_hide_local_video),$(".oracle-live-poor-video-connection-text").text(this._messages.application_universal_title_poor_connection),$(".oracle-live-recording").text(this._messages.application_universal_label_record),$(".oracle-live-duration-label").text(this._messages.application_universal_label_duration),$(".oracle-live-position-in-queue-label").text(this._messages.application_universal_label_position_in_queue),$(".oracle-live-main-button").attr("aria-label",this._messages.application_universal_label_main_button)}showComponent(){$(".oracle-live").removeClass("oracle-live-hidden")}hideEndCallButton(){$(".oracle-live-exit-button").hide()}hidePauseResumeButton(){$(".oracle-live-pause-button").hide()}hideQueueLengthIndicator(e){const t=$(".oracle-live-call-queue-info");e?t.addClass("oracle-live-hide-queue-info"):t.removeClass("oracle-live-hide-queue-info")}hideComponent(){$(".oracle-live").addClass("oracle-live-hidden")}setIdle(){console.log("LiveButtonMenu::setIdle"),this._idle=!0,this.setAssociateName(""),this._avatarImageUrl=null,this._callTimer.resetTimer(),this._enableZoom(!1),this._liveZoom=null,this._shortCode=null,this.setPopMessageText(this._greetingMessage,null),this.setPopMessageAriaDisabled(!1);const e=$(".oracle-live"),t=e.hasClass("oracle-live-cancelled");this.resetClass("oracle-live"),t&&e.addClass("oracle-live-cancelled"),!0===this._startInVideo?e.addClass("oracle-live-start-in-video"):e.removeClass("oracle-live-start-in-video"),!0===this._startInScreenShare?e.addClass("oracle-live-start-in-screenshare"):e.removeClass("oracle-live-start-in-screenshare"),$(".oracle-live-video-maximize").prop("title",this._messages.application_video_call_tooltip_maximize),this._isMeeting&&e.addClass("oracle-live-cancelled"),this._updateMenuButtons(),this._setMainButtonColourCss(!1)}showStartCallDialog(e){e?($(".oracle-live").addClass("oracle-live-precall-dialog"),$(".oracle-live-dialog-title").text(this._messages.application_universal_title_start_call),$(".oracle-live-dialog-message").text(this._messages.application_universal_message_continue),$(".oracle-live-dialog-ok").attr("aria-disabled","false"),$(".oracle-live-dialog-cancel").attr("aria-disabled","false"),$(".oracle-live-main-button").attr("aria-disabled","true"),this._showDialog(!0,!0)):($(".oracle-live").removeClass("oracle-live-precall-dialog"),$(".oracle-live").removeClass("oracle-live-show-dialog"),$(".oracle-live-main-button").attr("aria-disabled","false")),this._setMainButtonColourCss(!1)}setDiagnostics(e,t){this._diagnosticsRunning=e,e?(console.log("LiveButtonMenu::setDiagnostics, type="+t),$(".oracle-live-video-panel-enduser [role='heading']").text(this._messages.application_diagnostic_label_checking),"video"===t?this.setPopMessageText(this._messages.application_diagnostics_message_mic_camera_check,null):this.setPopMessageText(this._messages.application_diagnostics_message_mic_check,null)):(!0===this._shortCodeMode?($(".oracle-live").addClass("oracle-live-shortcode"),console.log("Set the text to ",this._messages.application_short_code_message_provide_code),this.setPopMessageText(this._messages.application_short_code_message_provide_code,this._shortCode)):this.setPopMessageText(this._connectingMessage,null),$(".oracle-live-video-panel-enduser [role='heading']").text(this._messages.application_universal_label_waiting_for_associate)),this._setMainButtonColourCss(!1)}setConnecting(e){console.log("setConnecting"),this._idle=!1,this._shortCode=e||null;const t=$(".oracle-live"),i=t.hasClass("oracle-live-video-preview"),o=t.hasClass("oracle-live-video-enduser-maximized");this.resetClass("oracle-live oracle-live-connecting"),this.setPopMessageAriaDisabled(!1),this._preCallIDCheck&&(console.log("Adding class oracle-live-preCallIDCheck-call-associate back in "),t.addClass("oracle-live-preCallIDCheck-call-associate"),t.addClass("oracle-live-video-enduser-maximized")),!0===i&&(t.addClass("oracle-live-video-enduser-on"),!0===o&&(t.addClass("oracle-live-video-enduser-maximized"),$(".oracle-live-exit-button").attr("aria-disabled",!1))),null!==this._shortCode?!0===this._startInScreenShare?this.setPopMessageText(this._messages.application_short_code_message_provide_code,this._shortCode):this.setPopMessageText(this._messages.application_short_code_message_provide_code_audio,this._shortCode):this.setPopMessageText(this._connectingMessage,null),$(".oracle-live-video-panel-enduser [role='heading']").text(this._messages.application_universal_label_waiting_for_associate),$(".oracle-live-audio-panel-message").text(this._messages.application_universal_label_waiting_for_associate),this._setMeetingTitle(),this._setMainButtonColourCss(!1)}setConnectingAudio(e){console.log("Setting connecting audio to "+e),e||null===this._connectingAudioTimer||(clearInterval(this._connectingAudioTimer),this._connectingAudioTimer=null);const t=document.getElementById("connectingAudio");if(t){if(console.log("Obtained a connecting audio, display="+t.style.display,t),!e)return console.log("Pausing connecting audio"),void t.pause();t.src!==this._connectingAudioSrc&&(t.src=this._connectingAudioSrc);let i=function(e){e._diagnosticsRunning?console.log("Still running diagnostics, not playing connecting audio yet"):(console.log("Playing connecting audio"),t.play())};i(this),this._connectingAudioTimer=setInterval(()=>{i(this)},4e3)}else console.log("Unable to control connectingAudio file")}_setMeetingTitle(){let e="";this._isMeeting&&(e=this._meetingTitle,this._agentName&&""!==this._agentName&&(e=e+" ("+this._messages.application_meeting_label_with+" "+this._agentName+")"),console.log('setMeetingTitle: "'+e+'"'),$(".oracle-live-video-panel-enduser [role='heading']").text(e),$(".oracle-live-video-panel [role='heading']").text(e),$(".oracle-live-audio-panel [role='heading']").text(e),$(".oracle-live-video-associate-maximized-title").text(e))}_setAssociateTitle(){let e="";this._agentName&&""!==this._agentName&&(e+=this._agentName),console.log('setAssociateTitle: "'+e+'"'),$(".oracle-live-video-associate-maximized-title").text(e)}setWaiting(e){this._setMeetingTitle(),e?($(".oracle-live").addClass("oracle-live-waiting"),$(".oracle-live-audio-panel-message").text(this._messages.application_meeting_label_wait)):($(".oracle-live").removeClass("oracle-live-waiting"),$(".oracle-live-audio-panel-message").text(this._messages.application_universal_label_connecting),$(".oracle-live-video-panel-enduser [role='heading']").text(this._messages.application_universal_label_connecting)),this._setMainButtonColourCss(!1)}setCancelled(e){e?($(".oracle-live").addClass("oracle-live-cancelled"),$(".oracle-live-audio-panel-message").text(this._messages.application_meeting_label_left)):($(".oracle-live").removeClass("oracle-live-cancelled"),$(".oracle-live-audio-panel-message").text("")),this._setMainButtonColourCss(!1)}setConnected(e){console.log("LiveButtonMenu::setConnected"),this._idle=!1;const t=$(".oracle-live"),i=t.hasClass("oracle-live-video-enduser-on"),o=t.hasClass("oracle-live-video-enduser-maximized")||!0===this._shortCodeMode&&!0===this._startVideoInFullScreen;this.resetClass("oracle-live oracle-live-connected"),this.setPopMessageAriaDisabled(!0),!0===i&&(t.addClass("oracle-live-video-enduser-on"),o&&this._maximizeEndUserVideo(!0)),this._preCallIDCheck&&(console.log("Adding class oracle-live-preCallIDCheck-call-associate back in "),t.addClass("oracle-live-preCallIDCheck-call-associate")),this._endUserControlsCamera&&t.addClass("oracle-live-video-control-enduser"),this._endUserControlsScreenShare&&t.addClass("oracle-live-screenshare-control-enduser"),e||this._callTimer.startTimer(),this._avatarImageUrl&&t.addClass("oracle-live-agent-image-loaded"),this._isMeeting?this._setMeetingTitle():this._setAssociateTitle(),e&&(this._resumeConnectedStatus=!0),this._updateMenuButtons(),this._setMainButtonColourCss(!1)}setDisconnecting(e){e?($(".oracle-live").addClass("oracle-live-disconnecting"),$(".oracle-live-dialog-title").text(this._messages.application_universal_title_exit_session),$(".oracle-live-dialog-message").text(this._messages.application_universal_message_exit_session),$(".oracle-live-dialog-ok").attr("aria-disabled","false"),$(".oracle-live-dialog-cancel").attr("aria-disabled","false"),this._showDialog(!0,!0)):($(".oracle-live").removeClass("oracle-live-disconnecting"),this._showDialog(!1)),this._updateMenuButtons(),this._setMainButtonColourCss(!1)}setDisconnected(e,t){console.log("LiveButtonMenu::setDisconnected, feedback=",e,", error=",t),this._callTimer.stopTimer(),this._agentName="",this._setMeetingTitle(),this._isMeeting&&$(".oracle-live-audio-panel-message").text(this._messages.application_meeting_label_left),this.setEndUserAnnotationOn(!1),this._removeActiveClasses();const o=$(".oracle-live");o.removeClass("oracle-live-connected"),o.addClass("oracle-live-disconnected"),o.hasClass("oracle-live-video-enduser-maximized")||o.hasClass("oracle-live-video-associate-maximized")||o.hasClass("oracle-live-screenshare-associate-maximized")||this._setCustomCssMinMax(!1);const n=$(".oracle-live-cancel-rejoin-buttons");this._canRejoinMeeting?(console.log("showing rejoin button"),n.hasClass("oracle-live-no-rejoin")&&n.removeClass("oracle-live-no-rejoin")):(console.log("hiding rejoin button"),n.hasClass("oracle-live-no-rejoin")||n.addClass("oracle-live-no-rejoin"));const a=$(".oracle-live-dialog-cancel"),r=$(".oracle-live-dialog-ok");t?(o.addClass("oracle-live-error"),t===i.LiveConnectingNoAnswer?($(".oracle-live-dialog-title").text(this._messages.application_universal_message_no_answer),$(".oracle-live-dialog-message").text(this._messages.application_universal_message_no_agent_available)):t===i.LiveDiagnosticsFailed?($(".oracle-live-dialog-title").text(this._messages.application_universal_title_service_failed),$(".oracle-live-dialog-message").text(this._messages.application_diagnostics_message_failed)):($(".oracle-live-dialog-title").text(this._messages.application_universal_title_service_ended),$(".oracle-live-dialog-message").text(this._messages.application_universal_message_service_ended)),r.attr("aria-disabled","false"),this._showDialog(!0,!1)):($(".oracle-live-dialog-title").text(this._messages.application_universal_title_service_ended),$(".oracle-live-dialog-message").text(this._messages.application_universal_message_service_ended),!0===e?(o.addClass("oracle-live-feedback"),r.attr("aria-disabled","true"),a.attr("aria-disabled","false"),this._showDialog(!0,!0)):(r.attr("aria-disabled","false"),this._showDialog(!0,!1))),!0===this._startInVideo?o.addClass("oracle-live-start-in-video"):o.removeClass("oracle-live-start-in-video"),!0===this._startInScreenShare?o.addClass("oracle-live-start-in-screenshare"):o.removeClass("oracle-live-start-in-screenshare"),this._havePausedResumed=!1,this._updateMenuButtons(),this._setMainButtonColourCss(!1)}sessionEnded(){$(".oracle-live-main-button").focus()}setReconnectingEndUser(e){console.log("LiveButtonMenu::setReconnectingEndUser",e),!0===e?($(".oracle-live-notification").text(this._messages.application_universal_message_local_attempting_to_reconnect),$(".oracle-live").addClass("oracle-live-reconnecting-enduser")):($(".oracle-live-notification").text(this._messages.application_universal_message_local_reconnected),$(".oracle-live").removeClass("oracle-live-reconnecting-enduser")),this._showNotification(),this._updateMenuButtons()}setReconnectingAssociate(e){console.log("LiveButtonMenu::setReconnectingAssociate",e),!0===e?($(".oracle-live-notification").text(this._messages.application_universal_message_associate_disconnected),$(".oracle-live").addClass("oracle-live-reconnecting-associate"),this.restoreFromAnnotation()):($(".oracle-live-notification").text(this._messages.application_universal_message_associate_reconnected),$(".oracle-live").removeClass("oracle-live-reconnecting-associate")),this._showNotification(),this._updateMenuButtons()}showVideoPreview(e){console.log("LiveButtonMenu::showVideoPreview",e),this.setEndUserControlsCamera(e);const t=$(".oracle-live");if(e){this.setCancelled(!1),t.addClass("oracle-live-video-preview"),$(".oracle-live-video-panel-enduser [role='heading']").text(this._messages.application_diagnostic_label_video_preview),$(".oracle-live-preview-cancel-button").text(this._messages.application_universal_button_cancel).attr("aria-disabled","false");const e=t.hasClass("oracle-live-connected");e?$(".oracle-live-preview-start-button").text(this._messages.application_universal_button_share).attr("aria-disabled","false"):$(".oracle-live-preview-start-button").text(this._messages.application_universal_button_start).attr("aria-disabled","false"),e&&!1===this.isRemoteVideoOn()&&!0===this._startVideoInFullScreen?this._maximizeEndUserVideo(!0):e||!0!==this._startVideoInFullScreen||!0===this._shortCodeMode?this._setCustomCssMinMax(!1):this._maximizeEndUserVideo(!0)}else t.removeClass("oracle-live-video-preview"),this._maximizeEndUserVideo(!1),this.setEndUserVideoOn(!1);this._updateMenuButtons(),this._setMainButtonColourCss(!1)}setEndUserVideoOn(e){console.log("setEndUserVideoOn=",e);const t=$(".oracle-live");t.removeClass("oracle-live-video-preview"),!0===e?(t.addClass("oracle-live-video-enduser-on"),this._setMeetingTitle()):(this.setAssociateVideoAnnotationOn(!1),this._clearVideoAnnotations(),t.removeClass("oracle-live-video-enduser-on"),t.removeClass("oracle-live-video-enduser-maximized"),t.removeClass("oracle-live-annotation-associate-video-on")),this._updateMenuButtons(),this._setCustomCssMinMax()}setAssociateVideoOn(e){console.log("LiveButtonMenu::setAssociateVideoOn=",e);const t=$(".oracle-live");if(!0===e)t.hasClass("oracle-live-video-enduser-on")&&t.hasClass("oracle-live-video-enduser-maximized")&&!this._havePausedResumed?t.hasClass("oracle-live-frozen-annotation")||t.hasClass("oracle-live-annotation-associate-video-on")||this._maximizeAssociateVideo(!0):!1===this.isVideoOn()&&!0===this._startVideoInFullScreen?this._maximizeAssociateVideo(!0):this._impl._isRehydratingMeetingCall()?this._maximizeAssociateVideo(!0):!this._isMeeting||t.hasClass("oracle-live-video-enduser-maximized")||t.hasClass("oracle-live-screenshare-associate-maximized")||this._maximizeAssociateVideo(!0),t.addClass("oracle-live-video-associate-on"),this._setMeetingTitle();else{const e=t.hasClass("oracle-live-video-enduser-on")&&t.hasClass("oracle-live-video-associate-maximized");t.removeClass("oracle-live-video-associate-on"),this._maximizeAssociateVideo(!1),e&&this._maximizeEndUserVideo(!0)}this._setCustomCssMinMax()}setVideoLoading(e){console.log("LiveButtonMenu::setVideoLoading=",e);const t=$(".oracle-live");e?t.addClass("oracle-live-video-loading"):(t.removeClass("oracle-live-video-loading"),this._resumeConnectedStatus&&(this._resumeConnectedStatus=!1,this.restoreFromAnnotation()))}setAssociateScreenShareOn(e){console.log("LiveButtonMenu::setAssociateScreenShareOn=",e);const t=$(".oracle-live");!0===e?(this._maximizedFeedWhenScreenShareAdded=this.getMaximizedFeed(),t.hasClass("oracle-live-video-enduser-on")&&t.hasClass("oracle-live-video-enduser-maximized")?this._maximizeAssociateScreenShare(!0):!1===this.isVideoOn()&&!0===this._startVideoInFullScreen&&this._maximizeAssociateScreenShare(!0),t.addClass("oracle-live-screenshare-associate-on"),this._setMeetingTitle()):(t.removeClass("oracle-live-screenshare-associate-on"),this._maximizeAssociateScreenShare(!1),"associateVideo"===this._maximizedFeedWhenScreenShareAdded&&this._maximizeAssociateVideo(!0)),this._updateMenuButtons(),this._setCustomCssMinMax()}setEndUserScreenShareOn(e){console.log("LiveButtonMenu::setEndUserScreenShareOn",e),!0===e?$(".oracle-live").addClass("oracle-live-screenshare-enduser-on"):(this.setEndUserAnnotationOn(!1),this.setAssociateAnnotationOn(!1),$(".oracle-live").removeClass("oracle-live-screenshare-enduser-on")),this._updateMenuButtons()}isEndUserAnnotationOn(){return $(".oracle-live").hasClass("oracle-live-annotation-enduser-on")}setEndUserAnnotationOn(e){console.log("setEndUserAnnotationOn:"+e);const t=$(".oracle-live");t.hasClass("oracle-live-annotation-associate-on")||(!0===e?(t.addClass("oracle-live-annotation-enduser-on"),this._addEndUserAnnotationSupport()):(t.removeClass("oracle-live-annotation-enduser-on"),this._removeAnnotationSupport()),this._updateMenuButtons())}setAssociateAnnotationOn(e){console.log("setAssociateAnnotationOn:"+e);const t=$(".oracle-live");if(!t.hasClass("oracle-live-annotation-enduser-on"))if(!0===e&&!0!==t.hasClass("oracle-live-annotation-associate-on")){let e=this._messages.application_video_call_message_remote_annotation_started;e&&e.length>0&&($(".oracle-live-notification").text(e),this._showNotification()),t.addClass("oracle-live-annotation-associate-on"),this._addAssociateAnnotationSupport(),this._updateMenuButtons()}else if(!0!==e&&t.hasClass("oracle-live-annotation-associate-on")){let e=this._messages.application_video_call_message_remote_annotation_stopped;e&&e.length>0&&($(".oracle-live-notification").text(e),this._showNotification()),t.removeClass("oracle-live-annotation-associate-on"),this._removeAnnotationSupport(),this._updateMenuButtons()}}setAssociateVideoAnnotationOn(e,t){console.log("setAssociateVideoAnnotationOn:"+e);const i=$(".oracle-live");if(e&&!i.hasClass("oracle-live-annotation-associate-video-on")){let e=this._messages.application_video_call_message_remote_annotation_video_started;e&&e.length>0&&($(".oracle-live-notification").text(e),this._showNotification()),i.addClass("oracle-live-annotation-associate-video-on"),i.hasClass("oracle-live-frozen-annotation")||($(".oracle-live-unfreeze-annotation-cross").prop("title",this._messages.application_video_call_tooltip_unannotate_video),this.setOriginMaximizedVideo(),this._maximizeEndUserVideo(!0),i.hasClass("oracle-live-collapsed")&&(this.setCollapsed(!1),i.addClass("oracle-live-collapsed-restore"))),this._addAssociateVideoAnnotationSupport()}else if(!0!==e&&i.hasClass("oracle-live-annotation-associate-video-on")){let e=this._messages.application_video_call_message_remote_annotation_video_stopped;e&&e.length>0&&!t&&($(".oracle-live-notification").text(e),this._showNotification()),i.removeClass("oracle-live-annotation-associate-video-on"),i.hasClass("oracle-live-frozen-annotation")||this.restoreOriginMaximizedVideo(),this._removeVideoAnnotationSupport(),t&&this._impl._conversation.relayCommandTo(null,"*","video_annotate_stop",[{}])}this._updateMenuButtons()}setFrozenAnnotationOn(e,t){const i=$(".oracle-live");if(e){let e=this._messages.application_video_call_message_remote_frozen_annotation_started;e&&e.length>0&&($(".oracle-live-notification").text(e),this._showNotification()),i.addClass("oracle-live-frozen-annotation"),$(".oracle-live-unfreeze-annotation-cross").prop("title",this._messages.application_video_call_tooltip_unfreeze_video),$(".oracle-live-unfreeze-annotation-camera").prop("title",this._messages.application_video_call_tooltip_frozen_video),i.hasClass("oracle-live-annotation-associate-video-on")||this.setOriginMaximizedVideo(),this._impl._av.freezeEndUserVideo(!0)}else{if(t){let e=this._messages.application_video_call_message_remote_frozen_annotation_stopped;e&&e.length>0&&($(".oracle-live-notification").text(e),this._showNotification())}i.removeClass("oracle-live-frozen-annotation"),i.hasClass("oracle-live-annotation-associate-video-on")||this.restoreOriginMaximizedVideo(),this._impl._av.freezeEndUserVideo(!1),this._frozenUrl=null,t||this._impl._conversation.relayCommandTo(null,"*","unfreeze_customer_stream",[{}]),this._clearVideoAnnotations()}this._updateMenuButtons()}restoreFromAnnotation(){this.setAssociateVideoAnnotationOn(!1,!0),this.setFrozenAnnotationOn(!1,!1),this._previousMaximizedFeed=this.getMaximizedFeed()}setOriginMaximizedVideo(){const e=$(".oracle-live");e.hasClass("oracle-live-video-associate-maximized")?this._originMaximizedVideo="ASSOCIATE":e.hasClass("oracle-live-video-enduser-maximized")?this._originMaximizedVideo="ENDUSER":this._originMaximizedVideo="NONE",e.hasClass("oracle-live-collapsed")&&(this.setCollapsed(!1),e.addClass("oracle-live-collapsed-restore")),this._maximizeEndUserVideo(!0),this._hideTopbarAndToolbar()}restoreOriginMaximizedVideo(){const e=$(".oracle-live");"NONE"===this._originMaximizedVideo?this._maximizeEndUserVideo(!1):"ASSOCIATE"===this._originMaximizedVideo&&this._maximizeAssociateVideo(!0),e.hasClass("oracle-live-collapsed-restore")&&(this.setCollapsed(!0),e.removeClass("oracle-live-collapsed-restore")),this._unHideTopbarAndToolbar(),this._topBarShowTimer&&clearTimeout(this._topBarShowTimer)}showUnfreezeAnnotationDialog(e){e?($(".oracle-live").addClass("oracle-live-unfreeze-annotation"),$(".oracle-live-dialog-title").text(this._messages.application_video_call_title_discard_frozen),0===this._videoAnnotationList.length?$(".oracle-live-dialog-message").text(this._messages.application_video_call_message_discard_frozen):$(".oracle-live-dialog-message").text(this._messages.application_video_call_message_discard_frozen_annotation),$(".oracle-live-dialog-ok").text(this._messages.application_universal_button_discard),$(".oracle-live-dialog-ok").attr("aria-disabled","false"),$(".oracle-live-dialog-cancel").attr("aria-disabled","false"),this._showDialog(!0,!0)):($(".oracle-live").removeClass("oracle-live-unfreeze-annotation"),$(".oracle-live").removeClass("oracle-live-show-dialog"),$(".oracle-live-main-button").attr("aria-disabled","false"),$(".oracle-live-dialog-ok").text(this._messages.application_universal_button_ok)),this._updateMenuButtons(),this._setMainButtonColourCss(!1)}distance(e,t){return Math.sqrt((e.x-t.x)*(e.x-t.x)+(e.y-t.y)*(e.y-t.y))}lineIntersects(e,t,i,o,n,a,r,s){const l=1e-5;function c(e,t,i){return e-l<=t&&t<=i+l}let d=((e*o-t*i)*(n-r)-(e-i)*(n*s-a*r))/((e-i)*(a-s)-(t-o)*(n-r)),u=((e*o-t*i)*(a-s)-(t-o)*(n*s-a*r))/((e-i)*(a-s)-(t-o)*(n-r));if(isNaN(d)||isNaN(u))return!1;if(e>=i){if(!c(i,d,e))return!1}else if(!c(e,d,i))return!1;if(t>=o){if(!c(o,u,t))return!1}else if(!c(t,u,o))return!1;if(n>=r){if(!c(r,d,n))return!1}else if(!c(n,d,r))return!1;if(a>=s){if(!c(s,u,a))return!1}else if(!c(a,u,s))return!1;return console.log("lineIntersects returning true"),!0}checkLineIntersectsWithAnnotations(e,t,i,o,n,a,r){a.forEach((a,s)=>{console.log("checkLineIntersectsWithAnnotations: processing annotation index (looking for intersection): ",s);for(let l=0;l<a.length-1;l++){let c=this.lineIntersects(e[0].x,e[0].y,e[1].x,e[1].y,a[l].x*t+o,a[l].y*i+n,a[l+1].x*t+o,a[l+1].y*i+n);console.log("checkLineIntersectsWithAnnotations: eraseAnnotation: intersects: ",c),c&&(console.log("checkLineIntersectsWithAnnotations: eraseAnnotation: found an intersection at index "+s),r.push(s))}})}_drawCursorPoint(e,t,i,o,n){let a;(a=e||(this._canvasCtx?this._canvasCtx:this._videoCanvasCtx)).beginPath(),a.moveTo(i,o),"circle"===t?a.arc(i,o,10,0,2*Math.PI):a.rect(i-10,o-10,20,20),a.strokeStyle=n,a.stroke()}eraseAnnotation(e){console.log("LiveButtonMenu::eraseAnnotation: ",e);let t=[];if(e.length>=1){let i=e[0].annotationIds;i&&this._annotationList.forEach((e,o)=>{e[0].objectId&&i.includes(e[0].objectId)&&(console.log("Marking screenshare '"+e[0].objectId+"' annotation["+o+"] for deletion"),t.push(o))})}if(0===t.length)console.log("LiveButtonMenu::eraseAnnotation: failed to find anything to delete");else{let e=[];console.log("LiveButtonMenu::eraseAnnotation: removing all intersecting annotations"),this._annotationList.forEach((i,o)=>{console.log("processing annotation index: ",o),t.includes(o)||e.push(i)}),console.log("LiveButtonMenu::eraseAnnotation: clearing annotations"),this._clearAnnotations(),console.log("LiveButtonMenu::eraseAnnotation: Redrawing annotations with just the survivors"),e.forEach((e,t)=>{this.displayAssociateAnnotation(e)})}}displayAssociateAnnotation(e){if(console.log("LiveButtonMenu::displayAssociateAnnotation",e),!this._canvasCtx)return;if(e&&"erase"===e[0].mode)return void this.eraseAnnotation(e);e&&e[0].color&&(this._canvasCtx.strokeStyle=e[0].color),this._annotationList.push(e);let t=0,i=0,o=0;"Chrome"===this._browser&&"browser"===this._impl._screen.getDisplaySurface()?(i=window.innerWidth,t=window.innerHeight):(i=window.outerWidth,t=window.outerHeight,o=t-window.innerHeight);const n=(e,n)=>{if(0===n)this._oldPosition={x:e.x*i,y:e.y*t-o};else{const n={x:e.x*i,y:e.y*t-o};this._drawGraph(this._oldPosition,n),this._oldPosition=n}};let a=window.screen.width,r=window.screen.height;const s=(e,t)=>{let i=a*e.x,n=r*e.y,s=i-(window.screenLeft-a),l=n-window.screenTop-o;if(0===t)this._oldPosition={x:s,y:l};else{const e={x:s,y:l};this._drawGraph(this._oldPosition,e),this._oldPosition=e}};"Chrome"===this._browser&&"monitor"===this._impl._screen.getDisplaySurface()?e.forEach((e,t)=>{s(e,t)}):e.forEach((e,t)=>{n(e,t)})}getXOffset(e){console.log("LiveButtonMenu::getXOffset");let t=0;if(!e)return t;const i=e.clientWidth,o=e.clientHeight,n=e.videoWidth,a=e.videoHeight,r=i/o,s=n/a;return console.log("LiveButtonMenu::cw: "+i+"  ch: "+o+"  vw: "+n+"  vh: "+a),console.log("LiveButtonMenu::car: "+r+"    ar: "+s),r>s&&(t=(i-o*n/a)/2),console.log("LiveButtonMenu::xOffset: "+t),t}getYOffset(e){console.log("LiveButtonMenu::getYOffset");let t=0;if(!e)return t;const i=e.clientWidth,o=e.clientHeight,n=e.videoWidth,a=e.videoHeight,r=i/o,s=n/a;return console.log("LiveButtonMenu::cw: "+i+"  ch: "+o+"  vw: "+n+"  vh: "+a),console.log("LiveButtonMenu::car: "+r+"    ar: "+s),r<s&&(t=(o-i*a/n)/2),console.log("LiveButtonMenu::yOffset: "+t),t}eraseVideoAnnotation(e){console.log("LiveButtonMenu::eraseVideoAnnotation: ",e);let t=[];if(e.length>=1){let i=e[0].annotationIds;i&&this._videoAnnotationList.forEach((e,o)=>{e[0].objectId&&i.includes(e[0].objectId)&&(console.log("Marking video '"+e[0].objectId+"' annotation["+o+"] for deletion"),t.push(o))})}if(0===t.length)console.log("LiveButtonMenu::eraseVideoAnnotation: failed to find anything to delete");else{let e=[];console.log("LiveButtonMenu::eraseVideoAnnotation: removing all intersecting annotations"),this._videoAnnotationList.forEach((i,o)=>{console.log("processing annotation index: ",o),t.includes(o)||e.push(i)}),console.log("LiveButtonMenu::eraseAnnotation: clearing annotations"),this._clearVideoAnnotations(),console.log("LiveButtonMenu::eraseAnnotation: Redrawing annotations with just the survivors"),e.forEach((e,t)=>{this.displayAssociateVideoAnnotation(e)})}}redrawVideoAnnotations(){console.log("LiveButtonMenu::redrawVideoAnnotation");let e=this._videoAnnotationList;this._clearVideoAnnotations(),console.log("LiveButtonMenu::redrawVideoAnnotation Redrawing the video annotations"),e.forEach((e,t)=>{this.displayAssociateVideoAnnotation(e)})}displayAssociateVideoAnnotation(e){if(console.log("LiveButtonMenu::displayAssociateVideoAnnotation",e),!this._videoCanvasCtx)return;if(e&&"erase"===e[0].mode)return void this.eraseVideoAnnotation(e);e&&e[0].color&&(this._videoCanvasCtx.strokeStyle=e[0].color),this._videoAnnotationList.push(e);const t=$(".oracle-live-local-video")[0],i=this.getXOffset(t),o=this.getYOffset(t);let n=0,a=0;a=t.clientWidth-2*i,n=t.clientHeight-2*o,"Chrome"===this._browser&&window.navigator&&window.navigator.userAgent&&window.navigator.userAgent.toLowerCase().indexOf("mobi")>0&&t.clientHeight>this._videoCanvasCtx.canvas.height&&this._videoCanvasCtx.canvas.height-2*o>=50&&(n=this._videoCanvasCtx.canvas.height-2*o);const r=(e,t,i,o)=>{if(0===t)this._oldPosition={x:e.x*a+i,y:e.y*n+o};else{const t={x:e.x*a+i,y:e.y*n+o};this._drawVideoGraph(this._oldPosition,t),this._oldPosition=t}};e.forEach((e,t)=>{r(e,t,i,o)})}setPausedByUser(e){const t=$(".oracle-live");!0===e?(t.addClass("oracle-live-paused-enduser"),this._endUserAnnotationOnPriorToPause=this.isEndUserAnnotationOn(),this._previousMaximizedFeed=this.getMaximizedFeed(),this._havePausedResumed=!0,this._endUserAnnotationOnPriorToPause&&this.setEndUserAnnotationOn(!1),$(".oracle-live-notification").text(this._messages.application_universal_message_local_hold),this._showNotification()):(t.removeClass("oracle-live-notification-show oracle-live-paused-enduser"),this._endUserAnnotationOnPriorToPause&&this.setEndUserAnnotationOn(!0),this.maximize(this._previousMaximizedFeed,!0)),this._updateMenuButtons()}setPausedByAssociate(e){const t=$(".oracle-live");!0===e?(this._toolbarsHidden=!1,t.hasClass("oracle-live-videopanel-toolbars-hidden")&&(t.removeClass("oracle-live-videopanel-toolbars-hidden"),this._toolbarsHidden=!0),$(".oracle-live-notification").text(this._messages.application_universal_message_remote_hold),t.addClass("oracle-live-paused-associate"),this._endUserAnnotationOnPriorToPause=this.isEndUserAnnotationOn(),this._endUserAnnotationOnPriorToPause&&this.setEndUserAnnotationOn(!1),this._previousMaximizedFeed=this.getMaximizedFeed(),this._havePausedResumed=!0,this._showNotification(),(t.hasClass("oracle-live-frozen-annotation")||t.hasClass("oracle-live-annotation-associate-video-on"))&&this._unHideTopbarAndToolbar()):(t.removeClass("oracle-live-notification-show oracle-live-paused-associate"),this._endUserAnnotationOnPriorToPause&&this.setEndUserAnnotationOn(!0),this.maximize(this._previousMaximizedFeed,!0),this._toolbarsHidden&&t.addClass("oracle-live-videopanel-toolbars-hidden")),this._updateMenuButtons()}setTransferringToAnotherAssociate(e){console.log("setTransferringToAnotherAssociate"),this._idle=!1,this.resetClass("oracle-live oracle-live-transferring"),this.setPopMessageAriaDisabled(!1),this.setPopMessageText(this._transferringMessage,null),this._updateMenuButtons(),$(".oracle-live-video-panel-enduser [role='heading']").text(this._messages.application_universal_label_transferring),$(".oracle-live-audio-panel-message").text(this._messages.application_universal_label_transferring),this._setMeetingTitle(),this._setMainButtonColourCss(!1),this._impl.holdCallWithAssociate()}setTransferredToAnotherAssociate(e){console.log("TRANSFER: setTransferredToAnotherAssociate",e),this.setConnected(!0),this._impl.resumeCallWithAssociate()}cancelCallTransfer(){console.log("cancelCallTransfer"),this.setConnected(!0),this._impl.resumeCallWithAssociate()}setAssociateName(e){this._agentName=e,$(".oracle-live-associate").text(e).prop("title",e);const t=(e=>{let t="";if(null===e)return t;const i=(e=e.trim()).indexOf(" ");return(t=-1===i?e.substring(0,1):e.substring(0,1)+e.substring(i).trim().substring(0,1)).toUpperCase()})(this._agentName);console.log("Agent initials="+t),$(".oracle-live-initials").text(t),$(".oracle-live-video-enduser-name").text(e).prop("title",e),$(".oracle-live-video-associate-name").text(e).prop("title",e),$(".oracle-live-screenshare-associate-name").text(e).prop("title",e),this._setMeetingTitle()}setAssociatePhoto(e){const t=this._messages.application_universal_message_picture_description.replace(/\{0\}/,this._agentName);this._avatarImageUrl=e,e&&$(".oracle-live").addClass("oracle-live-agent-image-loaded"),$(".oracle-live-agent-image").attr("src",e).prop("title",t)}setConnectingAudioSource(e){this._connectingAudioSrc=e}setPoorNetwork(e){console.log("LiveButtonMenu::setPoorNetwork",e);const t=$(".oracle-live");!0===e?($(".oracle-live-video-panel-message").text(this._messages.application_universal_title_poor_connection),t.hasClass("oracle-live-connecting")?$(".oracle-live-notification").text(this._messages.application_universal_message_poor_network_connection):(t.hasClass("oracle-live-connected")||t.hasClass("oracle-live-transferring"))&&$(".oracle-live-notification").text(this._messages.application_universal_message_check_network_connection),t.addClass("oracle-live-poor-connection")):(t.removeClass("oracle-live-poor-connection"),this._setMeetingTitle()),this._updateMenuButtons(),this._showNotification()}setCollapsed(e){console.log("LiveButtonMenu::setCollapsed ",e);const t=$(".oracle-live");!0===e?(console.log("LiveButtonMenu::setCollapsed Removing maximized styles and adding collapsed style"),t.removeClass("oracle-live-video-enduser-maximized").removeClass("oracle-live-video-associate-maximized").removeClass("oracle-live-screenshare-associate-maximized"),t.addClass("oracle-live-collapsed")):(console.log("LiveButtonMenu::setCollapsed Removing collapsed styles"),t.removeClass("oracle-live-collapsed oracle-live-video-hide").removeClass("oracle-live-video-local-hide"),(t.hasClass("oracle-live-annotation-associate-video-on")||t.hasClass("oracle-live-frozen-annotation"))&&t.addClass("oracle-live-video-enduser-maximized"),t.hasClass("oracle-live-annotation-associate-video-on")&&this._resizeVideoAnnotationCanvas())}setScreenShareDialogShowing(e){e?$(".oracle-live").addClass("oracle-live-screenshare-system-dialog"):$(".oracle-live").removeClass("oracle-live-screenshare-system-dialog"),this._updateMenuButtons()}setRecording(e){!0===e?$(".oracle-live").addClass("oracle-live-recording-on"):$(".oracle-live").removeClass("oracle-live-recording-on")}setRating(e){const t=$(".oracle-live");switch(e){case"poor":t.removeClass("oracle-live-quality-good").removeClass("oracle-live-quality-excellent").addClass("oracle-live-quality-poor");break;case"good":t.removeClass(" oracle-live-quality-excellent").removeClass("oracle-live-quality-poor").addClass("oracle-live-quality-good");break;case"excellent":t.removeClass("oracle-live-quality-poor").removeClass("oracle-live-quality-good").addClass("oracle-live-quality-excellent")}$(".oracle-live-dialog-ok").attr("aria-disabled","false"),$(".oracle-live-dialog-option-poor").prop("tabindex","poor"===e?0:-1).attr("aria-checked","poor"===e),$(".oracle-live-dialog-option-good").prop("tabindex","good"===e?0:-1).attr("aria-checked","good"===e),$(".oracle-live-dialog-option-excellent").prop("tabindex","excellent"===e?0:-1).attr("aria-checked","excellent"===e)}getMaximizedFeed(){const e=$(".oracle-live");return e.hasClass("oracle-live-collapsed")?null:e.hasClass("oracle-live-video-enduser-maximized")?"endUserVideo":e.hasClass("oracle-live-video-associate-maximized")?"associateVideo":e.hasClass("oracle-live-screenshare-associate-maximized")?"associateScreenShare":null}isVideoOn(){const e=$(".oracle-live");return e.hasClass("oracle-live-video-enduser-on")||e.hasClass("oracle-live-video-associate-on")||e.hasClass("oracle-live-screenshare-associate-on")}isRemoteVideoOn(){const e=$(".oracle-live");return e.hasClass("oracle-live-video-associate-on")||e.hasClass("oracle-live-screenshare-associate-on")}isFullScreen(){const e=$(".oracle-live");return e.hasClass("oracle-live-video-enduser-maximized")||e.hasClass("oracle-live-video-associate-maximized")||e.hasClass("oracle-live-screenshare-associate-maximized")}maximize(e,t){console.log("LiveButtonMenu::maximize ",e,t),$(".oracle-live").hasClass("oracle-live-collapsed")?console.log("is collapsed - returning"):"endUserVideo"===e?this._maximizeEndUserVideo(t):"associateVideo"===e?this._maximizeAssociateVideo(t):"associateScreenShare"===e&&this._maximizeAssociateScreenShare(t)}_showDialog(e,t){this._setDialogButtonColourCss($(".oracle-live-dialog-ok"),!0,!1),this._setDialogButtonColourCss($(".oracle-live-dialog-cancel"),!1,!1),e?(this._oldFocus=document.activeElement,$(".oracle-live").addClass("oracle-live-show-dialog"),!0===t?$(".oracle-live-dialog-cancel").focus():$(".oracle-live-dialog-ok").focus()):($(".oracle-live").removeClass("oracle-live-show-dialog"),this._oldFocus&&this._oldFocus.focus(),this._updateMenuButtons()),this._setButtonBarEndButtonIconCss(e)}_maximizeEndUserVideo(e){console.log("LiveButtonMenu::_maximizeEndUserVideo ",e);const t=$(".oracle-live");e&&!t.hasClass("oracle-live-collapsed")?(console.log("LiveButtonMenu::_maximizeEndUserVideo (max and not olc)"),t.removeClass("oracle-live-video-associate-maximized"),t.removeClass("oracle-live-screenshare-associate-maximized"),t.removeClass("oracle-live-videopanel-toolbars-hidden"),t.addClass("oracle-live-video-enduser-maximized"),$(".oracle-live-video-panel-enduser .oracle-live-video-maximize").prop("title",this._messages.application_video_call_tooltip_minimize_video),this._resizeVideoAnnotationCanvas()):(console.log("LiveButtonMenu::_maximizeEndUserVideo (not max) or (max and olc)"),t.removeClass("oracle-live-video-enduser-maximized"),$(".oracle-live-video-panel-enduser .oracle-live-video-maximize").prop("title",e?this._messages.application_video_call_tooltip_minimize_video:this._messages.application_video_call_tooltip_maximize),this._resizeVideoAnnotationCanvas()),e&&($(".oracle-live-video-panel-associate .oracle-live-video-maximize").prop("title",this._messages.application_video_call_tooltip_maximize),$(".oracle-live-screenshare-panel-associate .oracle-live-video-maximize").prop("title",this._messages.application_video_call_tooltip_maximize)),this._setCustomCssMinMax(e)}_maximizeAssociateVideo(e){console.log("LiveButtonMenu::_maximizeAssociateVideo ",e);const t=$(".oracle-live");e&&!t.hasClass("oracle-live-collapsed")?(console.log("LiveButtonMenu::_maximizeAssociateVideo (max and not olc)"),t.removeClass("oracle-live-video-enduser-maximized"),t.removeClass("oracle-live-screenshare-associate-maximized"),t.removeClass("oracle-live-videopanel-toolbars-hidden"),t.addClass("oracle-live-video-associate-maximized"),$(".oracle-live-video-panel-associate .oracle-live-video-maximize").prop("title",this._messages.application_video_call_tooltip_minimize_video)):(console.log("LiveButtonMenu::_maximizeAssociateVideo (not max) or (max and olc)"),t.removeClass("oracle-live-video-associate-maximized"),$(".oracle-live-video-panel-associate .oracle-live-video-maximize").prop("title",e?this._messages.application_video_call_tooltip_minimize_video:this._messages.application_video_call_tooltip_maximize)),e&&($(".oracle-live-video-panel-enduser .oracle-live-video-maximize").prop("title",this._messages.application_video_call_tooltip_maximize),$(".oracle-live-screenshare-panel-associate .oracle-live-video-maximize").prop("title",this._messages.application_video_call_tooltip_maximize)),this._setCustomCssMinMax(e)}_maximizeAssociateScreenShare(e){console.log("LiveButtonMenu::_maximizeAssociateScreenShare ",e);const t=$(".oracle-live");e&&!t.hasClass("oracle-live-collapsed")?(console.log("LiveButtonMenu::_maximizeAssociateScreenShare (max and not olc)"),t.removeClass("oracle-live-video-enduser-maximized"),t.removeClass("oracle-live-video-associate-maximized"),t.removeClass("oracle-live-videopanel-toolbars-hidden"),t.addClass("oracle-live-screenshare-associate-maximized"),$(".oracle-live-screenshare-panel-associate .oracle-live-video-maximize").prop("title",this._messages.application_video_call_tooltip_minimize_video),this._enableZoom(!0)):(console.log("LiveButtonMenu::_maximizeAssociateScreenShare (not max) or (max and olc)"),t.removeClass("oracle-live-screenshare-associate-maximized"),$(".oracle-live-screenshare-panel-associate .oracle-live-video-maximize").prop("title",e?this._messages.application_video_call_tooltip_minimize_video:this._messages.application_video_call_tooltip_maximize),this._enableZoom(!1)),e&&($(".oracle-live-video-panel-associate .oracle-live-video-maximize").prop("title",this._messages.application_video_call_tooltip_maximize),$(".oracle-live-video-panel-enduser .oracle-live-video-maximize").prop("title",this._messages.application_video_call_tooltip_maximize)),this._setCustomCssMinMax(e)}_updateMenuButtons(){const e=$(".oracle-live"),t=$(".oracle-live-menu"),i=$(".oracle-live-pause-button"),o=$(".oracle-live-video-button"),n=$(".oracle-live-screenshare-button"),a=$(".oracle-live-annotate-button"),r=$(".oracle-live-exit-button");!0===this._hideEndCallButton&&this.hideEndCallButton(),!0===this._hidePauseButton&&this.hidePauseResumeButton();const s=e.hasClass("oracle-live-show-dialog"),l=e.hasClass("oracle-live-video-preview"),c=e.hasClass("oracle-live-screenshare-system-dialog"),d=e.hasClass("oracle-live-connected"),u=e.hasClass("oracle-live-disconnecting"),h=e.hasClass("oracle-live-disconnected"),p=e.hasClass("oracle-live-reconnecting-enduser"),v=e.hasClass("oracle-live-paused-associate"),g=e.hasClass("oracle-live-paused-enduser"),m=e.hasClass("oracle-live-video-enduser-on"),f=e.hasClass("oracle-live-video-control-enduser"),S=e.hasClass("oracle-live-screenshare-enduser-on"),_=e.hasClass("oracle-live-screenshare-control-enduser"),C=e.hasClass("oracle-live-screenshare-associate-on"),b=e.hasClass("oracle-live-annotation-enduser-on"),E=e.hasClass("oracle-live-annotation-associate-on");if(this._isMeeting||((!0!==this._hidePauseButton||m||f||S||_||b||!0!==this._hideEndCallButton)&&(d||u||h)&&!e.hasClass("oracle-live-videopanel-topbar-toolbar-hidden")?t.css("display","block"):t.css("display","none")),!0===this._idle)return!0!==this._hidePauseButton?i.prop("title",this._messages.application_universal_tooltip_pause_call).attr("aria-pressed",!1).attr("aria-disabled",!1):i.prop("title",this._messages.application_universal_tooltip_pause_call_disabled).attr("aria-pressed",!1).attr("aria-disabled",!0),o.prop("title",this._messages.application_video_call_tooltip_share_camera).attr("aria-pressed",!1).attr("aria-disabled",!1),n.prop("title",this._messages.application_video_call_tooltip_share_screen).attr("aria-pressed",!1).attr("aria-disabled",!1),!0!==this._hideEndCallButton?r.prop("title",this._messages.application_universal_tooltip_end_call).attr("aria-pressed",!1).attr("aria-disabled",!1):r.prop("title",this._messages.application_universal_tooltip_end_call_disabled).attr("aria-pressed",!1).attr("aria-disabled",!0),this._addedOracleLiveVideoControlEnduser=!1,void(this._cameraDefaultOn=null);const R=p||v||u||h||s||l||c;i.attr("aria-disabled",R||this._hidePauseButton),i.attr("aria-pressed",g),R||this._hidePauseButton?(i.prop("title",this._messages.application_universal_tooltip_pause_call_disabled),this._setButtonBarButtonColourCss(i,!1,!0)):g?(i.prop("title",this._messages.application_universal_tooltip_resume_call),this._setButtonBarButtonColourCss(i,!0,!1)):(i.prop("title",this._messages.application_universal_tooltip_pause_call),this._setButtonBarButtonColourCss(i,!1,!1));const y=R||g||v;o.attr("aria-disabled",y),o.attr("aria-pressed",m),e.hasClass("oracle-live-frozen-annotation")||e.hasClass("oracle-live-annotation-associate-video-on")?$(".oracle-live-video-maximize.oracle-live-video-toolbar-enduser").attr("aria-disabled",!0):$(".oracle-live-video-maximize.oracle-live-video-toolbar-enduser").attr("aria-disabled",!1),y?(o.prop("title",this._messages.application_video_call_tooltip_share_camera_disabled),this._setButtonBarButtonColourCss(o,!1,!0)):m?(null===this._cameraDefaultOn&&(this._cameraDefaultOn=!0),o.prop("title",this._messages.application_video_call_tooltip_stop_camera_share),this._setButtonBarButtonColourCss(o,!0,!1),e.hasClass("oracle-live-video-control-enduser")||(this._addedOracleLiveVideoControlEnduser=!0,e.addClass("oracle-live-video-control-enduser"))):(null===this._cameraDefaultOn&&(this._cameraDefaultOn=!1),o.prop("title",this._messages.application_video_call_tooltip_share_camera),this._setButtonBarButtonColourCss(o,!1,!1),this._addedOracleLiveVideoControlEnduser&&!1===this._cameraDefaultOn&&(this._addedOracleLiveVideoControlEnduser=!1,e.removeClass("oracle-live-video-control-enduser")));const T=y||C;n.attr("aria-disabled",T),n.attr("aria-pressed",S),T?(n.prop("title",this._messages.application_video_call_tooltip_screen_share_disabled),this._setButtonBarButtonColourCss(n,!1,!0)):S?(n.prop("title",this._messages.application_video_call_tooltip_stop_screen_share),this._setButtonBarButtonColourCss(n,!0,!1)):(n.prop("title",this._messages.application_video_call_tooltip_share_screen),this._setButtonBarButtonColourCss(n,!1,!1)),a.attr("aria-disabled",y||E),a.attr("aria-pressed",b),y?(a.prop("title",this._messages.application_video_call_tooltip_annotation_disabled),this._setButtonBarButtonColourCss(a,!1,!0)):b?(a.prop("title",this._messages.application_video_call_tooltip_stop_annotation),this._setButtonBarButtonColourCss(a,!0,!1)):(a.prop("title",this._messages.application_video_call_tooltip_annotate),this._setButtonBarButtonColourCss(a,!1,!1));const A=u||h||s||l||this._hideEndCallButton;r.attr("aria-disabled",A),A?r.prop("title",this._messages.application_universal_tooltip_end_call_disabled):r.prop("title",this._messages.application_universal_tooltip_end_call),this._setButtonBarEndButtonColourCss(!1,A)}_enableZoom(e){e?(this._liveZoom||(this._liveZoom=new o(this._customization)),this._liveZoom.disable(!1)):this._liveZoom&&this._liveZoom.disable(!0)}hideVideo(){$(".oracle-live").addClass("oracle-live-video-hide")}hideLocalVideo(){$(".oracle-live").addClass("oracle-live-video-local-hide")}swapCamera(){console.log("Swap the local camera"),this._impl._av.swapCamera()}displayMessageDialog(e){$(".oracle-live-dialog-title").text(this._messages[e+"Title"]),$(".oracle-live-dialog-message").text(this._messages[e+"Message"]),$(".oracle-live-dialog-ok").attr("aria-disabled","false"),$(".oracle-live-dialog-ok").text(this._messages.application_universal_button_close),this._showDialog(!0,!1)}closeMessageDialog(){return $(".oracle-live-dialog-ok").text()===this._messages.application_universal_button_close&&($(".oracle-live-dialog-ok").text(this._messages.application_universal_button_ok),this._showDialog(!1),!0)}showShareRequest(e,t){this._resetChromeScreenSharePluginClasses(),e?("associate-screenshare"===t?($(".oracle-live-dialog-title").text(this._messages.application_universal_title_remote_add_screen_share),$(".oracle-live-dialog-message").text(this._messages.application_universal_message_remote_add_screen_share)):"user-screenshare"===t?($(".oracle-live-dialog-title").text(this._messages.application_video_call_title_share_screen_request),$(".oracle-live-dialog-message").text(this._messages.application_video_call_message_you_can_stop_screen_share)):"user-video"===t?($(".oracle-live-dialog-title").text(this._messages.application_video_call_message_see_surroundings),this._hidePauseButton?$(".oracle-live-dialog-message").text(this._messages.application_video_call_message_no_pause):$(".oracle-live-dialog-message").text(this._messages.application_video_call_message_pause)):console.log("showShareRequest: Unknown share type: '"+t+"'"),$(".oracle-live").addClass("oracle-live-share-media-request"),$(".oracle-live-dialog-ok").attr("aria-disabled","false"),$(".oracle-live-dialog-cancel").attr("aria-disabled","false"),this._showDialog(!0,!0)):($(".oracle-live").removeClass("oracle-live-share-media-request"),this._showDialog(!1)),this._updateMenuButtons()}_resetChromeScreenSharePluginClasses(){$(".oracle-live").removeClass("oracle-live-install-plugin-request"),$(".oracle-live").removeClass("oracle-live-installing-plugin"),$(".oracle-live").removeClass("oracle-live-installed-plugin"),$(".oracle-live-dialog-ok").text(this._messages.application_universal_button_ok)}showInstallChromeScreenSharePluginRequest(e){console.log("showInstallChromeScreenSharePluginRequest: show="+e),this._resetChromeScreenSharePluginClasses(),e?($(".oracle-live-dialog-title").text(this._messages.application_screen_share_plugin_install_chrome),$(".oracle-live-dialog-message").text(this._messages.application_screen_share_plugin_install_permission_chrome),$(".oracle-live").addClass("oracle-live-install-plugin-request"),$(".oracle-live-dialog-ok").text(this._messages.application_screen_share_plugin_install_extension),$(".oracle-live-dialog-ok").attr("aria-disabled","false"),this._showDialog(!0,!1)):this._showDialog(!1),this._updateMenuButtons()}showInstallingChromeScreenSharePlugin(e){console.log("showInstallingChromeScreenSharePlugin: show="+e),this._resetChromeScreenSharePluginClasses(),e?($(".oracle-live-dialog-title").text(""),$(".oracle-live-dialog-message").text(this._messages.application_screen_share_plugin_installing_message_chrome),$(".oracle-live").addClass("oracle-live-installing-plugin"),$(".oracle-live-dialog-cancel").attr("aria-disabled","false"),this._showDialog(!0,!0)):this._showDialog(!1),this._updateMenuButtons()}showInstalledChromeScreenSharePlugin(e){console.log("showInstalledChromeScreenSharePlugin: show="+e),this._resetChromeScreenSharePluginClasses(),e?($(".oracle-live-dialog-title").text(this._messages.application_screen_share_plugin_installed_title_chrome),$(".oracle-live-dialog-message").text(this._messages.application_screen_share_plugin_installed_message_chrome),$(".oracle-live").addClass("oracle-live-installed-plugin"),$(".oracle-live-dialog-cancel").attr("aria-disabled","false"),$(".oracle-live-dialog-ok").text(this._messages.application_screen_share_plugin_installed_share_screen),this._showDialog(!0,!0)):this._showDialog(!1),this._updateMenuButtons()}setStartInVideo(e){e!==this._startInVideo&&(this._startInVideo=e,!0===this._idle&&(!0===this._startInVideo?$(".oracle-live").addClass("oracle-live-start-in-video"):$(".oracle-live").removeClass("oracle-live-start-in-video")))}setStartInScreenShare(e){console.log("LiveButtonMenu::setStartInScreenShare",e),e!==this._startInScreenShare&&(this._startInScreenShare=e,!0===this._idle&&(!0===this._startInScreenShare?$(".oracle-live").addClass("oracle-live-start-in-screenshare"):$(".oracle-live").removeClass("oracle-live-start-in-screenshare")))}setStartVideoInFullScreen(e){console.log("setStartVideoInFullScreen: "+e),this._startVideoInFullScreen=e}setStartVideoWithFrontCamera(e){console.log("setStartVideoWithFrontCamera: "+e),this._startVideoWithFrontCamera=e}setHideEndCallButton(e){console.log("setHideEndCallButton: "+e),this._hideEndCallButton=e}setHidePauseButton(e){console.log("setHidePauseButton: "+e),this._hidePauseButton=e}setHideQueueLengthIndicator(e){console.log("setQueueLengthIndicator: "+e),this._hideQueueLengthIndicator=e}setEndUserControlsCamera(e){console.log("setEndUserControlsCamera: "+e),this._endUserControlsCamera=e}setEndUserControlsScreenShare(e){console.log("setEndUserControlsScreenShare: "+e),this._endUserControlsScreenShare=e}setShortCodeMode(e){e!==this._shortCodeMode&&(this._shortCodeMode=e)}setPreCallIDCheck(e){console.log("LiveButtonMenu::setPreCallIDCheck setting _preCallIDCheck: ",e),e!==this._preCallIDCheck&&(this._preCallIDCheck=e)}getPreCallIDCheck(){return this._preCallIDCheck}updatePositionInQueue(e){e&&(console.log(`Setting positionInQueue: ${e}`),$(".oracle-live-position-in-queue").attr("tabindex",null),$(".oracle-live-position-in-queue").text(e),$(".oracle-live-position-in-queue").attr("aria-label",null))}_showNotification(){console.log("LiveButtonMenu::_showNotification"),this._notificationTimer&&clearTimeout(this._notificationTimer);const e=$(".oracle-live");e.removeClass("oracle-live-notification-show  oracle-live-notification-close"),setTimeout(()=>{e.addClass("oracle-live-notification-show")},10),this._notificationTimer=setTimeout(()=>{e.removeClass("oracle-live-notification-show  oracle-live-notification-close")},this._notificationUptime)}closeNotificationMessage(){console.log("LiveButtonMenu::closeNotificationMessage()"),$(".oracle-live").addClass("oracle-live-notification-close")}_removeActiveClasses(){console.log("LiveButtonMenu::_removeActiveClasses");const e=$(".oracle-live-pause-button");!0===this._hidePauseButton?this.hidePauseResumeButton():e.css("display","inline-block"),!0===this._hideEndCallButton&&this.hideEndCallButton(),$(".oracle-live").removeClass("oracle-live-disconnecting oracle-live-feedback").removeClass("oracle-live-paused-enduser oracle-live-paused-associate").removeClass("oracle-live-reconnecting-enduser oracle-live-reconnecting-associate").removeClass("oracle-live-show-dialog").removeClass("oracle-live-recording-on oracle-live-collapsed").removeClass("oracle-live-video-enduser oracle-live-video-enduser-on").removeClass("oracle-live-video-associate oracle-live-video-associate-on").removeClass("oracle-live-screenshare-enduser oracle-live-screenshare-enduser-on").removeClass("oracle-live-screenshare-associate oracle-live-screenshare-associate-on").removeClass("oracle-live-screenshare-associate-maximized").removeClass("oracle-live-screenshare-system-dialog").removeClass("oracle-live-video-associate-maximized").removeClass("oracle-live-video-enduser-maximized").removeClass("oracle-live-enduser-screenshare-annotation-on").removeClass("oracle-live-videopanel-toolbars-hidden")}_addEndUserAnnotationSupport(){console.log("LiveButtonMenu::_addEndUserAnnotationSupport"),this._canvas=$(".oracle-live-annotation-canvas"),this._canvasCtx=this._canvas[0].getContext("2d"),this._oldPosition={x:0,y:0};const e=e=>(this._oldPosition={x:e.clientX,y:e.clientY},!0);this._resizeAnnotationCanvas(),$(window).off("resize.oraclelive").on("resize.oraclelive",e=>(this._resizeAnnotationCanvas(),!0)),this._canvas.off("mousemove").on("mousemove",e=>{if(console.log("LiveButtonMenu::_addEndUserAnnotationSupport::draw"),1!==e.buttons)return!0;const t={x:e.clientX,y:e.clientY};return this._drawGraph(this._oldPosition,t),this._oldPosition=t,!0}).off("mousedown").on("mousedown",t=>{console.log("LiveButtonMenu::_addEndUserAnnotationSupport::startGraph"),this._clearAnnotations();const i=$(".oracle-live");i.addClass("oracle-live-enduser-annotation-hide");const o=document.elementFromPoint(t.clientX,t.clientY);return $(o).click(),i.removeClass("oracle-live-enduser-annotation-hide"),e(t)}).off("mouseenter").on("mouseenter",e)}_addAssociateAnnotationSupport(){console.log("LiveButtonMenu::_addAssociateAnnotationSupport()"),this._canvas=$(".oracle-live-annotation-canvas"),this._canvasCtx=this._canvas[0].getContext("2d"),this._oldPosition={x:0,y:0},this._resizeAnnotationCanvas(),$(window).off("resize.oraclelive").on("resize.oraclelive",e=>(this._resizeAnnotationCanvas(),!0)),this._canvas.off("mousedown").on("mousedown",e=>{const t=$(".oracle-live");t.addClass("oracle-live-enduser-annotation-hide");const i=document.elementFromPoint(e.clientX,e.clientY);$(i).click(),t.removeClass("oracle-live-enduser-annotation-hide")})}_addAssociateVideoAnnotationSupport(){console.log("LiveButtonMenu::_addAssociateVideoAnnotationSupport"),this._videoCanvas=$(".oracle-live-annotation-video-canvas"),this._videoCanvasCtx=this._videoCanvas[0].getContext("2d"),this._oldPosition={x:0,y:0},this._resizeVideoAnnotationCanvas(),$(window).off("resize.oraclelive").on("resize.oraclelive",e=>(this._resizeVideoAnnotationCanvas(),!0)),this._videoCanvas.off("mousedown").on("mousedown",e=>{const t=$(".oracle-live");if(t.hasClass("oracle-live-frozen-annotation")||t.hasClass("oracle-live-annotation-associate-video-on"))return this._toggleTopbarAndToolbar(),!0;t.addClass("oracle-live-associate-annotation-video-hide");const i=document.elementFromPoint(e.clientX,e.clientY);$(i).click(),t.removeClass("oracle-live-associate-annotation-video-hide")})}_drawGraph(e,t){this._canvasCtx?(this._canvasCtx.beginPath(),this._canvasCtx.lineWidth=3,this._canvasCtx.lineCap="round",this._canvasCtx.strokeStyle||(this._canvasCtx.strokeStyle="#FF0000"),this._canvasCtx.moveTo(e.x,e.y),this._canvasCtx.lineTo(t.x,t.y),this._canvasCtx.stroke()):console.log("LiveButtonMenu::_drawGraph has no canvas context")}_drawVideoGraph(e,t){this._videoCanvasCtx?(this._videoCanvasCtx.beginPath(),this._videoCanvasCtx.lineWidth=3,this._videoCanvasCtx.lineCap="round",this._videoCanvasCtx.strokeStyle||(this._videoCanvasCtx.strokeStyle="#FF0000"),this._videoCanvasCtx.moveTo(e.x,e.y),this._videoCanvasCtx.lineTo(t.x,t.y),this._videoCanvasCtx.stroke()):console.log("LiveButtonMenu::_drawVideoGraph has no canvas context")}_removeAnnotationSupport(){this._clearAnnotations(),$(window).off("resize.oraclelive"),$(".oracle-live-annotation-canvas").off("mousemove").off("mousedown").off("mouseenter"),this._canvas=null,this._canvasCtx=null,this._annotationList=[]}_removeVideoAnnotationSupport(){console.log("_removeVideoAnnotationSupport:"),this._clearVideoAnnotations(),$(window).off("resize.oraclelive"),$(".oracle-live-annotation-video-canvas").off("mousemove").off("mousedown").off("mouseenter"),this._videoCanvas=null,this._videoCanvasCtx=null,this._videoAnnotationList=[]}_resizeAnnotationCanvas(){if(!this._canvasCtx)return;const e=window.innerWidth,t=window.innerHeight;this._canvasCtx&&this._canvasCtx.canvas?(this._canvasCtx.canvas.width=e,this._canvasCtx.canvas.height=t,console.log("LiveButtonMenu::_resizeAnnotationCanvas, success this time")):console.error("LiveButtonMenu::_resizeAnnotationCanvas, no canvas found!")}_resizeVideoAnnotationCanvas(){const e=$(".oracle-live");if(this._videoCanvasCtx)if(e.hasClass("oracle-live-video-enduser-maximized")){const e=window.innerWidth,t=window.innerHeight;this._videoCanvasCtx&&this._videoCanvasCtx.canvas?(this._videoCanvasCtx.canvas.width=e,this._videoCanvasCtx.canvas.height=t-44,this.redrawVideoAnnotations(),console.log("LiveButtonMenu::_resizeVideoAnnotationCanvas, success this time")):console.error("LiveButtonMenu::_resizeVideoAnnotationCanvas, no canvas found!")}else{const e=350,t=262;this._videoCanvasCtx.canvas.width=e,this._videoCanvasCtx.canvas.height=t,this.redrawVideoAnnotations()}}_clearAnnotations(){this._canvasCtx&&(this._canvasCtx.clearRect(0,0,this._canvasCtx.canvas.width,this._canvasCtx.canvas.height),this._annotationList=[])}_clearVideoAnnotations(){console.log("_clearVideoAnnotations"),this._videoCanvasCtx&&(this._videoCanvasCtx.clearRect(0,0,this._videoCanvasCtx.canvas.width,this._videoCanvasCtx.canvas.height),this._videoAnnotationList=[])}}}),liveRequire.define("LiveState",["LiveEvents","LiveButtonMenu","LiveSessionStore"],function(LiveEvents,LiveButtonMenu,LiveSessionStore){"use strict";const Paused={None:"None",Local:"Local",Remote:"Remote"},Name={Idle:"Idle",Connecting:"Connecting",Connected:"Connected",Transferring:"Transferring",ReconnectingLocal:"ReconnectingLocal",ReconnectingRemote:"ReconnectingRemote",Disconnecting:"Disconnecting",Disconnected:"Disconnected",PreCallIDCheck:"PreCallIDCheck"},TransferState={None:"None",Started:"Started",AssociateObtained:"AssociateObtained",RemoveOriginalAssociate:"RemoveOriginalAssociate"},Rating={Poor:1,Good:50,Excellent:100};class AbstractState{constructor(e){if(new.target===AbstractState)throw"Cannot instantiate abstract State";this._context=e}get context(){return this._context}get name(){return"Invalid"}enter(){}leave(){}start(){}pause(){}toggleVideo(){}toggleScreenShare(){}toggleScreenShareAnnotate(){}end(){}notification_close(){console.log("Close notification")}dialog_ok(){return this.context.menu.closeMessageDialog()}dialog_cancel(){console.log("Dialog Cancel ignored")}video_preview_start(){console.log("Start in video preview ignored")}video_preview_cancel(){console.log("Cancel in video preview ignored")}poor(){}good(){}excellent(){}changeSize(e){}hideVideo(){}hideLocalVideo(){}swapCamera(){}event(e,t){switch(e){case LiveEvents.LiveMessageEmitted:this.context.menu.displayMessageDialog(t);break;default:console.log("Ignore event: "+e,t||"")}}remoteResume(){this.context.paused===Paused.Remote&&(this.context.paused=Paused.None,this.context.menu.setPausedByAssociate(!1))}remotePause(){this.context.paused===Paused.None&&(this.context.paused=Paused.Remote,this.context.menu.setPausedByAssociate(!0))}localPauseResume(){if(console.log("LiveState::localPauseResume, previewActive="+this.context.previewActive+", oldPausedState="+this.context.paused),!0!==this.context.previewActive)switch(this.context.paused){case Paused.None:this.context.paused=Paused.Local,this.context.menu.setPausedByUser(!0),this.context.controller.holdCallWithAssociate();break;case Paused.Local:this.context.paused=Paused.None,this.context.menu.setPausedByUser(!1),this.context.controller.resumeCallWithAssociate()}else console.log("Ignore pause/resume when preview is active")}remoteUpgrade(){console.log("remoteUpgrade"),this.context.associateVideoOn=!0,this.context.maximizedFeed=null,this.context.menu.setAssociateVideoOn(!0)}reset(){this.context.state=Idle}collapseExpand(){this.context.collapsed=!this.context.collapsed,this.context.menu.setCollapsed(this.context.collapsed),this.context.collapsed?this._maximizedFeed=null:this.context.hiddenVideo&&(this.context.hiddenVideo=!1)}startCall(){this.context.menu.showStartCallDialog(!1),console.log("Idle::start requirePreview="+this.context.isStartWithEndUserVideo()),console.log("Idle::start isPreCallIDCheck="+this.context.isPreCallIDCheck()),this.context.isPreCallIDCheck()?(console.log("LiveState: about to initiate a preCallIDCheck"),this.context.state=PreCallIDCheck):this.context.isStartWithEndUserVideo()?(this.context.previewActive=!0,this.context.controller.startVideoPreview(),this.context.menu.showVideoPreview(!0)):this.context.state=Connecting}endCall(){this.context.controller.endCallWithAssociate(),this.context.menu.showVideoPreview(!1),this.context.controller.stopVideoPreview(!0),this.context.state=Idle}maximizeAssociateScreenShare(){this.context.controller._permanentTwoWayScreenShare||"associateVideo"===this.context.menu.getMaximizedFeed()&&this.context.menu.maximize("associateScreenShare",!0)}}class Idle extends AbstractState{constructor(e,t){console.log("Constructor for Idle State",e,t),super(e),super.context.menu.setIdle(),super.context.configureComponent(),super.context.controller.service.startCallDirectly&&super.context.menu.hideComponent()}get name(){return Name.Idle}start(){super.context.isMeeting||super.context.isPreCallIDCheck()||super.context.controller.service.startCallDirectly?super.startCall():super.context.previewActive||super.context.menu.showStartCallDialog(!0)}dialog_ok(){super.dialog_ok()||super.startCall()}dialog_cancel(){super.context.menu.showStartCallDialog(!1)}video_preview_start(){super.context.state=Connecting,super.context.previewActive=!1,super.context.menu.setEndUserVideoOn(!0)}video_preview_cancel(){super.context.previewActive=!1,super.context.menu.showVideoPreview(!1),super.context.controller.stopVideoPreview(!0),super.context.controller.service.startCallDirectly&&super.context.menu.hideComponent()}changeSize(e){const t=e!==super.context.menu.getMaximizedFeed();super.context.menu.maximize(e,t),this.maximizedFeed=t?e:null}swapCamera(){super.context.menu.swapCamera()}verificationTryAgain(){console.log("LiveState::idle::verificationTryAgain"),this.context.controller.resetPreCallIDCheckState()}event(e,t){switch(e){case LiveEvents.LiveStartCall:this.start();break;case LiveEvents.LiveCanceled:super.context.menu.setCancelled(!0);break;case LiveEvents.LiveNetworkPoor:super.context.menu.setPoorNetwork(!0);break;case LiveEvents.LiveNetworkNormal:super.context.menu.setPoorNetwork(!1);break;case LiveEvents.LiveDiagnosticsAudioVideoStarted:super.context.menu.setDiagnostics(!0,"video");break;case LiveEvents.LiveDiagnosticsAudioStarted:super.context.menu.setDiagnostics(!0,"audio");break;case LiveEvents.LiveDiagnosticsComplete:super.context.menu.setDiagnostics(!1);break;case LiveEvents.LiveLocalVideoStopped:super.context.previewActive&&(console.log("Cannot show video preview - continue as audio"),this.video_preview_cancel(),super.context.state=Connecting);break;default:super.event(e,t)}}}class Connecting extends AbstractState{constructor(e,t){super(e);const i=super.context.isShortCodeEnabled(),o=super.context.isMeeting;console.log("LiveState::shortCodeEnabled =",i),o&&console.log("LiveState::isMeeting, ignoring shortCodeEnabled");let n=null;!o&&i&&(n=super.context.controller.generateShortCode(),console.log("Short code is ",n)),super.context.menu.setConnecting(n),super.context.controller.startCallWithAssociate(null,n)}get name(){return Name.Connecting}enter(){super.enter(),super.context.menu.setConnectingAudio(!0)}leave(){super.leave(),super.context.menu.setConnectingAudio(!1)}start(){super.endCall()}startLocalVideo(){super.context.controller.startVideoPreview()}end(){super.endCall()}changeSize(e){const t=e!==super.context.menu.getMaximizedFeed();super.context.menu.maximize(e,t),this.maximizedFeed=t?e:null}swapCamera(){super.context.menu.swapCamera()}event(e,t){switch(e){case LiveEvents.LiveWaiting:super.context.menu.setWaiting(!0);break;case LiveEvents.LiveCanceled:super.context.menu.setCancelled(!0);break;case LiveEvents.LiveConnecting:super.context.menu.setWaiting(!1);break;case LiveEvents.LiveConnected:super.context.state=Connected;break;case LiveEvents.LiveConnectingNoAnswer:super.context.state=Disconnected,super.context.menu.setDisconnected(!1,e);break;case LiveEvents.LiveParticipantLeft:case LiveEvents.LiveEnded:super.endCall();break;case LiveEvents.LiveRecordingStarted:super.context.menu.setRecording(!0);break;case LiveEvents.LiveRecordingStopped:super.context.menu.setRecording(!1);break;case LiveEvents.LiveRatingRequired:super.context.ratingRequired=!0;break;case LiveEvents.LiveRemoteVideoStarted:console.log("LiveState::Got LiveRemoteVideoStarted"),super.remoteUpgrade();break;case LiveEvents.LiveRemoteVideoStopped:super.context.associateVideoOn=!1,super.context.menu.setAssociateVideoOn(!1);break;case LiveEvents.LiveLocalVideoStarted:console.log("LiveState::Got LiveLocalVideoStarted"),super.context.userVideoOn=!0,super.context.menu.setEndUserVideoOn(!0);break;case LiveEvents.LiveLocalVideoStopped:super.context.userVideoOn=!1,super.context.menu.setEndUserVideoOn(!1);break;case LiveEvents.LiveNetworkPoor:super.context.menu.setPoorNetwork(!0);break;case LiveEvents.LiveNetworkNormal:super.context.menu.setPoorNetwork(!1);break;case LiveEvents.LiveDiagnosticsAudioVideoStarted:super.context.menu.setDiagnostics(!0,"video");break;case LiveEvents.LiveDiagnosticsAudioStarted:super.context.menu.setDiagnostics(!0,"audio");break;case LiveEvents.LiveDiagnosticsComplete:super.context.menu.setDiagnostics(!1);break;case LiveEvents.LiveDiagnosticsFailed:super.context.state=Disconnected,super.context.menu.setDisconnected(!1,e);break;case LiveEvents.LiveCallQueuePositionUpdate:super.context.menu.updatePositionInQueue(super.context.controller.getPositionInQueue());break;default:super.event(e,t)}}}class Connected extends AbstractState{constructor(e,t){super(e),t===Name.Connecting&&super.context.menu.setConnected()}get name(){return Name.Connected}enter(){super.enter()}leave(){super.leave()}start(){super.collapseExpand()}pause(){super.localPauseResume()}toggleVideo(){super.context.paused===Paused.None?super.context.userVideoOn?(super.context.userVideoOn=!1,super.context.menu.setEndUserVideoOn(!1),super.context.controller.downgradeLocalVideo()):super.context.isEndUserVideoPossible()&&(super.context.previewActive=!0,super.context.controller.startVideoPreview(),super.context.menu.showVideoPreview(!0)):console.log("Ignore video button in paused state",super.context.paused)}toggleScreenShare(){super.context.paused===Paused.None?super.context.userScreenShareOn?super.context.controller.sendScreenShare(!1):super.context.isEndUserScreenSharePossible()&&super.context.controller.sendScreenShare(!0):console.log("Ignore video button in paused state",super.context.paused)}toggleScreenShareAnnotate(){super.context.userScreenShareOn&&(super.context.menu.isEndUserAnnotationOn()?super.context.menu.setEndUserAnnotationOn(!1):super.context.menu.setEndUserAnnotationOn(!0),super.context.userScreenShareAnnotationOn=super.context.menu.isEndUserAnnotationOn())}video_preview_start(){super.context.previewActive=!1,super.context.menu.setEndUserVideoOn(!0),console.log("Connected::preview-start: associateVideoOn=",super.context.associateVideoOn),super.context.controller.upgradeLocalVideo()}video_preview_cancel(){super.context.previewActive=!1,super.context.controller.stopVideoPreview(!1),super.context.menu.showVideoPreview(!1)}end(){super.context.state=Disconnecting}changeSize(e){console.log("LiveState::changeSize: feed ="+e+", max feed=",super.context.menu.getMaximizedFeed()),console.log("LiveState::changeSize: maximizedFeed = "+super.context.menu.getMaximizedFeed());const t=e!==super.context.menu.getMaximizedFeed();console.log("LiveState::changeSize: maximize = "+t),super.context.menu.maximize(e,t),this.maximizedFeed=t?e:null}hideVideo(){super.context.hiddenVideo=!0,super.context.menu.hideVideo()}hideLocalVideo(){super.context.hiddenLocalVideo=!0,super.context.menu.hideLocalVideo()}swapCamera(){super.context.menu.swapCamera()}dialog_ok(){if(!super.dialog_ok()){if($(".oracle-live").hasClass("oracle-live-install-plugin-request"))return console.log("The user is permitting the chrome plugin install!"),super.context.menu.showInstallChromeScreenSharePluginRequest(!1),void super.context.controller.installChromeScreenSharePlugin();if($(".oracle-live").hasClass("oracle-live-installed-plugin"))return console.log("The user is confirming the offer to share screen after the plugin install"),super.context.menu.showInstalledChromeScreenSharePlugin(!1),void super.context.controller.sendScreenShare(!0);if($(".oracle-live").hasClass("oracle-live-unfreeze-annotation"))return console.log("The user is confirming unfreezing annotation"),super.context.menu.showUnfreezeAnnotationDialog(!1),super.context.menu.setFrozenAnnotationOn(!1),void super.context.menu.setAssociateVideoAnnotationOn(!1,!0);super.context.menu.showShareRequest(!1),super.context.controller.upgradeRequestIsAssociateScreenShare()?super.context.controller.acceptUpgradeRequest():super.context.controller.upgradeRequestIsUserScreenShare()?this.toggleScreenShare():(super.context.previewActive=!0,super.context.controller.startVideoPreview(),super.context.menu.showVideoPreview(!0))}}dialog_cancel(){return $(".oracle-live").hasClass("oracle-live-install-plugin-request")?(console.log("The user is declining the offer to install the chrome plugin"),super.context.menu.showInstallChromeScreenSharePluginRequest(!1),void super.context.controller.declineUpgradeRequest()):$(".oracle-live").hasClass("oracle-live-installing-plugin")?(console.log("The user is canceling the wait for the chrome plugin install"),super.context.menu.showInstallingChromeScreenSharePlugin(!1),void super.context.controller.cancelChromeScreenSharePluginInstall()):$(".oracle-live").hasClass("oracle-live-installed-plugin")?(console.log("The user is canceling the offer to share screen after the plugin install"),super.context.menu.showInstalledChromeScreenSharePlugin(!1),void super.context.controller.declineUpgradeRequest()):$(".oracle-live").hasClass("oracle-live-unfreeze-annotation")?($("body").css("visibility","hidden"),$(".oracle-live").css("visibility","visible"),console.log("The user is canceling the unfreeze annotation"),void super.context.menu.showUnfreezeAnnotationDialog(!1)):(super.context.menu.showShareRequest(!1),void super.context.controller.declineUpgradeRequest())}notification_close(){console.log("Close notification"),super.context.menu.closeNotificationMessage()}event(e,t){switch(e){case LiveEvents.LiveParticipantLeft:console.log("Connected:LiveParticipantLeft: -> ParticipantLeft"),console.log("TRANSFER: TransferState = "+super.context.transferState),super.context.transferState===TransferState.RemoveOriginalAssociate?(console.log("TRANSFER: TransferingCall: Participant has left. Checking to switchover streams..."),super.context._controller._av.switchOverTransferStream(t)):(console.log("Not a transfer call, so disconnecting call."),super.context.state=Disconnected);break;case LiveEvents.LiveEnded:super.context.state=Disconnected;break;case LiveEvents.LiveReconnectingLocal:super.context.state=ReconnectingLocal;break;case LiveEvents.LiveReconnectingRemote:super.context.state=ReconnectingRemote;break;case LiveEvents.LivePausedRemotely:super.remotePause();break;case LiveEvents.LiveResumedRemotely:super.remoteResume();break;case LiveEvents.LiveScreenSharePluginRequired:console.log("Trying to show the Chrome plugin install permission dialog"),super.context.menu.showInstallChromeScreenSharePluginRequest(!0);break;case LiveEvents.LiveScreenSharePluginInstalling:console.log("Showing a dialog that the Chrome plugin install is in progress"),super.context.menu.showInstallingChromeScreenSharePlugin(!0);break;case LiveEvents.LiveScreenSharePluginInstalled:console.log("Closing the dialog that the Chrome plugin install is in progress"),super.context.menu.showInstallingChromeScreenSharePlugin(!1),super.context.menu.showInstalledChromeScreenSharePlugin(!0);break;case LiveEvents.LiveStartVideoRequested:super.context.menu.showShareRequest(!0,"user-video");break;case LiveEvents.LiveRemoteScreenShareRequested:super.context.menu.showShareRequest(!0,"associate-screenshare");break;case LiveEvents.LiveStartScreenShareRequested:super.context.menu.showShareRequest(!0,"user-screenshare");break;case LiveEvents.LiveStartVideoRequestCancelled:case LiveEvents.LiveRemoteScreenShareCancelled:case LiveEvents.LiveStartScreenShareRequestCancelled:super.context.menu.showShareRequest(!1);break;case LiveEvents.LiveRemoteVideoStarted:super.remoteUpgrade();break;case LiveEvents.LiveRemoteVideoStopped:super.context.associateVideoOn=!1,super.context.menu.setAssociateVideoOn(!1);break;case LiveEvents.LiveRemoteVideoLoading:super.context.menu.setVideoLoading(!0);break;case LiveEvents.LiveRemoteVideoLoaded:super.context.menu.setVideoLoading(!1);break;case LiveEvents.LiveLocalVideoStarted:super.context.userVideoOn=!0,super.context.menu.setEndUserVideoOn(!0);break;case LiveEvents.LiveLocalVideoStopped:super.context.userVideoOn=!1,super.context.menu.setEndUserVideoOn(!1);break;case LiveEvents.LiveRecordingStarted:super.context.menu.setRecording(!0);break;case LiveEvents.LiveRecordingStopped:super.context.menu.setRecording(!1);break;case LiveEvents.LiveRatingRequired:super.context.ratingRequired=!0;break;case LiveEvents.LiveRemoteScreenStarted:super.context.associateScreenOn=!0,super.context.menu.setAssociateScreenShareOn(!0),this.context.controller._permanentTwoWayScreenShare&&this.context.menu.maximize("associateScreenShare",!0);break;case LiveEvents.LiveRemoteScreenStopped:super.context.associateScreenOn=!1,super.context.menu.setAssociateScreenShareOn(!1);break;case LiveEvents.LiveRemoteScreenActive:super.maximizeAssociateScreenShare();break;case LiveEvents.LiveLocalScreenStarted:super.context.userScreenShareOn=!0,super.context.menu.setEndUserScreenShareOn(!0);break;case LiveEvents.LiveLocalScreenStopped:super.context.userScreenShareOn=!1,super.context.menu.setEndUserScreenShareOn(!1);break;case LiveEvents.LiveNetworkPoor:super.context.menu.setPoorNetwork(!0);break;case LiveEvents.LiveNetworkNormal:super.context.menu.setPoorNetwork(!1);break;case LiveEvents.LiveSystemScreenShareDialogShowing:super.context.menu.setScreenShareDialogShowing(!0);break;case LiveEvents.LiveSystemScreenShareDialogRemoved:super.context.menu.setScreenShareDialogShowing(!1);break;case LiveEvents.LiveAssociateAnnotationStarted:super.context.menu.setAssociateAnnotationOn(!0);break;case LiveEvents.LiveAssociateAnnotationStopped:super.context.menu.setAssociateAnnotationOn(!1);break;case LiveEvents.LiveAssociateAnnotationReceived:super.context.menu.displayAssociateAnnotation(t);break;case LiveEvents.LiveAssociateVideoAnnotationStarted:super.context.menu.setAssociateVideoAnnotationOn(!0);break;case LiveEvents.LiveAssociateVideoAnnotationStopped:super.context.menu.setAssociateVideoAnnotationOn(!1);break;case LiveEvents.LiveAssociateVideoAnnotationReceived:super.context.menu.displayAssociateVideoAnnotation(t);break;case LiveEvents.LiveAssociateFreezeCustomerStream:super.context.menu.setFrozenAnnotationOn(!0);break;case LiveEvents.LiveAssociateUnfreezeCustomerStream:super.context.menu.setFrozenAnnotationOn(!1,!0);break;case LiveEvents.LiveAssociateTransferStarted:console.log("TRANSFER: Connected: TransferStarted"),super.context.userScreenShareOn&&(console.log("TRANSFER: Turning screenshare off when transfer starts"),this.toggleScreenShare()),super.context.state=Transferring;break;default:super.event(e,t)}}unfreezeAnnotation(){const e=$(".oracle-live");e.hasClass("oracle-live-paused-associate")||(e.hasClass("oracle-live-frozen-annotation")?super.context.menu.showUnfreezeAnnotationDialog(!0):super.context.menu.setAssociateVideoAnnotationOn(!1,!0))}}class Transferring extends AbstractState{constructor(e,t){super(e),super.context.menu.setTransferringToAnotherAssociate(!0)}get name(){return Name.Transferring}enter(){super.enter()}leave(){super.leave()}start(){}end(){}event(e,t){switch(e){case LiveEvents.LiveAssociateTransferStartStream:console.log("Transferring: TransferStartStream");break;case LiveEvents.LiveAssociateTransferCompleted:console.log("Transferring: TransferComplete"),super.context.state=Connected,super.context.menu.setTransferredToAnotherAssociate(t),super.context.userScreenShareOn=!1;break;case LiveEvents.LiveAssociateTransferFailed:console.log("Transferring: TransferFailed"),super.context.state=Connected,super.context.menu.cancelCallTransfer();break;case LiveEvents.LiveAssociateTransferStopped:console.log("Transferring: TransferStopped"),super.context.state=Connected,super.context.menu.cancelCallTransfer();break;default:super.event(e,t)}}}class ReconnectingLocal extends AbstractState{constructor(e,t){super(e),super.context.menu.setReconnectingEndUser(!0)}get name(){return Name.ReconnectingLocal}enter(){super.enter()}leave(){super.leave()}start(){super.collapseExpand()}pause(){super.localPauseResume()}end(){super.context.state=Disconnecting}notification_close(){console.log("Close notification"),super.context.menu.closeNotificationMessage()}event(e,t){switch(e){case LiveEvents.LiveEnded:super.context.state=Disconnected;break;case LiveEvents.LiveStreamActive:case LiveEvents.LiveReconnectedLocal:super.context.menu.setPoorNetwork(!1),super.context.menu.setReconnectingEndUser(!1),super.context.controller.sendNetworkStatus("network_recover"),super.context.state=Connected;break;case LiveEvents.LivePausedRemotely:super.remotePause();break;case LiveEvents.LiveResumedRemotely:super.remoteResume();break;case LiveEvents.LiveRecordingStarted:super.context.menu.setRecording(!0);break;case LiveEvents.LiveRecordingStopped:super.context.menu.setRecording(!1);break;case LiveEvents.LiveRatingRequired:super.context.ratingRequired=!0;break;case LiveEvents.LiveParticipantLeft:super.context.state=Disconnected,super.context.menu.setDisconnected(!1,e);break;default:super.event(e,t)}}}class ReconnectingRemote extends AbstractState{constructor(e,t){super(e),super.context.menu.setReconnectingAssociate(!0)}get name(){return Name.ReconnectingRemote}enter(){super.enter()}leave(){super.leave()}start(){super.collapseExpand()}pause(){super.localPauseResume()}end(){super.context.state=Disconnecting}notification_close(){console.log("Close notification"),super.context.menu.closeNotificationMessage()}event(e,t){switch(e){case LiveEvents.LiveEnded:super.context.state=Disconnected;break;case LiveEvents.LiveReconnectedRemote:super.context.menu.setReconnectingAssociate(!1),super.context.state=Connected;break;case LiveEvents.LivePausedRemotely:super.remotePause();break;case LiveEvents.LiveResumedRemotely:super.remoteResume();break;case LiveEvents.LiveRecordingStarted:super.context.menu.setRecording(!0);break;case LiveEvents.LiveRecordingStopped:super.context.menu.setRecording(!1);break;case LiveEvents.LiveRatingRequired:super.context.ratingRequired=!0;break;case LiveEvents.LiveParticipantLeft:super.context.state=Disconnected,super.context.menu.setDisconnected(!1,e);break;case LiveEvents.LiveNetworkPoor:super.context.menu.setPoorNetwork(!0);break;case LiveEvents.LiveNetworkNormal:super.context.menu.setPoorNetwork(!1);break;default:super.event(e,t)}}}class Disconnecting extends AbstractState{constructor(e,t){super(e),super.context.menu.setDisconnecting(!0)}get name(){return Name.Disconnecting}dialog_ok(){super.dialog_ok()||(super.context.state=Disconnected)}dialog_cancel(){super.context.menu.setDisconnecting(!1),super.context.state=Connected}notification_close(){console.log("Close notification"),super.context.menu.closeNotificationMessage()}event(e,t){switch(e){case LiveEvents.LiveEnded:super.context.state=Disconnected;break;case LiveEvents.LiveReconnectedRemote:super.context.menu.setReconnectingAssociate(!1),super.context.state=Connected;break;case LiveEvents.LivePausedRemotely:super.remotePause();break;case LiveEvents.LiveResumedRemotely:super.remoteResume();break;case LiveEvents.LiveRecordingStarted:super.context.menu.setRecording(!0);break;case LiveEvents.LiveRecordingStopped:super.context.menu.setRecording(!1);break;case LiveEvents.LiveRatingRequired:super.context.ratingRequired=!0;break;case LiveEvents.LiveNetworkPoor:super.context.menu.setPoorNetwork(!0);break;case LiveEvents.LiveNetworkNormal:super.context.menu.setPoorNetwork(!1);break;case LiveEvents.LiveLocalVideoStopped:super.context.userVideoOn=!1,super.context.menu.setEndUserVideoOn(!1);break;default:super.event(e,t)}}}class Disconnected extends AbstractState{constructor(e,t){super(e);try{super.context.controller.endCallWithAssociate()}catch(e){console.error("LiveState::DISCONNECTED::could not end the call because of ",e)}super.context.menu.setDisconnected(super.context.ratingRequired)}get name(){return Name.Disconnected}notification_close(){console.log("Close notification"),super.context.menu.closeNotificationMessage()}dialog_ok(){if(!super.dialog_ok()){const e=super.context.rating;super.context.reset(),super.context.state=Idle,super.context.menu.sessionEnded(),e>0&&(super.context.controller._rest.sendPostCallRating(e,()=>{console.log("Submitted rating: "+e)}),super.context.controller.dispatchEvent(LiveEvents.LiveRatingCompleted))}super.context.menu.setAssociateName("")}enter(){super.enter(),super.context.controller._av.cancelTransferSwitchoverStream()}leave(){super.leave()}start(){super.context.isMeeting&&(console.log("Rejoin a meeting"),super.startCall())}dialog_cancel(){super.context.state=Idle}video_preview_start(){super.context.isMeeting&&(console.log("Rejoin a meeting"),super.context.state=Connecting,super.context.previewActive=!1,super.context.menu.setEndUserVideoOn(!0))}video_preview_cancel(){super.context.state=Idle,super.context.isMeeting&&super.context.menu.setCancelled(!0)}poor(){super.context.rating=Rating.Poor,super.context.menu.setRating("poor")}good(){super.context.rating=Rating.Good,super.context.menu.setRating("good")}excellent(){super.context.rating=Rating.Excellent,super.context.menu.setRating("excellent")}verificationSuccessContinue(){console.log("LiveState::disconnected::verificationSuccessContinue"),this.context.controller.resetPreCallIDCheckState(),super.context.state=Idle}verificationTryAgain(){console.log("LiveState::disconnected::verificationTryAgain"),this.context.controller.resetPreCallIDCheckState(),super.context.state=Idle}verificationEnd(){console.log("LiveState::disconnected::verificationEnd"),this.context.controller.removeClass(".oracle-live","oracle-live-preCallIDCheck-call-associate"),this.context.controller.removeClass(".oracle-live","oracle-live-preCallIDCheck-verifying"),this.context.controller.removeClass(".oracle-live","oracle-live-preCallIDCheck-verified"),this.context.controller.addClass(".oracle-live","oracle-live-preCallIDCheck-error")}}class PreCallIDCheck extends AbstractState{constructor(e,t){console.log("Constructor for PreCallIDCheck state",e,t),super(e),this.context.menu.setPreCallIDCheck(!0),this.context.controller.startPreCallIDCheck(window)}get name(){return Name.PreCallIDCheck}startPreCallIDCheck(){console.log("LiveState::PreCallIDCheck::starting")}continueVerification(){console.log("LiveState::PreCallIDCheck::continueVerification"),this.context.controller.continueVerification()}verificationSuccessContinue(){console.log("LiveState::PreCallIDCheck::verificationSuccessContinue"),this.context.controller.resetPreCallIDCheckState(),super.context.state=Idle}verificationTryAgain(){console.log("LiveState::PreCallIDCheck::verificationTryAgain"),this.context.controller.resetPreCallIDCheckState(),super.context.state=Idle}verificationEnd(){console.log("LiveState::PreCallIDCheck::verificationEnd"),this.context.controller.removeClass(".oracle-live","oracle-live-preCallIDCheck-call-associate"),this.context.controller.removeClass(".oracle-live","oracle-live-preCallIDCheck-verifying"),this.context.controller.removeClass(".oracle-live","oracle-live-preCallIDCheck-verified"),this.context.controller.addClass(".oracle-live","oracle-live-preCallIDCheck-error"),this.context.controller.netVerificationCancelled()}video_preview_start(){console.log("LiveState::PreCallIDCheck::video_preview_start"),super.context.state=Connecting,super.context.previewActive=!1,super.context.menu.setEndUserVideoOn(!0)}video_preview_cancel(){console.log("LiveState::PreCallIDCheck::video_preview_cancel"),super.context.previewActive=!1,super.context.menu.showVideoPreview(!1),super.context.controller.stopVideoPreview(!0)}startAssociateVerificationCall(){console.log("LiveState::PreCallIDCheck::startAssociateVerificationCall"),this.context.isStartWithEndUserVideo()?(console.log("startAssociateVerificationCall: starting video preview"),this.context.previewActive=!0,this.context.controller.startVideoPreview(),this.context.menu.showVideoPreview(!0)):(console.log("startAssociateVerificationCall: moving to connecting state"),this.context.state=Connecting)}showRecordingDialog(){super.context.previewActive||super.context.menu.showStartCallDialog(!0)}dialog_ok(){super.dialog_ok()||(super.context.menu.showStartCallDialog(!1),this.startAssociateVerificationCall())}dialog_cancel(){super.context.menu.showStartCallDialog(!1)}event(e,t){switch(console.log("LiveState::PreCallIDCheck:event ",e,t),e){case LiveEvents.LiveCanceled:super.context.menu.setCancelled(!0);break;case LiveEvents.LiveStartVerificationCall:this.showRecordingDialog();break;case LiveEvents.LivePreCallIDCheckComplete:super.context.state=Idle;break;case LiveEvents.LiveDiagnosticsAudioVideoStarted:super.context.menu.setDiagnostics(!0,"video");break;case LiveEvents.LiveDiagnosticsAudioStarted:super.context.menu.setDiagnostics(!0,"audio");break;case LiveEvents.LiveDiagnosticsComplete:super.context.menu.setDiagnostics(!1);break;default:super.event(e,t)}}}class LiveState{constructor(e){this._controller=e,this._buttonMenu=new LiveButtonMenu(e),this._state=new Idle(this,null),this._stateName=this._state.name,this._isMeeting=!1,this._associateName=null,this._associatePhotoURL=null,this._connectingAudioURL=null,this._positionInQueue=0,this._paused=Paused.None,this._collapsed=!1,this._rating=0,console.log("LiveState::constructor Setting rating required to false"),this._ratingRequired=!1,this._transferState=TransferState.None,this._userVideo=!1,this._userScreen=!1,this._userScreenAnnotate=!1,this._associateVideo=!1,this._associateScreen=!1,this._previewActive=!1,this._hiddenVideo=!1,this._hiddenLocalVideo=!1,this._maximizedFeed=null,this._hideWhenIdle=!1,this._hidden=!1,this._available=!0,this._canRejoinMeeting=!0,this._messages=null,LiveSessionStore.initState("LiveState",this),$(()=>{LiveSessionStore.loadState("LiveState",e=>{const t=e.stateName;this._stateSupportsRehydration(t)&&(this._stateName=e.stateName,this._positionInQueue=e.positionInQueue,this._associateName=e.associateName,this._associatePhotoURL=e.associatePhotoURL,this._connectingAudioURL=e.connectingAudioURL,this._paused=e.paused,this._collapsed=!1,this._maximizedFeed=e.maximizedFeed,this._associateVideo=e.associateVideo,this._userVideo=e.userVideo,this._isMeeting=e.isMeeting,this._canRejoinMeeting=e.canRejoinMeeting,this._userScreenAnnotate=e.userScreenAnnotate,this._associateScreen=e.associateScreen,this._previewActive=e.previewActive,this._hiddenVideo=e.hiddenVideo,this._hiddenLocalVideo=e.hiddenLocalVideo,this._rating=e.rating,this._transferState=e.transferState,this._ratingRequired=e.ratingRequired,this._hideWhenIdle=e.hideWhenIdle,this._hidden=e.hidden,this._available=e.available,this._messages=e.messages,console.log("LiveState: Loaded"))})})}toJSON(){return this._stateSupportsRehydration(this._stateName)?JSON.stringify({stateName:this._stateName,positionInQueue:this._positionInQueue,associateName:this._associateName,associatePhotoURL:this._associatePhotoURL,connectingAudioURL:this._connectingAudioURL,isMeeting:this._isMeeting,canRejoinMeeting:this._canRejoinMeeting,paused:this._paused,userVideo:this._userVideo,userScreenAnnotate:this._userScreenAnnotate,associateVideo:this._associateVideo,associateScreen:this._associateScreen,previewActive:this._previewActive,hiddenVideo:this._hiddenVideo,hiddenLocalVideo:this._hiddenLocalVideo,rating:this._rating,transferState:this._transferState,ratingRequired:this._ratingRequired,hideWhenIdle:this._hideWhenIdle,hidden:this._hidden,available:this._available,messages:this._messages,maximizedFeed:this._maximizedFeed}):null}loadComplete(){if(console.log("LiveState::loadComplete"),!this._stateSupportsRehydration(this._stateName))return void console.log("We will not have restored our state, stay in Idle");const stateClass=eval(this._stateName);this._state=new stateClass(this,null),console.log("LiveState::loadComplete restored state: ",this.stateName,this._buttonMenu);let recoverLocalVideoView=!1;"Connected"===this._stateName?(this._buttonMenu.setConnected(!0),this._hidden?this.hideMenu():this.showMenu()):"Disconnecting"===this._stateName?(this._buttonMenu.setConnected(!0),this._buttonMenu.setDisconnecting(!0),this._hidden?this.hideMenu():this.showMenu()):this.isEndUserVideo()&&(recoverLocalVideoView=!0),this._buttonMenu.updatePositionInQueue(this._positionInQueue),this._buttonMenu.setAssociateName(this._associateName),this._buttonMenu.setAssociatePhoto(this._associatePhotoURL),this._buttonMenu.setConnectingAudioSource(this._connectingAudioURL),console.log("About to restore the paused state: "+this._paused),this._paused===Paused.Local?this._buttonMenu.setPausedByUser(!0):this._paused===Paused.Remote&&this._buttonMenu.setPausedByAssociate(!0),this._associateVideo&&(console.log("About to turn associate video back on"),this._buttonMenu.setAssociateVideoOn(!0)),this._associateScreen&&(console.log("About to turn associate screen back on"),this._buttonMenu.setAssociateScreenShareOn(!0)),this._previewActive&&this._buttonMenu.showVideoPreview(!0),(this._userVideo||recoverLocalVideoView)&&(console.log("About to turn end user video back on"),this._buttonMenu.setEndUserVideoOn(!0),this._controller.startVideoPreview()),this._userScreen&&this._buttonMenu.setEndUserScreenShareOn(!0),this._userScreenAnnotate&&this._buttonMenu.setEndUserAnnotationOn(!0),this._hiddenVideo&&this._buttonMenu.hideVideo(),this._hiddenLocalVideo&&this._buttonMenu.hideLocalVideo(),this._maximizedFeed&&this._buttonMenu.maximize(this._maximizedFeed,!0),this._buttonMenu.setStartVideoWithFrontCamera(this.isStartVideoWithFrontCamera()),this._buttonMenu.setStartVideoInFullScreen(this.isStartVideoInFullScreen()),this._buttonMenu.setHideEndCallButton(this.isHideEndCallButton()),this._buttonMenu.setHidePauseButton(this.isHidePauseButton()),this._buttonMenu.setHideQueueLengthIndicator(this.isHideQueueLengthIndicator())}reset(){console.log("LiveState::reset"),this._positionInQueue=0,this._associateName=null,this._associatePhotoURL=null,this._paused=Paused.None,this._collapsed=!1,this._maximizedFeed=null,this._associateVideo=!1,this._userVideo=!1,this._userScreen=!1,this._userScreenAnnotate=!1,this._associateScreen=!1,this._previewActive=!1,this._hiddenVideo=!1,this._hiddenLocalVideo=!1,this._canRejoinMeeting=!0,this._rating=0,this._transferState=TransferState.None,console.log("LiveState::reset Setting rating required to false"),this._ratingRequired=!1}set state(e){const t=this._state;this._state.leave(e),this._state=new e(this,t.name),this._state.enter(t),this._stateName=this.stateName,console.log("state transition: "+t.name+" -> "+this.stateName)}get state(){return this._state}get stateName(){return this.state.name}get menu(){return this._buttonMenu}get controller(){return this._controller}get associateName(){return this._associateName}set associateName(e){this._associateName=e,this._buttonMenu.setAssociateName(e)}get associatePhotoURL(){return this._associatePhotoURL}set associatePhotoURL(e){this._associatePhotoURL=e,this._buttonMenu.setAssociatePhoto(e)}set connectingAudioURL(e){this._connectingAudioURL=e,this._buttonMenu.setConnectingAudioSource(e)}get connectingAudioURL(){return this._connectingAudioURL}get paused(){return this._paused}set paused(e){this._paused=e}get collapsed(){return this._collapsed}set collapsed(e){this._collapsed=e}get associateVideoOn(){return this._associateVideo}set associateVideoOn(e){this._associateVideo=e}get userVideoOn(){return this._userVideo}set userVideoOn(e){this._userVideo=e}get userScreenShareOn(){return this._userScreen}set userScreenShareOn(e){this._userScreen=e}get userScreenShareAnnotationOn(){return this._userScreenAnnotate}set userScreenShareAnnotationOn(e){this._userScreenAnnotate=e,e?this._controller.sendAnnotationStart():this._controller.sendAnnotationStop()}get associateScreenOn(){return this._associateScreen}set associateScreenOn(e){this._associateScreen=e}get previewActive(){return this._previewActive}set previewActive(e){this._previewActive=e}get hiddenVideo(){return this._hiddenVideo}set hiddenVideo(e){this._hiddenVideo=e}get hiddenLocalVideo(){return this._hiddenLocalVideo}set hiddenLocalVideo(e){this._hiddenLocalVideo=e}get rating(){return this._rating}set rating(e){this._rating=e}get transferState(){return this._transferState}set transferState(e){this._transferState=e}get isMeeting(){return this._isMeeting}set isMeeting(e){this._isMeeting=e,this.menu._isMeeting=e}get canRejoinMeeting(){return this._canRejoinMeeting}set canRejoinMeeting(e){this._canRejoinMeeting=e,this.menu._canRejoinMeeting=e}get ratingRequired(){return console.log("Get ratingRequired",this._ratingRequired),this._ratingRequired}set ratingRequired(e){console.log("Setting ratingRequired to ",e),this._ratingRequired=e}set messages(e){this._messages=e}get messages(){return this._messages}isTransferring(){const e=this._transferState===TransferState.Started||this._transferState===TransferState.AssociateObtained;return console.log("Transfer: isTransferring: "+e+"("+this._transferState+")"),e}isEndUserVideo(){return this.controller._behaviours&&this.controller._behaviours.isEndUserVideo()}isEndUserVideoPossible(){return this.controller._behaviours&&this.controller._behaviours.isEndUserVideoPossible()}isEndUserControlsCamera(){const e=this.controller._behaviours&&this.controller._behaviours.isEndUserVideoPossible()&&!0===this.controller._behaviours.endUserCanAddVideo;return console.log("isEndUserControlsCamera: "+!!e),!!e}isEndUserScreenSharePossible(){return this.controller._behaviours&&this.controller._behaviours.isEndUserScreenSharePossible()}isEndUserControlsScreenShare(){const e=this.controller._behaviours&&this.controller._behaviours.isEndUserScreenSharePossible()&&!0===this.controller._behaviours.endUserCanAddScreenShare;return console.log("isEndUserControlsScreenShare: "+!!e),!!e}isAssociateAudioPossible(){return this.controller._behaviours&&this.controller._behaviours.isAssociateAudioPossible()}isAssociateVideoPossible(){return this.controller._behaviours&&this.controller._behaviours.isAssociateVideoPossible()}isStartWithEndUserVideo(){return this.controller._behaviours&&this.controller._behaviours.isStartWithEndUserVideo()}isStartWithAssociateVideo(){return this.controller._behaviours&&this.controller._behaviours.isStartWithAssociateVideo()}isStartWithEndUserScreenShare(){return this.controller._behaviours&&this.controller._behaviours.isStartWithEndUserScreenShare()}isShortCodeEnabled(){const e=!this.isMeeting&&this.controller._behaviours&&this.controller._behaviours.shortCodeEnabled;return console.log("LiveState::isShortCodeEnabled=",e),!0===e}isPreCallIDCheck(){return console.log("LiveState::isPreCallIDCheck=",this.controller._behaviours&&this.controller._behaviours.preCallIDCheck),!0===(this.controller._behaviours&&this.controller._behaviours.preCallIDCheck)}isStartVideoWithFrontCamera(){const e=(this.isMeeting||this._controller.settings.startVideoWithFrontCamera)&&this.isEndUserVideoPossible();return console.log("LiveState::isStartVideoWithFrontCamera=",e),!0===e}isStartVideoInFullScreen(){const e=(this.isMeeting||this._controller.settings.startVideoInFullScreen)&&(this.isAssociateVideoPossible()||this.isEndUserVideoPossible());return console.log("LiveState::isStartVideoInFullScreen=",e),!0===e}isHideEndCallButton(){return console.log("LiveState: isHideEndCallButton=",this._controller.settings.hideEndCallButton),!0===this._controller.settings.hideEndCallButton}isHidePauseButton(){return console.log("LiveState: isHidePauseButton=",this._controller.settings.hidePauseButton),!0===this._controller.settings.hidePauseButton}isHideQueueLengthIndicator(){return console.log("LiveState: isHideQueueLengthIndicator=",this._controller.settings.hideQueueLengthIndicator),!0===this._controller.settings.hideQueueLengthIndicator}addMenu(e){const t=this.controller.contextAttributes.get("meetingTitle");this._messages&&this.menu.setMessages(this._messages),this.controller._customization&&this.menu.setCustomization(this.controller._customization),this.menu.addComponent(this.controller._messages,this.controller._browserName,t),e?console.log("addMenu: refreshing - not returning to Idle state"):this.menu.setIdle(),this.configureComponent(),this._setClickHandlers(),this._hidden?this.hideMenu():this.showMenu(),this.controller.service.startCallDirectly&&(live.resumeAudioContext(),this.start())}updateMenu(){const e=this.stateName;console.log("updateMenu in state: "+e),e===Name.Idle&&this.configureComponent()}configureComponent(){const e=this.controller.contextAttributes.get("meetingTitle");this.menu.updateMessages(this.controller._messages,e),this.menu.setCustomization(this.controller._customization);const t=this.isStartWithEndUserVideo()||this.isStartWithAssociateVideo();this.menu.setStartInVideo(t),this.menu.setStartVideoWithFrontCamera(this.isStartVideoWithFrontCamera()),this.menu.setStartVideoInFullScreen(this.isStartVideoInFullScreen()),this.menu.setStartInScreenShare(this.isStartWithEndUserScreenShare()),this.menu.setShortCodeMode(this.isShortCodeEnabled()),this.menu.setPreCallIDCheck(this.isPreCallIDCheck()),this.menu.setHideEndCallButton(this.isHideEndCallButton()),this.menu.setHidePauseButton(this.isHidePauseButton()),this.menu.setHideQueueLengthIndicator(this.isHideQueueLengthIndicator()),this.configureBehaviours()}hidePauseResumeButton(){this.menu.hidePauseResumeButton()}hideQueueLengthIndicator(){console.log("hideQueueLengthIndicator"),this.menu.hideQueueLengthIndicator(this.isHideQueueLengthIndicator())}configureBehaviours(){this.menu.setEndUserControlsCamera(this.isEndUserControlsCamera()),this.menu.setEndUserControlsScreenShare(this.isEndUserControlsScreenShare())}_stateSupportsRehydration(e){let t="Connecting"===e||"Connected"===e||"Disconnecting"===e;return console.log("supportsRehydration("+e+") returning "+t),t}_setClickHandlers(){this._connectHandlers($(".oracle-live-main-button"),()=>{live.resumeAudioContext(),this.start()}),this._connectHandlers($(".oracle-live-exit-button"),()=>{this.end()}),this._connectHandlers($(".oracle-live-cancel-button"),()=>{this.end()}),this._connectHandlers($(".oracle-live-rejoin-button"),()=>{this.start()}),this._connectHandlers($(".oracle-live-pause-button"),()=>{this.pause()}),this._connectHandlers($(".oracle-live-video-button"),()=>{this.toggleVideo()}),this._connectHandlers($(".oracle-live-screenshare-button"),()=>{this.toggleScreenShare()}),this._connectHandlers($(".oracle-live-annotate-button"),()=>{this.toggleScreenShareAnnotate()}),this._connectHandlers($(".oracle-live-notificationmessage"),()=>{this.notification_close()}),this._connectHandlers($(".oracle-live-dialog-ok"),()=>{this.dialog_ok()}),this._connectHandlers($(".oracle-live-dialog-cancel"),()=>{this.dialog_cancel()}),this._connectHandlers($(".oracle-live-dialog-option-poor"),()=>{this.poor()}),this._connectHandlers($(".oracle-live-dialog-option-good"),()=>{this.good()}),this._connectHandlers($(".oracle-live-dialog-option-excellent"),()=>{this.excellent()}),this._connectHandlers($(".oracle-live-preview-start-button"),()=>{this.video_preview_start()}),this._connectHandlers($(".oracle-live-preview-cancel-button"),()=>{this.video_preview_cancel()}),this._connectHandlers($(".oracle-live-video-maximize"),e=>{if(e&&e.target){const t=e.target.getAttribute("name");this.changeSize(t)}}),this._connectHandlers($(".oracle-live-video-closeall"),()=>{this.hideVideo()}),this._connectHandlers($(".oracle-live-swap-camera"),()=>{this.swapCamera()}),this._connectHandlers($(".oracle-live-video-closelocal"),()=>{this.hideLocalVideo()}),this._connectHandlers($(".oracle-live-verification-continue-button"),()=>{this.continueVerification()}),this._connectHandlers($(".oracle-live-verification-success-button"),()=>{this.verificationSuccessContinue()}),this._connectHandlers($(".oracle-live-verification-try-again-button"),()=>{this.verificationTryAgain()}),this._connectHandlers($(".oracle-live-verification-close"),()=>{this.verificationEnd()}),this._connectHandlers($(".oracle-live-unfreeze-annotation-cross"),()=>{this.unfreezeAnnotation()})}_connectHandlers(e,t){e&&t||console.log("Missing component",e," or handler ",t),e.off("click").click(i=>{if(!0!==e.attr("aria-disabled")&&"true"!==e.attr("aria-disabled"))return t(i),!1;console.log("Clicked on component is disabled",e)}),e.off("keypress").keypress(i=>{if(!0===e.attr("aria-disabled")||"true"===e.attr("aria-disabled"))return;const o=i.keyCode||i.which;return 13===o||32===o?(t(i),!1):void 0})}showMenu(){this._available&&(this._hidden=!1,this._hideWhenIdle=!1,this.controller.service.startCallDirectly?console.log("Not showing menu, startCallDirectly flag is set"):(console.log("showMenu in state: "+this.stateName),this.menu.showComponent()))}hideMenu(){this._hidden=!0,console.log("hideMenu in state: "+this.stateName),this.stateName===Name.Idle?(this.menu.hideComponent(),this._hideWhenIdle=!1):(console.log("Cannot hide component in state: "+this.stateName+", will hide when Idle"),this._hideWhenIdle=!0)}setAvailable(e){this._available=e,console.log("LiveState::setAvailable: ",this._available)}isAvailable(){return this._available}hideWhenIdle(){this._hideWhenIdle&&this._hidden&&(this.menu.hideComponent(),this._hideWhenIdle=!1)}start(){console.log("click: start in state: "+this.stateName),this._state.start()}pause(){console.log("click: pause in state: "+this.stateName),this._state.pause()}toggleVideo(){console.log("click: video in state: "+this.stateName),this._state.toggleVideo()}toggleScreenShare(){console.log("click: toggle screen share in state: "+this.stateName),this._state.toggleScreenShare()}toggleScreenShareAnnotate(){console.log("click: toggle screen share annotate in state: "+this.stateName),this._state.toggleScreenShareAnnotate()}end(){console.log("click: end in state: "+this.stateName),this._state.end()}notification_close(){console.log("click: X in state: "+this.stateName),this._state.notification_close()}dialog_ok(){console.log("click: ok in state: "+this.stateName),this._state.dialog_ok()}dialog_cancel(){console.log("click: cancel in state: "+this.stateName),this._state.dialog_cancel()}video_preview_start(){console.log("click: start video preview in state: "+this.stateName),this._state.video_preview_start()}video_preview_cancel(){console.log("click: cancel video preview in state: "+this.stateName),this._state.video_preview_cancel()}poor(){console.log("click: poor in state: "+this.stateName),this._state.poor()}good(){console.log("click: good in state: "+this.stateName),this._state.good()}excellent(){console.log("click: excellent in state: "+this.stateName),this._state.excellent()}changeSize(e){this._state.changeSize(e)}hideVideo(){console.log("click: hideVideo in state: "+this.stateName),this._state.hideVideo()}hideLocalVideo(){console.log("click: hideVideo in state: "+this.stateName),this._state.hideLocalVideo()}swapCamera(){console.log("click: swapCamera in state: "+this.stateName),this._state.swapCamera()}continueVerification(){console.log("click: continueVerification in state: "+this.stateName),this._state.continueVerification()}verificationSuccessContinue(){console.log("click: verificationSuccessContinue in state: "+this.stateName),this._state.verificationSuccessContinue()}verificationTryAgain(){console.log("click: verificationTryAgain in state: "+this.stateName),this._state.verificationTryAgain()}verificationEnd(){console.log("click: verificationEnd in state: "+this.stateName),this._state.verificationEnd()}unfreezeAnnotation(){$("body").css("visibility","visible"),console.log("click: veriunfreezeAnnotation in state: "+this.stateName),this._state.unfreezeAnnotation()}event(e,t){console.log("event: "+e+" in state: "+this.stateName),this._state.event(e,t)}}return LiveState}),function(e){"use strict";function t(){this.bitsNeeded=0,this.codePoint=0}function i(e){this.withCredentials=!1,this.responseType="",this.readyState=0,this.status=0,this.statusText="",this.responseText="",this.onprogress=A,this.onreadystatechange=A,this._contentType="",this._xhr=e,this._sendTimeout=0,this._abort=A}function o(e){return e.replace(/[A-Z]/g,function(e){return String.fromCharCode(e.charCodeAt(0)+32)})}function n(e){for(var t=Object.create(null),i=e.split("\r\n"),n=0;n<i.length;n+=1){var a=i[n].split(": "),r=a.shift(),s=a.join(": ");t[o(r)]=s}this._map=t}function a(){}function r(e){this._headers=e}function s(){}function l(){this._listeners=Object.create(null)}function c(e){g(function(){throw e},0)}function d(e){this.type=e,this.target=void 0}function u(e,t){d.call(this,e),this.data=t.data,this.lastEventId=t.lastEventId}function h(e,t){d.call(this,e),this.status=t.status,this.statusText=t.statusText,this.headers=t.headers}function p(e,t){l.call(this),this.onopen=void 0,this.onmessage=void 0,this.onerror=void 0,this.url=void 0,this.readyState=void 0,this.withCredentials=void 0,this._close=void 0,function(e,t,o){t=String(t);var n=void 0!=o&&Boolean(o.withCredentials),r=U(1e3),l=void 0!=o&&void 0!=o.heartbeatTimeout?V(o.heartbeatTimeout,45e3):U(45e3),p="",f=r,S=!1,_=void 0!=o&&void 0!=o.headers?JSON.parse(JSON.stringify(o.headers)):void 0,C=void 0!=o&&void 0!=o.Transport?o.Transport:v(),b=F?void 0:new i(new C),E=F?new s:new a,R=void 0,y=0,T=I,A="",q="",z="",H="",W=L,j=0,G=0,Y=function(t,i,o,n,a){if(T===w)if(R=a,200===t&&void 0!=o&&M.test(o)){T=k,S=!0,f=r,e.readyState=k;var s=new h("open",{status:t,statusText:i,headers:n});e.dispatchEvent(s),B(e,e.onopen,s)}else{var l="";200!==t?(i&&(i=i.replace(/\s+/g," ")),l="EventSource's response has a status "+t+" "+i+" that is not 200. Aborting the connection."):l="EventSource's response has a Content-Type specifying an unsupported type: "+(void 0==o?"-":o.replace(/\s+/g," "))+". Aborting the connection.",c(new Error(l)),K();var s=new h("error",{status:t,statusText:i,headers:n});e.dispatchEvent(s),B(e,e.onerror,s)}},J=function(t){if(T===k){for(var i=-1,o=0;o<t.length;o+=1){var n=t.charCodeAt(o);(n==="\n".charCodeAt(0)||n==="\r".charCodeAt(0))&&(i=o)}var a=(-1!==i?H:"")+t.slice(0,i+1);H=(-1===i?H:"")+t.slice(i+1),""!==a&&(S=!0);for(var s=0;s<a.length;s+=1){var n=a.charCodeAt(s);if(W===O&&n==="\n".charCodeAt(0))W=L;else if(W===O&&(W=L),n==="\r".charCodeAt(0)||n==="\n".charCodeAt(0)){if(W!==L){W===N&&(G=s+1);var c=a.slice(j,G-1),d=a.slice(G+(s>G&&a.charCodeAt(G)===" ".charCodeAt(0)?1:0),s);"data"===c?(A+="\n",A+=d):"id"===c?q=d:"event"===c?z=d:"retry"===c?(r=V(d,r),f=r):"heartbeatTimeout"===c&&(l=V(d,l),0!==y&&(m(y),y=g(function(){X()},l)))}if(W===L){if(""!==A){p=q,""===z&&(z="message");var h=new u(z,{data:A.slice(1),lastEventId:q});if(e.dispatchEvent(h),"message"===z&&B(e,e.onmessage,h),T===x)return}A="",z=""}W=n==="\r".charCodeAt(0)?O:L}else W===L&&(j=s,W=N),W===N?n===":".charCodeAt(0)&&(G=s+1,W=D):W===D&&(W=P)}}},Q=function(){if(T===k||T===w){T=I,0!==y&&(m(y),y=0),y=g(function(){X()},f),f=U(Math.min(16*r,2*f)),e.readyState=w;var t=new d("error");e.dispatchEvent(t),B(e,e.onerror,t)}},K=function(){T=x,void 0!=R&&(R(),R=void 0),0!==y&&(m(y),y=0),e.readyState=x},X=function(){if(y=0,T===I){S=!1,y=g(function(){X()},l),T=w,A="",z="",q=p,H="",j=0,G=0,W=L;var e=t;"data:"!==t.slice(0,5)&&"blob:"!==t.slice(0,5)&&""!==p&&(e+=(-1===t.indexOf("?")?"?":"&")+"lastEventId="+encodeURIComponent(p));var i={Accept:"text/event-stream"};if(void 0!=_)for(var o in _)Object.prototype.hasOwnProperty.call(_,o)&&(i[o]=_[o]);try{E.open(b,Y,J,Q,e,n,i)}catch(e){throw K(),e}}else S||void 0==R?(S=!1,y=g(function(){X()},l)):(c(new Error("No activity within "+l+" milliseconds. Reconnecting.")),R(),R=void 0)};e.url=t,e.readyState=w,e.withCredentials=n,e._close=K,X()}(this,e,t)}function v(){return f&&"withCredentials"in f.prototype?f:S}var g=e.setTimeout,m=e.clearTimeout,f=e.XMLHttpRequest,S=e.XDomainRequest,_=e.EventSource,C=e.document,b=e.Promise,E=e.fetch,R=e.Response,y=e.TextDecoder,T=e.TextEncoder;null==Object.create&&(Object.create=function(e){function t(){}return t.prototype=e,new t}),void 0!=b&&void 0==b.prototype.finally&&(b.prototype.finally=function(e){return this.then(function(t){return b.resolve(e()).then(function(){return t})},function(t){return b.resolve(e()).then(function(){throw t})})}),t.prototype.decode=function(e){function t(e,t,i){if(1===i)return e>=128>>t&&2047>=e<<t;if(2===i)return e>=2048>>t&&55295>=e<<t||e>=57344>>t&&65535>=e<<t;if(3===i)return e>=65536>>t&&1114111>=e<<t;throw new Error}function i(e,t){if(6===e)return t>>6>15?3:t>31?2:1;if(12===e)return t>15?3:2;if(18===e)return 3;throw new Error}for(var o=65533,n="",a=this.bitsNeeded,r=this.codePoint,s=0;s<e.length;s+=1){var l=e[s];0!==a&&(128>l||l>191||!t(r<<6|63&l,a-6,i(a,r)))&&(a=0,r=o,n+=String.fromCharCode(r)),0===a?(l>=0&&127>=l?(a=0,r=l):l>=192&&223>=l?(a=6,r=31&l):l>=224&&239>=l?(a=12,r=15&l):l>=240&&247>=l?(a=18,r=7&l):(a=0,r=o),0===a||t(r,a,i(a,r))||(a=0,r=o)):(a-=6,r=r<<6|63&l),0===a&&(65535>=r?n+=String.fromCharCode(r):(n+=String.fromCharCode(55296+(r-65535-1>>10)),n+=String.fromCharCode(56320+(r-65535-1&1023))))}return this.bitsNeeded=a,this.codePoint=r,n};void 0!=y&&void 0!=T&&function(){try{return"test"===(new y).decode((new T).encode("test"),{stream:!0})}catch(e){}return!1}()||(y=t);var A=function(){};i.prototype.open=function(e,t){this._abort(!0);var i=this,o=this._xhr,n=1,a=0;this._abort=function(e){0!==i._sendTimeout&&(m(i._sendTimeout),i._sendTimeout=0),(1===n||2===n||3===n)&&(n=4,o.onload=A,o.onerror=A,o.onabort=A,o.onprogress=A,o.onreadystatechange=A,o.abort(),0!==a&&(m(a),a=0),e||(i.readyState=4,i.onreadystatechange())),n=0};var r=function(){if(1===n){var e=0,t="",a=void 0;if("contentType"in o)e=200,t="OK",a=o.contentType;else try{e=o.status,t=o.statusText,a=o.getResponseHeader("Content-Type")}catch(i){e=0,t="",a=void 0}0!==e&&(n=2,i.readyState=2,i.status=e,i.statusText=t,i._contentType=a,i.onreadystatechange())}},s=function(){if(r(),2===n||3===n){n=3;var e="";try{e=o.responseText}catch(e){}i.readyState=3,i.responseText=e,i.onprogress()}},l=function(){s(),(1===n||2===n||3===n)&&(n=4,0!==a&&(m(a),a=0),i.readyState=4,i.onreadystatechange())},c=function(){a=g(function(){c()},500),3===o.readyState&&s()};o.onload=l,o.onerror=l,o.onabort=l,"sendAsBinary"in f.prototype||"mozAnon"in f.prototype||(o.onprogress=s),o.onreadystatechange=function(){void 0!=o&&(4===o.readyState?l():3===o.readyState?s():2===o.readyState&&r())},"contentType"in o&&(t+=(-1===t.indexOf("?")?"?":"&")+"padding=true"),o.open(e,t,!0),"readyState"in o&&(a=g(function(){c()},0))},i.prototype.abort=function(){this._abort(!1)},i.prototype.getResponseHeader=function(e){return this._contentType},i.prototype.setRequestHeader=function(e,t){var i=this._xhr;"setRequestHeader"in i&&i.setRequestHeader(e,t)},i.prototype.getAllResponseHeaders=function(){return void 0!=this._xhr.getAllResponseHeaders?this._xhr.getAllResponseHeaders():""},i.prototype.send=function(){if("ontimeout"in f.prototype||void 0==C||void 0==C.readyState||"complete"===C.readyState){var e=this._xhr;e.withCredentials=this.withCredentials,e.responseType=this.responseType;try{e.send(void 0)}catch(e){throw e}}else{var t=this;t._sendTimeout=g(function(){t._sendTimeout=0,t.send()},4)}},n.prototype.get=function(e){return this._map[o(e)]},a.prototype.open=function(e,t,i,o,a,r,s){e.open("GET",a);var l=0;for(var c in e.onprogress=function(){var t=e.responseText.slice(l);l+=t.length,i(t)},e.onreadystatechange=function(){if(2===e.readyState){var i=e.status,a=e.statusText,r=e.getResponseHeader("Content-Type"),s=e.getAllResponseHeaders();t(i,a,r,new n(s),function(){e.abort()})}else 4===e.readyState&&o()},e.withCredentials=r,e.responseType="text",s)Object.prototype.hasOwnProperty.call(s,c)&&e.setRequestHeader(c,s[c]);e.send()},r.prototype.get=function(e){return this._headers.get(e)},s.prototype.open=function(e,t,i,o,n,a,s){var l=new y;E(n,{headers:s,credentials:a?"include":"same-origin"}).then(function(e){var o=e.body.getReader();return t(e.status,e.statusText,e.headers.get("Content-Type"),new r(e.headers),function(){o.cancel()}),new b(function(e,t){var n=function(){o.read().then(function(t){if(t.done)e(void 0);else{var o=l.decode(t.value,{stream:!0});i(o),n()}}).catch(function(e){t(e)})};n()})}).finally(function(){o()})},l.prototype.dispatchEvent=function(e){e.target=this;var t=this._listeners[e.type];if(void 0!=t)for(var i=t.length,o=0;i>o;o+=1){var n=t[o];try{"function"==typeof n.handleEvent?n.handleEvent(e):n.call(this,e)}catch(e){c(e)}}},l.prototype.addEventListener=function(e,t){e=String(e);var i=this._listeners,o=i[e];void 0==o&&(o=[],i[e]=o);for(var n=!1,a=0;a<o.length;a+=1)o[a]===t&&(n=!0);n||o.push(t)},l.prototype.removeEventListener=function(e,t){e=String(e);var i=this._listeners,o=i[e];if(void 0!=o){for(var n=[],a=0;a<o.length;a+=1)o[a]!==t&&n.push(o[a]);0===n.length?delete i[e]:i[e]=n}},u.prototype=Object.create(d.prototype),h.prototype=Object.create(d.prototype);var I=-1,w=0,k=1,x=2,O=-1,L=0,N=1,D=2,P=3,M=/^text\/event\-stream;?(\s*charset\=utf\-8)?$/i,V=function(e,t){var i=parseInt(e,10);return i!=i&&(i=t),U(i)},U=function(e){return Math.min(Math.max(e,1e3),18e6)},B=function(e,t,i){try{"function"==typeof t&&t.call(e,i)}catch(e){c(e)}},F=void 0!=E&&void 0!=R&&"body"in R.prototype;p.prototype=Object.create(l.prototype),p.prototype.CONNECTING=w,p.prototype.OPEN=k,p.prototype.CLOSED=x,p.prototype.close=function(){this._close()},p.CONNECTING=w,p.OPEN=k,p.CLOSED=x,p.prototype.withCredentials=void 0,e.EventSourcePolyfill=p,e.NativeEventSource=_,void 0==f||void 0!=_&&"withCredentials"in _.prototype||(e.EventSource=p)}("undefined"!=typeof window?window:this),liveRequire.define("eventsource.min",function(){}),liveRequire.define("LiveRestHelper",["LiveEvents","LiveSessionStore","eventsource.min"],function(e,t){"use strict";const i=1e4;return class{constructor(e){this._impl=e,this._callQueue=null,this._clientId=null,this._clientKey=null,this._appName=null,this._noProxyForKyc=!1,this._kycAttemptNumber=0,this._runningForChromeExtension=!1,this._promisesInFlight={},t.initState("LiveRestHelper",this),$(()=>{console.log("LiveRestHelper: Loading"),t.loadState("LiveRestHelper",e=>{this._clientId=e.clientId,this._clientKey=e.clientKey,this._appName=e.appName,this._noProxyForKyc=e.noProxyForKyc,this._kycAttemptNumber=e.kycAttemptNumber,this._impl.contextAttributes.set("appName",this._appName),this._impl.contextAttributes.set("clientId",this._clientId),console.log("Loaded appName = "+this._impl.contextAttributes.get("appName")),console.log("LiveRestHelper: Loaded")})});let i=this._promisesInFlight;this.messageHandler=function(e){if(e.data&&e.data.lxRequest&&"LiveRestHelper.js"===e.data.lxRequest.sender){console.log("We have a response to a background XHR request..",e.data);let t=i[e.data.lxRequest.promiseId];t&&(console.log("Resolving - and deleting - promise...",t),e.data.lxError?t.reject(e.data.lxError):t.resolve(JSON.parse(e.data.lxResponse)),delete i[e.data.lxRequest.promiseId],console.log("Note: promisesInFlight cache now=",i))}},window.addEventListener("message",this.messageHandler,!1)}toJSON(){return JSON.stringify({clientId:this._clientId,clientKey:this._clientKey,appName:this._appName,noProxyForKyc:this._noProxyForKyc,kycAttemptNumber:this._kycAttemptNumber})}beforeUnload(){console.log("LiveRestHelper: Attempting to close the call queue"),this.closeCallQueue()}loadComplete(){console.log("LiveRestHelper: Load complete")}generateId(e){let t="",i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",o=i.length;for(let n=0;n<e;n++)t+=i.charAt(Math.floor(Math.random()*o));return t}defer(){let e,t,i=new Promise((i,o)=>{e=i,t=o});return i.resolve=e,i.reject=t,i}_fetchInBackground(e,t,i,o,n){console.log("LiveRestHelper.fetchInBackground - handing off to the background doXHR mechanism.."),console.log("LiveRestHelper.fetchInBackground: method=",e),console.log("LiveRestHelper.fetchInBackground: url=",t),console.log("LiveRestHelper.fetchInBackground: data=",i),console.log("LiveRestHelper.fetchInBackground: auth=",o),console.log("LiveRestHelper.fetchInBackground: contentType=",n);let a=this.defer(),r=this.generateId(8);return this._promisesInFlight[r]=a,window.postMessage({sender:"LiveRestHelper.js",msg:"doXHR",method:e,accept:n,contentType:n,auth:o||"Bearer "+this._impl.service.authToken,url:t,body:i,promiseId:r},"*"),a}_fetch(e,t,i,o,n){const a=o||this._impl.service.authToken,r=n||"application/json";return this._runningForChromeExtension?this._fetchInBackground(e,t,i,o,r):fetch(t,{method:e,body:i,mode:"cors",credentials:"include",headers:{"Content-Type":r,Accept:r,Authorization:"Bearer "+a,"X-Requested-With":"XMLHttpRequest"}}).then(e=>{if(e.ok)return 200===e.status?e.text():Promise.resolve(e.statusText);{const t=new Error(e.statusText);throw t.response=e,t}}).then(e=>{try{return e?Promise.resolve(JSON.parse(e)):Promise.resolve(e)}catch(t){return console.log("LiveRestHelper::fetch could not process : '"+e+"'"),console.warn("response : '"+t+"''"),Promise.resolve(e)}})}_get(e,t){return this._fetch("GET",e,null,null,t)}_post(e,t){return this._fetch("POST",e,t)}_put(e,t){return this._fetch("PUT",e,t)}_delete(e,t){return this._fetch("DELETE",e,null,t)}closeCallQueue(){this._callQueue&&this._callQueue.close(),this._callQueue=null,this.stopKeepAliveTimer()}addToCallQueue(e,t,i){console.log("LiveRestHelper::addToCallQueue: mediaType="+e);let o=this._impl.service.authToken,n=this._impl.service.address+"/assoc/api/tenant/"+this._impl.service.tenantID+"/conversation/pending?mediaType="+e+"&version="+this._impl.version+"&jwt="+o+(this._clientKey?"&clientKey="+this._clientKey:"");console.log("LiveRestHelper::addToCallQueue: pendingURI="+n),this.closeCallQueue(),this._callQueue=new EventSource(n),this._callQueue.addEventListener("Success",e=>{const i=e.data;console.log("LiveRestHelper::addToCallQueue: success: address="+i,e),this.closeCallQueue(),t(i)},!1),this._callQueue.addEventListener("Upgrade",e=>{const i=e.data;console.log("LiveRestHelper::addToCallQueue: upgrade: eventData="+i,e),this.closeCallQueue(),t(i)},!1),this._callQueue.addEventListener("None",e=>{const t=e.data;console.log("LiveRestHelper::addToCallQueue: none: message="+t,e),this.closeCallQueue(),i(t)}),this._callQueue.addEventListener("KeepAlive",e=>{const t=e.data;console.log("LiveRestHelper::addToCallQueue: keep-alive: message="+t,e);try{const e=JSON.parse(t);console.log("LiveRestHelper::addToCallQueue: keep-alive: waitTime="+e.waitTime+", queuePosition="+e.queuePosition),this._impl.setPositionInQueue(e.queuePosition)}catch(e){console.log("LiveRestHelper::addToCallQueue: keep-alive: failed to parse keep-alive response",e)}}),this.startKeepAliveTimer(e)}closeCallQueueAndRemove(t,i){if(console.log("closeCallQueueAndRemove",this._callQueue),!this._callQueue)return;this.closeCallQueue(),this._impl.dispatchEvent(e.LiveCanceled);let o=this._impl.service.authToken;this.removeFromQueue(t,o,i)}removeFromQueue(e,t,i){let o=this._impl.service.address+"/assoc/api/tenant/"+this._impl.service.tenantID+"/conversation/pending?mediaType="+e+"&jwt="+t+"&version="+this._impl.version+(this._clientKey?"&clientKey="+this._clientKey:"");console.log("removeFromQueue: pendingURI: "+o),this._delete(o,t).then(()=>{console.log("Got success for delete pending"),i()}).catch(e=>{404!==e.response.status?console.log("Failed to delete pending call, Error: "+e.message,e.response):(console.log("Pending call already removed"),i())})}startKeepAliveTimer(e){this.stopKeepAliveTimer(),console.log("startKeepAliveTimer"),this._keepAliveTimer=setInterval(()=>{this.sendQueueKeepAlive(e)},i)}stopKeepAliveTimer(){this._keepAliveTimer&&(console.log("stopKeepAliveTimer"),clearInterval(this._keepAliveTimer),this._keepAliveTimer=null)}sendQueueKeepAlive(t){let i=this._impl.service.address+"/assoc/api/tenant/"+this._impl.service.tenantID+"/conversation/keepAlive?version="+this._impl.version+(this._clientKey?"&clientKey="+this._clientKey:"");console.log("sendQueueKeepAlive: keepaliveURI: "+i),this._post(i,null).then(()=>{console.log("Got success to queue keep-alive")}).catch(i=>{console.log("Failed to send queue keep-alive, Error: "+i.message,i.response),i.response&&404===i.response.status&&(console.log("Got queue keep-alive 'Not Found' error response - pending call has been cancelled"),this.closeCallQueueAndRemove(t,()=>{console.log("Removed pending call"),this._impl.dispatchEvent(e.LiveEnded)}))})}getAppAvailability(e){console.log("LiveRestHelper::getAppAvailability: for tenantID=",this._impl.service.tenantID);let t=this._impl.service.address+"/tenant/api/tenants/"+this._impl.service.tenantID+"/application?version="+this._impl.version;this._get(t).then(t=>{console.log("Got availability response: ",t),e(t)}).catch(e=>{console.log("Failed to get availability, Error: "+e.message,e.response)})}getMetaScenario(e){if(console.log("LiveRestHelper::getMetaScenario: for tenantID=",this._impl.service.tenantID),!this._impl.service.tenantID)return;navigator.userAgent.includes("iPad")||navigator.userAgent.includes("iPhone")?this._impl.contextAttributes.set("devType","Mobile (iOS)"):navigator.userAgent.includes("Android")?this._impl.contextAttributes.set("devType","Mobile (Android)"):this._impl.contextAttributes.set("devType","web");let t=this._impl.service.address+"/tenant/api/tenants/"+this._impl.service.tenantID+"/match-meta-scenario?version="+this._impl.version,i=JSON.stringify(this._impl.contextAttributes.toWebContext());this._post(t,i).then(t=>{console.log("LiveRestHelper::getMetaScenario: Got success for post/match-meta-scenario: ",t);const i=t.Application;this._clientId=i.clientId,console.log("application.name received in matched metaScenario = "+i.name),this._appName=i.name,this._impl.contextAttributes.set("appName",i.name),this._impl.contextAttributes.set("clientId",i.clientId);const o=t.Configuration,n=t.Components;e(o,n)}).catch(e=>{console.error("Failed to match meta scenario (no response text), Error: "+e.message,e.response)})}getMessages(e,t){this._impl.service.tenantID&&this._clientId||(console.warn("LiveRestHelper::getMessages Cannot retrieve messages for invalid tenant"),t());let i=this._impl.service.address+"/tenant/api/tenant/"+this._impl.service.tenantID+"/localisation/application/"+this._clientId+"/messages/locale/"+e+"/?usageType=mce";this._get(i,"application/octet-stream").then(e=>{e?e.application_layer?t(e.application_layer):t(e):t()}).catch(e=>{console.warn("LiveRestHelper::getMessages Cannot retrieve messages, Error: "+e.message,e.response),t()})}sendContext(e){console.log("Inside sendContext");let t=this._impl.service.address+"/assoc/api/tenant/"+this._impl.service.tenantID+"/context?version="+this._impl.version+(this._clientKey?"&clientKey="+this._clientKey:""),i=this._impl.contextAttributes.toJSON();console.log("LiveRestHelper::sendContext: ",this._impl.contextAttributes),sessionStorage.setItem("previousJWT",this._impl.service.authToken),this._post(t,i).then(t=>{console.log("LiveRestHelper::sendContext: responseData: ",JSON.stringify(t)),t&&(t.clientKey?this._clientKey=t.clientKey:t.key&&(this._clientKey=t.key)),console.log("LiveRestHelper::sendContext: clientKey: "+this._clientKey),e()}).catch(e=>{console.error("LiveRestHelper::sendContext: Failed to send context info, Error: "+e.message,e.response)})}sendPostCallRating(e,t){console.log("sendPostCallRating: rating="+e),this._impl._conversationId||console.warn("Cannot submit post-call rating - invalid conversation ID");let i=JSON.stringify({uri:this._impl.service.userID,qualityRating:e}),o=this._impl.service.address+"/sr/api/tenant/"+this._impl.service.tenantID+"/application/"+this._clientId+"/session/"+this._impl._conversationId+"/participantcallrating/?version="+this._impl.version;console.log("sendRating: "+i+" to: "+o),this._post(o,i).then(()=>{console.log("Successfully sent call rating"),this._impl._conversationId=null,t()}).catch(e=>{console.error("Failed to send call rating, Error: "+e.message,e.response)})}getAssociateInfo(){console.log("Entered getAssociateInfo..");let e=this._impl.service.tenantID,t=this._impl._associateUri;if(!t)return void console.log("No associateURI field available so skipping retrieval");let i=encodeURI(this._impl.service.address+"/assoc/api/tenant/"+e+"/assoc/"+t+"?version="+this._impl.version);console.log("Fetch associate info from URL: "+i);const o=this._get(i);return o.then(e=>{console.log("Got response from associate info request..",e),e.name&&this._impl.setAssociateName(e.name)}).catch(e=>{console.log("Failed to retrieve associate info, Error: "+e.message,e.response)}),o}getAssociateAvatar(){console.log("Entered getAssociateAvatar..");let e=this._impl.service.authToken,t=this._impl.service.tenantID,i=this._impl._associateUri;if(!i)return void console.log("No associateURI field available so skipping retrieval");let o=encodeURI(this._impl.service.address+"/auth/user/api/users/avatar/"+t+"/"+i+"?version="+this._impl.version);console.log("Fetch associate avatar from URL: "+o),fetch(o,{credentials:"include",mode:"cors",headers:{Accept:"application/octet-stream","X-Requested-With":"XMLHttpRequest",Authorization:"Bearer "+e}}).then(e=>{if(e.ok)return e.blob();console.log("Failed to find avatar: "+e.status,e.statusText)}).then(e=>{let t=URL.createObjectURL(e);console.log("Successfully downloaded avatar",t),this._impl.setAssociatePhoto(t)}).catch(e=>{console.log("Failed to download associate avatar: ",e.message)})}updatePreCallIdCheck(e,t,i,o){if(console.log("LiveRestHelper::updatePreCallIdCheck:  for tenantID=",e.tenantID),console.log("clientKey: ",i),i||(i=this._clientKey),!e.tenantID||!this._clientId)return console.log("LiveRestHelper::updatePreCallIdCheck:Cannot update PreCallIDCheck for invalid tenant"),void o(void 0);let n=e.address+"/sl/api/kyc/tenant/"+e.tenantID+"/client/"+i+"/attempt/"+this.getLastUsedKycAttemptNumber()+"/update/"+t;this._post(n).then(e=>{console.log("LiveRestHelper::updatePreCallIdCheck: got response: "+e),e&&o(e)}).catch(e=>{console.log("LiveRestHelper::updatePreCallIdCheck: failed to updatePreCallIdCheck, Error: "+e.message,e.response)})}getLocale(){let e="en";return navigator.languages&&navigator.languages.length?e=navigator.languages[0]:navigator.language&&(e=navigator.language),console.log("LiveRestHelper::getLocale: language: ",e),e}setClientId(e){this._clientId=e}getClientKey(){return this._clientKey}createInitiatePreCallCheckPayload(){return{deviceType:"web",attemptNumber:this.getIncrementedKycAttemptNumber(),clientId:this._clientId,clientKey:this._clientKey,userId:this._impl.service.userID,locale:this.getLocale(),noProxy:this._noProxyForKyc}}initiatePreCallIDCheck(e,t,i){if(console.log("LiveRestHelper::initiatePreCallIDCheck: for tenantID=",e.tenantID),!e.tenantID||!this._clientId)return console.log("LiveRestHelper::initiatePreCallIDCheck:Cannot initiate PreCallIDCheck for invalid tenant"),void i(void 0);let o=e.address+"/kyc/api/tenant/"+e.tenantID+"/application/"+this._clientId+"/initiate";console.log("LiveRestHelper::initiatePreCallIDCheck: uri: ",o),console.log("LiveRestHelper::initiatePreCallIDCheck: data: ",t),this._post(o,JSON.stringify(t)).then(e=>{console.log("LiveRestHelper::initiatePreCallIDCheck: got response: ",e),e&&i(e)}).catch(e=>{console.log("LiveRestHelper::initiatePreCallIDCheck: failed to initiatePreCallIDCheck, Error: "+e.message,e.response)})}getPreCallIDCheckStatus(e,t,i,o){if(console.log("LiveRestHelper::getPreCallIDCheckStatus:  for tenantID=",e.tenantID),console.log("transactionReference: ",t),!e.tenantID||!this._clientId)return console.log("LiveRestHelper::getPreCallIDCheckStatus:Cannot get PreCallIDCheck for invalid tenant"),void o(void 0);let n=e.address+"/kyc/api/tenant/"+e.tenantID+"/application/"+this._clientId+"/transaction/"+t+"/status";this._get(n).then(e=>{console.log("LiveRestHelper::getPreCallIDCheckStatus: got response: "+e),e&&i(e)}).catch(e=>{console.log("LiveRestHelper::getPreCallIDCheckStatus: failed to getPreCallIDCheckStatus, Error: "+e.message,e.response),o(e.response)})}getPreCallIDCheckResult(e,t){if(console.log("LiveRestHelper::getPreCallIDCheckResult:  for tenantID=",e.tenantID),console.log("clientKey: ",t),!e.tenantID||!this._clientId)return console.log("LiveRestHelper::getPreCallIDCheckStatus:Cannot get PreCallIDCheck for invalid tenant"),Promise.reject(void 0);let i=e.address+"/sr/api/kyc/tenant/"+e.tenantID+"/session/"+t+"/id-verification/result";return this._get(i)}getLastUsedKycAttemptNumber(){return this._kycAttemptNumber}getIncrementedKycAttemptNumber(){return this._kycAttemptNumber+=1,this.getLastUsedKycAttemptNumber()}setNoProxyForKyc(e){console.log("LiveRestHelper::setNoProxyForKyc noProxy: ",e),this._noProxyForKyc=e}deleteIdentityVerificationTransaction(e,t){if(console.log("LiveRestHelper::deleteIdentityVerificationTransaction:  for tenantID=",e.tenantID),console.log("transactionReference: ",t),console.log("attempt: ",this._kycAttemptNumber),!e.tenantID||!this._clientKey)return console.log("LiveRestHelper::deleteIdentityVerificationTransaction: Cannot delete transaction for invalid tenant/app"),Promise.reject(new Error("Invalid tenant or application"));const i=e.address+"/sl/api/kyc/tenant/"+e.tenantID+"/client/"+this._clientKey+"/attempt/"+this._kycAttemptNumber+"/result",o={transactionReference:t,result:"Failed"};return this._post(i,JSON.stringify(o))}setRunningForChromeExtension(e){console.log("liveAPI REST helper: setRunningForChromeExtension="+e),this._runningForChromeExtension=e}}}),liveRequire.define("LiveDiagnostics",["LiveSessionStore","LiveEvents"],function(e,t){"use strict";const i=51,o=50,n=11,a=16,r="LXDiagnosticsResults";return class{constructor(t){this._impl=t,this._browserName=null,this._browserVersion=null,this._haveAudioIn=!1,this._haveAudioOut=!1,this._haveVideo=!1,this._haveTwoCameras=!1,this._cancelled=!1,this._videoStream=null,this._networkTestRunning=!1,this._networkResult=0,this._networkPromise=null,this._diagnosticsTimer={},this._diagnosticsTimeout=2e4,this._audioOutDiagnosticsTimeout=6e4,this._reloadedForDiagnosticsRun=!1,e.initState("LiveDiagnostics",this),$(()=>{console.log("LiveDiagnostics: Loading"),e.loadState("LiveDiagnostics",e=>{this._browserName=e.browserName,this._browserVersion=e.browserVersion,this._haveAudioIn=e.haveAudioIn,this._haveAudioOut=e.haveAudioOut,this._haveVideo=e.haveVideo,this._haveTwoCameras=e._haveTwoCameras,this._networkResult=e.networkResult,console.log("LiveDiagnostics: Loaded")})})}toJSON(){return JSON.stringify({browserName:this._browserName,browserVersion:this._browserVersion,haveAudioIn:this._haveAudioIn,haveAudioOut:this._haveAudioOut,haveVideo:this._haveVideo,haveTwoCameras:this._haveTwoCameras,networkResult:this._networkResult})}setAutoTest(e){console.log("LiveDiagnostics::setAutoTest setting to: ",e),!0===e&&(this._haveAudioIn=!0,this._haveAudioOut=!0,this._haveVideo=!0,this._haveTwoCameras=!1)}checkBrowser(){return new Promise((e,t)=>{if(!this._browserName||!this._browserVersion){const e=live.testBrowser().details;this._browserName=e.browserName,this._browserVersion=e.browserVersion}if("Chrome"===this._browserName&&this._browserVersion>i||"Firefox"===this._browserName&&this._browserVersion>o||"Safari"===this._browserName&&this._browserVersion>=n||"Edge"===this._browserName&&this._browserVersion>=a)console.log("Supported browser: "+this._browserName+", version: "+this._browserVersion),e({browserName:this._browserName,browserVersion:this._browserVersion});else{const e="Live Experience - Unsupported browser: "+this._browserName+", version: "+this._browserVersion;console.error(e),t(new Error(e))}})}cancelChecks(){console.log("cancelChecks: Diagnostics cancelled"),this._cancelled=!0}checkMedia(e){if(console.log("LiveDiagnostics::checkMedia includeCamera=",e),this._haveAudioIn&&this._haveAudioOut&&(!e||this._haveVideo))return console.log("LiveDiagnostics::checkMedia success from restored values"),Promise.resolve("Diagnostics completed already");e?this._impl.dispatchEvent(t.LiveDiagnosticsAudioVideoStarted):this._impl.dispatchEvent(t.LiveDiagnosticsAudioStarted),this._cancelled=!1;const i=()=>e?Promise.all([this._checkAudioOutput(),this._checkAudioInput(),this._checkCamera(),this._checkNetwork(!1)]):Promise.all([this._checkAudioOutput(),this._checkAudioInput(),this._checkNetwork(!1)]);return new Promise((e,t)=>{i().then(t=>{console.log("LiveDiagnostics::checkMedia: Diagnostics completed: ",t),this._cancelled?(console.log("LiveDiagnostics::checkMedia: Diagnostics cancelled"),e("CANCELLED")):e("Diagnostics complete")}).catch(e=>{console.warn("LiveDiagnostics::checkMedia: Diagnostics ended with error ",e),this._cancelled?(console.log("LiveDiagnostics::checkMedia: ignoring diagnostics were cancelled"),t("CANCELLED")):t("Diagnostics failed:"+e)})})}checkMeetingDiagnostics(e){console.log("checkMeetingDiagnostics: videoRequired="+e);const t=sessionStorage.getItem(r);return t?(this._meetingDiagnostics=JSON.parse(t),console.log("Have meeting diagnostics results: "+JSON.stringify(this._meetingDiagnostics,null,2)),this._haveAudioIn=this._meetingDiagnostics.audioIn,this._haveAudioOut=this._meetingDiagnostics.audioOut,this._haveVideo=this._meetingDiagnostics.video,this._networkResult=this._meetingDiagnostics.network,this._reloadedForDiagnosticsRun||this._haveAudioIn&&this._haveAudioOut||(console.log("We're headed for a diagnostics failure on meeting Rejoin, so reloading page instead"),this._reloadedForDiagnosticsRun=!0,location.reload()),this._checkNetworkResult(!e,this._networkResult)):(console.log("Warning: no meeting diagnostics results found"),Promise.resolve("No results"))}testCombinedDevices(e){if(console.log("LiveDiagnostics::testCombinedDevices includeCamera="+e),this._haveAudioIn&&this._haveAudioOut&&(!e||this._haveVideo))return console.log("LiveDiagnostics::testCombinedDevices success from restored values"),Promise.resolve("Diagnostics completed already");e?this._impl.dispatchEvent(t.LiveDiagnosticsAudioVideoStarted):this._impl.dispatchEvent(t.LiveDiagnosticsAudioStarted);let i={audio:!0};e&&(console.log("Including camera (video) as mandatory device.."),i.video={width:{min:640,ideal:1280,max:1920},height:{min:360,ideal:720,max:1080}});let o=this,n=t=>{let i=!1,n=!1,a=!1,r=[],s=!1,l=!1;(e=>{let t=navigator.mediaDevices.enumerateDevices();t&&t.then?navigator.mediaDevices.enumerateDevices().then(e).catch(()=>{e([])}):e([])})(c=>{c.forEach(e=>{let t={};for(let i in e)if("function"!=typeof e[i])try{t[i]=e[i]}catch(e){console.log("Error occurred checking for _device function",e)}if(console.log("Enumerated media device....",t),"audio"===t.kind&&(t.kind="audioinput"),"video"===t.kind&&(t.kind="videoinput"),"audioinput"===t.kind&&(s=!0,i=!0),"audiooutput"===t.kind&&(n=!0),"videoinput"===t.kind&&(a=!0,l=null!==o._videoStream)){const e={id:t.deviceId,label:t.label};r.push(e),console.log("cameraInfo: id: "+e.id+"  label: "+e.label)}}),console.log("mic="+i+", speakers="+n+", camera="+a+", micPermissions="+s+", camPermissions="+l),o._haveAudioIn=i&&s,o._haveAudioOut=o._haveAudioIn||n,o._haveVideo=!e||a&&l,o._haveTwoCameras=r.length>1,console.log("haveTwoCameras: "+(r.length>1)),console.log(`enumeratesFunction: cameras: ${JSON.stringify(r)}`),t("Camera, mic and speaker tests have been performed")})};return new Promise(t=>{console.log("Requesting user media with constraints:",i),navigator.mediaDevices.getUserMedia(i).then(i=>{e&&(o._videoStream=i),this._videoStream.getTracks().forEach(e=>{e.stop()}),n(t)}).catch(e=>{console.log("Error occurred getting user media",e),n(t)})})}hasAudio(){return console.log("LiveDiagnostics: hasAudio - haveAudioIn="+this._haveAudioIn+", haveAudioOut="+this._haveAudioOut),this._haveAudioIn&&this._haveAudioOut}hasVideo(){return console.log("LiveDiagnostics: hasVideo - haveVideo="+this._haveVideo),this._haveVideo}hasTwoCameras(){return console.log("LiveDiagnostics: hasTwoCameras - haveTwoCameras="+this._haveTwoCameras),this._haveTwoCameras}startNetworkCheck(e){return this._checkNetwork(e)}_clearDiagnosticsTimer(e){const t=this._diagnosticsTimer[e];t&&(clearTimeout(t),delete this._diagnosticsTimer[e])}_checkAudioOutput(){return this._haveAudioOut?Promise.resolve("Audio out already verified"):(this._haveAudioOut=!1,new Promise((e,t)=>{this._diagnosticsTimer.audio_out=setTimeout(()=>{console.warn("LiveDiagnostics::_checkAudioOutput timed out at ",(new Date).toString()),t("Audio output diagnosis timed out")},this._audioOutDiagnosticsTimeout),live.testAudio().then(i=>{this._clearDiagnosticsTimer("audio_out");let o=null,n=!1;i.available?(console.log("LiveDiagnostics::_checkAudioOutput Audio output works",i),this._haveAudioOut=!0,o="Audio output success",n=!0):"Firefox"===this._browserName||"Safari"===this._browserName?(console.log("LiveDiagnostics::_checkAudioOutput failure ignored in browser "+this._browserName),this._haveAudioOut=!0,o="Audio output failure ignored",n=!0):(console.warn("LiveDiagnostics::_checkAudioOutput failed",i),o="Audio output diagnosis failed"),this._cancelled?t("CANCELLED"):n?e(o):t(o)}).catch(e=>{console.warn("LiveDiagnostics::_checkAudioOutput check failed",e),this._clearDiagnosticsTimer("audio_out"),t("Audio output does not work")})}))}_checkAudioInput(){return this._haveAudioIn?Promise.resolve("Audio in already verified"):(this._haveAudioIn=!1,new Promise((e,t)=>{this._diagnosticsTimer.audio_in=setTimeout(()=>{this._clearDiagnosticsTimer("audio_in"),console.log("LiveDiagnostics::_checkAudioInput timed out at ",(new Date).toString()),t("Audio input diagnosis timed out")},6e4),live.testMicrophone().then(i=>{this._clearDiagnosticsTimer("audio_in"),i.available?(console.log("LiveDiagnostics::_checkAudioInput: Microphone works"),this._haveAudioIn=!0,this._cancelled?t("CANCELLED"):e("Audio input works"),console.log("Audio input works"),this._haveAudioIn=!0,e("Audio input works")):"Safari"===this._browserName?(console.log("Audio input test failure result ignored in browser "+this._browserName),this._haveAudioIn=!0,e("Audio input failure ignored")):(console.warn("LiveDiagnostics::_checkAudioInput Audio input does not work",i),t("Audio input does not work"))}).catch(e=>{this._clearDiagnosticsTimer("audio_in"),console.warn("LiveDiagnostics::_checkAudioInput Audio input does not work",e),t("Audio input does not work")})}))}_checkCamera(){return console.log("LiveDiagnostics::_checkCamera"),this._haveVideo?Promise.resolve("Camera already verified"):(this._haveVideo=!1,new Promise((e,t)=>{const i=e=>{console.warn("LiveDiagnostics::_checkCamera failed",e),this._clearDiagnosticsTimer("camera"),t("No camera detected")};this._diagnosticsTimer.camera=setTimeout(()=>{this._clearDiagnosticsTimer("camera"),console.log("LiveDiagnostics::_checkCamera timed out"),t("Camera diagnosis timed out")},this._diagnosticsTimeout),this._haveVideo=!1,this._videoStream=null,live.testCamera().then(o=>{if(console.log("LiveDiagnostics::_checkCamera succeeded with ",o),this._clearDiagnosticsTimer("camera"),this._cancelled&&t("CANCELLED"),!o.available)return console.warn("LiveDiagnostics::_checkCamera no camera found"),void t("Camera does not work");if(this._videoStream)return this._videoStream.getVideoTracks().forEach(e=>{e.stop()}),this._haveVideo=!0,void e("Camera is ready");const n={audio:!1,video:{width:{min:640,ideal:1280,max:1920},height:{min:360,ideal:720,max:1080}}};navigator.mediaDevices.getUserMedia(n).then(i=>{const o=i.getVideoTracks();o.forEach(e=>{e.stop()}),console.log("Got stream with constraints:",n),console.log("Using video device: "+o[0].label),this._videoStream=i,this._haveVideo=!0,this._cancelled?t("CANCELLED"):e("Camera is ready after checking user media")}).catch(i)}).catch(i)}))}_checkNetwork(e){return console.log("LiveDiagnostics::_checkNetwork: result="+this._networkResult),this._networkResult?this._checkNetworkResult(e,this._networkResult):this._checkNetworkInternal(e)}_checkNetworkInternal(e){return console.log("LiveDiagnostics::_checkNetworkInternal: audio=",e),this._networkTestRunning&&this._networkPromise?this._networkPromise:(this._networkPromise=new Promise(t=>{const i=e=>{this._networkResult=0,this._clearDiagnosticsTimer("network"),this._networkTestRunning=!1,console.log("Network check failed",e),t("Network check failure")},o=(t,i)=>(this._clearDiagnosticsTimer("network"),console.log("Network Quality: status:"+t+", hints:",i),this._networkTestRunning=!1,this._networkResult=t,this._checkNetworkResult(e,this._networkResult));this._diagnosticsTimer.network=setTimeout(()=>{this._clearDiagnosticsTimer("network"),this._networkTestRunning=!1,console.log("Network diagnosis timed out"),t("Network diagnosis timed out")},this._diagnosticsTimeout),this._networkTestRunning?console.log("Network status check already running"):(console.log("Checking network status"),this._networkResult=0,this._impl.getNetworkStatus(o,i),this._networkTestRunning=!0)}),this._networkPromise)}_checkNetworkResult(e,t){return new Promise(i=>{switch(t){case 1:this._haveAudioOut=!1,i("Audio quality too low: "+t);break;case 2:e?i("Audio quality maybe low: "+t):(this._haveVideo=!1,i("Video quality too low: "+t));break;case 3:i("Video quality maybe low: "+t);break;case 4:case 5:i("Acceptable for audio and video: "+t);break;default:i("Unknown result: "+t)}})}}}),liveRequire.define("LiveScreenSharing",["LiveEvents","LiveSessionStore"],function(e,t){"use strict";return class{constructor(e){this._impl=e,this._remoteOutgoingSS=null,this._remoteIncomingSS=null,this._remoteOutgoingStreamId=null,this._remoteIncomingStreamId=null,this._localOutgoingSS=null,this._localIncomingSS=null,this._localOutgoingStreamId=null,this._localIncomingStreamId=null,this._canvas=null,this._showScreenShareLoadingHint=!1,this._showSelectedScreenShareStream=!0,this._screenShareArrivingCanvasReady=!1,this._sharedTrack=null,this._showScreenSharePending=!1,this._haveDisplayedIncomingScreenShareInThisCallAlready=!1,this._screenSharePendingTimeout=null,this._screenShareStreamSettings={},this._localStreamOptions=null,this._localMedia=null,this._localScreenShareActive=!1,this._remoteScreenShareActive=!1,this._restartSendingScreenShare=!1,this._minChromeVersionForScreenShare=72,this._minSafariVersionForScreenShare=13,this._minFirefoxVersionForGetDisplayMedia=68,this._connectionRestored=!1,this._restoredStreams=[],this._qualityMetricsCallback=null,t.initState("LiveScreenSharing",this),$(()=>{console.log("LiveScreenSharing: Loading"),t.loadState("LiveScreenSharing",e=>{this._remoteScreenShareActive=e.remoteScreenShareActive,this._localScreenShareActive=e.localScreenShareActive,this._restartSendingScreenShare=e.restartSendingScreenShare,this._remoteOutgoingStreamId=e.remoteOutgoingStreamId,this._remoteIncomingStreamId=e.remoteIncomingStreamId,this._localOutgoingStreamId=e.localOutgoingStreamId,this._localIncomingStreamId=e.localIncomingStreamId,this._localStreamOptions=e.localStreamOptions,console.log("LiveScreenSharing: Loaded: localOutgoingStreamId="+this._localOutgoingStreamId)})})}toJSON(){return JSON.stringify({remoteScreenShareActive:this._remoteScreenShareActive,localScreenShareActive:this._localScreenShareActive,restartSendingScreenShare:this._localScreenShareActive||this._restartSendingScreenShare,localStreamOptions:this._localStreamOptions,localOutgoingStreamId:this._localOutgoingSS?this._localOutgoingSS.getId():null,localIncomingStreamId:this._localIncomingSS?this._localIncomingSS.getId():null,remoteOutgoingStreamId:this._remoteOutgoingSS?this._remoteOutgoingSS.getId():null,remoteIncomingStreamId:this._remoteIncomingSS?this._remoteIncomingSS.getId():null})}loadComplete(){console.log("LiveScreenSharing:loadComplete()"),this._connectionRestored&&(console.log("LiveScreenSharing:loadComplete() resumes screen share"),console.log("LiveScreenSharing:loadComplete() State is:","\n_remoteScreenShareActive:\t\t",this._remoteScreenShareActive,"\n_localScreenShareActive:\t\t",this._localScreenShareActive,"\n_restartSendingScreenShare:\t\t",this._restartSendingScreenShare,"\n_localStreamOptions:\t\t",this._localStreamOptions,"\n_localOutgoingStreamId:\t\t",this._localOutgoingStreamId,"\n_localIncomingStreamId:\t\t",this._localIncomingStreamId),this._resumeScreenShare())}setConnectionRestored(){this._connectionRestored=!0}checkStreamPeerConnection(e,t){t&&(t.call?t.call.peerConnection||alert("Something is wrong: "+e+" has no call.peerConnection reference"):alert("Something is wrong: "+e+" has no call reference"))}debugStreams(){console.log("======= WEB API STREAMS ======="),console.log("=== _localOutgoingSS",this._localOutgoingSS),console.log("=== _localIncomingSS",this._localIncomingSS),console.log("=== _localOutgoingStreamId",this._localOutgoingStreamId),console.log("=== _localIncomingStreamId",this._localIncomingStreamId),console.log("=== _remoteOutgoingSS",this._remoteOutgoingSS),console.log("=== _remoteIncomingSS",this._remoteIncomingSS),console.log("=== _remoteOutgoingStreamId",this._remoteOutgoingStreamId),console.log("=== _remoteIncomingStreamId",this._remoteIncomingStreamId),console.log("=== _remoteScreenShareActive",this._remoteScreenShareActive),this.isPermanentTwoWayScreenShare()&&(this.checkStreamPeerConnection("hidden outgoing",this._localOutgoingSS),this.checkStreamPeerConnection("hidden incoming",this._localIncomingSS)),console.log("================================"),setTimeout(()=>{this.debugStreams()},3e4)}createScreenShareStream(e,t){if(!this._impl._conversation)return Promise.reject(new Error("No ongoing conversation"));try{return t||(t=e?live.StreamInfo.createStreamOptions(live.MEDIADIRECTION.INACTIVE,live.MEDIADIRECTION.SENDONLY):live.StreamInfo.createStreamOptions(live.MEDIADIRECTION.INACTIVE,live.MEDIADIRECTION.RECVONLY)),this._impl._conversation.addScreenShareStream(null,t)}catch(e){return Promise.reject(e)}}startReceivingScreenShare(e){console.log("LiveScreenSharing::startReceivingScreenShare",e,this._localIncomingSS,this._remoteIncomingSS),this._remoteIncomingSS=e,this._localIncomingSS?console.log("LiveScreenSharing::startReceivingScreenShare Local SS incoming stream already active"):(console.log("Creating screen share stream to receive remote SS"),this.createScreenShareStream(!1).then(e=>{this._localIncomingSS=e.stream,this._qualityMetricsCallback&&(this._localIncomingSS.onQualityMetrics=this._qualityMetricsCallback),this._localStreamOptions=e.options,this._initCallbacks(this._localIncomingSS),this._localIncomingSS.start([])}).catch(e=>{console.warn("LiveScreenSharing::startReceivingScreenShare Could not start local stream",e)}))}stopReceivingScreenShare(){console.log("LiveScreenSharing: stopReceivingScreenShare"),this._impl.stopStream(this._localMedia),this._localMedia=null,$(".oracle-live-remote-screenshare").hide(),this._remoteIncomingSS=null,this._localIncomingSS&&(this._localIncomingSS.end(),this._localIncomingSS=null),this._remoteScreenShareActive&&this._impl.dispatchEvent(e.LiveRemoteScreenStopped),this._remoteScreenShareActive=!1}populateScreenShareStream(e,t){if(console.log("populateScreenShareStream entered:",e,t),!this._localOutgoingSS)return console.log("no outgoing SS - where did it go???"),void alert("Can no longer share screen in this call as reference to outgoing screen share stream has been lost");if(!e)return void console.log("populateScreenShareStream given no content stream - ignoring");let i=null;console.log("have initialized promise to:",i);let o=this;const n=function(){console.log("Caught stream ended on screen share track"),o.stopSendingScreenShare()};let a=this._localOutgoingSS.call.peerConnection,r=!1;return a?e.getTracks().forEach(e=>{console.log("real (new) SS track..",e.id,e.label);let o=a.getSenders().find(t=>t.track.kind===e.kind);console.log("we have found remote sender and have new track",o,e),i=o.replaceTrack(e),console.log("we have requested the track replacement and have new promise",i),this._isChrome()?e.enabled=!0:(e.enabled=!1,console.log("Delaying track enable; required by FF"),i.then(()=>{setTimeout(()=>{console.log("Enabling track (after short delay; required by FF)"),e.enabled=!0},750)})),r=!0,this._sharedTrack=e,t&&(e.onended=n)}):console.warn("No peer connection available - cannot substitute screen share stream tracks as desired"),r?i:Promise.reject("Failed to replace any screen share tracks in LX populateScreenShareStream")}populateEmptyScreenShareStream(){this.populateScreenShareStream(this.getEmptyMediaStream(),!1)}populateStreamWithScreenShareComingHint(){this._showScreenShareLoadingHint&&(console.log("populateStreamWithScreenShareComingHint entered"),this._addCanvasBackground().then(()=>{console.log("have canvas background ready.. using it to capture a stream"),this._hintStream=this._canvas.captureStream(1),console.log("have stream..",this._hintStream),this.populateScreenShareStream(this._hintStream,!0)}).catch(e=>{console.warn("LiveScreenSharing::populateStreamWithScreenShareComingHint failed:",e)}))}getEmptyMediaStream(){try{let e=document.querySelector("#screen-share-arriving");console.log("Starting hidden screen share stream using empty media, canvas=",e);let t=e.captureStream(1);return console.log("getEmptyMediaStream returning:",t),t}catch(e){return null}}startDummyScreenShare(){console.log("LiveScreenSharing::startDummyScreenShare");const t=live.StreamInfo.createStreamOptions(live.MEDIADIRECTION.INACTIVE,live.MEDIADIRECTION.SENDONLY);this.createScreenShareStream(!0,t).then(t=>{console.log("we have dummy SS with stream/options",t),this._localOutgoingSS=t.stream,this._qualityMetricsCallback&&(this._localOutgoingSS.onQualityMetrics=this._qualityMetricsCallback),this._localStreamOptions=t.options,this._initCallbacks(this._localOutgoingSS);let i=this.getEmptyMediaStream();i?this._localOutgoingSS.start([i]):this._localOutgoingSS.start([]),this._impl.dispatchEvent(e.LiveLocalScreenStopped)}).catch(e=>{console.warn("LiveScreenSharing::startDummyScreenShare could not start local outgoing stream",e)}),$("#oracle-live-remote-screenshare").off("resize").on("resize",()=>{this._showScreenSharePending&&(console.log("Have been waiting for this resize - showing incoming screen share now.."),this.showIncomingScreenShareNow())})}cleanSharedTrack(){this._sharedTrack&&(this._sharedTrack.stop(),this._sharedTrack=null)}startSendingScreenShareStream(e){console.log("LiveScreenSharing::startSendingScreenShareStream got permission to start"),this._impl.acceptUpgradeRequest(),this.populateScreenShareStream(e,!0).then(()=>{console.log("Track is replaced - other party can show the screen share again"),this.showHideScreenShare(!0)}).catch(e=>{console.warn("LiveScreenSharing::startSendingScreenShareStream: populate call failed:",e)})}getDisplaySurface(){return this._screenShareStreamSettings.displaySurface}startSendingScreenShare(){if(!this.isPermanentTwoWayScreenShare())return void this.startSendingScreenShareOriginal();if(console.log("LiveScreenSharing::startSendingScreenShare: remoteSS=",this._remoteOutgoingSS),this._remoteOutgoingSS)return console.log("LiveScreenSharing::startSendingScreenShare Remote SS stream already active"),this._impl.dispatchEvent(e.LiveLocalScreenStopped),void this._impl.declineUpgradeRequest();const t=(t,i)=>{console.warn(t,i),this._impl.declineUpgradeRequest(),this._impl.dispatchEvent(e.LiveLocalScreenStopped),this.stopSendingScreenShare(),this._isFirefox()&&this._impl.dispatchEvent(e.LiveMessageEmitted,"shareScreenDeclined")};if(this._isChrome()&&(console.log("Checking Chrome version >= ",this._minChromeVersionForScreenShare),parseInt(this._impl._browserVersion)<this._minChromeVersionForScreenShare))return this._impl.dispatchEvent(e.LiveMessageEmitted,"application_get_latest_browser_version"),console.log("In order to share your screen from Chrome you need version "+this._minChromeVersionForScreenShare+" or later"),void t("LiveScreenSharing::startSendingScreenShare error when starting screenshare:","Your Chrome version ("+this._impl._browserVersion+") is inadequate - must be "+this._minChromeVersionForScreenShare+" or later");if(this._isSafari()&&(console.log("Checking Safari version >= ",this._minSafariVersionForScreenShare),parseInt(this._impl._browserVersion)<this._minSafariVersionForScreenShare))return this._impl.dispatchEvent(e.LiveMessageEmitted,"application_get_latest_browser_version"),console.log("In order to share your screen from Safari you need version "+this._minSafariVersionForScreenShare+" or later"),void t("LiveScreenSharing::startSendingScreenShare error when starting screenshare:","Your Safari version ("+this._impl._browserVersion+") is inadequate - must be "+this._minSafariVersionForScreenShare+" or later");let i=!1;if(this._isFirefox()&&(console.log("Checking Firefox version >= ",this._minFirefoxVersionForGetDisplayMedia),parseInt(this._impl._browserVersion)<this._minFirefoxVersionForGetDisplayMedia&&(i=!0)),this._screenShareStreamSettings={},i)console.log("Using getUserMedia"),this._getMediaConstraints().then(e=>(console.log("LiveScreenSharing::startSendingScreenShare got constraints",e),navigator.mediaDevices.getUserMedia(e))).then(e=>{this.startSendingScreenShareStream(e)}).catch(e=>{t("LiveScreenSharing::startSendingScreenShare error when starting screenshare:",e)});else{console.log("Using getDisplayMedia");let e={video:!0};navigator.mediaDevices.getDisplayMedia(e).then(e=>{this._screenShareStreamSettings=e.getTracks()[0].getSettings(),console.log("Stream settings are: ",this._screenShareStreamSettings),this.startSendingScreenShareStream(e)},e=>{console.log("Unable to acquire screen capture",e),t("LiveScreenSharing::startSendingScreenShare error when starting screenshare:",e)})}}startSendingScreenShareOriginal(){if(console.log("LiveScreenSharing::startSendingScreenShareOriginal"),this._remoteOutgoingSS)return console.log("LiveScreenSharing::startSendingScreenShareOriginal Remote SS stream already active"),this._impl.dispatchEvent(e.LiveLocalScreenStopped),void this._impl.declineUpgradeRequest();const t=(t,i)=>{console.warn(t,i),this._impl.declineUpgradeRequest(),this._impl.dispatchEvent(e.LiveLocalScreenStopped),this.stopSendingScreenShare(),this._isFirefox()&&this._impl.dispatchEvent(e.LiveMessageEmitted,"shareScreenDeclined")};this.createScreenShareStream(!0).then(e=>{this._localOutgoingSS=e.stream,this._qualityMetricsCallback&&(this._localOutgoingSS.onQualityMetrics=this._qualityMetricsCallback),this._localStreamOptions=e.options,this._initCallbacks(this._localOutgoingSS),this._isChrome()||this._isSafari()?(console.log("We're in Chrome or Safari so we'll use getDisplayMedia.."),navigator.mediaDevices.getDisplayMedia({video:!0}).then(e=>{console.log("We have a media stream from getDisplayMedia"),this._impl.acceptUpgradeRequest(),this._localOutgoingSS.start([e])},e=>{console.log("Unable to acquire screen capture",e)})):this._getMediaConstraints().then(e=>(console.log("LiveScreenSharing::startSendingScreenShareOriginal got constraints ",e),navigator.mediaDevices.getUserMedia(e))).then(e=>{console.log("LiveScreenSharing::startSendingScreenShareOriginal got permission to start"),this._impl.acceptUpgradeRequest(),this._localOutgoingSS.start([e])}).catch(e=>{t("LiveScreenSharing::startSendingScreenShareOriginal error when starting screenshare:",e)})}).catch(e=>{t("LiveScreenSharing::startSendingScreenShareOriginal error when creating screenshare stream:",e),console.warn("LiveScreenSharing::startSendingScreenShareOriginal Could not start local stream",e)})}isPermanentTwoWayScreenShare(){return this._impl._permanentTwoWayScreenShare}clearPendingScreenShare(){this._showScreenSharePending=!1,this._screenSharePendingTimeout&&(clearTimeout(this._screenSharePendingTimeout),this._screenSharePendingTimeout=null)}showIncomingScreenShareNow(){console.log("Showing incoming screen share right now",this._localIncomingSS,this._remoteIncomingSS),this.clearPendingScreenShare(),this._remoteScreenShareActive=!0,$(".oracle-live-remote-screenshare").show(),this._impl.dispatchEvent(e.LiveRemoteScreenStarted)}showIncomingScreenShare(){console.log("We've been told to show incoming screen share"),this._isFirefox()||this._haveDisplayedIncomingScreenShareInThisCallAlready?this.showIncomingScreenShareNow():(console.log("First time, non-FF: we'll rely on screen resize to inform us of remote screen share arrival"),this._showScreenSharePending=!0,this._screenSharePendingTimeout=setTimeout(()=>{console.log("We're giving up waiting for resize event to trigger showing of screen share"),this.showIncomingScreenShareNow()},1500)),this._haveDisplayedIncomingScreenShareInThisCallAlready=!0}hideIncomingScreenShare(){console.log("We've been told to hide incoming screen share"),this._remoteScreenShareActive=!1,$(".oracle-live-remote-screenshare").hide(),this._impl.dispatchEvent(e.LiveRemoteScreenStopped)}showHideScreenShare(t){console.log("showHideScreenShare("+t+")"),this._impl._conversation?t?(console.log("Web API sending relay message to show screen share"),this._impl._conversation.relayCommandTo(null,"*","show_screen_share",[{}]),this._impl.dispatchEvent(e.LiveLocalScreenStarted)):(console.log("Web API sending relay message to hide screen share"),this._impl._conversation.relayCommandTo(null,"*","hide_screen_share",[{}]),this._impl.dispatchEvent(e.LiveLocalScreenStopped),this.cleanSharedTrack(),this.stopOutgoingSSVideo()):console.log("No conversation, so showHideScreenShare("+t+") call having no effect"),this._localScreenShareActive=t}stopSendingScreenShare(){this.isPermanentTwoWayScreenShare()?(console.log("LiveScreenSharing: stopSendingScreenShare"),this.showHideScreenShare(!1)):this.stopSendingScreenShareOriginal()}stopSendingScreenShareOriginal(){console.log("LiveScreenSharing: stopSendingScreenShareOriginal"),this._impl.stopStream(this._localMedia),this._localMedia=null,this._localScreenShareActive=!1,this._localOutgoingSS&&(this._localOutgoingSS.end(),this._localOutgoingSS=null),this._impl.dispatchEvent(e.LiveLocalScreenStopped)}pauseResumeStream(e){console.log("LiveScreenSharing: pauseResumeStream",e),this._localOutgoingSS&&(console.log("LiveScreenSharing: pauseResumeStream - local outgoing:",this._localOutgoingSS),this._localOutgoingSS.pauseResumeStream(e)),this._localIncomingSS&&(console.log("LiveScreenSharing: pauseResumeStream - local incoming:",this._localIncomingSS),this._localIncomingSS.pauseResumeStream(e))}streamJoined(e){console.log("=== LiveScreenSharing: streamJoined",e),"recvonly"===e.streamOptions.videoConfig&&(console.log("=== streamJoined: Our dummy screen share has started - make sure we've got it paused"),this._localScreenShareActive?console.log("Looks like an associate reconnect.. leaving the (currently shared) stream alone"):this.isPermanentTwoWayScreenShare()&&this.stopOutgoingSSVideo())}pauseResumeOutgoing(e){if(console.log("LiveScreenSharing: pauseResumeOutgoing: paused=",e),this._localOutgoingSS&&this._localOutgoingSS.call){let t=this._localOutgoingSS.call.peerConnection;if(t){let i=t.getSenders().find(e=>"video"===e.track.kind),o=e?"pausing":"resuming";console.log("LiveScreenSharing: "+o+" video track:",i.track),i.track.enabled=!e}}}stopOutgoingSSVideo(){if(console.log("LiveScreenSharing: stopOutgoingSSVideo"),this._localOutgoingSS){this.populateEmptyScreenShareStream(),console.log("Attempting to disable video tracks of hidden outgoing screen share stream (to save RTP)");let e=this._localOutgoingSS.call.peerConnection;if(e){let t=e.getSenders().find(e=>"video"===e.track.kind);console.log("Disabling video track of sender",t.track,t),t.track.enabled=!1}}}beforeUnload(){!0===this._localScreenShareActive?(console.log("LiveScreenSharing::beforeUnload - attempt to stop local screenshare"),this._restartSendingScreenShare=!0,this.stopSendingScreenShare()):console.log("LiveScreenSharing::beforeUnload - do nothing")}resume(e){console.log("======= LiveScreenSharing::resume",e),this._restoredStreams.push(e)}maybeSelectRemoteSS(){console.log("LiveScreenSharing::maybeSelectRemoteSS: remoteScreenShareActive=",this._remoteScreenShareActive,this._localIncomingSS,this._remoteIncomingSS),this._localIncomingSS&&this._remoteIncomingSS&&(console.log("Setting layout on incoming screen share"),this._remoteIncomingSS.setLayout(live.STREAMSIZE.PRIMARY,this._localIncomingSS))}isActive(){return!!this._localOutgoingSS||!!this._localIncomingSS}_resumeScreenShare(){if(console.log("=== LiveScreenSharing::_resumeScreenShare",this._restoredStreams),this._restoredStreams.forEach(e=>{console.log("resuming stream",e);const t=e.getId();t===this._localOutgoingStreamId?(console.log("=== (this is _localOutgoingSS)"),this._localOutgoingSS=e):t===this._localIncomingStreamId?(console.log("=== (this is _localIncomingSS)"),this._localIncomingSS=e):t===this._remoteOutgoingStreamId?(console.log("=== (this is _remoteOutgoingSS)"),this._remoteOutgoingSS=e):t===this._remoteIncomingStreamId&&(console.log("=== (this is _remoteIncomingSS)"),this._remoteIncomingSS=e)}),console.log("=== Assigned local and remote streams: ","_localOutgoingSS:",this._localOutgoingSS,"_remoteOutgoingSS:",this._remoteOutgoingSS,"_localIncomingSS:",this._localIncomingSS,"_remoteIncomingSS:",this._remoteIncomingSS),this._localOutgoingSS){console.log("LiveScreenSharing::resume: resuming hidden outgoing stream");try{this._initCallbacks(this._localOutgoingSS),this._localOutgoingSS.resume(()=>{console.log("LiveScreenSharing::resume: local outgoing stream resumed"),this.stopOutgoingSSVideo()},e=>{console.log("LiveScreenSharing::resume: FAILED to resume local outgoing SS stream:",e)})}catch(e){console.warn("LiveScreenSharing::resume could not restart outgoing screen share stream",e)}}if(this._localIncomingSS){console.log("LiveScreenSharing::resume: resuming hidden incoming stream");try{this._initCallbacks(this._localIncomingSS),this._localIncomingSS.resume(()=>{console.log("LiveScreenSharing::resume: local incoming stream resumed")},e=>{console.log("LiveScreenSharing::resume: FAILED to resume local incoming SS stream:",e)})}catch(e){console.warn("LiveScreenSharing::resume could not restart incoming screen share stream",e)}}!0===this._restartSendingScreenShare&&(console.log("LiveScreenSharing::resume ask user if they want to start the screenshare again"),this.startSendingScreenShare(),this._restartSendingScreenShare=!1)}_isChrome(){return"Chrome"===this._impl._browserName}_isFirefox(){return"Firefox"===this._impl._browserName}_isSafari(){return"Safari"===this._impl._browserName}reset(){this._remoteScreenShareActive=!1,this._localScreenShareActive=!1,this._restartSendingScreenShare=!1,this._localStreamOptions=null,this._remoteStreamId=null,this._remoteOutgoingSS=null,this._remoteIncomingSS=null,this._remoteOutgoingStreamId=null,this._remoteIncomingStreamId=null,this._localOutgoingSS=null,this._localIncomingSS=null,this._localOutgoingStreamId=null,this._localIncomingStreamId=null,this._sharedTrack=null,this._screenShareArrivingCanvasReady=!1,this._showScreenSharePending=!1,this._haveSharedScreenInThisCallAlready=!1,this._screenSharePendingTimeout=null,this._haveDisplayedIncomingScreenShareInThisCallAlready=!1,this._screenShareStreamSettings={}}_getMediaConstraints(){if(this._isFirefox()){const e={video:{mediaSource:"window"}};return Promise.resolve(e)}if(this._isSafari()){const e={video:{mediaSource:"window"}};return Promise.resolve(e)}console.warn("_getMediaConstraints() called, but doing nothing, for browser: "+this._impl._browserName)}_initCallbacks(e){console.log("Adding callbacks to stream:",e),e.withCallbacks(this.detectWhenScreenSharingHasChangedState.bind(this,e),this._makeScreenSharingStreamsLive.bind(this),this.detectWhenScreenSharingIsUpdated.bind(this,e),this.detectWhenStreamHasFailed.bind(this),this.detectStreamPauseResumeRequest.bind(this),this.detectWhenStreamOptionsAreUpdated.bind(this))}detectWhenScreenSharingHasChangedState(e,t){console.log("LiveScreenSharing: detectWhenScreenSharingHasChangedState: streamState=",JSON.stringify(t,null,2),e);const i=t.state,o=t.status,n=0+o.code,a=o.reason;switch(this._impl._connection.logEventTimestamp("ssStreamStateTo"+i),i){case live.STREAMSTATE.FAILED:case live.STREAMSTATE.ENDED:this._impl.onScreenShareEnded();break;case live.STREAMSTATE.ESTABLISHED:this._impl.onCallEstablished(!0),this._localStreamOptions.videoConfig===live.MEDIADIRECTION.SENDRECV&&(console.log("LiveScreenSharing: Downgrade local SS to sendonly"),this._localStreamOptions=live.StreamInfo.createStreamOptions(live.MEDIADIRECTION.INACTIVE,live.MEDIADIRECTION.SENDONLY),e.update(this._localStreamOptions));break;case live.STREAMSTATE.ERROR:console.log("LiveAudioVideo: detectWhenStreamHasChangedState - ERROR: code="+n+", reason="+a),n===live.ERRORCODE.ICE_CONNECTION_ERROR&&(console.log("LiveScreenSharing: ICE connection error"),this._impl.onCallStreamStateError())}}detectStreamPauseResumeRequest(t,i,o,n){const a=n.reason,r=a===live.PAUSERESUMEREASON.PAUSE_RESUME,s=n.audio===live.PAUSERESUME.PAUSE&&n.video===live.PAUSERESUME.PAUSE;console.log("LiveScreenSharing::detectStreamPauseResumeRequest() reason=",a,", isPause=",s),r&&(o.accept(),this.pauseResumeStream(n),s?this._impl.dispatchEvent(e.LivePausedRemotely):this._impl.dispatchEvent(e.LiveResumedRemotely))}_makeScreenSharingStreamsLive(t,i){if(console.log("LiveScreenSharing::_makeScreenSharingStreamsLive: event=",t,i),i instanceof RTCRtpReceiver||i instanceof RTCRtpSender){if(null===i.track)return void console.log("LiveScreenSharing::_makeScreenSharingStreamsLive: ignore screen-sharing event without video")}else if(0===i.getVideoTracks().length)return void console.log("LiveScreenSharing::_makeScreenSharingStreamsLive: ignore screen-sharing event without video");const o=$(".oracle-live-local-screenshare"),n=$(".oracle-live-remote-screenshare");switch(t){case live.MEDIASTREAMEVENT.LOCAL_STREAM_ADDED:this._localMedia=i,o.length?(this._impl._av.attachToMedia(i,o[0],!1,this.detectWhenScreenSharingEnds.bind(this)),this.isPermanentTwoWayScreenShare()||this._impl.dispatchEvent(e.LiveLocalScreenStarted)):console.error("LiveScreenSharing: _makeScreenSharingStreamsLive no element");break;case live.MEDIASTREAMEVENT.LOCAL_STREAM_REMOVED:this._impl.stopStream(this._localMedia),this._localMedia=null,o.length?o[0].srcObject=null:console.error("LiveScreenSharing: _makeScreenSharingStreamsLive No screen share element"),this.isPermanentTwoWayScreenShare()||this._impl.dispatchEvent(e.LiveLocalScreenStopped);break;case live.MEDIASTREAMEVENT.REMOTE_STREAM_ADDED:n.length?(this._impl._av.attachToMedia(i,n[0],!1),this.isPermanentTwoWayScreenShare()||(this._remoteScreenShareActive=!0,n.show(),this._impl.dispatchEvent(e.LiveRemoteScreenStarted))):console.error("LiveScreenSharing: _makeScreenSharingStreamsLive no element");break;case live.MEDIASTREAMEVENT.REMOTE_STREAM_REMOVED:this._remoteScreenShareActive=!1,n.length?(n[0].srcObject=null,n.hide()):console.error("LiveScreenSharing: _makeScreenSharingStreamsLive no element"),this._impl.dispatchEvent(e.LiveRemoteScreenStopped)}}detectWhenScreenSharingEnds(){console.log("LiveScreenSharing: detectWhenScreenSharingEnds"),this.stopSendingScreenShare()}detectWhenScreenSharingIsUpdated(e,t){console.log("LiveScreenSharing: detectWhenScreenSharingIsUpdated",t),e&&(this._localStreamOptions=t,e.accept(t))}detectWhenStreamHasFailed(t){console.log("LiveScreenSharing: detectWhenStreamHasFailed, error="+JSON.stringify(t,null,2)),this._impl.dispatchEvent(e.LiveStreamError)}detectWhenStreamOptionsAreUpdated(e,t,i,o){console.log("LiveScreenSharing: detectWhenStreamOptionsAreUpdated: streamRequest="+JSON.stringify(i,null,2)+", streamOptions="+JSON.stringify(o,null,2),t),i.accept(),t&&(this._localStreamOptions=o,t.accept(o))}isScreenScreenSharePossible(){return this._isFirefox()||this._isChrome()}_addCanvasBackground(){return this._screenShareArrivingCanvasReady?Promise.resolve():new Promise((e,t)=>{console.log("adding screenshare-arriving canvas background image"),this._canvas=document.querySelector("#screen-share-arriving"),console.log("have found screen share canvas:",this._canvas);let i=this._canvas.getContext("2d");i.font="14px Arial",i.fillStyle="white",i.textAlign="center",i.fillText("Screen Share Frames Arriving...",this._canvas.width/2,this._canvas.height/2),this._screenShareArrivingCanvasReady=!0,e()})}}}),liveRequire.define("LiveAudioVideo",["jquery","LiveEvents","LiveSessionStore"],function($,e,t){"use strict";return class{constructor(e){this._impl=e,this._avStream1=null,this._avStream2=null,this._newAssociateAvStream=null,this._av1StreamId=null,this._av2StreamId=null,this._newAssociateAvStreamId=null,this._localAudioStream=null,this._localVideoStream=null,this._previewStream=null,this._localStreamOptions=null,this._originalStreamOptions=null,this._userVideoInitiallyPaused=!1,this._associateVideoInitiallyPaused=!1,this._userIsCurrentlyPaused=!1,this._upgradePauseResume=null,this._sidebar=!1,this._qualityMetricsCallback=null,this._currentCameraId=null,this._cameras=[],this._hasTwoCameras=!1,t.initState("LiveAudioVideo",this),$(()=>{console.log("LiveAudioVideo: Loading"),t.loadState("LiveAudioVideo",e=>{this._localStreamOptions=e.localStreamOptions,this._originalStreamOptions=e.originalStreamOptions,this._av1StreamId=e.av1StreamId,this._av2StreamId=e.av2StreamId,this._userVideoInitiallyPaused=e.userVideoInitiallyPaused,this._associateVideoInitiallyPaused=e.associateVideoInitiallyPaused,this._userIsCurrentlyPaused=e.userIsCurrentlyPaused,this._hasTwoCameras=e.hasTwoCameras,this._currentCameraId=e.currentCameraId,this._cameras=e.cameras,console.log("LiveAudioVideo: Loaded, AV1="+this._av1StreamId+", AV2="+this._av2StreamId),console.log("LiveAudioVideo: Loaded, currentCameraId=",this._currentCameraId)})})}toJSON(){return JSON.stringify({localStreamOptions:this._localStreamOptions,originalStreamOptions:this._originalStreamOptions,av1StreamId:this._avStream1?this._avStream1.getId():null,av2StreamId:this._avStream2?this._avStream2.getId():null,userVideoInitiallyPaused:this._userVideoInitiallyPaused,associateVideoInitiallyPaused:this._associateVideoInitiallyPaused,userIsCurrentlyPaused:this._userIsCurrentlyPaused,hasTwoCameras:this._hasTwoCameras,currentCameraId:this._currentCameraId,cameras:this._cameras})}loadComplete(){console.log("LiveAudioVideo: Load complete"),this._av1StreamId&&this._impl._conversation&&(console.log("LiveAudioVideo: Attempting to resolve AV1: "+this._av1StreamId),this._avStream1=this._impl._conversation.getAudioVideoStream(this._av1StreamId),this._avStream1&&this._avStream1.getId()===this._av1StreamId||(this._avStream1=null,this._av1StreamId=null)),this._av2StreamId&&this._impl._conversation&&(console.log("LiveAudioVideo: Attempting to resolve AV2: "+this._av2StreamId),this._avStream2=this._impl._conversation.getAudioVideoStream(this._av2StreamId),this._avStream2&&this._avStream2.getId()===this._av2StreamId&&this._avStream2.getId()!==this._av1StreamId||(this._avStream2=null,this._av2StreamId=null)),this._showSwapCameraButton()}_isEdge(){return"Edge"===this._impl._browserName}isActive(){return!!this._avStream1||!!this._avStream2}_showSwapCameraButton(){const e=$(".oracle-live-swap-camera");e&&(this._hasTwoCameras?(console.log("LiveAudioVideo:_showSwapCameraButton removing oracle-live-hide-camera-swap-button class"),e.removeClass("oracle-live-hide-camera-swap-button")):(console.log("LiveAudioVideo:_showSwapCameraButton adding oracle-live-hide-camera-swap-button class"),e.addClass("oracle-live-hide-camera-swap-button")))}_getCameraDeviceIds(e){console.log("LiveAudioVideo::_getCameraDeviceIds"),e.forEach(e=>{if("videoinput"===e.kind){console.log("LiveAudioVideo::_getCameraDeviceIds found a camera: ",e);const t={deviceId:e.deviceId,label:e.label,isFront:e.label.toLowerCase().includes("front")};this._cameras.push(t)}}),console.log("LiveAudioVideo::_getCameraDeviceIds cameras: ",this._cameras),this._hasTwoCameras=this._cameras.length>1,this._showSwapCameraButton()}_getDifferentCameraId(e){let t;return console.log("LiveAudioVideo::_getDifferentCameraId"),this._cameras&&(t=this._cameras.find(t=>(console.log("LiveAudioVideo::_getDifferentCameraId  camera: ",t),t.deviceId&&t.deviceId!==e))),t?t.deviceId:e}_getCameraStreamWithDeviceId(e,t,i){console.log(`getCameraStream for camera with deviceId: ${e}`);let o=null;const n={audio:"Idle"===this._impl._buttonState.stateName,video:{width:{min:640,ideal:1024,max:1920},height:{min:360,ideal:768,max:1080},deviceId:{exact:e}}};navigator.mediaDevices.getUserMedia(n).then(e=>{console.log("_getCamera: we got a stream"),t(o=e)}).catch(t=>{console.log(`getCameraStream failed to obtain stream for camera with deviceID: ${e}`),console.error("getCameraStream error:  ",t),console.error(`getCameraStream error:  name: ${t.name}   message: ${t.message}`),i(t)})}reset(){this._impl.stopStream(this._localAudioStream),this._impl.stopStream(this._localVideoStream),this._impl.stopStream(this._previewStream),this._avStream1=null,this._avStream2=null,this._activeLocalVideoTrack=null,this._av1StreamId=null,this._av2StreamId=null,this._localAudioStream=null,this._localVideoStream=null,this._previewStream=null,this._localStreamOptions=null,this._originalStreamOptions=null,this._userVideoInitiallyPaused=!1,this._associateVideoInitiallyPaused=!1,this._userIsCurrentlyPaused=!1,this._upgradePauseResume=null,this._sidebar=!1,this._currentCameraId=null}start(e,t,i){console.log("LiveAudioVideo: start");let o=!1;this._previewStream&&this._previewStream.getVideoTracks()&&this._previewStream.getVideoTracks()[0]&&(o=!0),console.log("LiveAudioVideo: start -  usePreviewStream: ",o),this._avStream1=this._impl._conversation.createAudioVideoStream(e,null,t),this._av1StreamId=this._avStream1.getId(),this._localStreamOptions=e;const n=e=>{this._initCallbacks(this._avStream1),this._avStream1.start(e)};if(this._qualityMetricsCallback&&(this._avStream1.onQualityMetrics=this._qualityMetricsCallback),i)console.log("LiveAudioVideo: start - Attempting to use custom constraints: "+JSON.stringify(i,null,2)),navigator.mediaDevices.getUserMedia(i).then(e=>{console.log("LiveAudioVideo: start - Got media for custom constraints",e),this._localVideoStream=e,n(e)}).catch(e=>{console.log("LiveAudioVideo: start - Failed to getUserMedia with custom constraints",e),n(null)});else if(o){console.log("LiveAudioVideo: start - starting local av stream with clone of the previewStream");const e=this._previewStream.clone();n(e)}else n(null)}resume(e){const t=e.getId();if(console.log("LiveAudioVideo: resume, stream id=",t),t===this._av1StreamId)this._avStream1=e,this._initCallbacks(this._avStream1),console.log("LiveAudioVideo: resume - AV1");else{if(t!==this._av2StreamId)return void console.warn("LiveAudioVideo: resume - Invalid stream ID: "+t,e);this._avStream2=e,this._initCallbacks(this._avStream2),console.log("LiveAudioVideo: resume - AV2")}new Promise((t,i)=>{e.resume(t,i)}).then(()=>{console.log("LiveAudioVideo: resume - AV stream resumed",e),this._impl.addQualityMonitor(),this._impl.reconnectedLocal()}).catch(e=>{console.log("LiveAudioVideo: resume - FAILED to resume AV stream:",e),t===this._av1StreamId&&this._impl.reset()})}_initCallbacks(e){e.withCallbacks(this.detectWhenStreamHasChangedState.bind(this,e),this.makeAudioVideoStreamsLive.bind(this),this.detectWhenAudioVideoIsUpdated.bind(this,e),this.detectWhenStreamHasFailed.bind(this,e),this.detectStreamPauseResumeRequest.bind(this))}stop(){console.log("LiveAudioVideo: stop"),this._avStream1&&(console.log("LiveAudioVideo: stop - AV1"),this._avStream1.end(),this._avStream1=null,this._av1StreamId=null),this._avStream2&&(console.log("LiveAudioVideo: stop - AV2"),this._avStream2.end(),this._avStream2=null,this._av2StreamId=null)}streamJoined(e){if(console.log("LiveAudioVideo: streamJoined, userPaused="+this._userVideoInitiallyPaused+", assocPaused="+this._associateVideoInitiallyPaused,e),this.isActive()&&(this._userVideoInitiallyPaused&&this.stopVideo(),this._associateVideoInitiallyPaused)){const t=e.getStreamProfile();t.upgraded=!1,t.paused_by=this._impl.service.userID,t.pauseResume.pausedBy=this._impl.service.userID,t.pauseResume.video=live.PAUSERESUME.PAUSE,t.pauseResume.reason=live.PAUSERESUMEREASON.UPGRADE_DOWNGRADE,console.log("LiveAudioVideo: Associate is initially paused - updating stream profile",t),e.pauseResumeStream(t.pauseResume)}}stopRemote(e){console.log("LiveAudioVideo: Stop the remote stream",e);const t=e.getId();this._avStream1&&this._avStream2&&this._av1StreamId===t&&(console.log("LiveAudioVideo: Switch to sidebar: AV2 -> AV1"),this._sidebar=!0,this._avStream1=this._avStream2,this._av1StreamId=this._av2StreamId,this._avStream2=null,this._av2StreamId=null)}pauseResumeStream(e){this._avStream1&&this._avStream1.pauseResumeStream(e,()=>{console.log("LiveAudioVideo: pauseResumeStream - AV1 successful"),this._userIsCurrentlyPaused=this._avStream1.isVideoPaused()},e=>{console.log("LiveAudioVideo: pauseResumeStream - AV1 failed",e)}),this._avStream2&&this._avStream2.pauseResumeStream(e,()=>{console.log("LiveAudioVideo: pauseResumeStream - AV2 successful"),this._userIsCurrentlyPaused=this._avStream1.isVideoPaused()},e=>{console.log("LiveAudioVideo: pauseResumeStream - AV2 failed",e)})}makeAudioVideoStreamsLive(t,i){console.log("LiveAudioVideo: makeAudioVideoStreamsLive - event="+t,i);let o,n,a,r,s=!1,l=null;i instanceof RTCRtpReceiver||i instanceof RTCRtpSender?i.track&&"video"===i.track.kind&&(s=!0,l=i.track.getSettings().deviceId):(s=i.getVideoTracks().length>0,i.getVideoTracks()&&i.getVideoTracks()[0]&&(l=i.getVideoTracks()[0].getSettings().deviceId)),console.log("LiveAudioVideo: makeAudioVideoStreamsLive - deviceId: ",l),console.log("LiveAudioVideo: makeAudioVideoStreamsLive - stream has video="+s);let c=$(".oracle-live-local-video"),d=$(".oracle-live-remote-video");switch(t){case live.MEDIASTREAMEVENT.LOCAL_STREAM_ADDED:if(s){r=document.querySelector(".oracle-live-local-video"),console.log("LiveAudioVideo: Have local video: ",r);const t=this._userVideoInitiallyPaused||this._userIsCurrentlyPaused;console.log("LiveAudioVideo: User video is paused="+t),r&&(console.log("LiveAudioVideo: Setting local video stream",i),this._localVideoStream=i,this.attachToMedia(i,r,t)),t||(c.show(),this._impl.dispatchEvent(e.LiveLocalVideoStarted)),console.log("LiveAudioVideo: currentCameraId: ",this._currentCameraId),console.log("LiveAudioVideo: deviceId: ",l),this._currentCameraId&&l?l!==this._currentCameraId&&(this._currentCameraId=l,this.swapCamera()):this._currentCameraId=l}else a=document.querySelector(".oracle-live-local-audio"),console.log("LiveAudioVideo: Have local audio: ",a),a&&(console.log("LiveAudioVideo: Setting local audio stream",i),this._localAudioStream=i,a.srcObject=i,this.playMedia(a));break;case live.MEDIASTREAMEVENT.LOCAL_STREAM_REMOVED:console.log("LiveAudioVideo: Processing LOCAL_STREAM_REMOVED event"),(a=document.querySelector(".oracle-live-local-audio"))&&(a.srcObject=null),this._impl.stopStream(this._localAudioStream),this._localAudioStream=null,(r=document.querySelector(".oracle-live-local-video"))&&(r.srcObject=null),this._impl.stopStream(this._localVideoStream),this._localVideoStream=null,c.hide(),this._impl.dispatchEvent(e.LiveLocalVideoStopped);break;case live.MEDIASTREAMEVENT.REMOTE_STREAM_ADDED:if(s){if(n=document.querySelector(".oracle-live-remote-video")){let t=this._associateVideoInitiallyPaused;const o=this._impl._conversation.getRemoteParticipant();if(o){const e=o.getStreamInfos()[0].getStreamOptions(),i=o.getStreamInfos()[0].getStreamProfile();e&&(console.log("LiveAudioVideo: Remote stream options: video="+e.videoConfig),t=t||e.videoConfig===live.MEDIADIRECTION.RECVONLY||e.videoConfig===live.MEDIADIRECTION.INACTIVE),i&&(console.log("LiveAudioVideo: Remote stream profile: "+JSON.stringify(i,null,2)),t=t||!i.upgraded||i.pauseResume.video===live.PAUSERESUME.PAUSE&&i.pauseResume.reason===live.PAUSERESUMEREASON.UPGRADE_DOWNGRADE)}console.log("LiveAudioVideo: Remote video is paused="+t),this.attachToMedia(i,n,t),d.show(),t||this._impl.dispatchEvent(e.LiveRemoteVideoStarted)}}else(o=document.querySelector(".oracle-live-remote-audio"))&&(o.srcObject=i,this.playMedia(o));break;case live.MEDIASTREAMEVENT.REMOTE_STREAM_REMOVED:s?((n=document.querySelector(".oracle-live-remote-video"))&&(n.srcObject=null),d.hide(),this._impl.dispatchEvent(e.LiveRemoteVideoStopped)):(o=document.querySelector(".oracle-live-remote-audio"))&&(o.srcObject=null)}}attachToMedia(e,t,i,o){if(e&&t){console.log("LiveAudioVideo: attachToMedia: stream=",e,", media=",t),e instanceof RTCRtpReceiver||e instanceof RTCRtpSender?(e.track&&"video"===e.track.kind&&(e.track.enabled=!1),e.track&&"audio"===e.track.kind&&(e.track.enabled=!1)):(e.getVideoTracks().forEach(e=>{e.enabled=!1}),e.getAudioTracks().forEach(e=>{e.enabled=!1}));const n=()=>{console.log("LiveAudioVideo: Loaded metadata",e),t.removeEventListener("loadedmetadata",n);let a=!i||"Safari"===this._impl._browserName;e instanceof RTCRtpReceiver||e instanceof RTCRtpSender?(e.track&&"video"===e.track.kind&&(console.log("LiveAudioVideo: Loaded metadata: downgradedVideo="+i),e.track.enabled=a,console.log("LiveAudioVideo: video track enabled = "+e.track.enabled),o&&(e.track.onended=o)),e.track&&"audio"===e.track.kind&&(e.track.enabled=!0)):(e.getVideoTracks().forEach(e=>{console.log("LiveAudioVideo: Loaded metadata: downgradedVideo="+i),e.enabled=a,console.log("LiveAudioVideo: video track enabled = "+e.enabled),o&&(e.onended=o)}),e.getAudioTracks().forEach(e=>{e.enabled=!0}))};"Safari"===this._impl._browserName?n():t.addEventListener("loadedmetadata",n,{once:!0}),t.srcObject=e,this.playMedia(t)}}playMedia(e){e&&"function"==typeof e.play&&(console.log("Start playing media"),this._isEdge()?e.play():e.play().then(()=>{console.log("Started playing media")}).catch(e=>{console.log("Failed to start playing media",e)}))}detectWhenStreamHasChangedState(e,t){console.log("LiveAudioVideo: detectWhenStreamHasChangedState - streamState=",JSON.stringify(t,null,2),e,this._avStream1,this._avStream2);const i=t.state,o=t.status,n=o.code+0,a=o.reason;switch(this._impl._connection.logEventTimestamp("avStreamStateTo"+i),i){case live.STREAMSTATE.ESTABLISHED:e&&e.streamId&&this._impl._rememberMyStreams(e.streamId),this._impl.onCallEstablished();break;case live.STREAMSTATE.ERROR:console.log("LiveAudioVideo: detectWhenStreamHasChangedState - ERROR: code="+n+", reason="+a),n!==live.ERRORCODE.ICE_CONNECTION_ERROR||this._sidebar||(console.log("LiveAudioVideo: ICE connection error"),this._impl.onCallStreamStateError()),this._sidebar&&(this._sidebar=!1);break;case live.STREAMSTATE.FAILED:case live.STREAMSTATE.ENDED:console.log("live.STREAMSTATE.ENDED: Stream Ended"),console.dir(e),console.log("     Call State = "+this._impl._buttonState.stateName),console.log("  transferState = "+this._impl._buttonState.transferState),"None"!==this._impl._buttonState.transferState?(this._impl._buttonState.transferState="None",console.log("TRANSFER: Ignoring live.STREAMSTATE.ENDED because this is a participant leaving")):this._avStream2?(console.log("LiveAudioVideo: Switching to sidebar: AV2 -> AV1"),this._avStream1=this._avStream2,this._av1StreamId=this._av2StreamId,this._avStream2=null,this._av2StreamId=null):(console.log("LiveAudioVideo: Ending AV1 stream"),this._impl.onCallEnded(),this._avStream1=null,this._av1StreamId=null,this.reset())}}detectWhenAudioVideoIsUpdated(e,t){console.log("LiveAudioVideo: detectWhenAudioVideoIsUpdated",t,e);const i=e.getId();this._avStream1&&i===this._av1StreamId?(this._localStreamOptions=t,this._avStream1.accept(t)):this._avStream2&&i===this._av2StreamId&&(this._localStreamOptions=t,this._avStream2.accept(t))}detectWhenStreamHasFailed(t,i){console.log("LiveAudioVideo: detectWhenStreamHasFailed, error: ",JSON.stringify(i,null,2),t);const o=t.getId();this._avStream1&&this._avStream2?this._av2StreamId===o?console.log("LiveAudioVideo: Ignore error for AV1 stream - it will end soon"):this._av2StreamId===o&&this._impl.dispatchEvent(e.LiveStreamError):this._av1StreamId===o&&this._impl.dispatchEvent(e.LiveStreamError)}detectStreamPauseResumeRequest(t,i,o,n){let a=n.reason,r=a===live.PAUSERESUMEREASON.PAUSE_RESUME,s=n.audio===live.PAUSERESUME.PAUSE&&n.video===live.PAUSERESUME.PAUSE,l=n.audio===live.PAUSERESUME.RESUME&&n.video===live.PAUSERESUME.RESUME,c=n.audio===live.PAUSERESUME.RESUME&&n.video===live.PAUSERESUME.PAUSE,d=i.getType();console.log("LiveAudioVideo: detectStreamPauseResumeRequest - reason="+a+", isPause="+s+", isUpgrade="+l+", isDowngrade="+c,n),r?(o.accept(),$(".oracle-live").hasClass("oracle-live-frozen-annotation")&&(n.video=live.PAUSERESUME.RESUME),this.pauseResumeStream(n),this._impl._screen.pauseResumeOutgoing(s),s?this._impl.dispatchEvent(e.LivePausedRemotely):this._impl.dispatchEvent(e.LiveResumedRemotely)):c?(o.accept(),d===live.STREAMTYPE.AUDIOVIDEO&&(this._impl.dispatchEvent(e.LiveLocalVideoStopped),this.pauseResumeStream(n))):l&&(this._upgradePauseResume=n,this._impl._upgradeRequest=o,this._impl._upgradeRequestStreamType=d,this._impl._upgradeRequestForUser="user",d===live.STREAMTYPE.AUDIOVIDEO&&this._impl.dispatchEvent(e.LiveStartVideoRequested))}startVideo(){console.log("LiveAudioVideo: startVideo",this._upgradePauseResume);let t=this._upgradePauseResume;if(!t){const e=live.StreamProfile.create(this._avStream1.getStreamInfo().getStreamProfile());e.upgraded=!0,e.paused_by=this._impl.service.userID,e.pauseResume.pausedBy=this._impl.service.userID,e.pauseResume.video=live.PAUSERESUME.RESUME,e.pauseResume.reason=live.PAUSERESUMEREASON.UPGRADE_DOWNGRADE,t=e.pauseResume}console.log("LiveAudioVideo: startVideo: pauseResume="+JSON.stringify(t,null,2)),this._avStream1&&this._avStream1.pauseResumeStream(t,()=>{console.log("LiveAudioVideo: Started local video avStream1"),this._impl.dispatchEvent(e.LiveLocalVideoStarted),this._userVideoInitiallyPaused=!1}),this._avStream2&&this._avStream2.pauseResumeStream(t,()=>{console.log("LiveAudioVideo: Started local video avStream2"),this._impl.dispatchEvent(e.LiveLocalVideoStarted),this._userVideoInitiallyPaused=!1}),this._upgradePauseResume=null}stopVideo(){console.log("LiveAudioVideo: stopVideo");const t=this._avStream1.getStreamInfo().getStreamProfile();t.upgraded=!1,t.paused_by=this._impl.service.userID,t.pauseResume.pausedBy=this._impl.service.userID,t.pauseResume.video=live.PAUSERESUME.PAUSE,t.pauseResume.reason=live.PAUSERESUMEREASON.UPGRADE_DOWNGRADE,this._avStream1&&this._avStream1.pauseResumeStream(t.pauseResume,()=>{console.log("LiveAudioVideo: Stopped local video avStream1"),this._impl.dispatchEvent(e.LiveLocalVideoStopped),this._userVideoInitiallyPaused=!0}),this._avStream2&&this._avStream2.pauseResumeStream(t.pauseResume,()=>{console.log("LiveAudioVideo: Stopped local video avStream2"),this._impl.dispatchEvent(e.LiveLocalVideoStopped),this._userVideoInitiallyPaused=!0})}startVideoPreview(){const t=this._avStream1&&this._avStream1.isVideoPaused()||this._avStream2&&this._avStream2.isVideoPaused()||this._userVideoInitiallyPaused;if(console.log("LiveAudioVideo: startVideoPreview: videoIsPaused="+t),this._impl.acceptUpgradeRequest(),$(".oracle-live-local-video").show(),t&&this._localVideoStream)if(console.log("LiveAudioVideo: startVideoPreview: preview in Connected state"),this._cameras&&0===this._cameras.length&&navigator.mediaDevices.enumerateDevices().then(this._getCameraDeviceIds.bind(this)),this._localVideoStream instanceof RTCRtpReceiver||this._localVideoStream instanceof RTCRtpSender)this._localVideoStream.track&&"video"===this._localVideoStream.track.kind&&(console.log("LiveAudioVideo: Enable video tracks: length=1",this._localVideoStream.track),this._localVideoStream.track.enabled=!0);else{const e=this._localVideoStream.getVideoTracks();console.log("LiveAudioVideo: Enable video tracks: length="+e.length,e),e.forEach(e=>{e.enabled=!0})}else{console.log("LiveAudioVideo: startVideoPreview: preview in Idle state");const t={audio:!0,video:{width:{min:640,ideal:1024,max:1920},height:{min:360,ideal:768,max:1080}}};this._currentCameraId&&(t.video.deviceId={exact:this._currentCameraId});const i=e=>{if(console.log("LiveAudioVideo: Got preview stream for constraints:",t),this._cameras&&0===this._cameras.length&&navigator.mediaDevices.enumerateDevices().then(this._getCameraDeviceIds.bind(this)),console.log("LiveAudioVideo: this._cameras: ",this._cameras),e instanceof RTCRtpReceiver||e instanceof RTCRtpSender)e.track&&"video"===e.track.kind&&(this._currentCameraId=e.track.getSettings().deviceId,console.log("LiveAudioVideo: Using RTCRtp video device: "+e.track.label));else{const t=e.getVideoTracks();this._currentCameraId=t[0].getSettings().deviceId,console.log("LiveAudioVideo: Using video device: "+t[0].label)}e.oninactive=(()=>{console.log("LiveAudioVideo: Preview stream inactive")}),this._previewStream=e;const i=document.getElementById("oracle-live-local-video");i?(i.srcObject=e,this.playMedia(i)):(console.warn("LiveAudioVideo: Failed to attach preview stream"),this._impl.stopStream(this._previewStream))},o=t=>{console.warn("LiveAudioVideo: Failed to get preview stream",t),this._impl.dispatchEvent(e.LiveLocalVideoStopped)};navigator.mediaDevices.getUserMedia(t).then(i.bind(this)).catch(o.bind(this))}}stopVideoPreview(){this._impl.stopStream(this._previewStream),this._previewStream=null,this._avStream1&&this._avStream1.isVideoPaused()||(this._impl.stopStream(this._localVideoStream),this._localVideoStream=null)}swapCamera(){if(console.log("LiveAudioVideo::swapCamera"),!this._hasTwoCameras)return void console.log("LiveAudioVideo::swapCamera - nothing to swap so returning");if(this._activeLocalVideoTrack=null,this._avStream1){const e=this._avStream1.call;if(e){let t=e.getPeerConnection().getSenders().find(e=>e.track&&"video"===e.track.kind);t&&(console.log("LiveAudioVideo::swapCamera - stopping sender video track"),t.track.stop())}}const e=e=>{e instanceof RTCRtpReceiver||e instanceof RTCRtpSender?e.track&&"video"===e.track.kind&&(e.track.enabled=!1,e.track.stop()):e.getVideoTracks().forEach(e=>{e.enabled=!1,e.stop()}),e=null},t=this._getDifferentCameraId(this._currentCameraId);console.log("LiveAudioVideo::swapCamera  newDeviceId: ",t);const i=document.getElementById("oracle-live-local-video");this._localVideoStream&&(console.log("LiveAudioVideo::swapCamera  stopping _localVideoStream"),e(this._localVideoStream)),this._previewStream&&(console.log("LiveAudioVideo::swapCamera  stopping preview video tracks"),e(this._previewStream)),this._getCameraStreamWithDeviceId(t,e=>{console.log("LiveAudioVideo::swapCamera: gotStream()"),$(".oracle-live").hasClass("oracle-live-video-preview")&&(console.log("LiveAudioVideo::swapCamera:  updating video preview"),this._previewStream=e,i?this.attachToMedia(this._previewStream,i,!1):(console.warn("LiveAudioVideo::swapCamera Failed to attach preview stream"),this._impl.stopStream(this._previewStream)));const t=e.getVideoTracks();if(this._currentCameraId=t[0].getSettings().deviceId,this._avStream1){console.log("LiveAudioVideo::swapCamera: _avStream1: ",this._avStream1),console.log("LiveAudioVideo::swapCamera: cameraVideoTracks",t);const e=this._avStream1.call.getPeerConnection();e&&e.getSenders().forEach(e=>{e instanceof RTCRtpSender&&e.track&&"video"===e.track.kind&&(console.log("LiveAudioVideo::swapCamera: pcSenders replacing track with camera"),e.replaceTrack(t[0]))})}this._localVideoStream=e,$(".oracle-live").hasClass("oracle-live-video-preview")||this.attachToMedia(e,i,!1)},e=>{console.log("LiveAudioVideo::swapCamera: error trying to obtain camera stream: ",e)})}enableRemoteVideo(){this._avStream1&&this._avStream1.getRemoteStreams().forEach(e=>{e instanceof RTCRtpReceiver||e instanceof RTCRtpSender?e.track&&"video"===e.track.kind&&(e.track.enabled=!0):e.getVideoTracks().forEach(e=>{e.enabled=!0})}),this._avStream2&&this._avStream2.getRemoteStreams().forEach(e=>{e instanceof RTCRtpReceiver||e instanceof RTCRtpSender?e.track&&"video"===e.track.kind&&(e.track.enabled=!0):e.getVideoTracks().forEach(e=>{e.enabled=!0})}),console.log("LiveAudioVideo: Upgraded remote stream"),this._impl.dispatchEvent(e.LiveRemoteVideoStarted),this._associateVideoInitiallyPaused=!1}disableRemoteVideo(){let t="Safari"===this._impl._browserName;this._avStream1&&this._avStream1.getRemoteStreams().forEach(e=>{e instanceof RTCRtpReceiver||e instanceof RTCRtpSender?e.track&&"video"===e.track.kind&&(e.track.enabled=t):e.getVideoTracks().forEach(e=>{e.enabled=t})}),this._avStream2&&this._avStream2.getRemoteStreams().forEach(e=>{e instanceof RTCRtpReceiver||e instanceof RTCRtpSender?e.track&&"video"===e.track.kind&&(e.track.enabled=t):e.getVideoTracks().forEach(e=>{e.enabled=t})}),console.log("LiveAudioVideo: Downgraded remote stream (except for Safari)"),this._impl.dispatchEvent(e.LiveRemoteVideoStopped)}incomingAV(e,t){let i=null,o=e.getStreamOptions();this._avStream1?(console.log("LiveAudioVideo: incomingAV: Incoming AV2 stream",e),this._avStream2=e,this._av2StreamId=this._avStream2.getId(),i=this._localStreamOptions):(console.log("LiveAudioVideo: incomingAV: Incoming AV1 stream",e),this._avStream1=e,this._av1StreamId=this._avStream1.getId(),this._originalStreamOptions=live.StreamInfo.createStreamOptions(o.audioConfig,o.videoConfig),i=this._originalStreamOptions),console.log("LiveAudioVideo: incomingAV: Old streamOptions="+JSON.stringify(i,null,2)+", New local streamOptions="+JSON.stringify(o,null,2)+", New remote streamOptions="+JSON.stringify(t,null,2));const n=this._impl._conversation.getParticipants().find(e=>e.getUri()!==this._impl._conversation.getLocalParticipantUri());let a=!1;n&&(console.log("LiveAudioVideo: Checking if remote participant only has screen-share active"),a=n.getStreamInfos().every(e=>e.getType()===live.STREAMTYPE.SCREENSHARE)),console.log("LiveAudioVideo: incomingAV: remoteScreenShareOnly="+a),this._impl._screen._restartSendingScreenShare||a?(console.log("LiveAudioVideo: remoteScreenShareActive is "+this._impl._screen._remoteScreenShareActive),o=live.StreamInfo.createStreamOptions(i.audioConfig,live.MEDIADIRECTION.RECVONLY),console.log("LiveAudioVideo: incomingAV: Have active local screen share - Overriding stream options to: "+JSON.stringify(o,null,2))):console.log("LiveAudioVideo: incomingAV: New stream options are: "+JSON.stringify(o,null,2)),this._initCallbacks(e),e.accept(o),this._localStreamOptions=o;const r=this._impl._conversation.getLocalParticipant();if(r){const t=r.getStreamInfo(e.getId());if(t){console.log("LiveAudioVideo: incomingAV: Local stream options:",t.streamOptions);const e=t.getStreamProfile();console.log("LiveAudioVideo: incomingAV: Local stream profile:",e);const i=this._impl._behaviours;if(i){let t=!1;i.associateInitialMedia&&(t=i.associateInitialMedia===i.StartMediaType.AUDIO_VIDEO||i.associateInitialMedia===i.StartMediaType.VIDEO_ONLY);const o=i.associateCanAddVideo;console.log("LiveAudioVideo: incomingAV: startWithVideo:"+t+", canAdd:"+o),t||!o||this._avStream2||(e.upgraded=!1,this._userVideoInitiallyPaused=!0,console.log("LiveAudioVideo: incomingAV: Overriding local profile to have downgraded video"))}}}if(n){const t=n.getStreamInfo(e.getId());if(t){const e=t.streamOptions;console.log("LiveAudioVideo: incomingAV: Remote stream options:",e);const i=t.getStreamProfile();if(console.log("LiveAudioVideo: incomingAV: Remote stream profile:",i),e){const t=e.videoConfig===live.MEDIADIRECTION.SENDRECV||e.videoConfig===live.MEDIADIRECTION.SENDONLY;console.log("LiveAudioVideo: incomingAV: Setting Remote upgraded on incomingAV to "+t),this._associateVideoInitiallyPaused=!t}}}}createAVStreamForNewAssociate(e,t){console.log("TRANSFER: createAVStreamForNewAssociate"),console.log("createAVStreamForNewAssociate: Call in state="+this._impl._buttonState.stateName);let i=null;if(t&&t.getStreamInfos().length>0&&(i=t.getStreamInfos()[0].streamId),console.log("createAVStreamForNewAssociate:  participant streamId="+i),this._impl._buttonState&&"Transferring"!==this._impl._buttonState.stateName)return void console.log("createAVStreamForNewAssociate: Call not in connected state");let o=live.MEDIADIRECTION.SENDRECV,n=live.MEDIADIRECTION.INACTIVE;const a=this._impl._behaviours;a?a.associateCanAddVideo&&a.associateCanRequestEndUserVideo&&a.endUserCanAddVideo?n=live.MEDIADIRECTION.SENDRECV:a.endUserCanAddVideo?n=live.MEDIADIRECTION.SENDONLY:a.associateCanAddVideo&&(n=live.MEDIADIRECTION.RECVONLY):console.log("createAVStreamForNewAssociate: No behaviours found");let r=live.StreamInfo.createStreamOptions(o,n);const s=this._impl._conversation.getLocalParticipant();if(!s)return void console.log("createAVStreamForNewAssociate: No local participant found");const l=s.getUri(),c=live.StreamProfile.create();c.paused_by=l,c.pauseResume.pausedBy=l,a.endUserInitialMedia!==a.StartMediaType.AUDIO_VIDEO&&(c.pauseResume.video=live.PAUSERESUME.PAUSE),this._newAssociateAvStream&&(console.log("newAssociateAvStream should be null. Ending it first"),this._newAssociateAvStream.end()),console.log("createAVStreamForNewAssociate: creating audio/video stream"),this._newAssociateAvStream=this._impl._conversation.createAudioVideoStream(r,i,c),this._newAssociateAvStreamId=this._newAssociateAvStream.getId(),this._qualityMetricsCallback&&(this._newAssociateAvStream.onQualityMetrics=this._qualityMetricsCallback),console.log("createAVStreamForNewAssociate: Starting AV Media"),(e=>{this._initCallbacks(this._newAssociateAvStream),this._newAssociateAvStream.start(e)})(null)}switchOverTransferStream(e){if(console.log("TRANSFER: switchOverTransferStream"),console.log("transferringAssociate: "+this._impl._transferringAssociateUri),console.log("          participant: "+e.getUri()),this._impl._transferringAssociateUri===e.getUri()){let e=null;if(this._localAudioStream){const t=this._localAudioStream,i=t.getAudioTracks();console.log("Init activeLocalAudioTrack"),e=i[0],t.removeTrack(i[0])}this._avStream1&&(console.log("Ending AV1 stream for "+this._impl._transferringAssociateUri+" (associate has left)"),this._avStream1.end()),console.log("Switching over to new associate's stream"),this._avStream1=this._newAssociateAvStream,this._av1StreamId=this._newAssociateAvStreamId,this.replaceSenderAudioTrack(e),this._newAssociateAvStream=null,this._newAssociateAvStreamId=null,this._impl._transferringAssociateUri=null}}replaceSenderVideoTrack(e){if(this._avStream1){const t=this._avStream1.call.getPeerConnection();if(t){const i=t.getSenders();console.log("*** pcSenders: ",i),i.forEach(t=>{t instanceof RTCRtpSender&&t.track&&"video"===t.track.kind&&t.replaceTrack(e)})}}}replaceSenderAudioTrack(e){if(this._avStream1){const t=this._avStream1.call.getPeerConnection();if(t){const i=t.getSenders();console.log("*** pcSenders: ",i),i.forEach(t=>{t instanceof RTCRtpSender&&t.track&&"audio"===t.track.kind&&t.replaceTrack(e)})}}}replaceLocalStreamVideoTrack(e){if(console.log("replaceLocalStreamVideoTrack track: {} ",e),this._localVideoStream){const t=this._localVideoStream,i=t.getVideoTracks();this._activeLocalVideoTrack||(this._activeLocalVideoTrack=i[0]),t.removeTrack(i[0]),t.addTrack(e)}}cancelTransferSwitchoverStream(){"None"!==this._impl._buttonState.transferState&&(console.log("TRANSFER: cancelTransferSwitchoverStream"),this._newAssociateAvStream&&(console.log("newAssociateAvStream should be null. Ending it first"),this._newAssociateAvStream.end()),this._newAssociateAvStream=null,this._newAssociateAvStreamId=null,this._impl._buttonState.transferState="None")}freezeEndUserVideo(e){if(!e)return void(this._activeLocalVideoTrack&&(this.replaceSenderVideoTrack(this._activeLocalVideoTrack),this.replaceLocalStreamVideoTrack(this._activeLocalVideoTrack)));let t=$("#oracle-live-local-video")[0],i=document.createElement("canvas");i.width=t.videoWidth,i.height=t.videoHeight,i.getContext("2d").drawImage(t,0,0,i.width,i.height);let o=i.captureStream();console.log("Canvas stream ",o),this.replaceLocalStreamVideoTrack(o.getVideoTracks()[0]),this.replaceSenderVideoTrack(o.getVideoTracks()[0])}}}),liveRequire.define("LiveScenarioBehaviours",[],function(){"use strict";const e={NONE:"NONE",AUDIO_VIDEO:"AUDIO_VIDEO",AUDIO_ONLY:"AUDIO_ONLY",SCREEN_SHARE:"SCREEN_SHARE",VIDEO_ONLY:"VIDEO_ONLY"};return class{constructor(t){this.StartMediaType=e,t&&(this.endUserCanAddAudio=t.endUserCanAddAudio,this.endUserCanAddVideo=t.endUserCanAddVideo,this.endUserCanAddScreenShare=t.endUserCanAddScreenShare,this.associateCanAddAudio=t.associateCanAddAudio,this.associateCanAddVideo=t.associateCanAddVideo,this.associateCanAddScreenShare=t.associateCanAddScreenShare,this.associateCanRequestEndUserAudio=t.associateCanRequestEndUserAudio,this.associateCanRequestEndUserVideo=t.associateCanRequestEndUserVideo,this.associateCanRequestEndUserScreenShare=t.associateCanRequestEndUserScreenShare,this.preCallIDCheck=t.preCallIDCheck,this.endUserInitialMedia=t.endUserInitialMedia,this.associateInitialMedia=t.associateInitialMedia,this.shortCodeEnabled=t.shortCodeEnabled,this.meetingsEnabled=t.meetingsEnabled,this.transferEnabled=t.transferEnabled)}toJSON(){return{endUserCanAddAudio:this.endUserCanAddAudio,endUserCanAddVideo:this.endUserCanAddVideo,endUserCanAddScreenShare:this.endUserCanAddScreenShare,associateCanAddAudio:this.associateCanAddAudio,associateCanAddVideo:this.associateCanAddVideo,associateCanAddScreenShare:this.associateCanAddScreenShare,associateCanRequestEndUserAudio:this.associateCanRequestEndUserAudio,associateCanRequestEndUserVideo:this.associateCanRequestEndUserVideo,associateCanRequestEndUserScreenShare:this.associateCanRequestEndUserScreenShare,preCallIDCheck:this.preCallIDCheck,endUserInitialMedia:this.endUserInitialMedia,associateInitialMedia:this.associateInitialMedia,shortCodeEnabled:this.shortCodeEnabled,meetingsEnabled:this.meetingsEnabled,transferEnabled:this.transferEnabled}}allowDowngrades(t){console.log("Allowing Downgrades ("+t+")"),this.endUserInitialMedia!==e.AUDIO_ONLY&&this.endUserInitialMedia!==e.AUDIO_VIDEO||this.endUserCanAddAudio!==t&&(console.log("Altering endUserCanAddAudio to be ("+t+")"),this.endUserCanAddAudio=t),this.endUserInitialMedia===e.AUDIO_VIDEO&&this.endUserCanAddVideo!==t&&(console.log("Altering endUserCanAddVideo to be ("+t+")"),this.endUserCanAddVideo=t)}isEndUserAudioPossible(){return this.endUserCanAddAudio||this.associateCanRequestEndUserAudio||this.endUserInitialMedia===e.AUDIO_VIDEO||this.endUserInitialMedia===e.AUDIO_ONLY}isEndUserVideoPossible(){return this.endUserCanAddVideo||this.associateCanRequestEndUserVideo||this.endUserInitialMedia===e.AUDIO_VIDEO||this.endUserInitialMedia===e.VIDEO_ONLY}isStartWithEndUserVideo(){return this.endUserInitialMedia===e.AUDIO_VIDEO||this.endUserInitialMedia===e.VIDEO_ONLY}isStartWithAssociateVideo(){return this.associateInitialMedia===e.AUDIO_VIDEO||this.associateInitialMedia===e.VIDEO_ONLY}isStartWithEndUserScreenShare(){return console.log("liveScenarioBehaviours::isStartWithEndUserScreenShare",this.endUserInitialMedia===e.SCREEN_SHARE),this.endUserInitialMedia===e.SCREEN_SHARE}isEndUserScreenSharePossible(){return this.endUserCanAddScreenShare||this.associateCanRequestEndUserScreenShare||this.endUserInitialMedia===e.SCREEN_SHARE}isAssociateAudioPossible(){return this.associateCanAddAudio||this.associateInitialMedia===e.AUDIO_VIDEO||this.associateInitialMedia===e.AUDIO_ONLY}isAssociateVideoPossible(){return this.associateCanAddVideo||this.associateInitialMedia===e.AUDIO_VIDEO||this.associateInitialMedia===e.VIDEO_ONLY}isAssociateScreenSharePossible(){return this.associateCanAddScreenShare||this.associateInitialMedia===e.SCREEN_SHARE}isAudioPossible(){return this.endUserCanAddAudio||this.associateCanAddAudio||this.associateCanRequestEndUserAudio||this.associateInitialMedia===e.AUDIO_VIDEO||this.associateInitialMedia===e.AUDIO_ONLY||this.endUserInitialMedia===e.AUDIO_VIDEO||this.endUserInitialMedia===e.AUDIO_ONLY}isAudioOnly(){return this.associateInitialMedia===e.AUDIO_ONLY&&this.endUserInitialMedia===e.AUDIO_ONLY}isVideoPossible(){return this.endUserCanAddVideo||this.associateCanAddVideo||this.associateCanRequestEndUserVideo||this.associateInitialMedia===e.AUDIO_VIDEO||this.associateInitialMedia===e.VIDEO_ONLY||this.endUserInitialMedia===e.AUDIO_VIDEO||this.endUserInitialMedia===e.VIDEO_ONLY}isVideoOnly(){return this.associateInitialMedia===e.AUDIO_VIDEO&&this.endUserInitialMedia===e.AUDIO_VIDEO}isEndUserVideo(){return this.endUserInitialMedia===e.AUDIO_VIDEO||this.endUserInitialMedia===e.VIDEO_ONLY}isScreenSharePossible(){return this.endUserCanAddScreenShare||this.associateCanAddScreenShare||this.associateCanRequestEndUserScreenShare||this.associateInitialMedia===e.SCREEN_SHARE||this.endUserInitialMedia===e.SCREEN_SHARE}isPreCallIDCheck(){return this.preCallIDCheck}getMediaType(){let e="";return this.isAudioPossible()&&(e+="audio"),this.isVideoPossible()&&(""!==e&&(e+=","),e+="video"),this.isScreenSharePossible()&&(""!==e&&(e+=","),e+="screenshare"),e}}}),liveRequire.define("LiveScenarioMessages",[],function(){"use strict";return class{constructor(e){e&&(this.greetingMessage=e.greetingMessage,this.connectingMessage=e.connectingMessage)}}}),liveRequire.define("LiveNetworkQualityMonitor",["LiveEvents"],function(e){"use strict";const t=1e4;return class{constructor(e){this._impl=e,this._monitoredStreams=new Map,this._qualityMap={},this._isBad=!1,this._lastQualityResult=live.ExperienceStatus.GOOD,this._qualityPeriod=2e4,this._qualityTimer=null,this._videoLoadingTimer=null}_getExperienceStatus(e){switch(e){case live.ExperienceStatus.GOOD:return"GOOD";case live.ExperienceStatus.BAD:return"BAD";case live.ExperienceStatus.NOT_AVAILABLE:return"N/A";default:return"I/S"}}monitor(i,o){const n=o?"local":"remote",a=i.getId(),r=i.getType();if(this._monitoredStreams[n+r+a])return void this.optionallyLog("LiveNetworkQualityMonitor::monitor: Already monitoring "+n+" stream id: "+a+", type: "+r);this._monitoredStreams[n+r+a]=!0,this.optionallyLog("LiveNetworkQualityMonitor::monitor: Start monitoring "+n+" stream id: "+a+", type: "+r);const s=i.getQualityMonitor();if(s.onNewStatus(live.ExperienceFactor.VIDEO_INBOUND,(e,t)=>{const o=this._getExperienceStatus(e),s=JSON.stringify(t);this.optionallyLog("QM("+n+":"+r+":"+a+").InVideoStatus: "+o+" - hints: "+s+")"),i.getStreamOptions().shouldReceiveVideo()&&!i.isVideoPaused()&&this._updateMos(a,live.ExperienceFactor.VIDEO_INBOUND,e)}),s.onNewStatus(live.ExperienceFactor.VIDEO_OUTBOUND,(e,t)=>{const o=this._getExperienceStatus(e),s=JSON.stringify(t);this.optionallyLog("QM("+n+":"+r+":"+a+").OutVideoStatus: "+o+" - hints: "+s+")"),i.getStreamOptions().shouldSendVideo()&&!i.isVideoPaused()&&this._updateMos(a,live.ExperienceFactor.VIDEO_OUTBOUND,e)}),s.onNewStatus(live.ExperienceFactor.AUDIO_INBOUND,(e,t)=>{const o=this._getExperienceStatus(e),s=JSON.stringify(t);this.optionallyLog("QM("+n+":"+r+":"+a+").InAudioStatus: "+o+" - hints: "+s+")"),i.getStreamOptions().shouldReceiveAudio()&&!i.isAudioPaused()&&this._updateMos(a,live.ExperienceFactor.AUDIO_INBOUND,e)}),s.onNewStatus(live.ExperienceFactor.AUDIO_OUTBOUND,(e,t)=>{const o=this._getExperienceStatus(e),s=JSON.stringify(t);this.optionallyLog("QM("+n+":"+r+":"+a+").OutAudioStatus: "+o+" - hints: "+s+")"),i.getStreamOptions().shouldSendAudio()&&!i.isAudioPaused()&&this._updateMos(a,live.ExperienceFactor.AUDIO_OUTBOUND,e)}),o){let i=!0;r===live.STREAMTYPE.AUDIOVIDEO&&(this._impl.dispatchEvent(e.LiveRemoteVideoLoading),this._videoLoadingTimer=setTimeout(()=>{this._videoLoaded()},t)),s.withCallbacks(e=>{this.optionallyLog("QM("+n+":"+r+":"+a+").InFrRate: "+e),r===live.STREAMTYPE.AUDIOVIDEO&&e>0&&i&&(i=!1,this._videoLoaded())},e=>{this.optionallyLog("QM("+n+":"+r+":"+a+").OutFrRate: "+e)},(e,t)=>{this.optionallyLog("QM("+n+":"+r+":"+a+").InRes: "+e+"x"+t),r===live.STREAMTYPE.AUDIOVIDEO&&e>0&&t>0&&i&&(i=!1,this._videoLoaded())},(e,t)=>{this.optionallyLog("QM("+n+":"+r+":"+a+").OutRes: "+e+"x"+t)})}this._checkQualityStatus(this._qualityPeriod)}_videoLoaded(){this._impl.dispatchEvent(e.LiveRemoteVideoLoaded),this._videoLoadingTimer&&clearTimeout(this._videoLoadingTimer),this._videoLoadingTimer=null}_updateMos(e,t,i){const o="LiveNetworkQualityMonitor::_updateMos:";this.optionallyLog(`${o} streamId: ${e} factor: ${t}  status: ${i}`);const n={};n.status=i,n.timestamp=Date.now();const a=e+t;this._qualityMap[a]=this._qualityMap[a]||[],this._qualityMap[a].push(n),this.optionallyLog(`${o}key: ${a} = ${JSON.stringify(this._qualityMap[a])})`),this._isBad||i===live.ExperienceStatus.BAD&&(this._isBad=!0,this.optionallyLog("QoE value has changed to BAD. Show first BAD message now."),this._lastQualityResult=live.ExperienceStatus.BAD)}_getQualityResultOfLastPeriod(e){const t=Date.now(),i=this._impl._conversation.getLocalParticipant();if(!i)return this.optionallyLog("LiveNetworkQualityMonitor::_getQualityResultOfLastPeriod: returning not available"),live.ExperienceStatus.NOT_AVAILABLE;const o=[],n=[];return i.getStreamInfos().forEach(i=>{const a=i.getId(),r=i.getStreamOptions(),s=this._impl.getAssociateStreamInfo(i.getType()),l=this._qualityMap[a+live.ExperienceFactor.VIDEO_INBOUND],c=this._qualityMap[a+live.ExperienceFactor.VIDEO_OUTBOUND],d=this._qualityMap[a+live.ExperienceFactor.AUDIO_INBOUND],u=this._qualityMap[a+live.ExperienceFactor.AUDIO_OUTBOUND];void 0!==l&&l.length>0&&r.shouldReceiveVideo()&&!s.isVideoPaused()&&o.push(this._getQuality(t,e,live.ExperienceFactor.VIDEO_INBOUND,a)),void 0!==c&&c.length>0&&r.shouldSendVideo()&&!i.isVideoPaused()&&o.push(this._getQuality(t,e,live.ExperienceFactor.VIDEO_OUTBOUND,a)),void 0!==d&&d.length>0&&r.shouldReceiveAudio()&&!s.isAudioPaused()&&n.push(this._getQuality(t,e,live.ExperienceFactor.AUDIO_INBOUND,a)),void 0!==u&&u.length>0&&r.shouldSendAudio()&&!i.isAudioPaused()&&n.push(this._getQuality(t,e,live.ExperienceFactor.AUDIO_OUTBOUND,a))}),o.find(e=>e===live.ExperienceStatus.BAD)||n.find(e=>e===live.ExperienceStatus.BAD)?(this.optionallyLog("LiveNetworkQualityMonitor::_getQualityResultOfLastPeriod: returning BAD"),live.ExperienceStatus.BAD):(this.optionallyLog("LiveNetworkQualityMonitor::_getQualityResultOfLastPeriod: returning GOOD"),live.ExperienceStatus.GOOD)}_getQuality(e,t,i,o){const n=o+i,a=this._qualityMap[n],r=e-t,s={};s.status=a[a.length-1].status,s.timestamp=e,a.push(s);let l=0,c=0,d=0;this.optionallyLog(`LiveNetworkQualityMonitor::_getQuality: qualityTagList: ${JSON.stringify(a)}`);for(let e=0;e<a.length;e++){const t=a[e];if(t.timestamp>r){if(e>0){const i=a[e-1],o=t.timestamp-i.timestamp;i.status===live.ExperienceStatus.BAD?c+=o:i.status===live.ExperienceStatus.GOOD?l+=o:d+=o}}else t.timestamp=r}const u=a[a.length-1];this._qualityMap[n]=[],this._qualityMap[n].push(u);const h=Math.round(100*c/t);return this.optionallyLog(i+" of stream "+o+": bad time is: "+c/1e3+" seconds, the percentage is: "+h),h<30?live.ExperienceStatus.GOOD:live.ExperienceStatus.BAD}_checkQualityStatus(e){this._qualityTimer?this.optionallyLog("LiveNetworkQualityMonitor::_checkQualityStatus: qualityTimer is running - returning"):this._qualityTimer=setInterval(()=>{const t=this._getQualityResultOfLastPeriod(e);this.optionallyLog(`LiveNetworkQualityMonitor::qualityTimer: result of last period: ${t} previousResult: ${this._lastQualityResult}`),t===live.ExperienceStatus.BAD?this._lastQualityResult===live.ExperienceStatus.GOOD&&this.optionallyLog("LiveNetworkQualityMonitor::qualityTimer: QoE value changed to BAD"):t===live.ExperienceStatus.GOOD?(this._lastQualityResult===live.ExperienceStatus.BAD&&this.optionallyLog("LiveNetworkQualityMonitor::qualityTimer: QoE value changed to GOOD"),this._isBad=!1):this.optionallyLog(`LiveNetworkQualityMonitor::qualityTimer: Unexpected QoE result: ${t}`),this._lastQualityResult=t},e)}reset(){this.optionallyLog("LiveNetworkQualityMonitor::reset"),this._qualityTimer&&(clearInterval(this._qualityTimer),this._qualityTimer=null),this._qualityMap={},this._isBad=!1,this._lastQualityResult=live.ExperienceStatus.GOOD,this._videoLoadingTimer&&clearTimeout(this._videoLoadingTimer),this._videoLoadingTimer=null}optionallyLog(e){}}}),liveRequire.define("LiveControllerImpl",["oracle.live.sdk","jquery","LiveService","LiveContextAttributes","LiveSettings","LiveApiVersion","LiveEvents","LiveExposedEvents","LiveState","LiveRestHelper","LiveCallTimer","LiveDiagnostics","LiveScreenSharing","LiveAudioVideo","LiveScenarioBehaviours","LiveScenarioMessages","LiveSessionStore","LiveNetworkQualityMonitor","LiveScenarioCustomization"],function(e,$,t,i,o,n,a,r,s,l,c,d,u,h,p,v,g,m,f){"use strict";return class{constructor(){console.log("LiveControllerImpl::constructor START"),this.service=new t(this),this.contextAttributes=new i(this),this.settings=new o,this.version=(new n).version,this._browserName=null,this._browserVersion=null,this._networkQualityMonitor=new m(this),this._isMeeting=!1,this._buttonState=new s(this),this._rest=new l(this),this._diags=new d(this),this._screen=new u(this),this._av=new h(this),this._behaviours=null,this._messages=null,this._customization=null,this._connection=null,this._retry=!1,this._callMediaType="",this._conversation=null,this._conversationId=null,this._associateUri=null,this._transferringAssociateUri=null,this._upgradeRequest=null,this._upgradeRequestStreamType=null,this._upgradeRequestForUser=null,this._rehydratingToState=null,this._connectionId=null,this._readyToStartConnection=!1,this._readyToAddComponent=!1,this._haveRequestedVideoPreview=!1,this._callEstablished=!1,this._connectionTimer=null,this._connectionTimeout=18e4,this._reconnectionTimer=null,this._reconnectionTimeout=2e4,this._reconnectingLocal=!1,this._statusCheckTimer=null,this._statusCheckTimeout=1e4,this._dynamicChromeExtensionInstall=!1,this._permanentTwoWayScreenShare=!1,this._dummyScreenShareCreated=!1,this._canRejoinMeeting=!0,this._componentAdded=!1,this._autoTest=!1,this._transactionReference=null,this._positionInQueue=0,this._myStreams=[],g.initState("LiveControllerImpl",this),$(()=>{console.log("LiveControllerImpl::constructor about to restore"),g.loadState("LiveControllerImpl",e=>{console.log("LiveControllerImpl: Loading, found ",e),this._isMeeting=e.isMeeting;const t=e.state;this._autoTest=e.autoTest,this._browserVersion=e.browserVersion,this._browserName=e.browserName,this._metaScenario=e.metaScenario,this._conversationId=e.conversationId,this.setPermanentTwoWayScreenShare(e.permanentTwoWayScreenShare),this._dummyScreenShareCreated=e.dummyScreenShareCreated,console.log("LiveControllerImpl::getMetaScenario resetting the metaScenario"),e.metaScenario&&e.metaScenario.behaviours&&e.metaScenario.messages&&(this._behaviours=new p(e.metaScenario.behaviours),console.log("Restored behaviours: ",this._behaviours),this.contextAttributes.set("behaviours",e.metaScenario.behaviours),this._messages=new v(e.metaScenario.messages),console.log("Restored messages: ",this._messages),this.contextAttributes.set("messages",e.metaScenario.messages)),e.customization&&(this._customization=new f(e.customization),console.log("Restored customization: ",this._customization)),this._browserName&&this._browserVersion&&this.contextAttributes.populateContext(this.version,this._browserName,this._browserVersion),console.log("Context attributes are: ",this.contextAttributes),console.log("Loading state: ",t),console.log("Meeting is: ",this._isMeeting);let i=window.location.toString()===e.url;console.log("Location (URL) is: ",i?"unchanged":"changed"),!0===this._isMeeting&&i||this._buttonState._stateSupportsRehydration(t)?(this._rehydratingToState=this._isMeeting?"Meeting":t,this._callMediaType=e.callMediaType,this._associateUri=e.associateUri,this._transferringAssociateUri=e._transferringAssociateUri,this._connectionId=e.connectionId,console.log("Restored connection ID: ",this._connectionId)):(this._rehydratingToState=null,console.log("LiveControllerImpl::Not rehydrating, resetting the button state"),this._buttonState.reset(),"Connecting"===t&&(this._authToken=e.authToken,this.beforeUnload(),this._authToken=null)),console.log("LiveControllerImpl::constructor Attempting to restore state: "+this._rehydratingToState),console.log("LiveControllerImpl::constructor done restoring, creating the component=",this._readyToAddComponent),this._readyToStartConnection=!0,!0===this._readyToAddComponent&&this._addComponent(),this._transactionReference=e.transactionReference,this._positionInQueue=e.positionInQueue},()=>{console.log("LiveControllerImpl::constructor no state to restore, add component"),this._readyToStartConnection=!0,!0===this._readyToAddComponent&&this._addComponent()})}),console.log("LiveControllerImpl::constructor end")}toJSON(){return!0===this._isMeeting||this._buttonState._stateSupportsRehydration(this._buttonState.stateName)?JSON.stringify({isMeeting:this._isMeeting,url:window.location.toString(),metaScenario:this._metaScenario,callMediaType:this._callMediaType,associateUri:this._associateUri,transferringAssociateUri:this._transferringAssociateUri,state:this._buttonState.stateName,authToken:this.service.authToken,connectionId:this._connection.getConnectionId(),browserName:this._browserName,browserVersion:this._browserVersion,conversationId:this._conversationId,permanentTwoWayScreenShare:this._permanentTwoWayScreenShare,dummyScreenShareCreated:this._dummyScreenShareCreated,transactionReference:this._transactionReference,positionInQueue:this._positionInQueue,autoTest:this._autoTest,customization:this._customization}):null}setAutoTest(e){console.log("LiveControllerImpl::setAutoTest setting to: ",e),this._diags.setAutoTest(e),this._autoTest=e}setQualityMetricsCallback(e){this._av._qualityMetricsCallback=e,this._screen._qualityMetricsCallback=e}setRunningForChromeExtension(e){this._rest.setRunningForChromeExtension(e)}setNoProxyForKyc(e){console.log("LiveControllerImpl::setNoProxyForKyc setting to: ",e),this._rest.setNoProxyForKyc(e)}reset(){console.log("Controller::reset"),this._networkQualityMonitor.reset();const e=e=>{e&&(console.log("reset method is clearing media..",e),e.srcObject=null)};this._screen.stopReceivingScreenShare(),this._screen.reset(),this._autoTest=!1,e(document.querySelector(".oracle-live-local-audio")),e(document.querySelector(".oracle-live-local-video")),e(document.querySelector(".oracle-live-remote-audio")),e(document.querySelector(".oracle-live-remote-video")),e(document.querySelector(".oracle-live-local-screenshare")),e(document.querySelector(".oracle-live-remote-screenshare")),clearTimeout(this._connectionTimer),clearTimeout(this._reconnectionTimer),clearTimeout(this._statusCheckTimer),this._statusCheckTimer=null,this._reconnectionTimer=null,this._connectionTimer=null,this._callEstablished=!1,this._conversation=null,this._av.reset(),this._associateUri=null,this._transferringAssociateUri=null,this._upgradeRequest=null,this._upgradeRequestStreamType=null,this._upgradeRequestForUser=null,this._rehydratingToState=null,this._transactionReference=null,this._positionInQueue=0,this.setPermanentTwoWayScreenShare(!1),this._dummyScreenShareCreated=!1,this._reconnectingLocal=!1,this._haveRequestedVideoPreview=!1,this._rest.closeCallQueue(),this._diags.cancelChecks(),this._transactionReference=null,this.contextAttributes.remove("preCallCheckId"),$(".kyc-jumio-iframe").attr("src",null),$(".oracle-live-local-video").hide(),$(".oracle-live-remote-video").hide()}beforeUnload(){let e=this._authToken?this._authToken:this.service.authToken;e&&(console.log("beforeUnload: attempting to remove from queue",e),this._rest.removeFromQueue(this._callMediaType,e,()=>{console.log("success")}),this._authToken=null)}_isRehydrating(){let e=!!this._rehydratingToState;return console.log("_isRehydrating:",e,", state: ",this._rehydratingToState),e}_isRehydratingMeetingCall(){let e=this._isRehydrating()&&"Meeting"===this._rehydratingToState;return console.log("_isRehydratingMeetingCall:",e),e}_isRehydratingNonMeetingCall(){let e=this._isRehydrating()&&"Meeting"!==this._rehydratingToState;return console.log("_isRehydratingNonMeetingCall:",e),e}addComponent(e){console.log("LiveControllerImpl::addComponent"),e&&(console.log("We have a root tag, this is a meeting"),this._eventNode=e,this._isMeeting=!0),!0===this._readyToStartConnection?(console.log("LiveControllerImpl::addComponent ready, adding now"),this._addComponent()):(console.log("LiveControllerImpl::addComponent setting add when ready"),this._readyToAddComponent=!0)}_addComponent(){console.log("LiveControllerImpl::_addComponent"),this._isRehydrating()?(console.log("LiveControllerImpl::_addComponent/rehydrating"),this.loginToLiveExperience()):(console.log("LiveControllerImpl::_addComponent/not rehydrating"),this._diags.checkBrowser().then(e=>{this._browserName=e.browserName,this._browserVersion=e.browserVersion,console.log("Set the value of the browser name: "+this._browserName+" and browser version: "+this._browserVersion),this.service.isValid()&&this.contextAttributes.isValid()&&(this.contextAttributes.populateContext(this.version,this._browserName,this._browserVersion),this.loginToLiveExperience())}).catch(e=>{console.warn("Not displaying the component",e)}))}updateComponent(){this.service.authToken?this.getMetaScenario(()=>{this._componentAdded?this._buttonState.updateMenu():this._getMessagesAndAddComponent()}):console.log("Not attempting to resolve meta scenario while unauthorised")}getNetworkStatus(e,t){console.log("LiveAPI::getNetworkStatus",this._connection),this._connection?this._connection.getNetworkStatus(e,t):t("Invalid connection")}updateAuthToken(e){this._connection&&this._connection.updateWebSocketUri(this._getWebSocketUri(e))}stopStream(e){e&&(console.log("stop stream",e),e instanceof RTCRtpReceiver||e instanceof RTCRtpSender?(e.track&&"video"===e.track.kind&&(console.log("stop video track",e.track),e.track.stop&&e.track.stop(),e.track.enabled&&(e.track.enabled=!1),console.log("After stopping, track muted property="+e.track.muted)),e.track&&"audio"===e.track.kind&&(console.log("stop audio track",e.track),e.rack.stop&&e.track.stop(),e.track.enabled&&(e.track.enabled=!1),console.log("After stopping, track muted property="+e.track.muted))):(e.getVideoTracks().forEach(e=>{console.log("stop video track",e),e.stop&&e.stop(),e.enabled&&(e.enabled=!1),console.log("After stopping, track muted property="+e.muted)}),e.getAudioTracks().forEach(e=>{console.log("stop audio track",e),e.stop&&e.stop(),e.enabled&&(e.enabled=!1),console.log("After stopping, track muted property="+e.muted)})))}loginToLiveExperience(){console.log("loginToLiveExperience(): "+this.service.userID),this.loginAndConnect().then(()=>{console.log("Connected with username: "+this.service.userID+" and tenant: "+this.service.tenantID),this._connection.initCallbacks(this.detectIncomingStream.bind(this),this.refreshConnection.bind(this),this.detectWhenConnectionHasChanged.bind(this));const e=this._connection.isRefresh()||this._isRehydratingMeetingCall();if(console.log("Login success, refresh = "+e),e){const e=this._connection.getConversations(),t=e.length||0;console.log("Handling browser refresh",e),e&&t>0&&this.refreshConnection(e[t-1]),this._isMeeting&&(this._buttonState.isMeeting=!0),this._buttonState.addMenu(!0),g.loadStateCompleted(),this.dispatchEvent(a.LiveStateReloaded,{state:this._buttonState.stateName})}else this._isMeeting?this.getMetaScenario(()=>{this._getMessagesAndAddComponent()}):(this.getAvailability(),this.getMetaScenario(()=>{this._getMessagesAndAddComponent()}));this.dispatchEvent(a.LiveLoginSuccess)}).catch(e=>{console.error("Failed to connect",e),this.dispatchEvent(a.LiveLoginError)})}loginAndConnect(){return console.log("loginAndConnect()"),this._retry=!1,new Promise((e,t)=>{console.log("ConnectToLiveExperience Attempt 1"),this.connectToLiveExperience(e,i=>{this._retry?(console.log("Failed to connect to Live Experience (2) - already retried",i),t(i)):(console.log("Failed to connect to Live Experience (1) - retrying",i),this._retry=!0,console.log("ConnectToLiveExperience Attempt 2"),this.connectToLiveExperience(e,t))})})}_getWebSocketUri(e){let t=this.service.address.replace(/^http/,"ws")+"/ws/webrtc/cloud";return t+="?jwt="+e+"&tenant_profile_key="+this.service.tenantID,console.log("Connection has WebSocketURI: "+t),t}connectToLiveExperience(e,t){if(!(this.service.userID&&""!==this.service.userID&&this.service.userID.indexOf("@")>0))return console.log("connectToLiveExperience: Invalid username: "+this.service.userID),void this.logoutFromLiveExperience();let i=null;this._buttonState.connectingAudioURL=this.service.address+"/meeting/media/connecting.wav";let o=this.service.authToken;!0===this._isRehydrating()&&this._connectionId?(console.log("connectToLiveExperience: Rehydrating plus we have an existing session: "+this._connectionId),i=this._connectionId):(console.log("connectToLiveExperience: is rehydrating "+this._isRehydrating()),console.log("connectToLiveExperience: connectionId "+this._connectionId),console.log("connectToLiveExperience: Not rehydrating or no connection id to restart"),this._rehydratingToState=null),console.log("Logged in with username: "+this.service.userID+", tenant: "+this.service.tenantID),console.log("Local connection ID is: "+i),console.log("Creating connection with JWT: "+o);let n=this._getWebSocketUri(o);this._connection=new live.Connection(this.service.userID,n,e,t).withEarlyCallbacks(this.detectWhenConnectionHasChanged.bind(this),()=>null).withConnectionId(i).withExtPayloads({capability:{appid:"web"}}).start(),this._connection.setTrickleIceMode("full"),console.log("Starting connection: wsUri="+n,this._connection)}logoutFromLiveExperience(){console.log("LiveControllerImpl::logoutFromLiveExperience"),this._connection&&(console.log("logout: "+this.service.userID),this.beforeUnload(),this._connection.close(),this._connection=null,this._retry=!1),this.reset()}getMetaScenario(e){const t=this.contextAttributes.get("appLocation");return console.log("MetaScenario appLocation is ",this._metaScenarioAppLocation),"wce_test"===t?(console.log("LiveControllerImpl::getMetaScenario Using locally set configuration for test purposes: ",this._metaScenario),this._metaScenarioAppLocation=t,this._behaviours=new p(this._metaScenario.behaviours),this._behaviours.allowDowngrades(!1),this.contextAttributes.set("behaviours",this._metaScenario.behaviours),this._callMediaType=this._behaviours.getMediaType(),e&&e(),void this._buttonState.showMenu()):this._metaScenarioAppLocation&&this._metaScenarioAppLocation===t?(console.log("Scenario already downloaded, don't do anything"),e&&e(),void this._buttonState.showMenu()):(this._buttonState.hideMenu(),void this._rest.getMetaScenario((i,o)=>{i?(this._isMeeting&&(i=this._meet.applyPossiblePstnOverride(i)),this._metaScenario=i,this._metaScenarioAppLocation=t,this._behaviours=new p(i.behaviours),this._behaviours.allowDowngrades(!1),this._messages=new v(i.messages),this._callMediaType=this._behaviours.getMediaType(),console.log("Configuration.behaviours: ",i.behaviours),console.log("Configuration.messages: ",i.messages),this.contextAttributes.set("behaviours",i.behaviours),console.log("Stored behaviours: "+JSON.stringify(this.contextAttributes.get("behaviours"),null,2)),this.contextAttributes.set("messages",i.messages),console.log("Stored messages: "+JSON.stringify(this.contextAttributes.get("messages"),null,2))):console.log("getMetaScenario: No configuration"),o?(this._components=o,this._customization=new f(o.customization),console.log("Components.customization: ",o.customization)):console.log("getMetaScenario: No components"),this._buttonState.updateMenu(),this._isMeeting?(console.log("Hiding oracle-live-experience"),this._buttonState.isMeeting=!0,e&&e()):(e&&e(),this._buttonState.showMenu())}))}overrideBehaviours(e){console.log("Overriding behaviours to be "+JSON.stringify(e,null,2)),this._behaviours=new p(e),this._callMediaType=this._behaviours.getMediaType(),this.contextAttributes.set("behaviours",e),this._buttonState.updateMenu()}_getMessagesAndAddComponent(){const e=this.settings.locale||navigator.language;this._rest.getMessages(e,e=>{e&&(this._buttonState.messages=e),this._buttonState.addMenu(!1),this._componentAdded=!0,console.log("Component added")})}getAvailability(){this._rest.getAppAvailability(e=>{this.refreshAvailability(e.nextChange),console.log("getAvailability: available="+e.available),this._buttonState.setAvailable(!0===e.available),!0===e.available?this._buttonState.showMenu():this._buttonState.hideMenu()})}refreshAvailability(e){if(console.log("refreshAvailability: nextChange="+e),e){const t=Date.parse(e),i=Math.floor(t/1e3),o=Date.now(),n=Math.floor(o/1e3),a=t-o,r=Math.floor(a/1e3),s=c.formatDuration(n,i);console.log("Will refresh availability in: "+r+" seconds ("+s+" [hours:mins:secs])"),setTimeout(()=>{this.getAvailability()},a)}}checkPostCallRating(){this._conversation.isPostCallRatingRequired()&&(console.log("LiveAudioVideo: Post-call rating is required"),this._conversationId=this._conversation.getKey(),this.dispatchEvent(a.LiveRatingRequired))}startCallWithAssociate(e,t){if(console.log("LiveControllerImpl::startCallWithAssociate: rehydratingToState="+this._rehydratingToState),this._isMeeting||(this._connectionTimer=setTimeout(()=>{console.log("LiveControllerImpl:: associate did not respond in 3 minutes"),this.dispatchEvent(a.LiveConnectingNoAnswer)},this._connectionTimeout)),!0===this._reconnectingLocal)return void console.log("LiveControllerImpl::startCallWithAssociate: reconnectingLocal is true so returning");this.contextAttributes.set("shortCode",t||null);const i=t=>{console.log("LiveControllerImpl::startCallWithAssociate: waiting for answer.."),this._buttonState.hideQueueLengthIndicator(),this.dispatchEvent(a.LiveWaiting),this._connection.logEventTimestamp("availableAgentRequestSent"),this._rest.addToCallQueue(this._callMediaType,i=>{let o=i,n=null;if(i.startsWith("{")&&i.endsWith("}")){const e=JSON.parse(i);o=e.assignedAgent,n=e.conversationKey,console.log("LiveControllerImpl::_hidePauseResumeButton... "),this._buttonState.hidePauseResumeButton(),console.log("LiveControllerImpl::startCallWithAssociate: Have a conversationKey="+n)}console.log("LiveControllerImpl::startCallWithAssociate: Call answered, address="+o),this._connection.logEventTimestamp("availableAgentSuccessResponseGot"),this.dispatchEvent(a.LiveConnecting),this.startCall(o,e,n),t&&(console.log("Restore original behaviours for next call"),this.contextAttributes.set("behaviours",t))},e=>{console.log("LiveControllerImpl::startCallWithAssociate: No answer, reason="+e),this._connection.logEventTimestamp("availableAgentFailResponseGot"),this.dispatchEvent(a.LiveConnectingNoAnswer),t&&(console.log("Restore original behaviours for next call"),this.contextAttributes.set("behaviours",t))})},o=()=>{if(this.dispatchEvent(a.LiveDiagnosticsComplete),"Connecting"===this._rehydratingToState){let e=sessionStorage.getItem("previousJWT");e&&this._rest.removeFromQueue(this._callMediaType,e,()=>{console.log("Have removed earlier call made with JWT:"+e),console.log("LiveControllerImpl::startCallWithAssociate sending context"),this._rest.sendContext(()=>{i(this._behaviours)})})}else console.log("LiveControllerImpl::startCallWithAssociate sending context"),this._rest.sendContext(()=>{i(this._behaviours)})},n=()=>{this._diags.hasAudio()?(this._diags.hasAudio()&&!this._diags.hasVideo()&&(console.log("LiveControllerImpl::startCallWithAssociate: Cannot start video call - downgrading user behaviours"),this._behaviours.isEndUserVideo()&&(this._behaviours.endUserInitialMedia=this._behaviours.StartMediaType.AUDIO_ONLY),this._behaviours.associateCanRequestEndUserVideo&&(this._behaviours.associateCanRequestEndUserVideo=!1),this._behaviours.endUserCanAddVideo&&(this._behaviours.endUserCanAddVideo=!1),this.contextAttributes.set("behaviours",this._behaviours.toJSON()),this._buttonState.configureBehaviours()),o()):this._buttonState.event(a.LiveDiagnosticsFailed)};if(this._isMeeting)this._diags.checkMeetingDiagnostics(this._behaviours.isEndUserVideoPossible()).then(e=>{console.log("LiveControllerImpl::startCallWithAssociate: Audio & video checks completed: ",e),n()}).catch(e=>{console.log("LiveControllerImpl::startCallWithAssociate: Audio & video checks failed: ",e),n()});else if(!0===this._behaviours.isStartWithEndUserScreenShare())console.log("LiveControllerImpl::startCallWithAssociate: no diagnostics for screenshare call"),o();else{const e=this._behaviours.isEndUserVideoPossible()&&!this._haveRequestedVideoPreview;this._diags.testCombinedDevices(e).then(e=>{console.log("LiveControllerImpl::startCallWithAssociate: diagnostics completed: ",e),n()}).catch(e=>{console.warn("LiveControllerImpl::startCallWithAssociate: diagnostics failed: ",e),"CANCELLED"!==e&&this._buttonState.event(a.LiveDiagnosticsFailed)})}}endCallWithAssociate(){if($("body").css("visibility","visible"),console.log("LiveControllerImpl::endCallWithAssociate"),this._resetMyStreams(),this._av)try{this._av.stop()}catch(e){console.log("LiveControllerImpl::endCallWithAssociate Conversation already closed",e)}let e;if(this._screen.stopSendingScreenShare(),this._conversation)console.log("LiveControllerImpl::endCallWithAssociate ending conversation",this._conversation),e=this._conversation.conversationKey,this._conversation.getLocalParticipant().remove(),this._conversation=null;else{console.log("LiveControllerImpl::endCallWithAssociate no call, remove from queue");let e=this.service.authToken;this._rest.removeFromQueue(this._callMediaType,e,()=>{console.log("LiveControllerImpl::endCallWithAssociate removed from call queue")})}this._buttonState.isPreCallIDCheck()?this.getVerificationResult(e).finally(()=>this.reset()):this.reset()}holdCallWithAssociate(){if(console.log("LiveControllerImpl::holdCallWithAssociate"),this._buttonState.isTransferring())console.log("Not holding call with associate because we're transferring a call");else if(this._conversation&&(this._av.isActive()||this._screen.isActive())){console.log("LiveControllerImpl::holdCallWithAssociate found active stream");let e=new live.PauseResume(live.PAUSERESUME.PAUSE,live.PAUSERESUME.PAUSE,live.PAUSERESUMEREASON.PAUSE_RESUME);this._conversation.getParticipant(this._associateUri).getStreamInfos().forEach(t=>{t.pauseResumeStream(e,()=>{if(console.log("Paused stream"),this.dispatchEvent(a.LivePausedLocally),this._av.isActive()){const t=e;$(".oracle-live").hasClass("oracle-live-frozen-annotation")&&(t.video=live.PAUSERESUME.RESUME),this._av.pauseResumeStream(t)}this._screen.isActive()&&(this._screen.pauseResumeStream(e),this._screen.pauseResumeOutgoing(!0))})})}}resumeCallWithAssociate(){if(console.log("LiveControllerImpl::resumeCallWithAssociate"),this._buttonState.isTransferring())console.log("Not resuming call with associate because we're transferring a call");else if(this._conversation&&(this._av.isActive()||this._screen.isActive())){console.log("LiveControllerImpl::resumeCallWithAssociate found active stream");let e=new live.PauseResume(live.PAUSERESUME.RESUME,live.PAUSERESUME.RESUME,live.PAUSERESUMEREASON.PAUSE_RESUME);this._conversation.getParticipant(this._associateUri).getStreamInfos().forEach(t=>{t.pauseResumeStream(e,()=>{console.log("Resuming call"),this.dispatchEvent(a.LiveResumedLocally),this._av.isActive()&&this._av.pauseResumeStream(e),this._screen.isActive()&&(this._screen.pauseResumeStream(e),this._screen.pauseResumeOutgoing(!1))})})}}dispatchEvent(e,t){console.log("LiveControllerImpl::dispatchEvent: "+e,t);let i={bubbles:!0};t&&(i.detail=t);const o=new CustomEvent(e,i);if(console.log("LiveControllerImpl::dispatchEvent new event: ",o),this._eventNode)console.log("LiveControllerImpl::dispatchEvent dispatching on: ",this._eventNode),document.querySelector(this._eventNode).dispatchEvent(o);else{let t=document.querySelector("body");if(null===t)return void console.warn("No body element on this page - there's nowhere to dispatch its events to");r.find(t=>t===e)&&t.dispatchEvent(o)}this._buttonState.event(e,t)}event(e){console.log("LiveControllerImpl::receivedEvent: ",e),this._buttonState.event(e)}reloadAssociateAvatar(e){this._associateUri=e,this._isMeeting||this._rest.getAssociateAvatar()}startCall(e,t,i){console.log("startCall with: "+e+", conversationKey:"+i),this._associateUri=e,this._rest.getAssociateInfo(),this._isMeeting||this._rest.getAssociateAvatar();const o=i&&i.length>0;this._buttonState.canRejoinMeeting=!o,this._behaviours.allowDowngrades(o),this._buttonState.configureComponent(),this._resetMyStreams(),this._conversation=this._connection.makeConversation().withKey(i).withCallbacks(this.detectWhenRecordingStateChanges.bind(this),this.detectWhenParticipantsChange.bind(this),this.detectWhenCallHasFailed.bind(this),this.detectWhenRelayCommandIsReceived.bind(this)).withContext(this.contextAttributes.toWebContext()).withoutShortCircuit(),console.log("startCall: endUserInitialMedia="+this._behaviours.endUserInitialMedia+", associateInitialMedia="+this._behaviours.associateInitialMedia+", meetingsEnabled="+this._behaviours.meetingsEnabled);const n=new live.StreamProfile(!0,!1,this.service.userID,new live.PauseResume(live.PAUSERESUME.RESUME,live.PAUSERESUME.RESUME,null));this._behaviours.associateInitialMedia!==this._behaviours.StartMediaType.AUDIO_ONLY&&this._behaviours.associateInitialMedia!==this._behaviours.StartMediaType.NONE||(console.log("Updating associate stream profile to disable video"),n.upgraded=!1,n.pauseResume.video=live.PAUSERESUME.PAUSE,n.pauseResume.reason=live.PAUSERESUMEREASON.UPGRADE_DOWNGRADE,this._av._associateVideoInitiallyPaused=!0),console.log("startCall: assocStreamProfile="+JSON.stringify(n,null,2));const a=this._buildRemoteStreamOptions();if(this._behaviours.isStartWithEndUserScreenShare())this.startCallScreenShareStream(a,n);else{const e=new live.StreamProfile(!0,!1,this.service.userID,new live.PauseResume(live.PAUSERESUME.RESUME,live.PAUSERESUME.RESUME,null));this._behaviours.endUserInitialMedia!==this._behaviours.StartMediaType.AUDIO_ONLY&&this._behaviours.endUserInitialMedia!==this._behaviours.StartMediaType.NONE||(console.log("Updating user stream profile to disable video"),e.upgraded=!1,e.pauseResume.video=live.PAUSERESUME.PAUSE,e.pauseResume.reason=live.PAUSERESUMEREASON.UPGRADE_DOWNGRADE,this._av._userVideoInitiallyPaused=!0);const i=this._buildLocalStreamOptions();console.log("startCall: userStreamProfile="+JSON.stringify(e,null,2)),this.startCallAudioVideoStream(i,a,t,e,n)}}_resetMyStreams(){console.log("Resetting remembered streams"),this._myStreams=[]}_rememberMyStreams(e){console.log("Remembering streamId: "+e),this._myStreams.includes(e)||this._myStreams.push(e)}_buildLocalStreamOptions(){let e=live.MEDIADIRECTION.INACTIVE,t=live.MEDIADIRECTION.INACTIVE;return this._behaviours.isStartWithEndUserScreenShare()?(e=live.MEDIADIRECTION.INACTIVE,t=live.MEDIADIRECTION.SENDONLY):(this._behaviours.isAssociateAudioPossible()&&this._behaviours.isEndUserAudioPossible()?e=live.MEDIADIRECTION.SENDRECV:this._behaviours.isEndUserAudioPossible()?e=live.MEDIADIRECTION.SENDONLY:this._behaviours.isAssociateAudioPossible()&&(e=live.MEDIADIRECTION.RECVONLY),this._behaviours.isAssociateVideoPossible()&&this._behaviours.isEndUserVideoPossible()?t=live.MEDIADIRECTION.SENDRECV:this._behaviours.isEndUserVideoPossible()?t=live.MEDIADIRECTION.SENDONLY:this._behaviours.isAssociateVideoPossible()&&(t=live.MEDIADIRECTION.RECVONLY)),console.log("localStreamOptions: audio="+e+", video="+t),live.StreamInfo.createStreamOptions(e,t)}_buildRemoteStreamOptions(){let e=live.MEDIADIRECTION.INACTIVE,t=live.MEDIADIRECTION.INACTIVE;return this._behaviours.isStartWithEndUserScreenShare()?(e=live.MEDIADIRECTION.INACTIVE,t=live.MEDIADIRECTION.RECVONLY):(this._behaviours.isAssociateAudioPossible()&&this._behaviours.isEndUserAudioPossible()?e=live.MEDIADIRECTION.SENDRECV:this._behaviours.isEndUserAudioPossible()?e=live.MEDIADIRECTION.RECVONLY:this._behaviours.isAssociateAudioPossible()&&(e=live.MEDIADIRECTION.SENDONLY),this._behaviours.isAssociateVideoPossible()&&this._behaviours.isEndUserVideoPossible()?t=live.MEDIADIRECTION.SENDRECV:this._behaviours.isEndUserVideoPossible()?t=live.MEDIADIRECTION.RECVONLY:this._behaviours.isAssociateVideoPossible()&&(t=live.MEDIADIRECTION.SENDONLY)),console.log("remoteStreamOptions: audio="+e+", video="+t),live.StreamInfo.createStreamOptions(e,t)}startCallAudioVideoStream(e,t,i,o,n){console.log("startCallAudioVideoStream: associateUri="+this._associateUri),o&&console.log("Overriding local stream profile: ",o),this._conversation.withParticipant(this._associateUri,t,n),this._av.start(e,o,i)}startCallScreenShareStream(e,t){console.log("LiveControllerImpl::startScreensharing: associateUri="+this._associateUri),this._conversation.withParticipant(this._associateUri,e,t,live.STREAMTYPE.SCREEN),this._screen.startSendingScreenShare()}onCallEstablished(e){!0!==this._callEstablished&&(this._callEstablished=!0,clearTimeout(this.connectionTimer),this.dispatchEvent(a.LiveConnected),this.checkPostCallRating(),this.stopReconnectionTimer(),e&&this._behaviours&&"SCREEN_SHARE"===this._behaviours.endUserInitialMedia&&this.dispatchEvent(a.LiveLocalScreenStarted))}onCallStreamStateError(){!0!==this._reconnectingLocal&&(this.dispatchEvent(a.LiveReconnectingLocal),this.sendNetworkStatus("network_disconnect"),this.startReconnectionTimer())}onCallEnded(){clearTimeout(this._connectionTimer),this.dispatchEvent(a.LiveEnded)}onScreenShareEnded(){this._behaviours.isStartWithEndUserScreenShare()&&(clearTimeout(this._connectionTimer),this.dispatchEvent(a.LiveEnded))}detectWhenCallHasFailed(e){console.log("LiveControllerImpl::detectWhenCallHasFailed: ",JSON.stringify(e,null,2)),this.dispatchEvent(a.LiveCanceled)}detectWhenParticipantsChange(e,t,i){switch(console.log("LiveControllerImpl::detectWhenParticipantsChange change="+t,i),t){case live.CONVERSATIONSTATE.STREAM_ADDED:console.log("TRANSFER: Stream_Added: transferState="+this._buttonState.transferState),this._buttonState.isTransferring()&&this._av.createAVStreamForNewAssociate(e,i),i.initCallbacks(this.detectWhenParticipantStateChanges.bind(this,i),this.detectWhenAddLocalStreamRequested.bind(this),this.detectWhenAddRemoteStreamRequested.bind(this));break;case live.CONVERSATIONSTATE.STREAM_LEFT:case live.CONVERSATIONSTATE.STREAM_REMOVED:case live.CONVERSATIONSTATE.STREAM_REJECTED:this.dispatchEvent(a.LiveParticipantLeft,i)}}addQualityMonitor(){const e=this.getAssociateStreamInfo(live.STREAMTYPE.AUDIOVIDEO);e&&(console.log("addQualityMonitor: AV",e),this._networkQualityMonitor.monitor(e,!1));const t=this.getAssociateStreamInfo(live.STREAMTYPE.SCREENSHARE);t&&(console.log("addQualityMonitor: SS",t),this._networkQualityMonitor.monitor(t,!1));const i=this.getLocalStreamInfo(live.STREAMTYPE.AUDIOVIDEO);i&&(console.log("addQualityMonitor: AV",i),this._networkQualityMonitor.monitor(i,!0));const o=this.getLocalStreamInfo(live.STREAMTYPE.SCREENSHARE);o&&(console.log("addQualityMonitor: SS",o),this._networkQualityMonitor.monitor(o,!0))}detectWhenParticipantStateChanges(e,t,i){const o=e.getUri(),n=i.getType();console.log("LiveControllerImpl::detectWhenParticipantStateChanges: state="+t+", uri="+o+", streamType="+n,e,i);const r=i.getStreamProfile();console.log("Incoming stream profile=",JSON.stringify(r,null,2));const s=i.getStreamOptions();console.log("Incoming stream options=",JSON.stringify(s,null,2));const l=s.shouldSendVideo();switch(t){case live.CONVERSATIONSTATE.STREAM_ACTIVE:this._connection.logEventTimestamp((n===live.STREAMTYPE.AUDIOVIDEO?"av":"ss")+(o===this.service.userID?"Local":"Remote")+"ParticipantStateToSTREAM_ACTIVE"),o===this._associateUri&&this.addQualityMonitor(),n===live.STREAMTYPE.AUDIOVIDEO&&(this.dispatchEvent(a.LiveStreamActive),this.reconnectedLocal()),o===this.service.userID&&n===live.STREAMTYPE.SCREENSHARE&&this._screen.maybeSelectRemoteSS(),o===this._associateUri&&n===live.STREAMTYPE.SCREENSHARE&&l&&this.dispatchEvent(a.LiveRemoteScreenActive);break;case live.CONVERSATIONSTATE.STREAM_JOINED:o===this._associateUri&&n===live.STREAMTYPE.SCREENSHARE?(console.log("Screen share STREAM_JOINED!",i,JSON.stringify(s,null,2)),"sendonly"===i.streamOptions.videoConfig?(console.log("streamJoined: The associate is sending us a screen share"),this._screen.startReceivingScreenShare(i)):this._screen.streamJoined(i)):o===this._associateUri&&n===live.STREAMTYPE.AUDIOVIDEO&&this._av.isActive()&&this._av.streamJoined(i);break;case live.CONVERSATIONSTATE.STREAM_REMOVED:o===this._associateUri&&n===live.STREAMTYPE.SCREENSHARE?this._screen.stopReceivingScreenShare():o===this._associateUri&&n===live.STREAMTYPE.AUDIOVIDEO&&this._av.stopRemote(i);break;case live.CONVERSATIONSTATE.STREAM_CHANGED:o===this._associateUri&&n===live.STREAMTYPE.AUDIOVIDEO&&"resume"===r.pauseResume.video&&(console.log("Remote participant changed: upgraded="+r.upgraded+", paused="+r.paused+", video_paused="+r.pauseResume.video),!r.upgraded||s.videoConfig!==live.MEDIADIRECTION.SENDRECV&&s.videoConfig!==live.MEDIADIRECTION.SENDONLY?i&&i.streamId&&this._myStreams.includes(i.streamId)?this._av.disableRemoteVideo():console.log("Ignoring PROFILE_UPDATED for streamId: "+(i&&i.streamId?i.streamId:"(invalid streamId)")):this._av.enableRemoteVideo());break;case live.CONVERSATIONSTATE.PROFILE_UPDATED:o===this._associateUri&&n===live.STREAMTYPE.AUDIOVIDEO&&(console.log("Remote participant changed: upgraded="+r.upgraded+", paused="+r.paused+", video_paused="+r.pauseResume.video),!r.upgraded||s.videoConfig!==live.MEDIADIRECTION.SENDRECV&&s.videoConfig!==live.MEDIADIRECTION.SENDONLY?i&&i.streamId&&this._myStreams.includes(i.streamId)?this._av.disableRemoteVideo():console.log("Ignoring PROFILE_UPDATED for streamId: "+(i&&i.streamId?i.streamId:"(invalid streamId)")):this._av.enableRemoteVideo());break;case live.CONVERSATIONSTATE.SIDEBAR_CREATED:console.log("Sidebar created"),this._conversation.addRemainingStreams()}}detectWhenAddRemoteStreamRequested(e,t,i,o,n){console.log("LiveControllerImpl::detectWhenAddRemoteStreamRequested: conversation:",e),console.log(".. participant:",t),console.log(".. streamRequest:",i),console.log(".. streamType:",o),console.log(".. streamOptions:",n),this._upgradeRequest=i,this._upgradeRequestStreamType=o,this._upgradeRequestForUser="associate",o===live.STREAMTYPE.SCREENSHARE&&this.dispatchEvent(a.LiveRemoteScreenShareRequested)}detectWhenAddLocalStreamRequested(e,t,i,o,n){console.log("LiveControllerImpl::detectWhenAddLocalStreamRequested: conversation:",e),console.log(".. participant:",t),console.log(".. streamRequest:",i),console.log(".. streamType:",o),console.log(".. streamOptions:",n),this._upgradeRequest=i,this._upgradeRequestStreamType=o,this._upgradeRequestForUser="user",this.dispatchEvent(a.LiveStartScreenShareRequested)}upgradeRequestIsAssociateScreenShare(){return this._upgradeRequestStreamType===live.STREAMTYPE.SCREENSHARE&&"associate"===this._upgradeRequestForUser}upgradeRequestIsUserScreenShare(){return this._upgradeRequestStreamType===live.STREAMTYPE.SCREENSHARE&&"user"===this._upgradeRequestForUser}upgradeRequestIsUserVideo(){return this._upgradeRequestStreamType===live.STREAMTYPE.AUDIOVIDEO&&"user"===this._upgradeRequestForUser}reconnectedLocal(){if(console.log("reconnectedLocal: reconnecting="+this._reconnectingLocal),this._reconnectingLocal&&(this.dispatchEvent(a.LiveReconnectedLocal),this.stopReconnectionTimer(),this.sendNetworkStatus("network_recover")),this._conversation){const e=this._conversation.getRemoteParticipant(),t=this._conversation.getLocalParticipant();(e&&e.isRecording()||t&&t.isRecording()||this._conversation.isRecording())&&this.dispatchEvent(a.LiveRecordingStarted)}}detectWhenRelayCommandIsReceived(e,t,i,o,n){switch(console.log("detectWhenRelayCommandIsReceived: command="+o,n),o){case"network_disconnect":this.dispatchEvent(a.LiveReconnectingRemote),this.startReconnectionTimer();break;case"network_recover":this.dispatchEvent(a.LiveReconnectedRemote),this.stopReconnectionTimer();break;case"upgrade_downgrade":this._av.isActive()&&this._av.detectStreamPauseResumeRequest(e,t,i,n[0]),this._screen.isActive()&&this._screen.detectStreamPauseResumeRequest(e,t,i,n[0]);break;case"cancel":this.cancelUpgradeRequest(n[0].original_directive);break;case"annotate_start":this.dispatchEvent(a.LiveAssociateAnnotationStarted);break;case"annotate_stop":this.dispatchEvent(a.LiveAssociateAnnotationStopped);break;case"video_annotate_start":this.dispatchEvent(a.LiveAssociateVideoAnnotationStarted);break;case"video_annotate_stop":this.dispatchEvent(a.LiveAssociateVideoAnnotationStopped);break;case"freeze_customer_stream":$("body").css("visibility","hidden"),$(".oracle-live").css("visibility","visible"),this.dispatchEvent(a.LiveAssociateFreezeCustomerStream,n);break;case"unfreeze_customer_stream":$("body").css("visibility","visible"),this.dispatchEvent(a.LiveAssociateUnfreezeCustomerStream);break;case"hidden_screen_share":console.log("hidden_screen_share received on stream:",t),this.setPermanentTwoWayScreenShare(!0),this.startDummyScreenShareIfNecessary();break;case"show_screen_share":console.log("show_screen_share received on stream:",t),this._screen.showIncomingScreenShare();break;case"hide_screen_share":this._screen.hideIncomingScreenShare();break;case"stop_screen_share":this._screen.stopSendingScreenShare();break;case"transfer_started":console.log("TRANSFER: transfer_started"),this._isMeeting&&this._meet._isPstnUpgrade&&(console.log("Received a transfer during PSTN upgrade, ending meeting leg"),this.endCallWithAssociate()),this._transferringAssociateUri=this._associateUri,this._buttonState.transferState="Started",this.dispatchEvent(a.LiveAssociateTransferStarted,n);break;case"transfer_start_stream":this._transferringAssociateUri=this._associateUri,n.length>0&&n[0].target&&n[0].target.length>0&&(this._associateUri=n[0].target,this._buttonState.transferState="AssociateObtained",this._rest.getAssociateInfo().then(()=>{this.reloadAssociateAvatar(this._associateUri)}),console.log("TRANSFER: Received transfer_start_steam"),console.log("          Transferring associate: "+this._transferringAssociateUri),console.log("           Transfer-to associate: "+this._associateUri),this.dispatchEvent(a.LiveAssociateTransferStartStream,n));break;case"transfer_completed":console.log("TRANSFER: transfer_complete"),this._buttonState.transferState="RemoveOriginalAssociate",this.dispatchEvent(a.LiveAssociateTransferCompleted,n);break;case"transfer_failed":console.log("TRANSFER: transfer_failed"),this._buttonState.transferState="None",this.dispatchEvent(a.LiveAssociateTransferFailed,n);break;case"transfer_stopped":console.log("TRANSFER: transfer_stopped"),this._buttonState.transferState="None",this.dispatchEvent(a.LiveAssociateTransferStopped,n);break;case"annotate_customer_stream":{let e=n&&n[0]&&n[0].annotation_type?n[0].annotation_type:void 0;console.log("annotationType: ",e),void 0===e?(console.log("annotate_customer_screen missing annotation_type"),this.dispatchEvent(a.LiveAssociateAnnotationReceived,n)):"screen_share"===e?this.dispatchEvent(a.LiveAssociateAnnotationReceived,n):"video"===e&&this.dispatchEvent(a.LiveAssociateVideoAnnotationReceived,n);break}default:console.log("Ignoring directive: ",o,", args: ",n)}}detectWhenRecordingStateChanges(e,t){console.log("Conversation "+(t?"IS":"is NOT")+" being recorded"),t?this.dispatchEvent(a.LiveRecordingStarted):this.dispatchEvent(a.LiveRecordingStopped)}setPermanentTwoWayScreenShare(e){console.log("setPermanentTwoWayScreenShare => "+e),this._permanentTwoWayScreenShare=e}installChromeScreenSharePlugin(){this.dispatchEvent(a.LiveScreenSharePluginInstalling),this._screen.installChromeScreenSharePlugin()}cancelChromeScreenSharePluginInstall(){this.declineUpgradeRequest(),this._screen.cancelChromeScreenSharePluginInstall()}acceptUpgradeRequest(){this._upgradeRequest&&(console.log("Accepting request for: "+this._upgradeRequestStreamType+" to: "+this._upgradeRequestForUser),this._upgradeRequest.accept(),this._upgradeRequest=null,console.log("Accepted remote upgrade request"),this._upgradeRequestStreamType=null,this._upgradeRequestForUser=null)}declineUpgradeRequest(){this._upgradeRequest&&(console.log("Declining request for: "+this._upgradeRequestStreamType+" to: "+this._upgradeRequestForUser),this._upgradeRequest.decline(),this._upgradeRequest=null,this._av._upgradePauseResume=null,this._upgradeRequestStreamType=null,this._upgradeRequestForUser=null)}cancelUpgradeRequest(e){console.log("Associate has cancelled request: "+e),this._upgradeRequestStreamType&&this._upgradeRequestForUser&&console.log("Pending request for: "+this._upgradeRequestStreamType+" to: "+this._upgradeRequestForUser),"add_stream"===e?this.upgradeRequestIsAssociateScreenShare()?this.dispatchEvent(a.LiveRemoteScreenShareCancelled):this.upgradeRequestIsUserScreenShare()?this.dispatchEvent(a.LiveStartScreenShareRequestCancelled):this.upgradeRequestIsUserVideo()&&this.dispatchEvent(a.LiveStartVideoRequestCancelled):"pause_resume_stream"===e&&(this.upgradeRequestIsUserScreenShare()?this.dispatchEvent(a.LiveStartScreenShareRequestCancelled):this.upgradeRequestIsUserVideo()&&this.dispatchEvent(a.LiveStartVideoRequestCancelled)),this._upgradeRequestStreamType=null,this._upgradeRequestForUser=null,this._av._upgradePauseResume=null}upgradeLocalVideo(){this._av.startVideo()}downgradeLocalVideo(){this._av.stopVideo()}startVideoPreview(){console.log("LiveControllerImpl.startVideoPreview"),this._isRehydratingNonMeetingCall()||this._isRehydratingMeetingCall()?console.log("LiveControllerImpl.startVideoPreview: rehydrating so not starting preview"):(this.removeClass(".oracle-live","oracle-live-preCallIDCheck-verified"),this.removeClass(".oracle-live","oracle-live-preCallIDCheck-enabled"),console.log("LiveControllerImpl.startVideoPreview: call LiveAudioVideo.startVideoPreview"),this._haveRequestedVideoPreview=!0,this._av.startVideoPreview())}stopVideoPreview(e){this._av.stopVideoPreview(),this.hasClass(".oracle-live","oracle-live-preCallIDCheck-call-associate")&&(this.removeClass(".oracle-live","oracle-live-preCallIDCheck-call-associate"),this.addClass(".oracle-live","oracle-live-preCallIDCheck-error")),e&&(this._buttonState.isPreCallIDCheck()?this.netVerificationCancelled(a.LiveCanceled):this.dispatchEvent(a.LiveCanceled))}sendScreenShare(e){console.log("LiveControllerImpl::sendScreenShare",!0===e),e?this._screen.startSendingScreenShare():this._screen.stopSendingScreenShare()}detectWhenConnectionHasChanged(e){switch(console.log("LiveControllerImpl::detectWhenConnectionHasChanged: state=",e),e){case live.CONNECTIONSTATE.FAILED:console.log("LiveControllerImpl::detectWhenConnectionHasChanged FAILED"),this._conversation?this.dispatchEvent(a.LiveStreamError):(console.error("Failed to connect to server"),this._connectionId=null,this.dispatchEvent(a.LiveLoginError),this.reset(),this._connection=null);break;case live.CONNECTIONSTATE.RECONNECTING:this._reconnectingLocal=!0,this.dispatchEvent(a.LiveReconnectingLocal),this.sendNetworkStatus("network_disconnect"),this.startReconnectionTimer();break;case live.CONNECTIONSTATE.CONNECTED:this.reconnectedLocal()}}detectIncomingStream(e,t,i){console.log("detectIncomingStream: streamOptions="+JSON.stringify(i,null,2),t),t.getType()===live.STREAMTYPE.AUDIOVIDEO?(console.log("incomingAV: ",t),this._av.incomingAV(t,i)):console.log("incomingSS: ",t)}sendNetworkStatus(e){this._conversation&&(console.log("sendNetworkStatus: "+e),this._conversation.relayCommandTo(null,"*",e,[{target:this._conversation.getLocalParticipantUri()}]))}sendUpdatedContextAttribute(e,t){if(this._conversation&&this._av.isActive()){const i={};i[e]=t,console.log("sendUpdatedContextAttribute: "+JSON.stringify(i,null,2)),this._conversation.relayCommandTo(null,"*","context_updated",[i])}}sendAnnotationStart(){const e=this.getAssociateStreamInfo(live.STREAMTYPE.SCREENSHARE);if(e){const t=e.getId();if(t)return void this._conversation.relayCommandTo(t,"*","annotate_start",[{}])}console.log("sendAnnotationStart: failed to send annotationStart relay message")}sendAnnotationStop(){const e=this.getAssociateStreamInfo(live.STREAMTYPE.SCREENSHARE);if(e){const t=e.getId();if(t)return void this._conversation.relayCommandTo(t,"*","annotate_stop",[{}])}console.log("sendAnnotationStop: failed to send annotationStop relay message")}startReconnectionTimer(){this._reconnectionTimer?console.log("Reconnection timer already running"):(console.log("Starting the reconnection timer"),this._reconnectingLocal=!0,this._reconnectionTimer=setTimeout(()=>{console.log("Reconnection timer expired, assume that remote participant has left"),this.dispatchEvent(a.LiveParticipantLeft)},this._reconnectionTimeout),this.stopStatusCheckTimer())}stopReconnectionTimer(){this._reconnectionTimer&&(console.log("Stopped the reconnection timer"),clearTimeout(this._reconnectionTimer),this._reconnectingLocal=!1,this._reconnectionTimer=null,this._conversation&&this.startStatusCheckTimer())}startStatusCheckTimer(){this._statusCheckTimer?console.log("StatusCheck timer already running"):(console.log("Starting the StatusCheck timer"),this._statusCheckTimer=setTimeout(()=>{console.log("StatusCheck timer, checking the status of the call"),this._conversation?this._conversation.checkStatus(()=>{console.log("Status check successful")},e=>{console.log("Status check failed: "+e),this.dispatchEvent(a.LiveParticipantLeft)}):this.dispatchEvent(a.LiveParticipantLeft)},this._statusCheckTimeout))}stopStatusCheckTimer(){this._statusCheckTimer&&(console.log("Stopped the StatusCheck timer"),clearTimeout(this._statusCheckTimer),this._statusCheckTimer=null)}generateCode(){const e={},t=window.location.search.substring(1).split("&");for(let i=0;i<t.length;i++){const o=t[i].split("=");void 0===e[o[0]]?e[o[0]]=decodeURIComponent(o[1]):"string"==typeof e[o[0]]?e[o[0]]=[e[o[0]],decodeURIComponent(o[1])]:e[o[0]].push(decodeURIComponent(o[1]))}let i={};const o=e.meeting_id;return o?(i.id=o,i.type="meetingCode"):sessionStorage.getItem("Code")?i=JSON.parse(sessionStorage.getItem("Code")):(i.id=this.generateShortCode(),i.type="shortCode"),sessionStorage.setItem("Code",JSON.stringify(i)),console.log("Generated code: "+i.id+","+i.type),i}generateShortCode(){let e="23456789ABCDEFGHJKLMNPQRSTUVWXYZ",t=Math.ceil(1),i=Math.floor(e.length),o=window.crypto||window.msCrypto,n="";for(let a=0;a<6;a++){let a=new Uint32Array(1);o.getRandomValues(a);let r=a[0]/4294967296;n+=e[Math.floor(r*(i-t+1))+t-1]}return console.log("Generated short-code: "+n),n}refreshConnection(e){console.log("LiveControllerImpl::refreshConnection ",e),this._conversation=e,this._reconnectingLocal=!0,this._conversation.withCallbacks(this.detectWhenRecordingStateChanges.bind(this),this.detectWhenParticipantsChange.bind(this),this.detectWhenCallHasFailed.bind(this),this.detectWhenRelayCommandIsReceived.bind(this)),this._conversation.getParticipants().forEach(e=>{e.initCallbacks(this.detectWhenParticipantStateChanges.bind(this,e),this.detectWhenAddLocalStreamRequested.bind(this),this.detectWhenAddRemoteStreamRequested.bind(this))});const t=this._conversation.getLocalParticipantUri(),i=this._conversation.getParticipants().find(e=>e.getUri()!==t);i&&(console.log("Found remote participant: "+JSON.stringify(i,null,2)),this._associateUri=i.getUri()),e.getStreams().forEach(e=>{e.getType()===live.STREAMTYPE.AUDIOVIDEO?this._av.resume(e):(console.log("LiveControllerImpl::refreshConnection screenshare stream ",e),this._screen.resume(e)),this._screen.setConnectionRestored()}),this.sendUpdatedContextAttribute("url",this.contextAttributes.get("url"))}setPositionInQueue(e){console.log(`positionInQueue: ${e}`),this._positionInQueue=e,this.dispatchEvent(a.LiveCallQueuePositionUpdate)}getPositionInQueue(){console.log("getPositionInQueue");let e="";return this._positionInQueue&&(e+=this._positionInQueue),e.endsWith("1")&&"11"!==e?e+="st":e.endsWith("2")&&"12"!==e?e+="nd":e.endsWith("3")&&"13"!==e?e+="rd":e+="th",e}setAssociateName(e){this._buttonState.associateName=e}setAssociatePhoto(e){this._buttonState.associatePhotoURL=e}getAssociateStreamInfo(e){return this._conversation.getParticipant(this._associateUri).getStreamInfos().find(t=>t.getType()===e)}getLocalStreamInfo(e){return this._conversation.getLocalParticipant().getStreamInfos().find(t=>t.getType()===e)}startDummyScreenShareIfNecessary(){this._dummyScreenShareCreated||this._behaviours&&this._behaviours.isEndUserScreenSharePossible()&&(console.log("End user can share screen - creating a dummy screen share stream for faster on/off"),this._dummyScreenShareCreated=!0,console.log("adding dummy screen share"),this._screen.startDummyScreenShare())}netVerificationCancelled(e=a.LivePreCallIDCheckError){this.dispatchEvent(e),this._rest.deleteIdentityVerificationTransaction(this.service,this._transactionReference).then(e=>console.log("netVerificationCancelled: got response: "+e)).catch(e=>console.error("netVerificationCancelled: failed to delete transaction: "+e.message,e.response))}waitForVerificationStatus(e,t=1e4,i=6e5){console.log("LiveControllerImpl::waitForVerificationStatus  transactionReference: ",e);const o=Number(new Date)+i;let n="PENDING",a="FAILURE";const r=e=>{e&&console.log("LiveControllerImpl::rejectCallback: received response: ",e),this.removeClass(".oracle-live","oracle-live-preCallIDCheck-verifying"),this.addClass(".oracle-live","oracle-live-preCallIDCheck-error"),this.netVerificationCancelled()},s=i=>{i&&(n=i.status,a=i.lxResult),console.log("LiveControllerImpl::resolveCallback received response: ",i),"DONE"!==n||"SUCCESS"!==a&&"UNSURE"!==a?"ERROR"===n||"FAILURE"===a?(console.log("LiveControllerImpl::resolveCallback error received"),this.removeClass(".oracle-live","oracle-live-preCallIDCheck-verifying"),this.addClass(".oracle-live","oracle-live-preCallIDCheck-error"),this.netVerificationCancelled()):"PENDING"===n&&(console.log("LiveControllerImpl::resolveCallback: about to call poll"),setTimeout(()=>{l()},t)):(console.log("LiveControllerImpl::resolveCallback we have a successful verification"),this.contextAttributes.set("preCallCheckId",e),this.removeClass(".oracle-live","oracle-live-preCallIDCheck-verifying"),this.addClass(".oracle-live","oracle-live-preCallIDCheck-verified"))},l=()=>{const t=Number(new Date);console.log("LiveControllerImpl::poll status: "+n+"  endTime: "+o+" now: "+t),"PENDING"===n?t<o?(console.log("LiveControllerImpl::poll:  waiting"),console.log("LiveControllerImpl::poll:  polling"),this._rest.getPreCallIDCheckStatus(this.service,e,s,r)):(console.log("Polling timeout occurred - verification failed"),this.removeClass(".oracle-live","oracle-live-preCallIDCheck-verifying"),this.addClass(".oracle-live","oracle-live-preCallIDCheck-error"),this.netVerificationCancelled()):console.log("LiveControllerImpl::poll: stop polling: ")};l()}startPreCallIDCheck(e){console.log("LiveControllerImpl::startPreCallIDCheck"),this.dispatchEvent(a.LivePreCallIDCheckStarted);const t=this,i=o=>{if(console.log("LiveControllerImpl::jumioMessageHandler origin: ",o.origin),this._autoTest||"https://netverify.com"===o.origin){let n=JSON.parse(o.data);if(console.log("LiveControllerImpl::jumioMessageHandler data: ",JSON.stringify(n,null,2)),n.payload){const o=n.payload.value;"loaded"===o?console.log("LiveControllerImpl::jumioMessageHandler received 'loaded' message"):"success"===o?(console.log("LiveControllerImpl::jumioMessageHandler We have success!"),e.removeEventListener("message",i,!1),this.addClass(".oracle-live","oracle-live-preCallIDCheck-verifying"),t._transactionReference=n.transactionReference,t._transactionReference&&t.waitForVerificationStatus(t._transactionReference)):"error"===o&&(this._transactionReference=n.transactionReference,this.removeClass(".oracle-live","oracle-live-preCallIDCheck-enabled"),this.addClass(".oracle-live","oracle-live-preCallIDCheck-error"),this.netVerificationCancelled())}}else console.log("LiveControllerImpl::jumioMessageHandler with an invalid origin - ignoring")};this._rest.sendContext(()=>{const t=this._rest.createInitiatePreCallCheckPayload();console.log("LiveControllerImpl::startPreCallIDCheck: data: ",t),this._rest.initiatePreCallIDCheck(this.service,t,t=>{console.log("LiveControllerImpl::startPreCallIDCheck received response: ",t);let o="",n="";t.redirectUrl&&(o=t.redirectUrl,n=t.transactionReference,console.log("LiveControllerImpl::startPreCallIDCheck redirectUrl",o),console.log("LiveControllerImpl::startPreCallIDCheck transactionRef",n),e.addEventListener("message",i,!1),$(".kyc-jumio-iframe").attr("src",o),this.addClass(".oracle-live","oracle-live-preCallIDCheck-in-progress"),this.addClass(".oracle-live","oracle-live-preCallIDCheck-enabled"))})})}continueVerification(){console.log("LiveControllerImpl::continueVerification"),this._rest.updatePreCallIdCheck(this.service,this._transactionReference,null,e=>{e&&console.log("LiveControllerImpl::rejectCallback: received response: ",e)}),this.addClass(".oracle-live","oracle-live-preCallIDCheck-call-associate"),this.addClass(".oracle-live","oracle-live-video-enduser-maximized"),this.dispatchEvent(a.LiveStartVerificationCall)}getVerificationResult(e){console.log("LiveControllerImpl::getVerificationResult: conversationKey: ",e);let t="Failure";return this._rest.getPreCallIDCheckResult(this.service,e).then(e=>{console.log("LiveRestHelper::getPreCallIDCheckResult: got response: "+e),console.log("LiveControllerImpl::getVerificationResult: received response: ",e),e&&(t=e.result),"Success"===t?(console.log("resolveCallback: result: Success"),this.removeClass(".oracle-live","oracle-live-preCallIDCheck-verifying"),this.addClass(".oracle-live","oracle-live-preCallIDCheck-success")):(console.log("resolveCallback: result: Failure"),this.removeClass(".oracle-live","oracle-live-preCallIDCheck-verifying"),this.addClass(".oracle-live","oracle-live-preCallIDCheck-error"))}).catch(e=>{console.log("LiveRestHelper::getPreCallIDCheckResult: failed to getPreCallIDCheckResult, Error: "+e.message,e.response),e.response&&console.log("LiveControllerImpl::rejectCallback: received response: ",e.response),this.removeClass(".oracle-live","oracle-live-preCallIDCheck-verifying"),this.addClass(".oracle-live","oracle-live-preCallIDCheck-error"),this.netVerificationCancelled()})}resetPreCallIDCheckState(){console.log("LiveControllerImpl::resetPreCallIDCheckState"),this.removeClass(".oracle-live","oracle-live-preCallIDCheck-verifying"),this.removeClass(".oracle-live","oracle-live-preCallIDCheck-verified"),this.removeClass(".oracle-live","oracle-live-preCallIDCheck-error"),this.removeClass(".oracle-live","oracle-live-preCallIDCheck-success"),this.removeClass(".oracle-live","oracle-live-preCallIDCheck-enabled"),this.removeClass(".oracle-live","oracle-live-preCallIDCheck-call-associate"),this._transactionReference=null,this.contextAttributes.remove("preCallCheckId"),$(".kyc-jumio-iframe").attr("src",null)}removeClass(e,t){e&&t?$(e).removeClass(t):console.log("LiveControllerImpl::removeClass: unable to remove class - invalid parameters")}addClass(e,t){e&&t?$(e).addClass(t):console.log("LiveControllerImpl::removeClass: unable to add class - invalid parameters")}hasClass(e,t){if(e&&t)return $(e).hasClass(t);console.log("LiveControllerImpl::removeClass: unable to remove class - invalid parameters")}}}),liveRequire.define("LiveMeeting",[],function(){"use strict";return class{constructor(e){this._impl=e,console.log("Resetting pstn upgrade indicator to false"),this._isPstnUpgrade=!1}addComponent(e){this._impl.addComponent(e)}event(e){this._impl.event(e)}getNetworkStatus(e,t){this._impl.getNetworkStatus(e,t)}getMetaScenario(e){this._impl._rest.getMetaScenario(e)}overrideBehaviours(e){this._impl.overrideBehaviours(e)}setPstnOverride(e){return console.log("setPstnOverride.."),this._isPstnUpgrade=!0,null===e?null:this.applyPossiblePstnOverride(e)}applyPossiblePstnOverride(e){return console.log("applyPossiblePstnOverride.."),this._isPstnUpgrade&&(console.log("applyPossiblePstnOverride knows this meeting is a PSTN upgrade."),e=this.removeAudio(e),this.overrideBehaviours(e.behaviours)),console.log("applyPossiblePstnOverride returning config:",e),e}removeAudio(e){return console.log("Removing audio from configuration behaviours: "+JSON.stringify(e.behaviours,null,2)),"AUDIO_ONLY"===e.behaviours.endUserInitialMedia?e.behaviours.endUserInitialMedia="NONE":"AUDIO_VIDEO"===e.behaviours.endUserInitialMedia&&(e.behaviours.endUserInitialMedia="VIDEO_ONLY"),"AUDIO_ONLY"===e.behaviours.associateInitialMedia?e.behaviours.associateInitialMedia="NONE":"AUDIO_VIDEO"===e.behaviours.associateInitialMedia&&(e.behaviours.associateInitialMedia="VIDEO_ONLY"),e.behaviours.endUserCanAddAudio=!1,e.behaviours.associateCanAddAudio=!1,e.behaviours.associateCanRequestEndUserAudio=!1,console.log("Configuration behaviours is now: "+JSON.stringify(e.behaviours,null,2)),e}}}),liveRequire.define("LiveController",["LiveControllerImpl","LiveEvents","LiveMeeting"],function(e,t,i){"use strict";return class{constructor(){console.log("construct LiveController"),this._impl=new e,this._meet=new i(this._impl),this._impl._meet=this._meet}get service(){return this._impl.service}get contextAttributes(){return this._impl.contextAttributes}get settings(){return this._impl.settings}get version(){return this._impl.version}get events(){return t}addComponent(){this._impl.addComponent()}updateComponent(){this._impl.updateComponent()}}}),liveRequire.define("oracle.live.api",["LiveController"],function(e){"use strict";return console.log("Oracle Live Experience loaded"),{controller:new e}}),liveRequire.require.config({waitSeconds:60,baseUrl:"live/js",paths:{jquery:"oracle.live.api",text:"oracle.live.api",i18n:"oracle.live.api",css:"oracle.live.api","oracle.live.api":"oracle.live.api","oracle.live.style":"oracle.live.style","oracle.live.button":"oracle.live.api","oracle.live.sdk":"oracle.live.api"},shim:{jquery:{exports:["jQuery","$"]}}}),liveRequire.require(["oracle.live.api"],function(liveApi){return window.liveApi=liveApi,{liveApi:liveApi}}),liveRequire.define("all-main",function(){}),function(e){var t=document,i="appendChild",o="styleSheet",n=t.createElement("style");n.type="text/css",t.getElementsByTagName("head")[0][i](n),n[o]?n[o].cssText=e:n[i](t.createTextNode(e))}("/*!\n * Copyright (c) 2018 Oracle. All rights reserved.\n *\n * This material is the confidential property of Oracle Corporation or its\n * licensors and may be used, reproduced, stored or transmitted only in\n * accordance with a valid Oracle license or sublicense agreement.\n */.oracle-live{font-family:system-ui,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif;font-weight:400}.oracle-live.oracle-live-hidden{display:none}.oracle-live [role=button]{height:30px;width:30px;display:inline-block;margin:6px 5px;background-repeat:no-repeat;background-position:50%;border-radius:50%;background-color:#0c7db9;border:1px solid #0c7db9;cursor:pointer}.oracle-live [role=button][aria-pressed=true]{background-color:#fff}.oracle-live [role=button]:hover{background-color:#2183b8;border-color:#2183b8}.oracle-live [role=button]:focus{outline:none;box-shadow:0 0 3pt 2pt #8bbefd}.oracle-live [role=button][aria-pressed=true]:hover{background-color:#e0f0fd;border-color:#0c7db9}.oracle-live [role=button][aria-disabled=true],.oracle-live [role=button][aria-disabled=true]:hover{background-color:#b3b3b3;border-color:#b3b3b3;cursor:default}.oracle-live [role=button][aria-disabled=true][aria-pressed=true]{background-color:#fff;border-color:#b3b3b3}.oracle-live-dialog [role=button]{display:inline-block;text-align:center;line-height:30px;min-width:70px;width:unset;height:auto;margin:0;border-radius:2px;border-color:#0c7db9;background:#0c7db9;color:#fff}.oracle-live-dialog [role=button]:hover{background:#2183b8;border-color:#2183b8}.oracle-live-dialog [role=button][aria-disabled=true],.oracle-live-dialog [role=button][aria-disabled=true]:hover,.oracle-live-dialog [role=button][aria-pressed=true][aria-disabled=true],.oracle-live-dialog [role=button][aria-pressed=true][aria-disabled=true]:hover{background-color:#b3b3b3;border-color:#b3b3b3}.oracle-live-recording{display:none}.oracle-live-recording-on .oracle-live-recording{display:block;font-size:11px;padding:0 0 0 17px;margin-top:2px;background-image:url(images/oracle-live_v0.2.png);background-repeat:no-repeat;background-position:-6px -1102px;height:20px;width:auto}.oracle-live-annotation-canvas,.oracle-live-annotation-video-canvas{display:none}.oracle-live-annotation-associate-on .oracle-live-annotation-canvas,.oracle-live-annotation-enduser-on .oracle-live-annotation-canvas{display:block;background-color:transparent;position:fixed;top:0;left:0;z-index:9300000}.oracle-live-annotation-associate-on .oracle-live-annotation-canvas{pointer-events:none}.oracle-live-video-enduser-on.oracle-live-video-associate-on.oracle-live-annotation-associate-video-on .oracle-live-annotation-video-canvas{display:none}.oracle-live-video-enduser-maximized.oracle-live-video-enduser-on.oracle-live-annotation-associate-video-on .oracle-live-annotation-video-canvas{display:block;background-color:transparent;position:fixed;top:44px;width:100vw;height:calc(100vh - 44px);left:0;z-index:9099950}.oracle-live-video-enduser-on.oracle-live-annotation-associate-video-on .oracle-live-annotation-video-canvas{display:block;height:100%;width:100%;top:1px;position:absolute;overflow:hidden;z-index:9099985}.oracle-live-associate-annotation-video-hide .oracle-live-annotation-video-canvas,.oracle-live-enduser-annotation-hide .oracle-live-annotation-canvas,.oracle-live-screenshare-associate-maximized.oracle-live-video-associate-on .oracle-live-annotation-video-canvas,.oracle-live-video-associate-maximized.oracle-live-video-associate-on .oracle-live-annotation-video-canvas,.oracle-live-video-preview .oracle-live-annotation-canvas,.oracle-live-video-preview .oracle-live-annotation-video-canvas{display:none}.oracle-live-screen-share-canvas{display:none;background-color:transparent;position:fixed;width:100%;height:100%;top:50%;left:50%;z-index:9300000}.oracle-live-cancel-rejoin-buttons{display:none;position:absolute;bottom:35px;left:50%;transform:translate(-50%);text-align:center;z-index:9100020}.oracle-live-meeting.oracle-live-cancelled .oracle-live-cancel-rejoin-buttons,.oracle-live-meeting.oracle-live-disconnected .oracle-live-cancel-rejoin-buttons,.oracle-live-meeting.oracle-live.oracle-live-connecting .oracle-live-cancel-rejoin-buttons,.oracle-live-video-enduser-maximized.oracle-live-connecting .oracle-live-cancel-rejoin-buttons{display:block}.oracle-live-cancel-rejoin-buttons [role=button]{background-color:#0c7db9;color:#fff;text-align:center;font-size:18px;line-height:44px;height:44px;border-radius:100px;margin:0;display:none;width:120px;max-width:120px;white-space:nowrap;text-overflow:ellipsis;overflow:hidden;flex-wrap:nowrap;padding-left:10px;padding-right:10px}.oracle-live-meeting.oracle-live-connecting .oracle-live-cancel-rejoin-buttons .oracle-live-cancel-button,.oracle-live-video-enduser-maximized.oracle-live-connecting .oracle-live-cancel-rejoin-buttons .oracle-live-cancel-button{display:block}.oracle-live-meeting.oracle-live-disconnected.oracle-live-error .oracle-live-cancel-rejoin-buttons .oracle-live-cancel-button{display:none}.oracle-live-meeting.oracle-live-cancelled .oracle-live-cancel-rejoin-buttons .oracle-live-rejoin-button,.oracle-live-meeting.oracle-live-disconnected .oracle-live-cancel-rejoin-buttons .oracle-live-rejoin-button{display:block}.oracle-live-meeting.oracle-live-disconnected .oracle-live-cancel-rejoin-buttons.oracle-live-no-rejoin .oracle-live-rejoin-button,.oracle-live-meeting.oracle-live-disconnected.oracle-live-feedback.oracle-live-show-dialog .oracle-live-cancel-rejoin-buttons .oracle-live-rejoin-button,.oracle-live-meeting.oracle-live-disconnected.oracle-live-video-preview.oracle-live-video-enduser-maximized .oracle-live-cancel-rejoin-buttons .oracle-live-rejoin-button{display:none}.oracle-live-menu{display:none;height:44px;background-color:#e0f0fd;border-radius:100px;box-shadow:2px 2px 10px #aaa;position:fixed;right:58px;bottom:38px;z-index:9100000}.oracle-live-connected .oracle-live-menu,.oracle-live-disconnected .oracle-live-menu{display:block;animation:oracle-live-buttonmenu-show-keyframes .4s ease-in 0s;animation-fill-mode:forwards}.oracle-live-collapsed .oracle-live-menu,.oracle-live-connecting.oracle-live-transferring.oracle-live-disconnected .oracle-live-menu{animation:oracle-live-buttonmenu-hide-keyframes .4s ease-in 0s;animation-fill-mode:forwards}.oracle-live-menu>div[role=presentation]{display:inline-block;width:50px}.oracle-live-connected.oracle-live-meeting .oracle-live-menu,.oracle-live-connected.oracle-live-screenshare-associate-on.oracle-live-screenshare-associate-maximized .oracle-live-menu,.oracle-live-connected.oracle-live-video-associate-on.oracle-live-video-associate-maximized .oracle-live-menu,.oracle-live-connected.oracle-live-video-enduser-on.oracle-live-video-enduser-maximized .oracle-live-menu{display:inline-block;right:50%;transform:translate(50%);animation:none}.oracle-live-meeting.oracle-live-disconnected.oracle-live .oracle-live-menu,.oracle-live-meeting .oracle-live-menu>div[role=presentation],.oracle-live-meeting.oracle-live-video-preview.oracle-live-video-associate-maximized .oracle-live-menu,.oracle-live-preCallIDCheck-enabled .oracle-live-menu,.oracle-live-screenshare-associate-maximized .oracle-live-menu>div[role=presentation],.oracle-live-transferring .oracle-live-menu,.oracle-live-video-associate-maximized .oracle-live-menu>div[role=presentation],.oracle-live-video-enduser-maximized .oracle-live-menu>div[role=presentation],.oracle-live-video-preview.oracle-live-video-enduser-maximized .oracle-live-menu,.oracle-live-video-preview.oracle-live-video-enduser-on.oracle-live-video-enduser-maximized .oracle-live-menu{display:none}.oracle-live-menu [role=button] [role=presentation]{background-repeat:no-repeat;height:16px;width:16px;margin:6px auto 0}.oracle-live-buttonbar-icon,.oracle-live-exitbutton-icon,.oracle-live-menu [role=button] [role=presentation]{background-image:url(images/oracle-live_v0.2.png)}.oracle-live-pause-button [role=presentation]{background-position-y:-688px;background-position-x:-30px}.oracle-live-connecting .oracle-live-pause-button,.oracle-live-transferring .oracle-live-pause-button{display:none}.oracle-live-pause-button[aria-disabled=true] [role=presentation],.oracle-live-pause-button[aria-disabled=true] [role=presentation]:hover{background-position-y:-668px}.oracle-live-pause-button[aria-pressed=true] [role=presentation]{background-position-y:-708px}.oracle-live-pause-button[aria-pressed=true][aria-disabled=true] [role=presentation],.oracle-live-pause-button[aria-pressed=true][aria-disabled=true] [role=presentation]:hover{background-position-y:-728px}.oracle-live-exit-button[role=button] [role=presentation]{background-position-y:-688px;background-position-x:-7px;width:20px}.oracle-live-connecting .oracle-live-exit-button,.oracle-live-transferring .oracle-live-exit-button{display:none}.oracle-live-exit-button[role=button]{background-color:#ff3b2f;border-color:#ff3b2f}.oracle-live-exit-button[role=button]:hover{background-color:#a3171b;border-color:#a3171b}.oracle-live-menu .oracle-live-video-button[role=button]{display:none}.oracle-live-video-control-enduser .oracle-live-video-button[role=button]{display:inline-block}.oracle-live-annotation-associate-video-on .oracle-live-video-button[role=button],.oracle-live-connecting .oracle-live-video-button[role=button],.oracle-live-frozen-annotation .oracle-live-video-button[role=button],.oracle-live-transferring .oracle-live-video-button[role=button]{display:none}.oracle-live-video-button[role=button] [role=presentation]{background-position-y:-688px;background-position-x:-108px;width:20px}.oracle-live-video-button[role=button][aria-disabled=true] [role=presentation],.oracle-live-video-button[role=button][aria-disabled=true] [role=presentation]:hover{background-position-y:-668px}.oracle-live-video-button[role=button][aria-pressed=true] [role=presentation],.oracle-live-video-button[role=button][aria-pressed=true] [role=presentation]:hover{background-position-y:-708px}.oracle-live-video-button[role=button][aria-pressed=true][aria-disabled=true] [role=presentation],.oracle-live-video-button[role=button][aria-pressed=true][aria-disabled=true] [role=presentation]:hover{background-position-y:-728px}.oracle-live-menu .oracle-live-screenshare-button[role=button]{display:none}.oracle-live-screenshare-control-enduser .oracle-live-screenshare-button[role=button],.oracle-live-screenshare-enduser-on .oracle-live-screenshare-button[role=button]{display:inline-block}.oracle-live-annotation-associate-video-on .oracle-live-screenshare-button[role=button],.oracle-live-connecting .oracle-live-screenshare-button[role=button],.oracle-live-frozen-annotation .oracle-live-screenshare-button[role=button],.oracle-live-transferring .oracle-live-screenshare-button[role=button]{display:none}.oracle-live-screenshare-button[role=button] [role=presentation]{background-position-y:-688px;background-position-x:-148px;width:20px}.oracle-live-screenshare-button[role=button][aria-disabled=true] [role=presentation],.oracle-live-screenshare-button[role=button][aria-disabled=true] [role=presentation]:hover{background-position-y:-668px}.oracle-live-screenshare-button[role=button][aria-pressed=true] [role=presentation],.oracle-live-screenshare-button[role=button][aria-pressed=true] [role=presentation]:hover{background-position-y:-708px}.oracle-live-screenshare-button[role=button][aria-pressed=true][aria-disabled=true] [role=presentation],.oracle-live-screenshare-button[role=button][aria-pressed=true][aria-disabled=true] [role=presentation]:hover{background-position-y:-728px}.oracle-live-menu .oracle-live-annotate-button[role=button]{display:none;cursor:auto}.oracle-live-screenshare-enduser-on .oracle-live-annotate-button[role=button]{display:inline-block}.ooracle-live-annotation-associate-video-on .oracle-live-annotate-button[role=button],.oracle-live-connecting .oracle-live-annotate-button[role=button],.oracle-live-frozen-annotation .oracle-live-annotate-button[role=button],.oracle-live-transferring .oracle-live-annotate-button[role=button]{display:none}.oracle-live-annotate-button[role=button] [role=presentation]{background-position-y:-688px;background-position-x:-88px;width:20px}.oracle-live-annotate-button[role=button][aria-disabled=true] [role=presentation],.oracle-live-annotate-button[role=button][aria-disabled=true] [role=presentation]:hover{background-position-y:-668px;cursor:auto}.oracle-live-annotate-button[role=button][aria-pressed=true] [role=presentation],.oracle-live-annotate-button[role=button][aria-pressed=true] [role=presentation]:hover{background-position-y:-708px;cursor:crosshair}.oracle-live-annotate-button[role=button][aria-pressed=true][aria-disabled=true] [role=presentation],.oracle-live-annotate-button[role=button][aria-pressed=true][aria-disabled=true] [role=presentation]:hover{background-position-y:-728px;cursor:auto}.oracle-live .oracle-live-main-button[role=button]{display:block;width:80px;height:80px;margin:0;background-color:#fff;font-weight:lighter;line-height:0;font-size:0;border-radius:50%;border:1px solid #c8c8c8;box-shadow:2px 2px 10px #aaa;position:fixed;right:20px;bottom:20px;z-index:9100010}.oracle-live .oracle-live-main-button[role=button]:focus{box-shadow:0 0 3pt 2pt #8bbefd}.oracle-live-meeting .oracle-live-main-button[role=button],.oracle-live-preCallIDCheck-enabled .oracle-live-main-button[role=button],.oracle-live-screenshare-associate-maximized .oracle-live-main-button[role=button],.oracle-live-video-associate-maximized .oracle-live-main-button[role=button],.oracle-live-video-enduser-maximized .oracle-live-main-button[role=button]{display:none}.oracle-live-disconnected .oracle-live-main-button[role=button],.oracle-live-disconnecting .oracle-live-main-button[role=button]{background-color:#fff}.oracle-live-connected .oracle-live-main-button[role=button]{border-width:2px;background-image:none;color:#fff;font-size:20px;text-align:center;vertical-align:middle;line-height:80px;border-color:#81bb5f;background-color:#1e3948}.oracle-live-disconnected .oracle-live-main-button[role=button]{border-width:2px;background-image:none;color:#b3b3b3;font-size:20px;text-align:center;vertical-align:middle;line-height:80px;background-color:#fff}.oracle-live-meeting .oracle-live-main-button[role=button]{display:none}.oracle-live-connected.oracle-live-poor-connection .oracle-live-main-button[role=button]{border-color:#fd9013}.oracle-live-paused-associate .oracle-live-main-button[role=button],.oracle-live-paused-enduser .oracle-live-main-button[role=button],.oracle-live.oracle-live-disconnected .oracle-live-main-button[role=button],.oracle-live.oracle-live-disconnecting .oracle-live-main-button[role=button]{border-color:#b3b3b3}.oracle-live-connecting .oracle-live-main-button[role=button],.oracle-live-reconnecting-associate .oracle-live-main-button[role=button],.oracle-live-reconnecting-enduser .oracle-live-main-button[role=button],.oracle-live-transferring .oracle-live-main-button[role=button]{border-width:1px;border-color:#c8c8c8}.oracle-live-mainbutton-icon{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:42px;height:41px;background-image:url(images/oracle-live_v0.2.png);background-repeat:no-repeat;background-position-y:-8px;background-position-x:-8px}.oracle-live-mainbutton-icon:hover{background-position-y:-50px}.oracle-live-start-in-video .oracle-live-mainbutton-icon{background-position-x:-50px}.oracle-live-start-in-video .oracle-live-mainbutton-icon:hover{background-position-y:-50px}.oracle-live-start-in-screenshare .oracle-live-mainbutton-icon{background-position-x:-134px}.oracle-live-start-in-screenshare .oracle-live-mainbutton-icon:hover{background-position-y:-50px}.oracle-live-connecting .oracle-live-mainbutton-icon,.oracle-live-transferring .oracle-live-mainbutton-icon{background-position-x:-92px}.oracle-live-connecting .oracle-live-mainbutton-icon:hover,.oracle-live-transferring .oracle-live-mainbutton-icon:hover{background-position-y:-50px}.oracle-live-connected .oracle-live-mainbutton-icon,.oracle-live-connected .oracle-live-mainbutton-icon:hover{display:none}.oracle-live-connected .oracle-live-main-button span{display:block;position:absolute;top:0;left:0;width:100%}.oracle-live-main-button img{display:none}.oracle-live-agent-image-loaded.oracle-live-connected .oracle-live-main-button{line-height:0;font-size:0}.oracle-live-agent-image-loaded.oracle-live-connected .oracle-live-main-button img,.oracle-live-agent-image-loaded.oracle-live-disconnected.oracle-live-show-dialog .oracle-live-main-button img{display:block;position:absolute;left:0;top:0;width:80px;height:80px;border-radius:50%}.oracle-live-agent-image-loaded.oracle-live-connected .oracle-live-main-button img:hover,.oracle-live-agent-image-loaded.oracle-live-paused-associate .oracle-live-main-button img,.oracle-live-agent-image-loaded.oracle-live-paused-enduser .oracle-live-main-button img,.oracle-live-agent-image-loaded.oracle-live-reconnecting-associate .oracle-live-main-button img,.oracle-live-agent-image-loaded.oracle-live-reconnecting-enduser .oracle-live-main-button img{opacity:.6}.oracle-live-main-button .oracle-live-mainbutton-badge,.oracle-live.oracle-live-disconnected .oracle-live-main-button .oracle-live-mainbutton-badge{display:none}.oracle-live-connected .oracle-live-mainbutton-badge{display:block;position:absolute;top:47px;left:47px;background-image:url(images/oracle-live_v0.2.png);background-repeat:no-repeat;background-position:-70px -707px;width:16px;height:20px}.oracle-live-paused-associate .oracle-live-main-button .oracle-live-mainbutton-badge,.oracle-live-paused-enduser .oracle-live-main-button .oracle-live-mainbutton-badge,.oracle-live-reconnecting-enduser .oracle-live-main-button .oracle-live-mainbutton-badge{background-image:url(images/oracle-live_v0.2.png);background-repeat:no-repeat;background-position:-50px -746px;width:16px;height:20px;top:47px;left:47px}.oracle-live-screenshare-associate-on .oracle-live-main-button .oracle-live-mainbutton-badge,.oracle-live-screenshare-enduser-on .oracle-live-main-button .oracle-live-mainbutton-badge{background-image:url(images/oracle-live_v0.2.png);background-repeat:no-repeat;background-position:-168px -707px;width:20px;height:20px;top:48px;left:40px}.oracle-live-paused-associate.oracle-live-screenshare-associate-on .oracle-live-main-button .oracle-live-mainbutton-badge,.oracle-live-paused-associate.oracle-live-screenshare-enduser-on .oracle-live-main-button .oracle-live-mainbutton-badge,.oracle-live-paused-enduser.oracle-live-screenshare-associate-on .oracle-live-main-button .oracle-live-mainbutton-badge,.oracle-live-paused-enduser.oracle-live-screenshare-enduser-on .oracle-live-main-button .oracle-live-mainbutton-badge,.oracle-live-reconnecting-associate.oracle-live-screenshare-associate-on .oracle-live-main-button .oracle-live-mainbutton-badge,.oracle-live-reconnecting-enduser.oracle-live-screenshare-enduser-on .oracle-live-main-button .oracle-live-mainbutton-badge{background-image:url(images/oracle-live_v0.2.png);background-repeat:no-repeat;background-position:-148px -746px;width:20px;height:20px;top:48px;left:40px}.oracle-live-connected.oracle-live-video-associate-on .oracle-live-main-button .oracle-live-mainbutton-badge,.oracle-live-connected.oracle-live-video-enduser-on .oracle-live-main-button .oracle-live-mainbutton-badge{background-image:url(images/oracle-live_v0.2.png);background-repeat:no-repeat;background-position:-108px -707px;width:20px;height:20px;top:50px;left:43px}.oracle-live-paused-associate.oracle-live-video-associate-on .oracle-live-main-button .oracle-live-mainbutton-badge,.oracle-live-paused-associate.oracle-live-video-enduser-on .oracle-live-main-button .oracle-live-mainbutton-badge,.oracle-live-paused-enduser.oracle-live-video-associate-on .oracle-live-main-button .oracle-live-mainbutton-badge,.oracle-live-paused-enduser.oracle-live-video-enduser-on .oracle-live-main-button .oracle-live-mainbutton-badge,.oracle-live-reconnecting-associate.oracle-live-video-associate-on .oracle-live-main-button .oracle-live-mainbutton-badge,.oracle-live-reconnecting-enduser.oracle-live-video-enduser-on .oracle-live-main-button .oracle-live-mainbutton-badge{background-image:url(images/oracle-live_v0.2.png);background-repeat:no-repeat;background-position:-128px -746px;width:20px;height:20px;top:50px;left:43px}.oracle-live-initials{display:none}.oracle-live-connected .oracle-live-initials{display:inline}.oracle-live-connecting.oracle-live-transferring.oracle-live-disconnected .oracle-live-initials,.oracle-live-mainbutton-spinner{display:none}.oracle-live-connected.oracle-live-reconnecting-associate .oracle-live-mainbutton-spinner,.oracle-live-connected.oracle-live-reconnecting-enduser .oracle-live-mainbutton-spinner,.oracle-live-connecting .oracle-live-mainbutton-spinner,.oracle-live-transferring .oracle-live-mainbutton-spinner{display:block;position:absolute;left:-1px;top:-1px;border-radius:50%;width:80px;height:80px;border-top:3px solid #81bb5f;border-right:3px solid #81bb5f;border-bottom:3px solid #81bb5f;border-left:3px solid transparent;-ms-transform:translateZ(0);animation:c 2s infinite linear}.oracle-live-connected.oracle-live-reconnecting-associate .oracle-live-mainbutton-spinner,.oracle-live-connected.oracle-live-reconnecting-enduser .oracle-live-mainbutton-spinner,.oracle-live-connecting.oracle-live-poor-connection .oracle-live-mainbutton-spinner,.oracle-live-transferring.oracle-live-poor-connection .oracle-live-mainbutton-spinner{border-top-color:#fd9013;border-right-color:#fd9013;border-bottom-color:#fd9013}.oracle-live-connecting.oracle-live-transferring.oracle-live-disconnected .oracle-live-mainbutton-spinner{display:none}*,:after,:before{box-sizing:border-box}.oracle-live-callinfo{width:80px;background-color:#e0f0fd;color:#4d4d4d;font-weight:lighter;padding:10px;border-radius:5%;border:1px solid #c8c8c8;box-shadow:2px 2px 10px #aaa;position:fixed;right:20px;bottom:120px;display:none;z-index:9100020}.oracle-live-connected .oracle-live-callinfo{display:block;animation:a .4s ease-in 0s;animation-fill-mode:forwards}.oracle-live-collapsed .oracle-live-callinfo{animation:b .4s ease-in 0s;animation-fill-mode:forwards}.oracle-live-callinfo div{border-bottom:1px solid #c8c8c8;padding:0;margin:0;height:13pt}.oracle-live-callinfo div:first-child{background-image:url(images/oracle-live_v0.2.png);background-repeat:no-repeat;background-position:-54px -771px;border-bottom:1px solid #c8c8c8;padding:0;margin:0 0 0 3px;height:13pt}.oracle-live-callinfo div:first-child span{font-size:12px;font-weight:400;margin:0 0 0 9px;white-space:nowrap;text-overflow:ellipsis;overflow:hidden;display:block}.oracle-live-callinfo label{display:block;font-size:10px;margin-top:5px}.oracle-live-callinfo span{display:block;font-size:18px;margin-top:2px}.oracle-live-meeting .oracle-live-callinfo,.oracle-live-screenshare-associate-on .oracle-live-callinfo,.oracle-live-video-associate-on .oracle-live-callinfo,.oracle-live-video-enduser-on .oracle-live-callinfo,.oracle-live-video-preview .oracle-live-callinfo{display:none}.oracle-live-callinfo-duration{font-size:11px}.oracle-live-callinfo [role=timer]{user-select:none}\n\n/*!\n * Copyright (c) 2019 Oracle. All rights reserved.\n *\n * This material is the confidential property of Oracle Corporation or its\n * licensors and may be used, reproduced, stored or transmitted only in\n * accordance with a valid Oracle license or sublicense agreement.\n */.oracle-live-call-queue-info{width:80px;background-color:#e0f0fd;color:#4d4d4d;font-size:12px;font-weight:lighter;padding:10px;border-radius:5%;border:1px solid #c8c8c8;box-shadow:2px 2px 10px #aaa;position:fixed;right:20px;bottom:120px;display:none;z-index:9100020}.oracle-live-waiting .oracle-live-call-queue-info{display:block}.oracle-live-waiting .oracle-live-video-panel-enduser .oracle-live-call-queue-info{display:block;border:unset;box-shadow:unset;right:110px;bottom:210px;width:165px;background-color:transparent;font-size:18px;color:#fff}.oracle-live-call-queue-info.oracle-live-hide-queue-info,.oracle-live-meeting .oracle-live-video-panel-enduser .oracle-live-call-queue-info,.oracle-live-waiting .oracle-live-call-queue-info.oracle-live-hide-queue-info,.oracle-live-waiting .oracle-live-video-panel-enduser .oracle-live-call-queue-info.oracle-live-hide-queue-info{display:none}.oracle-live-waiting.oracle-live-video-enduser-maximized .oracle-live-video-panel-enduser .oracle-live-call-queue-info{right:calc(50vw - 100px);bottom:calc(50vh - 90px)}.oracle-live-call-queue-info label{display:block;font-size:12px;font-weight:lighter;margin-top:5px;word-wrap:break-word}.oracle-live-video-panel-enduser .oracle-live-call-queue-info label{font-size:18px}.oracle-live-call-queue-info span{font-size:18px;margin-top:2px;font-weight:lighter}.oracle-live-video-panel-enduser .oracle-live-call-queue-info span{margin-left:55px;font-weight:700}.oracle-live-meeting .oracle-live-call-queue-info,.oracle-live-screenshare-associate-on .oracle-live-call-queue-info,.oracle-live-video-associate-on .oracle-live-call-queue-info,.oracle-live-video-enduser-on .oracle-live-call-queue-info,.oracle-live-video-preview .oracle-live-call-queue-info{display:none}.oracle-live-dialog{display:none;position:fixed;right:20px;bottom:115px;max-width:240px;background-color:#fff;color:#4d4d4d;border-radius:4px;font-size:14px;padding:16px;border:1px solid #b3b3b3;box-shadow:2px 2px 10px #aaa;z-index:9200000}.oracle-live-preCallIDCheck-call-associate.oracle-live-precall-dialog .oracle-live-dialog{z-index:9300010}.oracle-live-preCallIDCheck-call-associate.oracle-live-disconnected.oracle-live-show-dialog .oracle-live-dialog{display:none}.oracle-live-show-dialog .oracle-live-dialog{display:block}.oracle-live-meeting.oracle-live-disconnected.oracle-live-show-dialog .oracle-live-dialog{display:none}.oracle-live-meeting.oracle-live-disconnected.oracle-live-show-dialog.oracle-live-feedback .oracle-live-dialog{display:block}.oracle-live-meeting .oracle-live-dialog,.oracle-live-screenshare-associate-maximized .oracle-live-dialog,.oracle-live-video-associate-maximized .oracle-live-dialog,.oracle-live-video-enduser-maximized .oracle-live-dialog{left:50%;transform:translate(-50%);bottom:100px}.oracle-live-dialog-title{font-weight:700;text-align:center;padding-bottom:16px}.oracle-live-dialog-message{text-align:center}.oracle-live-dialog-buttons{text-align:right;margin-top:25px}.oracle-live-dialog .oracle-live-dialog-ok[role=button]{margin-left:8px}.oracle-live-installing-plugin .oracle-live-dialog-ok[role=button]{display:none}.oracle-live-dialog .oracle-live-dialog-cancel[role=button]{border:1px solid #0c7db9;background-color:#fff;color:#0c7db9;display:none}.oracle-live-dialog .oracle-live-dialog-cancel[role=button]:hover{background-color:#e0f0fd;border-color:#2183b8;color:#2183b8}.oracle-live-disconnected.oracle-live-feedback .oracle-live-dialog-cancel[role=button],.oracle-live-disconnecting .oracle-live-dialog-cancel[role=button],.oracle-live-install-plugin-request .oracle-live-dialog-cancel[role=button],.oracle-live-installed-plugin .oracle-live-dialog-cancel[role=button],.oracle-live-installing-plugin .oracle-live-dialog-cancel[role=button],.oracle-live-precall-dialog .oracle-live-dialog-cancel[role=button],.oracle-live-share-media-request .oracle-live-dialog-cancel[role=button],.oracle-live-unfreeze-annotation .oracle-live-dialog-cancel[role=button]{display:inline-block}.oracle-live-dialog-feedback{display:none}.oracle-live-disconnected.oracle-live-feedback .oracle-live-dialog-feedback{display:block;margin:25px 0}.oracle-live-dialog-question{text-align:center}.oracle-live-dialog-options{margin-top:25px}.oracle-live-dialog-options [role=radio]{display:inline-block;border-right:1px solid #c8c8c8;width:30%;text-align:center}.oracle-live-label-ellipsis{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.oracle-live-dialog-cancel.oracle-live-label-ellipsis,.oracle-live-dialog-ok.oracle-live-label-ellipsis{max-width:40%;padding-left:4px;padding-right:4px}.oracle-live-dialog-options .oracle-live-dialog-option-excellent{border-right:none}.oracle-live-dialog-options label{font-size:13px;color:#4d4d4d;text-align:center}.oracle-live-dialog-options [role=presentation]{width:32px;height:32px;background-image:url(images/oracle-live_v0.2.png);background-repeat:no-repeat;background-position-x:-9px;background-position-y:-293px;margin:0 auto 11px}.oracle-live-dialog-options .oracle-live-dialog-option-poor:hover [role=presentation],.oracle-live-quality-poor .oracle-live-dialog-option-poor [role=presentation]{background-position-y:-327px}.oracle-live-dialog-options .oracle-live-dialog-option-good [role=presentation]{background-position-x:-77px}.oracle-live-dialog-options .oracle-live-dialog-option-good:hover [role=presentation],.oracle-live-quality-good .oracle-live-dialog-option-good [role=presentation]{background-position-y:-327px}.oracle-live-dialog-options .oracle-live-dialog-option-excellent [role=presentation]{background-position-x:-43px}.oracle-live-dialog-options .oracle-live-dialog-option-excellent:hover [role=presentation],.oracle-live-quality-excellent .oracle-live-dialog-option-excellent [role=presentation]{background-position-y:-327px}.oracle-live-notificationmessage{display:none;position:fixed;top:50px;left:50%;transform:translate(-50%);-ms-transform:translate(-50%);color:#4d4d4d;background-color:#ecffeb;border-color:#07f400;border-radius:4px;font-size:14px;padding:16px 40px 16px 58px;max-width:50%;border-width:0 0 2px;border-style:solid;box-shadow:2px 2px 10px #aaa}.oracle-live-connected.oracle-live-notification-show .oracle-live-notificationmessage{display:block;z-index:9200000;animation:b 2s ease-in 3s;animation-fill-mode:forwards}.oracle-live-notification-close.oracle-live .oracle-live-notificationmessage{display:none}.oracle-live-annotation-associate-on .oracle-live-notificationmessage,.oracle-live-paused-enduser .oracle-live-notificationmessage{background-color:#e0f0fd;border-color:#0c7db9}.oracle-live-paused-associate .oracle-live-notificationmessage,.oracle-live-poor-connection .oracle-live-notificationmessage,.oracle-live-reconnecting-associate .oracle-live-notificationmessage,.oracle-live-reconnecting-enduser .oracle-live-notificationmessage{background-color:#fffbeb;border-color:#f4cb00}.oracle-live-notificationmessage div[role=button],.oracle-live-notificationmessage span{position:fixed;background-repeat:no-repeat;background-position:50%;border-radius:50%;height:27px;width:27px;display:block}.oracle-live-notificationmessage span{top:50%;transform:translateY(-50%);left:16px;background-image:url(images/oracle-live_v0.2.png);background-repeat:no-repeat;background-position:-30px -529px;height:20px;width:20px}.oracle-live-annotation-associate-on .oracle-live-notificationmessage span,.oracle-live-paused-enduser .oracle-live-notificationmessage span{background-position:-9px -529px}.oracle-live-paused-associate .oracle-live-notificationmessage span,.oracle-live-poor-connection .oracle-live-notificationmessage span,.oracle-live-reconnecting-associate .oracle-live-notificationmessage span,.oracle-live-reconnecting-enduser .oracle-live-notificationmessage span{background-position:-51px -529px}.oracle-live-notificationmessage div[role=button]{background-image:url(images/oracle-live_v0.2.png);background-repeat:no-repeat;background-position:-8px -847px;background-color:transparent;border:none;top:15px;right:6px;margin:0}.oracle-live-notificationmessage div[role=button]:hover{background-color:#c8c8c8;border:none}.oracle-live-popmessage{position:fixed;right:112px;bottom:60px;transform:translateY(50%);-ms-transform:translateY(50%);background-color:#0c7db9;color:#fff;box-shadow:2px 2px 10px #aaa;font-weight:400;font-size:14px;max-width:200px;border-radius:20px;padding:10px;z-index:9100050}.oracle-live-connected .oracle-live-popmessage,.oracle-live-disconnected .oracle-live-popmessage,.oracle-live-meeting .oracle-live-popmessage,.oracle-live-preCallIDCheck-enabled .oracle-live-popmessage,.oracle-live-video-preview .oracle-live-popmessage{display:none}.oracle-live-connecting.oracle-live-transferring.oracle-live-video-preview .oracle-live-popmessage{display:block}.oracle-live-connecting.oracle-live-video-enduser-maximized .oracle-live-popmessage,.oracle-live-meeting .oracle-live-popmessage,.oracle-live-popmessage-shortcode,.oracle-live-screenshare-associate-maximized .oracle-live-popmessage,.oracle-live-transferring.oracle-live-video-enduser-maximized .oracle-live-popmessage,.oracle-live-video-associate-maximized .oracle-live-popmessage,.oracle-live-video-enduser-maximized .oracle-live-popmessage{display:none}.oracle-live-connecting.oracle-live-shortcode .oracle-live-popmessage-shortcode{padding-top:1em;display:block}.oracle-live-video-panel{display:none;height:262px;width:350px;position:fixed;right:20px;bottom:120px;font-weight:lighter;overflow:hidden;background-color:#000;color:#fff;box-shadow:2px 2px 10px #aaa}@media screen and (max-width:399px){.oracle-live-video-panel{height:calc((100vw - 40px) * 3 / 4);width:calc(100vw - 40px)}}.oracle-live-screenshare-panel-associate{z-index:9099960}.oracle-live-video-panel-associate{z-index:9099970}.oracle-live-video-panel-enduser{z-index:9099980}.oracle-live.oracle-live-connected.oracle-live-collapsed .oracle-live-video-panel,.oracle-live.oracle-live-connected.oracle-live-video-hide .oracle-live-video-panel,.oracle-live.oracle-live-connected.oracle-live-video-local-hide .oracle-live-video-panel-enduser{animation:b .4s ease-in 0s;animation-fill-mode:forwards}.oracle-live-connected.oracle-live-screenshare-associate-on .oracle-live-screenshare-panel-associate,.oracle-live-connected.oracle-live-video-associate-on .oracle-live-video-panel-associate,.oracle-live-connected.oracle-live-video-enduser-on .oracle-live-video-panel-enduser,.oracle-live-connecting.oracle-live-video-enduser-on .oracle-live-video-panel-enduser,.oracle-live-transferring.oracle-live-video-enduser-on .oracle-live-video-panel-enduser,.oracle-live-video-preview .oracle-live-video-panel-enduser{display:block;animation:a .4s ease-in 0s;animation-fill-mode:forwards}@keyframes a{0%{opacity:0}to{opacity:1}}.oracle-live-screenshare-associate-on.oracle-live-video-enduser-on .oracle-live-video-panel-enduser,.oracle-live-video-associate-on.oracle-live-video-enduser-on .oracle-live-video-panel-enduser{height:74px;width:98px;z-index:9100010;right:262px;bottom:130px;box-shadow:none}.oracle-live-video-associate-maximized .oracle-live-video-panel-associate,.oracle-live-video-enduser-maximized.oracle-live-video-enduser-on .oracle-live-video-panel.oracle-live-video-panel-enduser,.oracle-live-video-enduser-maximized.oracle-live-video-preview .oracle-live-video-panel.oracle-live-video-panel-enduser,.oracle-live.oracle-live-connected.oracle-live-screenshare-associate-maximized .oracle-live-screenshare-panel-associate{display:block;z-index:9099900;right:0;top:0;width:100%;height:100%;color:#4d4d4d}.oracle-live-meeting.oracle-live-video-associate-maximized.oracle-live-video-preview .oracle-live-video-panel-enduser{z-index:9099910;right:0;top:44px;width:100%;height:100%;color:#4d4d4d;animation:none}.oracle-live-meeting.oracle-live-video-enduser-maximized.oracle-live-video-preview .oracle-live-video-panel-enduser{animation:none}.oracle-live-meeting.oracle-live-video-associate-maximized.oracle-live-video-preview .oracle-live-video-panel-enduser video{object-fit:contain;height:89%}.oracle-live-meeting.oracle-live-video-associate-maximized.oracle-live-video-preview .oracle-live-video-panel-enduser>div{display:none}.oracle-live-meeting.oracle-live-video-associate-maximized.oracle-live-video-preview .oracle-live-video-panel-enduser .oracle-live-video-buttons-preview{display:block}.oracle-live-screenshare-associate-on.oracle-live-video-associate-on .oracle-live-screenshare-panel-associate{right:382px}.oracle-live-screenshare-associate-on.oracle-live-video-enduser-on.oracle-live-paused-associate .oracle-live-video-panel-enduser,.oracle-live-screenshare-associate-on.oracle-live-video-enduser-on.oracle-live-paused-enduser .oracle-live-video-panel-enduser,.oracle-live-video-associate-on.oracle-live-video-enduser-on.oracle-live-paused-associate .oracle-live-video-panel-enduser,.oracle-live-video-associate-on.oracle-live-video-enduser-on.oracle-live-paused-enduser .oracle-live-video-panel-enduser{display:none}.oracle-live-screenshare-associate-on.oracle-live-video-enduser-on.oracle-live-paused-associate.oracle-live-annotation-associate-video-on .oracle-live-video-panel-enduser,.oracle-live-screenshare-associate-on.oracle-live-video-enduser-on.oracle-live-paused-associate.oracle-live-frozen-annotation .oracle-live-video-panel-enduser,.oracle-live-screenshare-associate-on.oracle-live-video-enduser-on.oracle-live-paused-enduser.oracle-live-annotation-associate-video-on .oracle-live-video-panel-enduser,.oracle-live-screenshare-associate-on.oracle-live-video-enduser-on.oracle-live-paused-enduser.oracle-live-frozen-annotation .oracle-live-video-panel-enduser,.oracle-live-video-associate-on.oracle-live-video-enduser-on.oracle-live-paused-associate.oracle-live-annotation-associate-video-on .oracle-live-video-panel-enduser,.oracle-live-video-associate-on.oracle-live-video-enduser-on.oracle-live-paused-associate.oracle-live-frozen-annotation .oracle-live-video-panel-enduser,.oracle-live-video-associate-on.oracle-live-video-enduser-on.oracle-live-paused-enduser.oracle-live-annotation-associate-video-on .oracle-live-video-panel-enduser,.oracle-live-video-associate-on.oracle-live-video-enduser-on.oracle-live-paused-enduser.oracle-live-frozen-annotation .oracle-live-video-panel-enduser{display:block}.oracle-live-screenshare-associate-maximized.oracle-live-video-enduser-on .oracle-live-video-panel-enduser,.oracle-live-video-associate-maximized.oracle-live-video-enduser-on .oracle-live-video-panel-enduser,.oracle-live-video-associate-maximized.oracle-live-video-preview .oracle-live-video-panel-enduser{height:149px;width:200px;right:12px;top:56px}.oracle-live-screenshare-associate-maximized.oracle-live-video-enduser-on .oracle-live-video-panel-associate,.oracle-live-video-enduser-maximized.oracle-live-video-associate-on.oracle-live-video-enduser-on .oracle-live-video-panel-associate{display:block;height:149px;width:200px;right:12px;top:56px;box-shadow:none}.oracle-live-screenshare-associate-maximized.oracle-live-video-associate-on .oracle-live-video-panel-associate,.oracle-live-video-associate-maximized.oracle-live-screenshare-associate-on .oracle-live-screenshare-panel-associate,.oracle-live-video-enduser-maximized.oracle-live-screenshare-associate-on .oracle-live-screenshare-panel-associate{height:194px;width:257px;right:12px;top:56px}.oracle-live-screenshare-associate-maximized.oracle-live-video-associate-on.oracle-live-video-enduser-on .oracle-live-video-panel-enduser,.oracle-live-video-associate-maximized.oracle-live-screenshare-associate-on.oracle-live-video-enduser-on .oracle-live-video-panel-enduser,.oracle-live-video-enduser-maximized.oracle-live-screenshare-associate-on.oracle-live-video-associate-on .oracle-live-video-panel-associate{height:74px;width:98px;right:161px;top:166px}.oracle-live-video-enduser-maximized.oracle-live-screenshare-associate-on.oracle-live-video-associate-on .oracle-live-video-associate-name{display:none}.oracle-live-screenshare-associate-maximized.oracle-live-screenshare-associate-on .oracle-live-video-panel-associate{top:50px;right:12px}.oracle-live-meeting.oracle-live-video-enduser-maximized.oracle-live-video-preview .oracle-live-video-panel-enduser video,.oracle-live-video-panel video{height:100%;width:100%;object-fit:contain;position:relative}.oracle-live-screenshare-associate-maximized .oracle-live-screenshare-panel-associate video,.oracle-live-video-associate-maximized .oracle-live-video-panel-associate video,.oracle-live-video-enduser-maximized .oracle-live-video-panel-enduser video{object-fit:contain;top:44px;height:calc(100vh - 44px)}.oracle-live-paused-associate video,.oracle-live-paused-enduser video{display:none}.oracle-live-paused-associate.oracle-live-frozen-annotation video,.oracle-live-paused-enduser.oracle-live-frozen-annotation video{display:block;opacity:.75}.oracle-live-video-pause-graphic{background-image:url(images/mini-video-paused.svg);width:80px;height:80px;margin:-32px -40px;z-index:9999}.oracle-live-video-no-connection-graphic,.oracle-live-video-pause-graphic{display:none;background-repeat:no-repeat;position:absolute;top:50%;right:50%}.oracle-live-video-no-connection-graphic{background-image:url(images/oracle-live_v0.2.png);background-position:-62px -414px;width:26px;height:28px;margin:-14px}.oracle-live-paused-associate .oracle-live-video-pause-graphic,.oracle-live-paused-enduser .oracle-live-video-pause-graphic,.oracle-live-reconnecting-associate .oracle-live-video-no-connection-graphic,.oracle-live-reconnecting-enduser .oracle-live-video-no-connection-graphic{display:inline-block}.oracle-live-reconnecting-associate .oracle-live-screenshare-panel-associate video,.oracle-live-reconnecting-associate .oracle-live-video-panel-associate video,.oracle-live-reconnecting-enduser video{display:none}.oracle-live-video-panel-message{display:none;font-size:12px;position:absolute;top:50%;left:50%;transform:translate(-50%,14px);color:#fff}.oracle-live-meeting .oracle-live-video-panel-message{font-size:24px;line-height:22px}.oracle-live-poor-connection .oracle-live-screenshare-panel-associate .oracle-live-video-panel-message,.oracle-live-poor-connection .oracle-live-video-panel-associate .oracle-live-video-panel-message,.oracle-live-poor-connection .oracle-live-video-panel-enduser .oracle-live-video-panel-message,.oracle-live-reconnecting-associate .oracle-live-screenshare-panel-associate .oracle-live-video-panel-message,.oracle-live-reconnecting-associate .oracle-live-video-panel-associate .oracle-live-video-panel-message,.oracle-live-reconnecting-enduser .oracle-live-video-panel-message{display:block}.oracle-live-poor-connection.oracle-live-screenshare-associate-on .oracle-live-video-panel-enduser .oracle-live-video-panel-message,.oracle-live-poor-connection.oracle-live-video-associate-on .oracle-live-video-panel-enduser .oracle-live-video-panel-message,.oracle-live-reconnecting-enduser.oracle-live-screenshare-associate-on .oracle-live-video-panel-enduser .oracle-live-video-panel-message,.oracle-live-reconnecting-enduser.oracle-live-video-associate-on .oracle-live-video-panel-enduser .oracle-live-video-panel-message{display:none}.oracle-live-video-panel [role=presentation]{position:absolute;left:0;width:100%;height:22px}.oracle-live-video-panel video+[role=presentation],.oracle-live-video-scroller+[role=presentation]{top:0;background:linear-gradient(rgba(0,0,0,.8),transparent)}.oracle-live-video-panel [role=presentation]+[role=presentation]{bottom:0;background:linear-gradient(transparent,rgba(0,0,0,.8))}.oracle-live-screenshare-associate-on.oracle-live-video-enduser-on .oracle-live-video-panel-enduser [role=presentation],.oracle-live-video-associate-on.oracle-live-video-enduser-on .oracle-live-video-panel-enduser [role=presentation]{height:22px}.oracle-live-screenshare-associate-maximized .oracle-live-screenshare-panel-associate [role=presentation],.oracle-live-video-associate-maximized .oracle-live-video-panel-associate [role=presentation],.oracle-live-video-enduser-maximized .oracle-live-video-panel-enduser [role=presentation]{display:none}.oracle-live-video-buttons-preview{display:none;position:relative;bottom:50px;left:50%;transform:translate(-50%);text-align:center}.oracle-live-connecting .oracle-live-video-panel-enduser>div,.oracle-live-transferring .oracle-live-video-panel-enduser>div,.oracle-live-video-preview .oracle-live-video-panel-enduser>div{display:none}.oracle-live-connecting .oracle-live-video-panel-enduser>[role=presentation],.oracle-live-transferring .oracle-live-video-panel-enduser>[role=presentation],.oracle-live-video-preview .oracle-live-video-panel-enduser .oracle-live-video-buttons-preview,.oracle-live-video-preview .oracle-live-video-panel-enduser>[role=presentation]{display:block}.oracle-live-video-preview .oracle-live-video-panel-enduser [role=heading]{display:block;font-weight:400}.oracle-live-connecting .oracle-live-video-panel-enduser [role=heading],.oracle-live-connecting .oracle-live-video-panel-enduser div[role=toolbar],.oracle-live-transferring .oracle-live-video-panel-enduser [role=heading],.oracle-live-transferring .oracle-live-video-panel-enduser div[role=toolbar],.oracle-live-video-preview .oracle-live-video-panel-enduser div[role=toolbar]{display:block}.oracle-live.oracle-live-videopanel-toolbars-hidden .oracle-live-video-panel div:not(.oracle-live-video-scroller){animation:b .4s ease-in 0s;animation-fill-mode:forwards}@keyframes b{0%{opacity:1}to{opacity:0}}.oracle-live.oracle-live-videopanel-toolbars-hidden .oracle-live-video-panel .oracle-live-video-buttons-preview{animation:none}.oracle-live-video-panel .oracle-live-video-buttons-preview [role=button]{background-color:#0c7db9;color:#fff;text-align:center;line-height:30px;height:30px;border-radius:22px;margin:0;width:100px;max-width:100px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;flex-wrap:nowrap;padding-left:10px;padding-right:10px}.oracle-live-video-panel .oracle-live-video-buttons-preview>[role=button]{margin-left:8px}.oracle-live-video-scroller{position:absolute;top:0;left:0;width:100%;height:100%}.oracle-live-screenshare-associate-maximized .oracle-live-video-scroller{overflow:scroll}.oracle-live-video-buttons-zoom{display:none;color:#fff;font-size:10px;line-height:24px;text-align:center;width:45px}.oracle-live-screenshare-associate-maximized .oracle-live-video-buttons-zoom{display:block;position:absolute;right:10px;bottom:50px;z-index:9099990;background-color:#e0f0fd;border-radius:100px;box-shadow:2px 2px 10px #aaa}.oracle-live-video-zoomin-button[role=button],.oracle-live-video-zoomout-button[role=button]{font-size:24px}.oracle-live-video-panel [role=heading]{display:none;position:absolute;top:10px;font-size:14px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;transform:translate(0);left:30px;width:calc(100% - 170px);text-align:center}.oracle-live-connected.oracle-live-video-associate-maximized .oracle-live-video-panel-associate [role=heading],.oracle-live-video-enduser-maximized .oracle-live-video-panel-enduser [role=heading]{display:block}.oracle-live.oracle-live-videopanel-topbar-toolbar-hidden .oracle-live-video-panel-enduser [role=heading]{display:none}.oracle-live-meeting.oracle-live-connected.oracle-live-screenshare-associate-maximized .oracle-live-screenshare-panel-associate .oracle-live-video-associate-maximized-title,.oracle-live-meeting.oracle-live-connected.oracle-live-video-associate-maximized .oracle-live-video-panel-associate .oracle-live-video-associate-maximized-title,.oracle-live-meeting.oracle-live-connected.oracle-live-video-enduser-maximized .oracle-live-video-panel-enduser .oracle-live-video-associate-maximized-title{font-size:18px;font-weight:400;display:block}.oracle-live-meeting.oracle-live-video-associate-maximized.oracle-live-video-preview .oracle-live-video-panel-enduser .oracle-live-video-associate-maximized-title{display:none}.oracle-live-video-panel [role=toolbar]{display:block;width:100%;height:30px;position:absolute;top:0;left:0;z-index:9099990}.oracle-live-screenshare-associate-on.oracle-live-video-enduser-on .oracle-live-video-panel-enduser [role=toolbar],.oracle-live-video-associate-on.oracle-live-video-enduser-on .oracle-live-video-panel-enduser [role=toolbar]{display:block}.oracle-live-screenshare-associate-maximized .oracle-live-screenshare-panel-associate [role=toolbar],.oracle-live-video-associate-maximized .oracle-live-video-panel-associate [role=toolbar],.oracle-live-video-enduser-maximized .oracle-live-video-panel-enduser [role=toolbar],.oracle-live-video-preview.oracle-live-video-enduser-maximized .oracle-live-video-panel-enduser [role=toolbar]{background-color:#e0f0fd;height:44px}.oracle-live-video-enduser-maximized.oracle-live-annotation-associate-video-on .oracle-live-video-panel-enduser .oracle-live-video-toolbar-enduser-unfreeze [role=toolbar],.oracle-live-video-enduser-maximized.oracle-live-frozen-annotation .oracle-live-video-panel-enduser .oracle-live-video-toolbar-enduser-unfreeze [role=toolbar]{background-color:transparent}.oracle-live-video-panel [role=button]{background-color:transparent;margin:0;padding:0;display:inline-block;width:32px;height:32px;background-position:50%;background-repeat:no-repeat;border:none;border-radius:0}.oracle-live-video-panel .oracle-live-video-hide[role=button]{display:none}.oracle-live-video-maximize[role=button]{float:left;background-position:-6px -1036px;margin:6px}.oracle-live-swap-camera[role=button],.oracle-live-video-maximize[role=button]{background-image:url(images/oracle-live_v0.2.png);background-repeat:no-repeat;height:20px;width:20px}.oracle-live-swap-camera[role=button]{background-position:-40px -1036px;position:absolute;top:8px;right:5px;float:right}.oracle-live-unfreeze-annotation-camera[role=button]{background-position:-8px -1216px;opacity:.5}.oracle-live-unfreeze-annotation-camera[role=button],.oracle-live-unfreeze-annotation-cross[role=button]{background-image:url(images/oracle-live_v0.2.png);background-repeat:no-repeat;float:left;height:28px;width:28px;margin:6px}.oracle-live-unfreeze-annotation-cross[role=button]{background-position:-36px -1216px}.oracle-live-screenshare-associate-maximized .oracle-live-screenshare-panel-associate .oracle-live-video-maximize[role=button],.oracle-live-video-associate-maximized .oracle-live-video-panel-associate .oracle-live-video-maximize[role=button],.oracle-live-video-enduser-maximized .oracle-live-video-panel-enduser .oracle-live-video-maximize[role=button]{background-position:-23px -968px}.oracle-live-video-associate-maximized .oracle-live-video-panel-associate .oracle-live-swap-camera[role=button],.oracle-live-video-enduser-maximized .oracle-live-video-panel-enduser .oracle-live-swap-camera[role=button]{background-position:-40px -968px}.oracle-live-meeting .oracle-live-video-maximize[role=button][name=associateScreenShare],.oracle-live-meeting .oracle-live-video-maximize[role=button][name=associateVideo]{display:block}.oracle-live-annotation-associate-video-on .oracle-live-swap-camera[role=button],.oracle-live-frozen-annotation .oracle-live-swap-camera[role=button],.oracle-live-meeting.oracle-live-screenshare-associate-maximized .oracle-live-video-maximize[role=button][name=associateScreenShare],.oracle-live-meeting.oracle-live-video-associate-maximized .oracle-live-video-maximize[role=button][name=associateVideo],.oracle-live-meeting.oracle-live-video-enduser-maximized .oracle-live-video-maximize[role=button][name=endUserVideo],.oracle-live-video-panel-associate .oracle-live-swap-camera[role=button]{display:none}.oracle-live-connected.oracle-live-meeting.oracle-live-video-preview .oracle-live-video-panel-associate .oracle-live-swap-camera[role=button]{display:block}.oracle-live-swap-camera[role=button].oracle-live-hide-camera-swap-button,.oracle-live-video-panel.oracle-live-screenshare-panel-enduser .oracle-live-local-screenshare{display:none}.oracle-live-video-closeall[role=button]{background-image:url(images/oracle-live_v0.2.png);background-repeat:no-repeat;background-position:-225px -720px;background-color:transparent;float:right}.oracle-live-connecting .oracle-live-video-closeall[role=button],.oracle-live-transferring .oracle-live-video-closeall[role=button],.oracle-live-video-preview .oracle-live-video-closeall[role=button]{display:none}.oracle-live-video-closelocal[role=button]{display:none;background-image:url(images/oracle-live_v0.2.png);background-repeat:no-repeat;background-position:-78px -1038px;height:16px;width:15px;position:absolute;top:5px;right:5px}.oracle-live-screenshare-associate-on.oracle-live-video-enduser-on .oracle-live-video-closelocal[role=button],.oracle-live-video-associate-on.oracle-live-video-enduser-on .oracle-live-video-closelocal[role=button]{display:block}.oracle-live-screenshare-associate-maximized.oracle-live-screenshare-associate-on .oracle-live-video-closelocal[role=button],.oracle-live-video-associate-maximized.oracle-live-video-associate-on .oracle-live-video-closelocal[role=button]{display:none}.oracle-live-video-panel .oracle-live-recording{position:absolute;top:10px;right:35px;line-height:14px;vertical-align:middle}.oracle-live-screenshare-associate-maximized .oracle-live-video-panel-associate .oracle-live-recording,.oracle-live-screenshare-associate-maximized .oracle-live-video-panel-enduser .oracle-live-recording,.oracle-live-video-associate-maximized .oracle-live-screenshare-panel-associate .oracle-live-recording,.oracle-live-video-associate-maximized .oracle-live-video-panel-enduser .oracle-live-recording,.oracle-live-video-enduser-maximized .oracle-live-screenshare-panel-associate .oracle-live-recording,.oracle-live-video-enduser-maximized .oracle-live-video-panel-associate .oracle-live-recording,.oracle-live-video-panel.oracle-live-video-panel-enduser .oracle-live-video-associate-name,.oracle-live-video-panel.oracle-live-video-screenshare-panel-associate .oracle-live-video-associate-name{display:none}.oracle-live-screenshare-associate-maximized .oracle-live-screenshare-panel-associate .oracle-live-recording-on,.oracle-live-video-associate-maximized .oracle-live-video-panel-associate .oracle-live-recording-on,.oracle-live-video-enduser-maximized .oracle-live-video-panel-enduser .oracle-live-recording-on{top:12px;right:11px;font-size:14px;display:block}.oracle-live-screenshare-associate-on.oracle-live-video-enduser-on:not(.oracle-live-video-enduser-maximized) .oracle-live-video-panel-enduser [role=recindicator],.oracle-live-video-associate-on.oracle-live-video-enduser-on:not(.oracle-live-video-enduser-maximized) .oracle-live-video-panel-enduser [role=recindicator]{display:none}.oracle-live-video-panel [role=timer]{position:absolute;top:10px;left:50%;transform:translate(-50%);font-size:14px;display:block}.oracle-live-screenshare-associate-maximized .oracle-live-screenshare-panel-associate [role=timer],.oracle-live-video-associate-maximized .oracle-live-video-panel-associate [role=timer],.oracle-live-video-enduser-maximized .oracle-live-video-panel-enduser [role=timer]{top:12px;left:100%;transform:translate(-120px)}.oracle-live-screenshare-associate-maximized .oracle-live-video-closeall[role=button],.oracle-live-screenshare-associate-maximized .oracle-live-video-panel-associate [role=timer],.oracle-live-screenshare-associate-maximized .oracle-live-video-panel-enduser [role=timer],.oracle-live-screenshare-associate-on.oracle-live-video-enduser-on:not(.oracle-live-video-enduser-maximized) .oracle-live-video-panel-enduser [role=timer],.oracle-live-start-in-video.oracle-live-video-preview .oracle-live-video-panel-enduser [role=timer],.oracle-live-video-associate-maximized .oracle-live-screenshare-panel-associate [role=timer],.oracle-live-video-associate-maximized .oracle-live-video-closeall[role=button],.oracle-live-video-associate-maximized .oracle-live-video-panel-enduser [role=timer],.oracle-live-video-associate-on.oracle-live-video-enduser-on:not(.oracle-live-video-enduser-maximized) .oracle-live-video-panel-enduser [role=timer],.oracle-live-video-enduser-maximized .oracle-live-screenshare-panel-associate [role=timer],.oracle-live-video-enduser-maximized .oracle-live-video-closeall[role=button],.oracle-live-video-enduser-maximized .oracle-live-video-panel-associate [role=timer],.oracle-live-video-preview .oracle-live-video-panel [role=timer],.oracle-live.oracle-live-connecting .oracle-live-video-panel-enduser [role=timer],.oracle-live.oracle-live-transferring .oracle-live-video-panel-enduser [role=timer],.oracle-live.oracle-live-waiting .oracle-live-video-panel-enduser [role=timer],:not(.oracle-live-annotation-associate-video-on) .oracle-live-unfreeze-annotation-cross,:not(.oracle-live-frozen-annotation) .oracle-live-unfreeze-annotation-camera,:not(.oracle-live-frozen-annotation) .oracle-live-unfreeze-annotation-cross{display:none}.oracle-live-annotation-associate-video-on .oracle-live-unfreeze-annotation-cross,.oracle-live-frozen-annotation .oracle-live-unfreeze-annotation-cross{position:absolute;right:11px;display:block}.oracle-live-frozen-annotation .oracle-live-unfreeze-annotation-camera{display:block}.oracle-live-annotation-associate-video-on.oracle-live-video-enduser-maximized.oracle-live-video-associate-on.oracle-live-video-enduser-on .oracle-live-video-panel-associate,.oracle-live-frozen-annotation.oracle-live-video-enduser-maximized.oracle-live-video-associate-on.oracle-live-video-enduser-on .oracle-live-video-panel-associate,.oracle-live-paused-associate.oracle-live-annotation-associate-video-on .oracle-live-unfreeze-annotation-cross,.oracle-live-paused-associate.oracle-live-frozen-annotation .oracle-live-unfreeze-annotation-camera,.oracle-live-paused-associate.oracle-live-frozen-annotation .oracle-live-unfreeze-annotation-cross,.oracle-live-paused-enduser.oracle-live-annotation-associate-video-on .oracle-live-unfreeze-annotation-cross,.oracle-live-paused-enduser.oracle-live-frozen-annotation .oracle-live-unfreeze-annotation-camera,.oracle-live-paused-enduser.oracle-live-frozen-annotation .oracle-live-unfreeze-annotation-cross{display:none}.oracle-live-annotation-associate-video-on.oracle-live-video-enduser-maximized .oracle-live-video-panel-enduser .oracle-live-video-maximize,.oracle-live-frozen-annotation.oracle-live-video-enduser-maximized .oracle-live-video-panel-enduser .oracle-live-video-maximize{background-position:-23px -1053px;background-color:transparent;border-color:transparent}.oracle-live-annotation-associate-video-on .oracle-live-video-panel.oracle-live-video-panel-associate,.oracle-live-frozen-annotation .oracle-live-video-panel.oracle-live-video-panel-associate{display:none}.oracle-live-video-associate-name{font-size:14px;max-width:80%;position:absolute;left:50%;transform:translate(-50%);bottom:5px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.oracle-live-screenshare-associate-on.oracle-live-video-enduser-on .oracle-live-screenshare-panel-associate .oracle-live-video-associate-name,.oracle-live-video-associate-on.oracle-live-video-enduser-on .oracle-live-video-panel-associate .oracle-live-video-associate-name{max-width:42%;transform:translate(-20px)}.oracle-live-screenshare-associate-on.oracle-live-video-associate-on.oracle-live-video-enduser-on .oracle-live-screenshare-panel-associate .oracle-live-video-associate-name{max-width:80%;transform:translate(-50%)}.oracle-live-meeting.oracle-live-screenshare-associate-on.oracle-live-video-associate-on.oracle-live-video-enduser-on .oracle-live-screenshare-panel-associate .oracle-live-video-associate-name,.oracle-live-meeting.oracle-live-video-associate-on.oracle-live-video-enduser-on .oracle-live-video-panel-associate .oracle-live-video-associate-name,.oracle-live-screenshare-associate-maximized .oracle-live-screenshare-panel-associate .oracle-live-video-associate-name,.oracle-live-screenshare-associate-on .oracle-live-video-panel-enduser .oracle-live-video-associate-name,.oracle-live-video-associate-maximized .oracle-live-video-panel-associate .oracle-live-video-associate-name,.oracle-live-video-associate-on .oracle-live-video-panel-enduser .oracle-live-video-associate-name,.oracle-live-video-enduser-maximized .oracle-live-video-panel-enduser .oracle-live-video-associate-name{display:none}.oracle-live-video-loading-spinner{display:none;position:absolute;top:50%;left:50%;width:50px;height:50px;margin-left:-25px;margin-top:-25px;background:url(images/spinner.svg) no-repeat;animation:c 2s infinite linear}.oracle-live-video-loading .oracle-live-video-loading-spinner{display:block}\n\n/*!\n * Copyright (c) 2018 Oracle. All rights reserved.\n *\n * This material is the confidential property of Oracle Corporation or its\n * licensors and may be used, reproduced, stored or transmitted only in\n * accordance with a valid Oracle license or sublicense agreement.\n */.oracle-live-audio-panel{display:none;z-index:9099900;position:absolute;right:0;top:0;width:100%;height:100%;color:#4d4d4d;background-color:#000;background-repeat:no-repeat;background-position:50% 50%}.oracle-live-meeting .oracle-live-audio-panel{display:block}.oracle-live-connected .oracle-live-audio-panel{background-image:url(images/audioMeetingIcon.svg)}.oracle-live-connected .oracle-live-audio-panel hr{position:absolute;z-index:9100020;border-radius:50%;border:2px solid rgba(80,80,80,.7);display:inline-block;top:50%;left:50%;width:134px;height:134px;margin-top:-68px;margin-left:-68px}.oracle-live-paused-associate .oracle-live-audio-panel hr,.oracle-live-paused-enduser .oracle-live-audio-panel hr{display:none}.oracle-live-audio-panel>div:first-child{position:absolute;left:0;width:100%;height:44px;background-color:#e0f0fd}.oracle-live-audio-panel [role=heading]{display:block;position:absolute;top:10px;font-size:18px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;transform:translate(0);left:30px;width:calc(100% - 170px);text-align:center}.oracle-live-audio-panel [role=timer]{position:absolute;font-size:14px;font-weight:lighter;top:12px;left:100%;transform:translate(-120px)}.oracle-live-connecting .oracle-live-audio-panel [role=timer],.oracle-live-disconnected .oracle-live-audio-panel [role=timer],.oracle-live-transferring .oracle-live-audio-panel [role=timer],.oracle-live-waiting .oracle-live-audio-panel [role=timer]{display:none}.oracle-live-audio-panel .oracle-live-recording{position:absolute;font-weight:lighter;bottom:5px;line-height:14px;vertical-align:middle;top:12px;right:11px;font-size:14px}.oracle-live-connecting .oracle-live-audio-panel .oracle-live-recording,.oracle-live-disconnected .oracle-live-audio-panel .oracle-live-recording,.oracle-live-transferring .oracle-live-audio-panel .oracle-live-recording,.oracle-live-waiting .oracle-live-audio-panel .oracle-live-recording{display:none}.oracle-live-audio-panel-message{display:none;font-size:24px;line-height:22px;position:absolute;top:50%;left:50%;transform:translate(-50%,16px);color:#fff;text-align:center;width:60%}.oracle-live-cancelled .oracle-live-audio-panel-message,.oracle-live-connecting .oracle-live-audio-panel-message,.oracle-live-disconnected .oracle-live-audio-panel-message,.oracle-live-transferring .oracle-live-audio-panel-message,.oracle-live-waiting .oracle-live-audio-panel-message{display:inline-block}\n\n/*!\n * Copyright (c) 2019 Oracle. All rights reserved.\n *\n * This material is the confidential property of Oracle Corporation or its\n * licensors and may be used, reproduced, stored or transmitted only in\n * accordance with a valid Oracle license or sublicense agreement.\n */.oracle-live-know-your-customer{display:none;background-color:#fff;top:0;left:0;z-index:9300000}.kyc-jumio-iframe,.oracle-live-know-your-customer{position:absolute;width:100%;height:100%}.oracle-live-verification-panel{display:none;background-color:#fff;border:1px solid;border-color:#b3b3b3;z-index:9300000}.oracle-live.oracle-live-preCallIDCheck-error .oracle-live-verification-failed,.oracle-live.oracle-live-preCallIDCheck-success .oracle-live-verification-success,.oracle-live.oracle-live-preCallIDCheck-verified .oracle-live-verification-verified,.oracle-live.oracle-live-preCallIDCheck-verifying .oracle-live-verification-identity{display:block;width:100%;height:100%;position:absolute;top:0;left:0}.oracle-live.oracle-live-preCallIDCheck-enabled .oracle-live-know-your-customer{display:block;background-color:#fff}.oracle-live-verification-panel div[role=toolbar]{background-color:#f1f1f1;height:48px}.oracle-live-verification-container{width:375px;height:600px;display:inline-block;position:absolute;left:calc((100vw - 375px) / 2);top:calc((100vh - 600px) / 2)}.oracle-live-verification-close[role=button]{background-image:url(images/close-icon.png);background-repeat:no-repeat;background-color:#f1f1f1;height:16px;width:16px;border:none;border-radius:0;margin:0;left:19px;top:16px;position:relative}.oracle-live-preCallIDCheck-verified .oracle-live-verification-continue-button[role=button]{height:60px;width:342px;color:#fff;background-color:#0c7db9;border:1px solid #0c7db9;border-radius:3px;left:12px;top:130px;position:relative;text-align:center;line-height:60px;font-size:20px}.oracle-live-preCallIDCheck-success .oracle-live-verification-success-button[role=button]{top:130px}.oracle-live-preCallIDCheck-error .oracle-live-verification-try-again-button[role=button],.oracle-live-preCallIDCheck-success .oracle-live-verification-success-button[role=button]{height:60px;width:342px;color:#fff;background-color:#0c7db9;border:1px solid #0c7db9;border-radius:3px;left:12px;position:relative;text-align:center;line-height:60px;font-size:22px}.oracle-live-preCallIDCheck-error .oracle-live-verification-try-again-button[role=button]{top:160px}.oracle-live-verification-verifying-image{background-image:url(images/verifying.png)}.oracle-live-verification-almost-done-image{background-image:url(images/almost-done.png)}.oracle-live-verification-success-image{background-image:url(images/verification-complete.png)}.oracle-live-verification-failed-image{background-image:url(images/verification-failed.png)}.oracle-live-verification-identity .oracle-live-verification-image{width:197px;height:164px;top:73px;left:89px}.oracle-live-verification-verified .oracle-live-verification-image{width:196px;height:196px;top:57px;left:89px}.oracle-live-verification-success .oracle-live-verification-image{width:172px;height:196px;top:73px;left:100px}.oracle-live-verification-failed .oracle-live-verification-image{width:172px;height:196px;top:57px;left:100px}.oracle-live-verification-image{background-size:cover;position:relative}.oracle-live-verification-identity .oracle-live-verification-heading{position:relative;top:100px}.oracle-live-verification-identity .oracle-live-verification-message{position:relative;top:116px}.oracle-live-verification-verified .oracle-live-verification-heading{position:relative;top:100px}.oracle-live-verification-verified .oracle-live-verification-message{position:relative;top:116px;left:24px;width:320px;height:48px}.oracle-live-verification-success .oracle-live-verification-heading{position:relative;top:100px;font-size:28px;height:48px}.oracle-live-verification-success .oracle-live-verification-message{position:relative;top:116px;left:24px;width:320px;height:48px}.oracle-live-verification-failed .oracle-live-verification-heading{position:relative;top:100px;font-size:28px;height:48px}.oracle-live-verification-failed .oracle-live-verification-message{position:relative;top:116px;left:50px;width:265px;height:48px}.oracle-live-verification-heading{font-size:22px;font-weight:700;line-height:26px;color:#1e3948}.oracle-live-verification-heading,.oracle-live-verification-message{font-family:system-ui,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif;text-align:center}.oracle-live-verification-message{font-size:16px;line-height:22px;color:#798085}.oracle-live-verification-spinner{display:none;position:absolute;top:66%;left:50%;width:50px;height:50px;margin-left:-25px;margin-top:-25px;background:url(images/verification-spinner.svg) no-repeat;animation:c 2s infinite linear}@keyframes c{0%{transform:rotate(0deg)}to{transform:rotate(1turn)}}.oracle-live-verification-identity .oracle-live-verification-spinner{display:block}");